; /* /bitrix/js/calendar/new/calendar-core.min.js?152740167510831*/
; /* /bitrix/js/calendar/new/calendar-view.min.js?152740167596240*/
; /* /bitrix/js/calendar/new/calendar-view-transition.min.js?152740167518480*/
; /* /bitrix/js/calendar/new/calendar-entry.min.js?152740167515879*/
; /* /bitrix/js/calendar/new/calendar-section.min.js?15274016757931*/
; /* /bitrix/js/calendar/new/calendar-controls.min.js?152740167532174*/
; /* /bitrix/js/calendar/new/calendar-dialogs.min.js?15274016756537*/
; /* /bitrix/js/calendar/new/calendar-simple-popup.min.js?152740167525599*/
; /* /bitrix/js/calendar/new/calendar-simple-view-popup.min.js?152740167511154*/
; /* /bitrix/js/calendar/new/calendar-section-slider.min.js?152740167535256*/
; /* /bitrix/js/calendar/new/calendar-settings-slider.min.js?152740167510158*/
; /* /bitrix/js/calendar/new/calendar-edit-entry-slider.min.js?152740167535751*/
; /* /bitrix/js/calendar/new/calendar-view-entry-slider.min.js?152740167510187*/
; /* /bitrix/js/calendar/new/calendar-sync-slider.min.js?152740167522952*/
; /* /bitrix/js/calendar/new/calendar-util.min.js?152740167517027*/
; /* /bitrix/js/calendar/new/calendar-search.min.js?15274016753418*/

; /* Start:"a:4:{s:4:"full";s:60:"/bitrix/js/calendar/new/calendar-core.min.js?152740167510831";s:6:"source";s:40:"/bitrix/js/calendar/new/calendar-core.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
(function(e){function t(t,i,n){this.id=t.id;this.showTasks=t.showTasks;this.calDavConnections=t.connections;this.util=new e.BXEventCalendar.Util(this,t,n);if(this.util.isFilterEnabled()){this.search=new e.BXEventCalendar.Search(this,{filterId:t.filterId,counters:t.counters})}this.sectionController=new e.BXEventCalendar.SectionController(this,i,t);this.entryController=new e.BXEventCalendar.EntryController(this,i);this.section=new e.BXEventCalendar.Section(this,i);this.currentViewName=this.util.getUserOption("view");this.requests={};this.currentUser=t.user;this.ownerUser=t.ownerUser||false;this.viewRangeDate=new Date;this.keyHandlerEnabled=true;this.allowMeetings=true;this.build();if(t.startupEvent){this.showStartUpEntry(t.startupEvent)}if(t.showNewEventDialog&&!this.util.readOnlyMode()&&this.entryController.canDo(true,"add_event")){setTimeout(BX.delegate(function(){this.getView().showEditSlider()},this),1e3)}}t.prototype={build:function(){this.mainCont=BX(this.id+"-main-container");if(this.mainCont){this.topBlock=BX.create("DIV",{props:{className:"calendar-top-block"}});this.topBlock=BX.create("DIV",{props:{className:"calendar-top-block"}});this.viewTitleContainer=this.topBlock.appendChild(BX.create("DIV",{props:{className:"calendar-top-title-container"}}));this.viewTitle=this.viewTitleContainer.appendChild(BX.create("H2",{props:{className:"calendar-top-title"}}));this.buildNavigation();this.mainCont.appendChild(this.topBlock);this.viewsCont=BX.create("DIV",{props:{className:"calendar-views-container calendar-disable-select"}});BX.bind(this.viewsCont,"click",BX.proxy(this.handleViewsClick,this));this.dragDrop=new e.BXEventCalendar.DragDrop(this);this.buildViews();if(this.util.isFilterEnabled()){this.searchCont=BX(this.id+"-search-container");if(this.searchCont){this.buildSearchControll()}}this.buildTopButtons();this.buildViewSwitcher();this.mainCont.appendChild(this.viewsCont);this.rightBlock=this.mainCont.appendChild(BX.create("DIV",{props:{className:"calendar-right-container"}}));BX.bind(document.body,"keyup",BX.proxy(this.keyUpHandler,this));BX.addCustomEvent(this,"doRefresh",BX.proxy(this.refresh,this));this.util.applyHacksHandlersForPopupzIndex()}},buildViews:function(){this.views=[new e.BXEventCalendar.CalendarDayView(this),new e.BXEventCalendar.CalendarWeekView(this),new e.BXEventCalendar.CalendarMonthView(this),new e.BXEventCalendar.CalendarListView(this)];BX.onCustomEvent(e,"onCalendarBeforeBuildViews",[this.views,this]);this.views.forEach(this.buildView,this);this.viewTransition=new e.BXEventCalendar.ViewTransition(this);BX.onCustomEvent(e,"onCalendarAfterBuildViews",[this])},buildNavigation:function(){this.navigationWrap=this.topBlock.appendChild(BX.create("DIV",{props:{className:"calendar-navigation-container"}}));this.navigationWrap.appendChild(BX.create("SPAN",{props:{className:"calendar-navigation-previous"},events:{click:BX.delegate(this.showPrevious,this)}}));this.navigationWrap.appendChild(BX.create("SPAN",{props:{className:"calendar-navigation-current"},text:BX.message("EC_TODAY"),events:{click:BX.delegate(this.showToday,this)}}));this.navigationWrap.appendChild(BX.create("SPAN",{props:{className:"calendar-navigation-next"},events:{click:BX.delegate(this.showNext,this)}}));this.topBlock.appendChild(BX.create("DIV",{style:{clear:"both"}}))},showNext:function(){var e=this.getView().increaseViewRangeDate();if(e){this.triggerEvent("changeViewDate",{viewRange:e})}},showPrevious:function(){var e=this.getView().decreaseViewRangeDate();if(e){this.triggerEvent("changeViewDate",{viewRange:e})}},showToday:function(){var e=this.getView(),t=e.adjustViewRangeToDate(new Date);if(t){this.triggerEvent("changeViewDate",{viewRange:t})}},buildView:function(e){var t=e.getContainer();if(t){this.viewsCont.appendChild(t)}if(this.currentViewName==e.getName()){this.setView(e.getName(),{first:true})}},buildViewSwitcher:function(){this.viewSwitcherCont=BX(this.id+"-view-switcher-container");if(!this.viewSwitcherCont){this.viewSwitcherCont=this.mainCont.appendChild(BX.create("DIV",{props:{className:"calendar-view-switcher-container"},attrs:{id:this.id+"-view-switcher-container"}}))}var e=this.viewSwitcherCont.appendChild(BX.create("DIV",{props:{className:"calendar-view-switcher-list"},events:{click:BX.delegate(function(e){var t=e.target||e.srcElement;if(t&&t.getAttribute){var i=t.getAttribute("data-bx-calendar-view");this.setView(i,{animation:true})}},this)}}));this.views.forEach(function(t){t.switchNode=e.appendChild(BX.create("SPAN",{props:{className:"calendar-view-switcher-list-item"+(this.currentViewName==t.name?" calendar-view-switcher-list-item-active":"")},attrs:{"data-bx-calendar-view":t.name},text:t.title||t.name}))},this)},setView:function(e,t){if(e){if(!t)t={};var i=this.getView(),n=i.getViewRange(),a=this.getView(e);if(a&&(e!=this.currentViewName||!i.getIsBuilt())){t.currentViewDate=this.getViewRangeDate();t.newViewDate=a.getAdjustedDate(t.date||false,n,true);t.currentView=i;t.newView=a;this.setViewRangeDate(t.newViewDate);this.triggerEvent("beforeSetView",{currentViewName:this.currentViewName,newViewName:e});if(t.animation){this.viewTransition.transit(t)}else{if(e!=this.currentViewName){i.hide()}if(t.first===true){this.initialViewShow=true;a.adjustViewRangeToDate(t.newViewDate,false)}else{a.adjustViewRangeToDate(t.newViewDate)}this.currentViewName=a.getName();if(a.switchNode){BX.addClass(a.switchNode,"calendar-view-switcher-list-item-active")}if(i.switchNode){BX.removeClass(i.switchNode,"calendar-view-switcher-list-item-active")}}this.util.setUserOption("view",e);this.triggerEvent("afterSetView",{viewName:e})}}},buildCounters:function(){},registerEventHandlers:function(){},request:function(e){if(!e.url)e.url=this.util.getActionUrl();if(e.bIter!==false)e.bIter=true;if(!e.data)e.data={};var t;e.reqId=t=Math.round(Math.random()*1e6);e.data.sessid=BX.bitrix_sessid();e.data.bx_event_calendar_request="Y";e.data.reqId=t;var i=this,n=0,a;if(e.handler){a=function(a){var s=function(){if(i.requests[t].status!=="canceled"){var r=a.toLowerCase().indexOf("bx_event_calendar_action_error");if(!a||a.length<=0||r!=-1){var o="";if(r>=0){var l=r+"BX_EVENT_CALENDAR_ACTION_ERROR:".length,h=a.indexOf("--\x3e",l);o=a.substr(l,h-l)}if(e.onerror&&typeof e.onerror=="function")e.onerror();return i.displayError(o||e.errorText||"")}i.requests[t].status="complete";var d=e.handler(i.getRequestResult(t),a);if(d===false&&++n<20&&e.bIter){setTimeout(s,5)}else{delete top.BXCRES[t]}}};setTimeout(s,50)}}else{a=BX.DoNothing()}this.requests[e.reqId]={status:"sent",xhr:e.type=="post"?BX.ajax.post(e.url,e.data,a):BX.ajax.get(e.url,e.data,a)};return e},cancelRequest:function(e){if(this.requests[e]&&this.requests[e].status=="sent")this.requests[e].status="canceled"},getRequestResult:function(e){if(top.BXCRES&&typeof top.BXCRES[e]!="undefined")return top.BXCRES[e];return{}},displayError:function(e,t){var i=this;setTimeout(function(){if(!i.bOnunload){alert(e||"[Bitrix Calendar] Request error");if(t)BX.reload()}},200)},triggerEvent:function(e,t){BX.onCustomEvent(this,e,[t])},getView:function(e){e=e||this.currentViewName;for(var t=0;t<this.views.length;t++){if(this.views[t].getName()==e){return this.views[t]}}return this.views[0]},getViewRangeDate:function(){if(!this.viewRangeDate)this.viewRangeDate=new Date;this.viewRangeDate.setHours(0,0,0,0);return this.viewRangeDate},setViewRangeDate:function(e){this.viewRangeDate=e;this.triggerEvent("changeViewRange",e)},getDisplayedViewRange:function(){return this.displayedRange},setDisplayedViewRange:function(e){this.displayedRange=e},handleViewsClick:function(e){var t=e.target||e.srcElement,i=this.util.findTargetNode(t,this.viewsCont);if(i){if(i.getAttribute("data-bx-calendar-weeknumber")){this.setView("week",{date:new Date(parseInt(i.getAttribute("data-bx-cal-time"))),animation:true})}else if(i.getAttribute("data-bx-calendar-date")){this.setView("day",{date:new Date(parseInt(i.getAttribute("data-bx-calendar-date"))),animation:true})}this.triggerEvent("viewOnClick",{e:e,target:t,specialTarget:i})}},handleViewsMousedown:function(e){var t=e.target||e.srcElement,i=this.util.findTargetNode(t,this.viewsCont);if(i){this.triggerEvent("viewOnMouseDown",{e:e,target:t,specialTarget:i})}},disableKeyHandler:function(){this.keyHandlerEnabled=false},enableKeyHandler:function(){this.keyHandlerEnabled=true},keyUpHandler:function(e){if(this.keyHandlerEnabled){var t=this.util.getKeyCodes(),i=e.keyCode;if(i==t["escape"]){this.getView().deselectEntry()}else if(i==t["delete"]){var n=this.getView().getSelectedEntry();if(n){this.entryController.deleteEntry(n)}}if(i==t["left"]){this.showPrevious()}else if(i==t["right"]){this.showNext()}this.triggerEvent("keyup",{e:e,keyCode:i})}},buildSearchControll:function(){this.countersCont=BX(this.id+"-counter-container");if(!this.countersCont){this.countersCont=this.mainCont.appendChild(BX.create("DIV",{props:{className:"calendar-counter-container"},attrs:{id:this.id+"-counter-container"}}))}BX.addClass(this.countersCont,"calendar-counter");this.search.updateCounters()},buildTopButtons:function(){this.buttonsCont=BX(this.id+"-buttons-container");if(this.buttonsCont){this.sectionButton=this.buttonsCont.appendChild(BX.create("SPAN",{props:{className:"webform-small-button webform-small-button-transparent"},html:'<span class="">'+BX.message("EC_SECTION_BUTTON")+"</span>"}));new e.BXEventCalendar.SectionSlider({calendar:this,button:this.sectionButton});if(this.util.userIsOwner()){this.syncButton=this.buttonsCont.appendChild(BX.create("DIV",{props:{className:"webform-small-button webform-small-button-transparent calendar-sync-button"},html:'<span class="webform-small-button-icon"></span>'}));this.syncSlider=new e.BXEventCalendar.SyncSlider({calendar:this,button:this.syncButton})}if(this.util.userIsOwner()||this.util.config.TYPE_ACCESS){this.settingsButton=this.buttonsCont.appendChild(BX.create("DIV",{props:{className:"webform-small-button webform-small-button-transparent webform-cogwheel"},html:'<span class="webform-button-icon"></span>'}));new e.BXEventCalendar.SettingsSlider({calendar:this,button:this.settingsButton})}if(!this.util.readOnlyMode()){this.addButton=new e.BXEventCalendar.AddButton({wrap:this.buttonsCont.appendChild(BX.create("SPAN")),calendar:this})}}},refresh:function(){this.triggerEvent("beforeRefresh");this.getView().refresh();this.triggerEvent("afterRefresh")},reload:function(e){this.triggerEvent("beforeReload");if(e&&e.syncGoogle){this.reloadGoogle=true}this.entryController.clearLoadIndexCache();this.refresh();this.triggerEvent("afterReload")},showStartUpEntry:function(t){var i=new e.BXEventCalendar.Entry(this,t);this.getView().showViewSlider({entry:i})}};if(e.BXEventCalendar){e.BXEventCalendar.Core=t}else{BX.addCustomEvent(e,"onBXEventCalendarInit",function(){e.BXEventCalendar.Core=t})}})(window);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:60:"/bitrix/js/calendar/new/calendar-view.min.js?152740167596240";s:6:"source";s:40:"/bitrix/js/calendar/new/calendar-view.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
(function(e){function t(e){this.calendar=e;this.util=e.util;this.entryController=e.entryController;this.name="#calendar view#";this.title=this.name;this.enabled=true;this.contClassName="";this.isBuilt=false;this.animateClass="calendar-grid-animate";this.collapseOffHours=this.util.getUserOption("collapseOffHours","Y")=="Y";this.entries=[];this.entriesIndex={};BX.addCustomEvent(this.calendar,"viewOnClick",BX.proxy(this.handleClick,this))}t.prototype={build:function(){this.viewCont=BX.create("DIV",{props:{className:this.contClassName}})},show:function(){if(!this.isBuilt){this.build();this.isBuilt=true}this.viewCont.style.display="";this.setTitle()},refresh:function(){this.displayEntries()},hide:function(){this.viewCont.style.display="none"},getName:function(){return this.name},getContainer:function(){return this.viewCont},setTitle:function(e){this.calendar.viewTitle.innerHTML=e.replace("#GRAY_START#",'<span class="calendar-top-title-gray">').replace("#GRAY_END#","</span>")},getIsBuilt:function(){return this.isBuilt},fadeAnimation:function(e,t,i){new BX.easing({duration:t||200,start:{opacity:100},finish:{opacity:0},transition:BX.easing.makeEaseOut(BX.easing.transitions.quad),step:function(t){e.style.opacity=t.opacity/100},complete:function(){if(i&&BX.type.isFunction(i))i()}}).animate()},showAnimation:function(e,t,i){new BX.easing({duration:t||200,start:{opacity:0},finish:{opacity:100},transition:BX.easing.makeEaseOut(BX.easing.transitions.quad),step:function(t){e.style.opacity=t.opacity/100},complete:function(){e.removeAttribute("style");if(i&&BX.type.isFunction(i))i()}}).animate()},getArrow:function(e,t,i){var s=BX.util.urlencode(t),a=i?BX.util.urlencode(t):"none",r="",n;if(e=="left"){n=BX.create("DIV",{props:{className:"calendar-event-angle-start-yesterday"}});r="url(data:image/svg+xml;charset=US-ASCII,%3Csvg%20width%3D%2215px%22%20height%3D%2218px%22%20viewBox%3D%220%200%2015%2018%22%20version%3D%221.1%22%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%3E%0A%3Cpath%20fill%3D%22"+a+"%22%20stroke%3D%22"+s+"%22%20stroke-width%3D%221%22%20d%3D%22M14.5%2C17.5%20L14.5%2C0.5%20L2.00049088%2C0.5%20C1.78697323%2C0.5%201.57591593%2C0.545584%201.38143042%2C0.633704227%20C0.626846099%2C0.975601882%200.292297457%2C1.86447615%200.634195112%2C2.61906047%20L3.05787308%2C7.96823256%20C3.35499359%2C8.62399158%203.35499359%2C9.37600842%203.05787308%2C10.0317674%20L0.634195112%2C15.3809395%20C0.546074885%2C15.575425%200.500490885%2C15.7864823%200.500490885%2C16%20C0.500490885%2C16.8284271%201.17206376%2C17.5%202.00049088%2C17.5%20L14.5%2C17.5%20Z%22/%3E%0A%3C/svg%3E)"}else{n=BX.create("DIV",{props:{className:"calendar-event-angle-finish-tomorrow"}});r="url(data:image/svg+xml;charset=US-ASCII,%3Csvg%20width%3D%2215px%22%20height%3D%2218px%22%20viewBox%3D%220%200%2015%2018%22%20version%3D%221.1%22%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%3E%0A%3Cpath%20fill%3D%22"+a+"%22%20stroke%3D%22"+s+"%22%20stroke-width%3D%221%22%20d%3D%22M0.5%2C0.5%20L0.5%2C17.5%20L8.7031205%2C17.5%20C9.65559352%2C17.5%2010.5253145%2C16.9587787%2010.9460243%2C16.1042565%20L13.8991717%2C10.1059895%20C14.2418971%2C9.40986472%2014.2419701%2C8.59406382%2013.8993692%2C7.89787777%20L10.9458495%2C1.89614482%20C10.5252214%2C1.04140271%209.65538246%2C0.5%208.70274816%2C0.5%20L0.5%2C0.5%20Z%22/%3E%0A%3C/svg%3E)"}n.style.backgroundImage=r;return n},occupySlot:function(e){if(this.days){var t;for(t=e.startIndex;t<e.endIndex;t++){if(this.days[t]){this.days[t].slots[e.slotIndex]=false}}}},showSimplePopup:function(t){if(!this.simpleEntryPopup)this.simpleEntryPopup=new e.BXEventCalendar.SimpleAddPopup(this.calendar);this.simpleEntryPopup.show(t)},showSimpleViewPopup:function(t){if(!this.simpleViewPopup){this.simpleViewPopup=new e.BXEventCalendar.SimpleViewPopup(this.calendar)}else if(this.simpleViewPopup.isShown()){this.simpleViewPopup.close()}this.simpleViewPopup.show(t)},showEditSlider:function(t){if(this.simpleViewPopup){this.simpleViewPopup.close()}if(!t||!t.entry)t={};if(this.simpleEntryPopup){t.newEntryData=this.simpleEntryPopup.getPopupData();this.simpleEntryPopup.close()}if(!this.calendar.editSlider)this.calendar.editSlider=new e.BXEventCalendar.EditEntrySlider(this.calendar);this.calendar.editSlider.show(t)},handleEntryClick:function(e){var t=e.entry||this.getEntryById(e.uid);e.entry=e.entry||this.getEntryById(e.uid);if(e.entry.isSelected()){if(e.entry.isTask()){BX.SidePanel.Instance.open(this.calendar.util.getViewTaskPath(e.entry.id),{loader:"task-new-loader"})}else{this.showViewSlider({entry:e.entry})}}this.selectEntry(e.entry);if(this.name=="week"||this.name=="month"){this.showSimpleViewPopup(e)}},showViewSlider:function(t){if(!this.calendar.viewSlider)this.calendar.viewSlider=new e.BXEventCalendar.ViewEntrySlider(this.calendar);this.calendar.viewSlider.show(t);if(this.simpleViewPopup){this.simpleViewPopup.close()}setTimeout(BX.delegate(function(){if(this.simpleViewPopup){this.simpleViewPopup.close()}},this),200)},isActive:function(){return this.calendar.currentViewName===this.name},getEntryById:function(e){if(e&&this.entriesIndex[e]!==undefined&&this.entries[this.entriesIndex[e]])return this.entries[this.entriesIndex[e]];return false},selectEntry:function(e){if(e&&e.parts){if(this.selectedEntry)this.deselectEntry();if(e.select)e.select();e.parts.forEach(function(t){t.params=this.selectEntryPart(t.params,e.color,e.isExpired())},this);this.selectedEntry=e;if(this.name!=="week"&&this.name!=="month"){this.showAdditionalInfo(e)}}},selectEntryPart:function(e,t){if(e.wrapNode){e.backupWrapZIndex=e.wrapNode.style.zIndex||"";e.wrapNode.style.zIndex=4e3;e.backupWrapNodeClass=e.wrapNode.className;BX.addClass(e.wrapNode,"calendar-event-line-fill");BX.addClass(e.wrapNode,"active")}if(e.blockBackgroundNode){e.backupBlockOpacity=e.blockBackgroundNode.style.opacity;e.blockBackgroundNode.style.opacity=1}if(e.innerContainer){e.backupBackground=e.innerContainer.style.background;e.backupBorderColor=e.innerContainer.style.borderColor;e.innerContainer.style.backgroundColor=t;e.innerContainer.style.borderColor=t}if(e.nameNode){e.backupNameColor=e.nameNode.style.color;e.nameNode.style.color="#fff"}if(e.timeNode){e.backupTimeColor=e.timeNode.style.color;e.backupTimeZIndex=e.timeNode.style.zIndex||0;e.timeNode.style.color="#fff";e.timeNode.style.zIndex=200}return e},deselectEntry:function(e){if(!e&&this.selectedEntry)e=this.selectedEntry;if(e){if(e.deselect)e.deselect();e.parts.forEach(function(e){if(e.params.wrapNode){e.params.wrapNode.className=e.params.backupWrapNodeClass;e.params.wrapNode.style.zIndex=e.params.backupWrapZIndex}if(e.params.innerContainer){e.params.innerContainer.style.backgroundColor=e.params.backupBackground;e.params.innerContainer.style.borderColor=e.params.backupBorderColor}if(e.params.blockBackgroundNode){e.params.blockBackgroundNode.style.opacity=e.params.backupBlockOpacity}if(e.params.nameNode){e.params.nameNode.style.color=e.params.backupNameColor}if(e.params.timeNode){e.params.timeNode.style.color=e.params.backupTimeColor;e.params.timeNode.style.zIndex=e.params.backupTimeZIndex}},this)}BX.remove(this.calendar.additionalInfoOuter);this.selectedEntry=false},getSelectedEntry:function(){return this.selectedEntry||false},preloadEntries:function(){},showAllEventsInPopup:function(e){var t,i;t=BX.create("DIV",{props:{className:"calendar-all-events-popup calendar-custom-scroll"},events:{click:BX.proxy(this.calendar.handleViewsClick,this.calendar)}});e.day.entries.list.sort(this.calendar.entryController.sort);var s,a;e.day.entries.list.forEach(function(e){if(e.entry){if(e.entry.isTask()){if(!s){t.appendChild(BX.create("DIV",{props:{className:"calendar-event-title"},text:BX.message("EC_ENTRIES_TASKS")}));s=t.appendChild(BX.create("DIV",{props:{className:"calendar-event-block"}}))}this.displayEntryPiece({entry:e.entry,part:e.part,holder:s,popupMode:true})}else{if(!a){t.appendChild(BX.create("DIV",{props:{className:"calendar-event-title"},text:BX.message("EC_ENTRIES_EVENTS")}));a=t.appendChild(BX.create("DIV",{props:{className:"calendar-event-block"}}))}this.displayEntryPiece({entry:e.entry,part:e.part,holder:a,popupMode:true})}}},this);i=BX.PopupWindowManager.create(this.calendar.id+"-all-events-popup",e.day.hiddenStorage,{autoHide:true,closeByEsc:true,offsetTop:-2,offsetLeft:this.getDayWidth()/2+4,lightShadow:true,content:t});i.setAngle({offset:118});i.show(true);this.allEventsPopup=i;BX.addCustomEvent(i,"onPopupClose",function(){i.destroy()})},showAdditionalInfo:function(t){BX.remove(this.calendar.additionalInfoOuter);this.calendar.additionalInfoOuter=this.calendar.rightBlock.appendChild(BX.create("DIV",{props:{className:"calendar-right-block hide"}}));if(!this.simpleViewPopup)this.simpleViewPopup=new e.BXEventCalendar.SimpleViewPopup(this.calendar);this.calendar.additionalInfoOuter.appendChild(this.simpleViewPopup.createContent({entry:t}))},showNavigationCalendar:function(){setTimeout(BX.delegate(function(){if(this.calendar.rightBlock){if(!this.calendar.navCalendar){this.calendar.navCalendar=new e.BXEventCalendar.NavigationCalendar(this.calendar,{wrap:this.calendar.rightBlock.appendChild(BX.create("DIV",{props:{className:"calendar-right-block"}}))})}if(this.calendar.initialViewShow){BX.addClass(this.calendar.mainCont,"calendar-main-container-small-calendar");this.calendar.initialViewShow=false}this.calendar.navCalendar.show()}},this),0)},getDayWidth:function(){var e=200;if(this.days&&this.days[0]&&this.days[0].node){e=this.days[0].node.offsetWidth||e}return Math.min(e,400)}};function i(){t.apply(this,arguments);this.initConfig();this.preBuild()}i.prototype=Object.create(t.prototype);i.prototype.constructor=i;i.prototype.initConfig=function(){this.name="day";this.gridLineHeight=60;this.slotHeight=20;this.title=BX.message("EC_VIEW_DAY");this.entryWidthOffset=2;this.lastEntryWidthOffset=14;this.contClassName="calendar-day-view";this.gridWrapClass="calendar-grid-wrap";this.fullDayContClass="calendar-grid-day-full-days-events-holder";this.fullDayContHolderClass="calendar-grid-week-full-days-events-holder-grid";this.topEntryHolderClass="calendar-grid-day-events-holder";this.outerGridClass="calendar-grid-day-container";this.gridClass="calendar-grid-day";this.gridClassCurrent="calendar-grid-day-current";this.gridClassNext="calendar-grid-day-left-slide";this.gridClassPrevious="calendar-grid-day-right-slide";this.changeNextClass="calendar-change-day-left-slide";this.changePreviousClass="calendar-change-day-right-slide";this.gridRowClass="calendar-grid-day-row";this.gridCellClass="calendar-grid-day-cell";this.gridTimelinesClass="calendar-grid-day-time-lines";this.gridTimelineHourClass="calendar-grid-day-time-line-hour";this.gridTimelineHourLabelClass="calendar-grid-day-time-line-hour-label";this.gridTimelineHourLabelClassInner="calendar-grid-week-time-line-hour-label-inner";this.gridNowTimeClass="calendar-grid-day-time-line-hour-now";this.gridNowTimeLabelClass="calendar-grid-day-time-line-hour-label";this.gridNowTimeLineClass="calendar-grid-day-time-line-hour-now-line";this.gridNowTimeDotClass="calendar-grid-day-time-line-hour-now-dot";this.gridTimeTranslucentClass="calendar-grid-time-line-translucent";this.offHoursClass="calendar-grid-off-hours";this.offHoursCollapseClass="calendar-grid-off-hours-collapse";this.offHoursAnimateClass="calendar-grid-off-hours-animate";this.offHoursFastAnimateClass="calendar-grid-off-hours-fast-animate";this.dayCount=1};i.prototype.preBuild=function(){this.viewCont=BX.create("DIV",{props:{className:this.contClassName},style:{display:"none"}})};i.prototype.build=function(){this.titleCont=this.viewCont.appendChild(BX.create("DIV",{props:{className:"calendar-grid-week-row-days-week"}}));var e=this.util.getWorkTime();this.checkTimelineScroll(!this.collapseOffHours||(e.end-e.start)*this.gridLineHeight+20>this.util.getViewHeight());this.fullDayEventsCont=this.viewCont.appendChild(BX.create("DIV",{props:{className:this.fullDayContClass}}));this.gridWrap=this.viewCont.appendChild(BX.create("DIV",{props:{className:this.gridWrapClass},style:{height:this.util.getViewHeight()+"px"}}));this.outerGrid=this.gridWrap.appendChild(BX.create("DIV",{props:{className:this.outerGridClass}}));this.grid=this.outerGrid.appendChild(BX.create("DIV",{props:{className:this.gridClass+" "+this.gridClassCurrent}}));BX.bind(this.gridWrap,"mousedown",BX.proxy(this.handleMousedown,this))};i.prototype.show=function(){t.prototype.show.apply(this,arguments);this.buildDaysGrid();this.showNavigationCalendar();BX.remove(this.calendar.additionalInfoOuter);this.displayEntries()};i.prototype.hide=function(){t.prototype.hide.apply(this,arguments)};i.prototype.setFullDayHolderSize=function(e){this.fullDayEventsCont.style.height=e*(this.slotHeight+1)+"px"};i.prototype.increaseViewRangeDate=function(){this.changeViewRangeDate(this.dayCount);this.setTitle();if(this.gridWrap)this.gridWrap.style.overflowX="hidden";var e=this.outerGrid.appendChild(BX.create("DIV",{props:{className:this.gridClass+" "+this.gridClassNext+" "+this.animateClass}}));BX.addClass(this.grid,this.animateClass);this.buildDaysGrid({grid:e});this.preloadEntries();setTimeout(BX.delegate(function(){BX.addClass(this.outerGrid,this.changeNextClass);setTimeout(BX.delegate(function(){BX.removeClass(this.outerGrid,this.changeNextClass);BX.removeClass(e,this.gridClassNext);BX.addClass(e,this.gridClassCurrent);BX.remove(this.grid);this.grid=e;BX.removeClass(this.grid,this.animateClass);this.gridWrap.style.overflowX="";this.displayEntries()},this),400)},this),0)};i.prototype.decreaseViewRangeDate=function(){this.changeViewRangeDate(-this.dayCount);this.setTitle();this.gridWrap.style.overflowX="hidden";var e=this.outerGrid.appendChild(BX.create("DIV",{props:{className:this.gridClass+" "+this.gridClassPrevious+" "+this.animateClass}}));BX.addClass(this.grid,this.animateClass);this.buildDaysGrid({grid:e});setTimeout(BX.delegate(function(){BX.addClass(this.outerGrid,this.changePreviousClass);setTimeout(BX.delegate(function(){BX.removeClass(this.outerGrid,this.changePreviousClass);BX.removeClass(e,this.gridClassPrevious);BX.addClass(e,this.gridClassCurrent);BX.remove(this.grid);this.grid=e;BX.removeClass(this.grid,this.animateClass);this.gridWrap.style.overflowX="";this.displayEntries()},this),400)},this),0)};i.prototype.changeViewRangeDate=function(e){var t=this.calendar.getViewRangeDate(),i=new Date(t.getTime());i.setDate(i.getDate()+e);this.calendar.setViewRangeDate(i);return i};i.prototype.getViewRange=function(){var e=this.calendar.getViewRangeDate(),t=new Date(e.getTime());t.setDate(t.getDate()+this.dayCount);return{start:e,end:t}};i.prototype.getAdjustedDate=function(e,t){if(!e){e=new Date}if(t&&e.getTime()<t.start.getTime()){e=new Date(t.start.getTime())}if(t&&e.getTime()>t.end.getTime()){e=new Date(t.end.getTime())}var i=false;if(e&&e.getTime){e.setHours(0,0,0,0);i=new Date(e.getTime())}return i};i.prototype.adjustViewRangeToDate=function(e,t){var i=this.calendar.getViewRangeDate(),s=false;if(e&&e.getTime){e.setHours(0,0,0,0);var a=(e.getTime()-i.getTime())/this.calendar.util.dayLength;if(a==this.dayCount){this.increaseViewRangeDate()}else if(a==-this.dayCount){this.decreaseViewRangeDate()}else{s=new Date(e.getTime());s.setHours(0,0,0,0);this.calendar.setViewRangeDate(s);if(t===false){this.show()}else{this.fadeAnimation(this.getContainer(),100,BX.delegate(function(){this.show();this.getContainer().style.opacity=0;this.showAnimation(this.getContainer(),300)},this))}}}return s};i.prototype.buildDaysGrid=function(e){if(!e)e={};var t,i,s=e.grid||this.grid,a=this.calendar.getViewRangeDate(),r=new Date(a.getTime());if(this.dayCount>1){r=this.getAdjustedDate(r)}BX.cleanNode(s);BX.cleanNode(this.fullDayEventsCont);this.holderTitle=this.fullDayEventsCont.appendChild(BX.create("DIV",{props:{className:"calendar-grid-day-full-days-events-holder-title"},text:BX.message("EC_VIEW_DAY")}));this.fullDayEventsHolderCont=this.fullDayEventsCont.appendChild(BX.create("DIV",{props:{className:this.fullDayContHolderClass}}));this.topEntryHolder=this.fullDayEventsCont.appendChild(BX.create("DIV",{props:{className:this.topEntryHolderClass}}));this.gridRow=s.appendChild(BX.create("DIV",{props:{className:this.gridRowClass+" "+this.animateClass},style:{height:this.getDayGridHeight()+"px"}}));this.dayIndex={};this.days=[];if(this.titleCont){BX.cleanNode(this.titleCont)}this.gridRowShadow=BX.create("DIV",{props:{className:"calendar-grid-week-row-shadow"}});for(t=0;t<this.dayCount;t++){i=this.util.getDayCode(r);this.fullDayEventsHolderCont.appendChild(BX.create("DIV",{attrs:{"data-bx-calendar-week-day":i},props:{className:this.gridCellClass}}));this.buildDayCell({date:r,month:"previous",grid:s});if(this.dayCount>1)r.setDate(r.getDate()+1);this.gridRowShadow.appendChild(BX.create("DIV",{attrs:{"data-bx-calendar-timeline-day":i},props:{className:"calendar-grid-week-cell"},html:'<span class="calendar-grid-cell-inner"></span>'}))}this.timeLinesCont=this.gridRow.appendChild(BX.create("DIV",{props:{className:this.gridTimelinesClass}}));this.timelineEntryHolder=this.gridRow.appendChild(BX.create("DIV",{props:{className:this.topEntryHolderClass}}));this.timeLinesIndex=[];for(t=0;t<=24;t++){this.timeLinesIndex[t]=this.timeLinesCont.appendChild(BX.create("DIV",{props:{className:this.gridTimelineHourClass},html:'<div class="'+this.gridTimelineHourLabelClass+'">'+this.calendar.util.formatTime(t,0,true)+"</div>",style:{top:t*this.gridLineHeight+"px"}}))}this.gridRow.appendChild(this.gridRowShadow);setTimeout(BX.delegate(function(){if(!this.gridWrap.scrollTop&&!this.collapseOffHours){var e=this.util.getWorkTime();this.gridWrap.scrollTop=e.start*this.gridLineHeight-5}},this),0);this.showOffHours();this.showNowTime(this.timeLinesCont);this.gridRow.appendChild(BX.create("DIV",{props:{className:"calendar-grid-day-events-holder"}}))};i.prototype.buildDayCell=function(e){var t=e.date,i="",s="",a=Math.round(t.getTime()/1e3)*1e3,r=t.getDay(),n=this.util.getDayCode(t),o=this.util.getWeekDayByInd(r);if(e.month=="previous"){s+=" calendar-grid-previous-month-day"}else if(e.month=="next"){s+=" calendar-grid-next-month-day"}if(this.util.isHoliday(t)){s+=" calendar-grid-holiday"}if(this.util.isToday(t)){i+=" calendar-grid-today"}if(this.titleCont&&this.name=="week"){this.titleCont.appendChild(BX.create("DIV",{props:{className:this.gridCellClass+i},html:'<span class="calendar-grid-cell-inner" data-bx-calendar-date="'+a+'">'+BX.message("EC_WEEK_TITLE").replace("#DAY_OF_WEEK#",BX.date.format("D",a/1e3)).replace("#DATE#",t.getDate())+"</span>"}))}else if(this.titleCont){this.titleCont.appendChild(BX.create("DIV",{props:{className:this.gridCellClass+i},html:'<span class="calendar-grid-cell-inner" data-bx-calendar-date="'+a+'">'+'<span class="calendar-day-of-week-day">'+BX.date.format("l",a/1e3)+"</span>"+"</span>"}))}this.days.push({date:new Date(t.getTime()),dayOffset:this.util.getWeekDayOffset(o),node:this.gridRow.appendChild(BX.create("DIV",{attrs:{"data-bx-calendar-timeline-day":n},props:{className:this.gridCellClass+s+" a1"},html:'<span class="calendar-grid-cell-inner"></span>'})),dayCode:n});this.dayIndex[this.days[this.days.length-1].dayCode]=this.days.length-1;this.calendar.dragDrop.registerTimelineDay(this.days[this.days.length-1])};i.prototype.setTitle=function(){var e=this.calendar.getViewRangeDate(),i=e.getTime()/1e3;t.prototype.setTitle.apply(this,[BX.date.format(BX.message("EC_DATE_FORMAT_1_MAY"),i)+" #GRAY_START#"+BX.date.format("Y",i)+"#GRAY_END#"])};i.prototype.displayEntries=function(e){var t,i,s,a,r,n,o=0,l=this.getViewRange();if(!e)e={};if(e.reloadEntries!==false){this.entries=this.entryController.getList({startDate:new Date(l.start.getFullYear(),l.start.getMonth(),1),finishDate:new Date(l.end.getFullYear(),l.end.getMonth()+1,1),viewRange:l,finishCallback:BX.proxy(this.displayEntries,this)})}this.partsStorage=[];this.timelinePartsStorage=[];BX.cleanNode(this.topEntryHolder);BX.cleanNode(this.timelineEntryHolder);this.fullDayEventsCont.style.height="";this.days.forEach(function(e){e.slots=[];e.timelineMap={};e.entries={topList:[],started:[],timeline:[],hidden:[]}});if(this.entries&&this.entries.length){for(t=0;t<this.entries.length;t++){i=this.entries[t];this.entriesIndex[i.uid]=t;i.cleanParts();n=false;for(a=this.dayIndex[i.startDayCode];a<this.days.length;a++){r=this.days[a];if(!i.isLongWithTime()&&r.dayCode==i.startDayCode&&r.dayCode==i.endDayCode&&!i.fullDay){s=i.startPart({from:r,to:r,daysCount:0,fromTimeValue:this.util.getTimeValue(i.from),toTimeValue:this.util.getTimeValue(i.to)});r.entries.timeline.push({entry:i,part:s});this.timelinePartsStorage.push({part:s,entry:i});break}else{if(r.dayCode==i.startDayCode){n=true;s=i.startPart({from:r,daysCount:0});r.entries.started.push({entry:i,part:s})}if(n){r.entries.topList.push({entry:i,part:s});s.daysCount++;s.to=r;if(r.entries.topList.length>o)o=r.entries.topList.length;if(r.dayCode==i.endDayCode||r.dayOffset==this.dayCount-1||this.dayCount==1){this.partsStorage.push({part:s,entry:i});if(r.dayCode==i.endDayCode){break}}}}}}}this.setFullDayHolderSize(Math.max(o,1));if(this.entries&&this.entries.length){this.displayTopEntries();this.displayTimelineEntries();this.slotsCount=100;this.arrangeTopEntries();this.arrangeTimelineEntries()}BX.addClass(this.grid,"calendar-events-holder-show");BX.addClass(this.fullDayEventsCont,"calendar-events-holder-show");var d=this.util.getWorkTime();this.checkTimelineScroll(!this.collapseOffHours||(d.end-d.start)*this.gridLineHeight+20>this.util.getViewHeight())};i.prototype.arrangeTopEntries=function(){var e,t,i,s,a,r,n;for(i=0;i<this.days.length;i++){s=this.days[i];if(s.entries.started.length>0){s.entries.started.sort(this.calendar.entryController.sort);for(e=0;e<s.entries.started.length;e++){if(s.entries.started[e]){a=s.entries.started[e].entry;r=s.entries.started[e].part;if(!a.checkPartIsRegistered(r))continue;n=false;for(t=0;t<this.slotsCount;t++){if(s.slots[t]!==false){this.occupySlot({slotIndex:t,startIndex:i,endIndex:i+r.daysCount});n=true;a.getWrap(r.partIndex).style.top=t*this.slotHeight+"px";break}}}if(s.hiddenStorage&&s.entries.hidden.length>0){s.hiddenStorageText.innerHTML=BX.message("EC_SHOW_ALL")+" ("+s.entries.list.length+")"}}}}};i.prototype.arrangeTimelineEntries=function(){var e=30,t=33,i=20,s=40,a=23,r=6,n=2,o,l,d,h,p,c,f,u,m,y,g,C,w,B,T,v,x,D,X;function E(e){var t,i;for(t=e.timeFrom;t<e.timeTo;t++){if(!e.layers[t])e.layers[t]=[];i=e.day.layers[t][e.layerIndex]||{entries:[],start:[]};i.entries.push(e.entryIndex);if(t==e.timeFrom){i.start.push(e.entryIndex);e.entryPart.layerParallels=i.start.length}e.day.layers[t][e.layerIndex]=i}e.entryPart.layerIndex=e.layerIndex}function N(e,t){var i=f.layers[e][t];return i&&i.entries&&i.entries.length==i.start.length}function I(e){return!e}function b(e){var t,i,s,a=[],r={};for(t=e.timeFrom;t<e.timeTo;t++){if(e.layerIndex>0&&e.day.layers[t][e.layerIndex-1]){i=e.day.layers[t][e.layerIndex-1].entries;if(i.length>0){s=i[i.length-1];if(!r[s]){r[s]=true;a.push(s)}}}}return a}function H(t,i){if(!i)i=e;return t.getHours()*60+Math.floor(t.getMinutes()/i)*i}for(c=0;c<this.days.length;c++){f=this.days[c];f.entries.timeline.sort(function(e,t){if(e.part.fromTimeValue==t.part.fromTimeValue)return t.part.toTimeValue-t.part.fromTimeValue-(e.part.toTimeValue-e.part.fromTimeValue);return e.part.fromTimeValue-t.part.fromTimeValue});o=0;d="";l=0;C=0;f.layers=[];for(h=0;h<f.entries.timeline.length;h++){D=f.entries.timeline[h].entry;X=f.entries.timeline[h].part;y=H(D.from);g=H(D.to,1);if(y==g)g+=1;if(!f.layers)f.layers=[];w=0;while(true){if(!f.layers[y]||N(y,w)||I(f.layers[y][w])){E({day:f,timeFrom:y,timeTo:g,layers:f.layers,entryIndex:h,layerIndex:w,entryPart:X});break}w++}}for(h=0;h<f.entries.timeline.length;h++){if(f.entries.timeline[h]){D=f.entries.timeline[h].entry;X=f.entries.timeline[h].part;y=H(D.from);g=H(D.to,1);if(y==g)g+=1;if(!D.checkPartIsRegistered(X)||!f.layers[y]||!f.layers[y][X.layerIndex]){continue}m=f.layers[y][X.layerIndex].start;if(X.params&&X.params.wrapNode){X.params.wrapNode.style.zIndex=y}X.absoluteLeftOffset=n;if(X.layerIndex>0){x=b({day:f,entryIndex:h,layerIndex:X.layerIndex,timeFrom:y,timeTo:g});for(p=0;p<x.length;p++){B=f.entries.timeline[x[p]];if(B&&B.part&&B.part.params&&X.params.wrapNode){T=parseInt(X.params.wrapNode.style.top)-parseInt(B.part.params.wrapNode.style.top);if(T>t){X.offsetFractionLeft=B.part.offsetFractionWidth*.1}else{X.offsetFractionLeft=B.part.offsetFractionWidth*.45}X.offsetFractionLeftTotal=B.part.offsetFractionLeftTotal+X.offsetFractionLeft;X.offsetFractionWidth=1-X.offsetFractionLeftTotal;if(this.dayCount>1){X.offsetLeftRate=X.from.dayOffset+X.offsetFractionLeftTotal}else{X.offsetLeftRate=X.offsetFractionLeftTotal}X.absoluteLeftOffset=(B.absoluteLeftOffset||n)+r;v=1-X.offsetFractionLeftTotal;if(T<=t){if(T<i){B.part.params.timeNode.style.maxWidth="calc("+(1-X.offsetFractionWidth)*100+"% - 4px)";if(B.part.params.timeNode.offsetWidth<s){B.part.params.timeNode.style.textOverflow="clip";B.part.params.timeNode.style.maxWidth=s+"px"}}B.part.params.nameNode.style.maxWidth="calc("+(1-X.offsetFractionWidth)*100+"% - 4px)";if(B.part.params.nameNode.offsetWidth<s){B.part.params.nameNode.style.textOverflow="clip";B.part.params.nameNode.style.maxWidth="calc("+(1-X.offsetFractionWidth)*100+"% + 5px)";this.checkTimelineEntrySize(B.part,B.entry,true)}}else{B.part.params.nameNode.style.maxHeight=T-a+"px"}X.params.wrapNode.style.left="calc((100% / "+this.dayCount+") * "+X.offsetLeftRate+")";X.params.wrapNode.style.width="calc(100% / ("+this.dayCount+") * "+X.offsetFractionWidth+" - "+this.lastEntryWidthOffset+"px)";BX.addClass(X.params.wrapNode,"calendar-bordered-block")}}}if(m.length>1){u=BX.util.array_search(h,f.layers[y][X.layerIndex].start);var k=this.entryWidthOffset;if(u==f.layers[y][X.layerIndex].start.length-1){k=this.lastEntryWidthOffset;if(X.absoluteLeftOffset>n){k+=X.absoluteLeftOffset/m.length+1}}if(this.dayCount>1){X.params.wrapNode.style.width="calc(100% / ("+this.dayCount+" * "+m.length+") - "+k+"px)";X.params.wrapNode.style.left="calc((100% / "+this.dayCount+") * "+X.from.dayOffset+" + 100% * "+u+"/ ("+this.dayCount+" * "+m.length+") + "+X.absoluteLeftOffset+"px)"}else{X.params.wrapNode.style.width="calc(100% / ("+this.dayCount+" * "+m.length+") - "+k+"px)";X.params.wrapNode.style.left="calc(100% * "+u+"/ "+m.length+" + "+X.absoluteLeftOffset+"px)"}}this.checkTimelineEntrySize(X,D,true)}}}};i.prototype.fillTimelineMap=function(e,t,i){var s,a=t.from.getHours()*60+t.from.getMinutes(),r=t.to.getHours()*60+t.to.getMinutes();for(s=a;s<r;s++){if(!e[s])e[s]=[];e[s].push(i)}};i.prototype.displayTopEntry=function(e){var t,i=e.entry,s=e.part.from,a=e.part.daysCount,r,n,o,l,d,h,p,c="calendar-event-line-wrap",f=0,u,m;if(i.isFullDay()){c+=" calendar-event-line-fill"}else if(i.isLongWithTime()){c+=" calendar-event-line-border"}if(i.isExternal()){c+=" calendar-event-line-intranet"}if(this.util.getDayCode(i.from)!==this.util.getDayCode(s.date)){c+=" calendar-event-line-start-yesterday";f+=8;u=this.getArrow("left",i.color,i.isFullDay())}if(this.util.getDayCode(i.to)!==this.util.getDayCode(e.part.to.date)){c+=" calendar-event-line-finish-tomorrow";m=this.getArrow("right",i.color,i.isFullDay());f+=12}if(u&&!m){f+=4}if(f==0){f=5}r=BX.create("DIV",{attrs:{"data-bx-calendar-entry":i.uid},props:{className:c},style:{top:0,left:this.dayCount>1?"calc((100% / "+this.dayCount+") * ("+(s.dayOffset+1)+" - 1) + 2px)":"2px",width:"calc("+a+" * 100% / "+this.dayCount+" - "+f+"px)"}});if(u){r.appendChild(u);r.style.left="9px"}if(m){r.appendChild(m)}p=r.appendChild(BX.create("DIV",{props:{className:"calendar-event-line-inner-container"}}));o=p.appendChild(BX.create("DIV",{props:{className:"calendar-event-line-inner"}}));n=o.appendChild(BX.create("DIV",{props:{className:"calendar-event-line-dot"}}));if(i.isFullDay()){o.style.maxWidth="calc(200% / "+a+" - "+this.lastEntryWidthOffset+"px)"}else if(i.isLongWithTime()){r.style.borderColor=i.color;o.style.maxWidth="calc(200% / "+a+" - "+this.lastEntryWidthOffset+"px)";if(e.part.partIndex==0){if(a>1){d=o.appendChild(BX.create("SPAN",{props:{className:"calendar-event-line-time"},text:this.calendar.util.formatTime(i.from.getHours(),i.from.getMinutes())}))}o.style.width="calc(100% / "+a+" - "+this.lastEntryWidthOffset+"px)"}if(!d&&a==1&&this.util.getDayCode(i.from)==e.part.from.dayCode){d=o.appendChild(BX.create("SPAN",{props:{className:"calendar-event-line-time"},text:this.calendar.util.formatTime(i.from.getHours(),i.from.getMinutes())}))}if(e.part.partIndex==i.parts.length-1){if(a>1&&i.parts.length>1){o.style.width="calc("+(a-1)+"00% / "+a+" - "+this.lastEntryWidthOffset+"px)"}if(a>1){h=o.appendChild(BX.create("SPAN",{props:{className:i.parts.length>1&&a==1?"calendar-event-line-time":"calendar-event-line-expired-time"},text:this.calendar.util.formatTime(i.to.getHours(),i.to.getMinutes())}))}}if(!h&&a==1&&this.util.getDayCode(i.to)==e.part.to.dayCode){h=o.appendChild(BX.create("SPAN",{props:{className:"calendar-event-line-time"},text:this.calendar.util.formatTime(i.to.getHours(),i.to.getMinutes())}))}}else{d=o.appendChild(BX.create("SPAN",{props:{className:"calendar-event-line-time"},text:this.calendar.util.formatTime(i.from.getHours(),i.from.getMinutes())}))}l=o.appendChild(BX.create("SPAN",{props:{className:"calendar-event-line-text"},text:e.entry.name}));if(i.isFullDay()){p.style.backgroundColor=this.calendar.util.hexToRgba(i.color,.3);p.style.borderColor=this.calendar.util.hexToRgba(i.color,.3)}else{if(i.isLongWithTime()){p.style.borderColor=this.calendar.util.hexToRgba(i.color,.5)}n.style.backgroundColor=i.color}this.topEntryHolder.appendChild(r);t={wrapNode:r,nameNode:l,innerNode:o,innerContainer:p,timeNode:d||false,endTimeNode:h||false,dotNode:n};if(!e.popupMode){e.entry.registerPartNode(e.part,t)}this.calendar.dragDrop.registerEntry(r,e);return t};i.prototype.displayTopEntries=function(){var e;for(e=0;e<this.partsStorage.length;e++){this.displayTopEntry(this.partsStorage[e])}};i.prototype.displayTimelineEntries=function(){this.zIndexTimeline=100;this.timelinePartsStorage.sort(function(e,t){if(e.part.fromTimeValue==t.part.fromTimeValue)return t.part.toTimeValue-t.part.fromTimeValue-(e.part.toTimeValue-e.part.fromTimeValue);return e.part.fromTimeValue-t.part.fromTimeValue});var e;for(e=0;e<this.timelinePartsStorage.length;e++){this.displayTimelineEntry(this.timelinePartsStorage[e])}};i.prototype.displayTimelineEntry=function(e){var t=false,i,s,a,r,n,o,l,d,h,p=this.util.getWorkTime(),c=e.entry,f=e.part.from,u=e.part.fromTimeValue,m=e.part.toTimeValue,y="calendar-event-block-wrap";if(c.isExternal()){y+=" calendar-event-block-intranet"}if(!this.collapseOffHours||m>p.start&&u<p.end){if(this.collapseOffHours){u=Math.max(e.part.fromTimeValue,p.start);m=Math.min(e.part.toTimeValue,p.end);i=(u-p.start)*this.gridLineHeight+1+"px"}else{i=u*this.gridLineHeight+1+"px"}s=BX.create("DIV",{attrs:{"data-bx-calendar-entry":c.uid},props:{className:y},style:{top:i,height:(m-u)*this.gridLineHeight-3+"px",left:this.dayCount>1?"calc((100% / "+this.dayCount+") * "+f.dayOffset+" + 2px)":"2px",width:"calc(100% / "+this.dayCount+" - "+this.lastEntryWidthOffset+"px)"}});h=s.appendChild(BX.create("DIV",{props:{className:"calendar-event-block-border"}}));a=s.appendChild(BX.create("DIV",{props:{className:"calendar-event-block-inner"}}));d=a.appendChild(BX.create("DIV",{props:{className:"calendar-event-block-background"}}));o=this.calendar.util.formatTime(c.from)+" &ndash; "+this.calendar.util.formatTime(c.to);n=a.appendChild(BX.create("SPAN",{props:{className:"calendar-event-block-time"},html:o+'<span class="calendar-event-block-time-shadow">'+o+"</span>"}));r=a.appendChild(BX.create("SPAN",{props:{className:"calendar-event-block-text"},text:e.entry.name}));h.style.backgroundColor=c.color;d.style.backgroundColor=c.color;if(this.calendar.entryController.canDo(c,"edit")){l=s.appendChild(BX.create("DIV",{props:{className:"calendar-event-resizer"}}))}this.timelineEntryHolder.appendChild(s);t={wrapNode:s,nameNode:r,innerNode:a,timeNode:n,blockBackgroundNode:d,resizerNode:l};e.part.offsetFractionRate=1;e.part.offsetFractionLeft=0;e.part.offsetFractionWidth=1;e.part.offsetFractionLeftTotal=0;e.entry.registerPartNode(e.part,t);this.calendar.dragDrop.registerEntry(s,e)}return t};i.prototype.checkTimelineEntrySize=function(e,t,i){if(e.params.innerNode.offsetHeight){this.setEntryBlockCompact(e,t)}if(i===true){setTimeout(BX.proxy(function(){this.checkTimelineEntrySize(e,t,false)},this),100)}};i.prototype.setEntryBlockCompact=function(e,t){var i,s,a,r=16,n=23,o=60,l=e.params.nameNode,d=e.params.innerNode,h=d.offsetWidth,p=parseInt(l.style.maxHeight);if(p){i=Math.floor(Math.min(d.offsetHeight-n,p)/r)}else{i=Math.floor((d.offsetHeight-n)/r)}if(p||l.offsetHeight+n>d.offsetHeight||h<o){if(i<1||h<o){s=t.entry&&t.entry.from?t.entry.from:t.from;if(s){a=this.calendar.util.formatTime(s.getHours(),s.getMinutes());e.params.timeNode.innerHTML=a+'<span class="calendar-event-block-time-shadow">'+a+"</span>"}BX.addClass(e.params.wrapNode,"calendar-event-block-compact");if(h<o)BX.addClass(e.params.wrapNode,"narrow-block")}else if(i==1){l.style.whiteSpace="nowrap";l.style.display="block"}else{if(BX.browser.IsChrome()){l.style.WebkitLineClamp=i;l.style.display="-webkit-box"}else{l.style.height=i*r+"px"}}}};i.prototype.showNowTime=function(e){this.nowTimeCont=e.appendChild(BX.create("DIV",{props:{className:this.gridNowTimeClass}}));this.nowTimeLine=this.nowTimeCont.appendChild(BX.create("DIV",{props:{className:this.gridNowTimeLineClass}}));this.nowTimeLine.appendChild(BX.create("DIV",{props:{className:this.gridNowTimeDotClass}}));this.nowTimeLabel=this.nowTimeCont.appendChild(BX.create("DIV",{props:{className:this.gridNowTimeLabelClass}}));if(this.nowTimeInterval)clearInterval(this.nowTimeInterval);this.updateNowTime();this.nowTimeInterval=setInterval(BX.proxy(this.updateNowTime,this),15e3)};i.prototype.hideNowTime=function(){BX.cleanNode(this.nowTimeCont,1);delete this.nowTimeCont;if(this.nowTimeInterval)clearInterval(this.nowTimeInterval)};i.prototype.updateNowTime=function(){if(!this.nowTimeCont)return;var e=10,t=15,i=this.util.getWorkTime(),s=new Date,a=this.getViewRange(),r=this.util.getTimeValue(s),n=true,o=Math.round(r);var l=document.querySelector("."+this.gridTimeTranslucentClass);if(l)BX.removeClass(l,this.gridTimeTranslucentClass);if(s.getTime()>a.start.getTime()&&s.getTime()<a.end.getTime()){if(!this.nowTimeCont)this.showNowTime();if(this.dayCount>1){var d=this.util.getWeekDayOffset(this.util.getWeekDayByInd(s.getDay()));if(d==0){this.nowTimeLine.style.left=0}else{this.nowTimeLine.style.left="calc("+d+" * 100% / "+this.dayCount+")"}}}else{return this.hideNowTime()}var h=this.calendar.util.formatTime(s.getHours(),s.getMinutes());if(BX.isAmPmMode())h=h.replace(/(\sam|pm)/gi,"<small>$1<small>");this.nowTimeLabel.innerHTML=h;if(this.collapseOffHours){if(r<i.start){n=false;this.nowTimeLabel.style.display="none";this.nowTimeCont.style.top="-5px"}else if(r>i.end){n=false;this.nowTimeLabel.style.display="none";this.nowTimeCont.style.top=(i.end-i.start)*this.gridLineHeight+4+"px"}else{if(r<i.start+e/this.gridLineHeight||r>i.end-e/this.gridLineHeight){this.nowTimeLabel.style.display="none"}else{this.nowTimeLabel.style.display=""}this.nowTimeCont.style.top=(r-i.start)*this.gridLineHeight+1+"px"}}else{if(r<i.start+t/this.gridLineHeight&&r>i.start||r>i.end-t/this.gridLineHeight&&r<i.end){n=false;this.nowTimeLabel.style.display="none"}this.nowTimeCont.style.top=r*this.gridLineHeight+1+"px"}if(n&&Math.abs((o-r)*this.gridLineHeight)<e){if(this.timeLinesIndex[o]){BX.addClass(this.timeLinesIndex[o],this.gridTimeTranslucentClass)}}};i.prototype.getTimeByPos=function(e,t){var i=this.util.getWorkTime(),s=e/this.gridLineHeight,a=this.util.getTimeByFraction(s,t||10);if(this.collapseOffHours){a.h+=i.start}return a};i.prototype.showOffHours=function(){var e=this.util.getWorkTime();this.topOffHours=this.timeLinesCont.appendChild(BX.create("DIV",{props:{className:this.offHoursClass+" "+this.offHoursAnimateClass},style:{top:0,height:e.start*this.gridLineHeight+1+"px"}}));this.topOffHoursLabel=this.topOffHours.appendChild(BX.create("DIV",{props:{className:this.gridTimelineHourLabelClass},children:[BX.create("DIV",{props:{className:this.gridTimelineHourLabelClassInner},html:this.calendar.util.formatTime(0,0,true)+"<br>"+this.calendar.util.formatTime(e.start,0,true)})]}));this.topOffHours.appendChild(BX.create("DIV",{props:{className:"calendar-grid-off-hours-active"},events:{click:BX.proxy(this.switchOffHours,this),mouseover:BX.proxy(function(){BX.addClass(this.topOffHours,"calendar-grid-off-hours-hover");BX.addClass(this.bottomOffHours,"calendar-grid-off-hours-hover")},this),mouseout:BX.proxy(function(){BX.removeClass(this.topOffHours,"calendar-grid-off-hours-hover");BX.removeClass(this.bottomOffHours,"calendar-grid-off-hours-hover")},this)}}));this.topOffHours.appendChild(BX.create("DIV",{props:{className:"calendar-grid-off-hours-drag-down"},attrs:{"data-bx-calendar-off-time-drag":"top"},events:{mousedown:BX.proxy(this.offHoursMousedown,this)}}));this.bottomOffHours=this.timeLinesCont.appendChild(BX.create("DIV",{props:{className:this.offHoursClass+" "+this.offHoursAnimateClass},style:{top:e.end*this.gridLineHeight+1+"px",height:(24-e.end)*this.gridLineHeight+1+"px"}}));this.bottomOffHoursLabel=this.bottomOffHours.appendChild(BX.create("DIV",{props:{className:this.gridTimelineHourLabelClass},children:[BX.create("DIV",{props:{className:this.gridTimelineHourLabelClassInner},html:this.calendar.util.formatTime(e.end,0,true)+"<br>"+this.calendar.util.formatTime(24,0,true)})]}));this.bottomOffHours.appendChild(BX.create("DIV",{props:{className:"calendar-grid-off-hours-active"},events:{click:BX.proxy(this.switchOffHours,this),mouseover:BX.proxy(function(){BX.addClass(this.topOffHours,"calendar-grid-off-hours-hover");BX.addClass(this.bottomOffHours,"calendar-grid-off-hours-hover")},this),mouseout:BX.proxy(function(){BX.removeClass(this.topOffHours,"calendar-grid-off-hours-hover");BX.removeClass(this.bottomOffHours,"calendar-grid-off-hours-hover")},this)}}));this.bottomOffHours.appendChild(BX.create("DIV",{props:{className:"calendar-grid-off-hours-drag-up"},attrs:{"data-bx-calendar-off-time-drag":"bottom"},events:{mousedown:BX.proxy(this.offHoursMousedown,this)}}));BX.bind(this.topOffHours,"click",BX.proxy(function(){if(this.collapseOffHours){this.switchOffHours(true)}},this));BX.bind(this.bottomOffHours,"click",BX.proxy(function(){if(this.collapseOffHours){this.switchOffHours(true)}},this));if(this.collapseOffHours){this.gridRow.style.height=this.gridLineHeight*(e.end-e.start)+30+"px";this.collapseOffHours=!this.collapseOffHours;this.switchOffHours(false);this.updateGridRowShadowHeight()}else{this.gridRow.style.height=this.gridLineHeight*24+40+"px";this.updateGridRowShadowHeight()}};i.prototype.offHoursMousedown=function(e){var t=e.target||e.srcElement;this.lastWorkTime=false;this.lastTopCount=false;if(t&&t.getAttribute){this.lastWorkTime=BX.clone(this.util.getWorkTime());BX.unbind(document,"mousemove",BX.proxy(this.offHoursMousemove,this));BX.unbind(document,"mouseup",BX.proxy(this.offHoursMouseup,this));BX.bind(document,"mousemove",BX.proxy(this.offHoursMousemove,this));BX.bind(document,"mouseup",BX.proxy(this.offHoursMouseup,this));BX.removeClass(this.topOffHours,this.offHoursAnimateClass);BX.removeClass(this.bottomOffHours,this.offHoursAnimateClass);BX.addClass(this.topOffHours,this.offHoursFastAnimateClass);BX.addClass(this.bottomOffHours,this.offHoursFastAnimateClass);if(t.getAttribute("data-bx-calendar-off-time-drag")=="top"){this.offtimeTuneMode="top"}else{this.offtimeTuneMode="bottom"}this.offtimeTuneBaseZeroPos=BX.pos(this.timeLinesCont).top}};i.prototype.offHoursMousemove=function(e){if(this.offtimeTuneMode){var t=this.util.getMousePos(e),i=Math.max(Math.round((t.y-this.offtimeTuneBaseZeroPos)/this.gridLineHeight),0);if(this.lastTopCount!==i){if(this.offtimeTuneMode=="top"){i=Math.min(this.lastWorkTime.end-1,i);this.topOffHours.style.height=i*this.gridLineHeight+1+"px";this.lastWorkTime.start=i}else{i=Math.max(this.lastWorkTime.start+1,i);this.bottomOffHours.style.top=i*this.gridLineHeight+"px";this.bottomOffHours.style.height=(24-i)*this.gridLineHeight+1+"px";this.lastWorkTime.end=i}this.lastTopCount=i}}};i.prototype.offHoursMouseup=function(){BX.unbind(document,"mousemove",BX.proxy(this.offHoursMousemove,this));BX.unbind(document,"mouseup",BX.proxy(this.offHoursMouseup,this));BX.addClass(this.topOffHours,this.offHoursAnimateClass);BX.addClass(this.bottomOffHours,this.offHoursAnimateClass);BX.removeClass(this.topOffHours,this.offHoursFastAnimateClass);BX.removeClass(this.bottomOffHours,this.offHoursFastAnimateClass);var e=this.util.setWorkTime(this.lastWorkTime);this.topOffHoursLabel.innerHTML=this.calendar.util.formatTime(0,0,true)+"<br>"+this.calendar.util.formatTime(e.start,0,true);this.bottomOffHoursLabel.innerHTML=this.calendar.util.formatTime(e.end,0,true)+"<br>"+this.calendar.util.formatTime(24,0,true);this.offtimeTuneMode=false;delete this.lastWorkTime;delete this.lastTopCount;this.collapseOffHours=false;this.switchOffHours(true)};i.prototype.switchOffHours=function(e){if(this.denySwitch)return;e=e!==false;if(this.nowTimeCont)this.nowTimeCont.display="none";BX.cleanNode(this.timelineEntryHolder);this.hideNowTime();if(e){BX.removeClass(this.grid,"calendar-events-holder-show");BX.addClass(this.bottomOffHours,this.offHoursAnimateClass);BX.addClass(this.topOffHours,this.offHoursAnimateClass);BX.addClass(this.timeLinesCont,this.offHoursAnimateClass)}else{BX.removeClass(this.bottomOffHours,this.offHoursAnimateClass);BX.removeClass(this.topOffHours,this.offHoursAnimateClass);BX.removeClass(this.timeLinesCont,this.offHoursAnimateClass)}this.denySwitch=true;var t=this,i=300,s,a,r=this.util.getWorkTime();setTimeout(BX.delegate(function(){this.denySwitch=false;if(this.collapseOffHours){}else{for(s in this.timeLinesIndex){if(this.timeLinesIndex.hasOwnProperty(s)){this.timeLinesIndex[s].style.opacity="";this.timeLinesIndex[s].style.display=""}}}BX.addClass(this.bottomOffHours,this.offHoursAnimateClass);BX.addClass(this.topOffHours,this.offHoursAnimateClass);BX.addClass(this.timeLinesCont,this.offHoursAnimateClass);if(this.scrollTopInterval)clearTimeout(this.scrollTopInterval);if(this.timeLinesCont&&!this.nowTimeCont)this.showNowTime(this.timeLinesCont);if(e){BX.addClass(this.grid,"calendar-events-holder-show");this.displayEntries()}},this),e?500:10);function n(t){if(e){setTimeout(function(){t.style.opacity=1},i)}else{t.style.opacity=1}}function o(t){if(e){setTimeout(function(){t.style.display="none"},i)}else{t.style.display="none"}}function l(){t.gridWrap.scrollTop=t.savedScrollTop||r.start*t.gridLineHeight-5;t.scrollTopInterval=setTimeout(l,5)}var d=true;if(!this.collapseOffHours&&(r.end-r.start)*this.gridLineHeight+20<=this.util.getViewHeight()){d=false}this.checkTimelineScroll(d);if(this.collapseOffHours){this.gridRow.style.height=this.gridLineHeight*24+40+"px";this.topOffHours.style.height=this.gridLineHeight*r.start+1+"px";this.bottomOffHours.style.height=this.gridLineHeight*(24-r.end)+1+"px";this.bottomOffHours.style.top=this.gridLineHeight*r.end+"px";for(s in this.timeLinesIndex){if(this.timeLinesIndex.hasOwnProperty(s)){if(s>=r.start&&s<=r.end){o(this.timeLinesIndex[s])}else{this.timeLinesIndex[s].style.display="block";n(this.timeLinesIndex[s])}this.timeLinesIndex[s].style.top=s*this.gridLineHeight+"px"}}if(e&&this.savedScrollTop){this.scrollTopInterval=setTimeout(l,5)}}else{this.gridRow.style.height=this.gridLineHeight*(r.end-r.start)+30+"px";this.topOffHours.style.height="10px";this.bottomOffHours.style.height=this.gridLineHeight*(24-r.end)+1+"px";this.bottomOffHours.style.top=this.gridLineHeight*r.end+"px";for(s in this.timeLinesIndex){if(this.timeLinesIndex.hasOwnProperty(s)){if(s<=r.start||s>=r.end){a=this.timeLinesIndex[s];this.timeLinesIndex[s].style.opacity=0;o(this.timeLinesIndex[s])}else{n(this.timeLinesIndex[s])}if(s>=r.end){this.timeLinesIndex[s].style.top=(r.end-r.start)*this.gridLineHeight+"px"}else{this.timeLinesIndex[s].style.top=(s-r.start)*this.gridLineHeight+"px"}}}this.bottomOffHours.style.height="10px";this.bottomOffHours.style.top=(r.end-r.start)*this.gridLineHeight+9+"px";this.savedScrollTop=parseInt(this.gridWrap.scrollTop)}this.collapseOffHours=!this.collapseOffHours;BX.toggleClass(this.topOffHours,[this.offHoursCollapseClass,this.offHoursClass]);BX.toggleClass(this.bottomOffHours,[this.offHoursCollapseClass,this.offHoursClass]);this.util.setUserOption("collapseOffHours",this.collapseOffHours?"Y":"N");this.updateGridRowShadowHeight()};i.prototype.checkTimelineScroll=function(e){var t=e?this.util.getScrollbarWidth():0;if(this.titleCont){this.titleCont.style.paddingRight=t+"px"}if(this.fullDayEventsHolderCont&&this.topEntryHolder){new BX.easing({duration:100,start:{width:t,paddingRight:0},finish:{width:0,paddingRight:t},transition:BX.easing.makeEaseOut(BX.easing.transitions.linear),step:BX.delegate(function(e){this.gridWrap.style.width="calc(100% + "+e.width+"px)";this.topEntryHolder.style.right=e.paddingRight+"px";this.fullDayEventsHolderCont.style.paddingRight=e.paddingRight+"px"},this),complete:function(){}}).animate()}};i.prototype.getDayGridHeight=function(){return 1040};i.prototype.updateGridRowShadowHeight=function(){if(this.collapseOffHours){this.gridRowShadow.style.height=parseInt(this.gridRow.style.height)-38+"px";BX.removeClass(this.gridRowShadow,"calendar-grid-week-row-shadow-off-hours")}else{this.gridRowShadow.style.height=parseInt(this.gridRow.style.height)-40+"px";BX.addClass(this.gridRowShadow,"calendar-grid-week-row-shadow-off-hours")}};i.prototype.handleClick=function(e){if(this.isActive()){if(!e)e={};var t,i;if(e.specialTarget&&(i=e.specialTarget.getAttribute("data-bx-calendar-entry"))){this.handleEntryClick({uid:i,specialTarget:e.specialTarget,target:e.target,e:e.e})}else if(e.specialTarget&&(t=e.specialTarget.getAttribute("data-bx-calendar-show-all-events"))){}else if(!this.calendar.util.readOnlyMode()&&this.entryController.canDo(true,"add_event")&&(t=e.specialTarget&&e.specialTarget.getAttribute("data-bx-calendar-week-day"))){this.deselectEntry();this.showSimplePopupForNewEntry({entry:this.buildTopNewEntryWrap({dayFrom:this.days[this.dayIndex[t]],holder:this.topEntryHolder})})}}};i.prototype.handleMousedown=function(e){if(!this.isActive())return;var t,i=this.calendar.util.findTargetNode(e.target||e.srcElement);if(!this.calendar.util.readOnlyMode()&&this.entryController.canDo(true,"add_event")&&(t=i&&i.getAttribute("data-bx-calendar-timeline-day"))){BX.unbind(document,"mousemove",BX.proxy(this.handleMousemove,this));BX.unbind(document,"mouseup",BX.proxy(this.handleMouseup,this));BX.bind(document,"mousemove",BX.proxy(this.handleMousemove,this));BX.bind(document,"mouseup",BX.proxy(this.handleMouseup,this));BX.addCustomEvent(this.calendar,"keyup",BX.proxy(this.checkKeyup,this));this.createEntryMode=true;this.offtimeTuneBaseZeroPos=BX.pos(this.timeLinesCont).top;this.offtimeBottomBasePos=BX.pos(this.bottomOffHours).bottom-2;this.startMousePos=Math.max(this.offtimeTuneBaseZeroPos+this.gridWrap.scrollTop,this.calendar.util.getMousePos(e).y);this.newEntry=this.buildTimelineNewEntryWrap({dayFrom:this.days[this.dayIndex[t]],holder:this.timelineEntryHolder});this.newEntry.dayFrom=this.days[this.dayIndex[t]];this.newEntry.timeFrom=this.getTimeByPos(this.startMousePos-this.offtimeTuneBaseZeroPos,30,true);var s=this.util.getWorkTime(),a=this.newEntry.timeFrom.h+this.newEntry.timeFrom.m/60;if(this.collapseOffHours){a=Math.max(a,s.start);this.startMousePos=this.offtimeTuneBaseZeroPos+((a-s.start)*this.gridLineHeight+1)}else{this.startMousePos=this.offtimeTuneBaseZeroPos+(a*this.gridLineHeight+1)}if(this.newEntry.timeFrom.h==23)this.newEntry.timeTo={h:23,m:59};else this.newEntry.timeTo={h:this.newEntry.timeFrom.h+1,m:this.newEntry.timeFrom.m};this.newEntry.changeTimeCallback(this.newEntry.timeFrom,this.newEntry.timeTo);this.newEntry.entryNode.style.top=this.startMousePos+"px"}};i.prototype.handleMousemove=function(e){if(this.createEntryMode){var t=this.calendar.util.getMousePos(e).y,i=Math.min(Math.max(t-this.startMousePos,10),this.offtimeBottomBasePos-parseInt(this.newEntry.entryNode.style.top));this.newEntry.entryNode.style.height=i+"px";this.newEntry.timeTo=this.getTimeByPos(i+this.startMousePos-this.offtimeTuneBaseZeroPos);this.newEntry.changeTimeCallback(this.newEntry.timeFrom,this.newEntry.timeTo)}};i.prototype.handleMouseup=function(e){BX.unbind(document,"mousemove",BX.proxy(this.offHoursMousemove,this));BX.unbind(document,"mouseup",BX.proxy(this.offHoursMouseup,this));BX.removeCustomEvent(this.calendar,"keyup",BX.proxy(this.checkKeyup,this));if(this.createEntryMode){var t=new Date(this.newEntry.dayFrom.date.getTime()),i=new Date(this.newEntry.dayFrom.date.getTime());t.setHours(this.newEntry.timeFrom.h,this.newEntry.timeFrom.m,0,0);i.setHours(this.newEntry.timeTo.h,this.newEntry.timeTo.m,0,0);this.deselectEntry();this.showSimplePopupForNewEntry({entry:this.newEntry,entryTime:{from:t,to:i}});this.createEntryMode=false}};i.prototype.checkKeyup=function(e){var t=this.util.getKeyCodes();if(e.keyCode==t["escape"]&&this.createEntryMode&&this.newEntry){BX.remove(this.newEntry.entryNode);this.createEntryMode=false;this.handleMouseup()}};i.prototype.buildTopNewEntryWrap=function(e){var t=this,i,s,a,r,n,o="calendar-event-line-wrap",l=0,d=e.dayFrom,h,p,c=1,f=this.calendar.sectionController.getCurrentSection(),u=f.color;i=this.entryController.getTimeForNewEntry(d.date);s=this.entryController.getDefaultEntryName();a=e.holder.appendChild(BX.create("DIV",{props:{className:o},style:{top:0,left:this.dayCount>1?"calc((100% / "+this.dayCount+") * ("+(d.dayOffset+1)+" - 1) + 2px)":"2px",width:"calc("+c+" * 100% / "+this.dayCount+" - "+l+"px)"}}));n=a.appendChild(BX.create("DIV",{props:{className:"calendar-event-line-inner-container"}}));r=n.appendChild(BX.create("DIV",{props:{className:"calendar-event-line-inner"}}));r.appendChild(BX.create("SPAN",{props:{className:"calendar-event-line-time"},text:this.calendar.util.formatTime(i.from.getHours(),i.from.getMinutes())}));r.appendChild(BX.create("SPAN",{props:{className:"calendar-event-line-text"},text:s}));a.style.backgroundColor=u;a.style.borderColor=u;a.style.opacity=0;var m=BX.pos(a);var y=BX.adjust(document.body.appendChild(a.cloneNode(true)),{props:{className:"calendar-event-line-clone"},style:{width:m.width+1+"px",height:m.height+"px",top:m.top+"px",left:m.left+"px",opacity:1}});if(a){BX.remove(a,true)}p=y.querySelector(".calendar-event-line-text");h=y.querySelector(".calendar-event-line-time");r=y.querySelector(".calendar-event-line-inner");var g={entryNode:y,innerNode:r,section:f,entryName:s,entryTime:i,changeTimeCallback:function(e,i){if(e.getHours&&i.getHours){h.innerHTML=t.calendar.util.formatTime(e.getHours(),e.getMinutes())}else{h.innerHTML=t.calendar.util.formatTime(e.h,e.m)}},changeNameCallback:function(e){p.innerHTML=BX.util.htmlspecialchars(e)}};this.selectEntryPart(g,u,false);return g};i.prototype.buildTimelineNewEntryWrap=function(e){var t=this,i,s,a,r,n="calendar-event-block-wrap",o=e.dayFrom,l,d,h,p,c,f,u=this.calendar.sectionController.getCurrentSection(),m=u.color;i=this.entryController.getTimeForNewEntry(o.date);s=this.entryController.getDefaultEntryName();a=e.holder.appendChild(BX.create("DIV",{props:{className:n},style:{top:top,height:this.gridLineHeight+"px",minHeight:"20px",left:this.dayCount>1?"calc((100% / "+this.dayCount+") * "+o.dayOffset+" + 2px)":"2px",width:"calc(100% / "+this.dayCount+" - "+this.lastEntryWidthOffset+"px)"}}));l=a.appendChild(BX.create("DIV",{props:{className:"calendar-event-block-border"}}));r=a.appendChild(BX.create("DIV",{props:{className:"calendar-event-block-inner"}}));d=r.appendChild(BX.create("DIV",{props:{className:"calendar-event-block-background"}}));h=this.calendar.util.formatTime(i.from.getHours(),i.from.getMinutes())+" &ndash; "+this.calendar.util.formatTime(i.to.getHours(),i.to.getMinutes());r.appendChild(BX.create("SPAN",{props:{className:"calendar-event-block-time"},style:{color:"#fff"},html:h+'<span class="calendar-event-block-time-shadow">'+h+"</span>"}));r.appendChild(BX.create("SPAN",{props:{className:"calendar-event-block-text"},style:{color:"#fff"},text:s}));l.style.backgroundColor=m;d.style.backgroundColor=m;var y=BX.pos(a);var g=BX.adjust(document.body.appendChild(a.cloneNode(true)),{props:{className:"calendar-event-line-clone calendar-event-block-wrap active"},style:{width:y.width+1+"px",height:y.height+"px",top:y.top+"px",left:y.left+"px",opacity:1}});if(a){BX.remove(a,true)}c=g.querySelector(".calendar-event-block-text");p=g.querySelector(".calendar-event-block-time");r=g.querySelector(".calendar-event-block-inner");l=g.querySelector(".calendar-event-block-border");d=g.querySelector(".calendar-event-block-background");f=g.appendChild(BX.create("DIV",{props:{className:"calendar-event-bind-node"}}));if(this.dayCount==1)f.style.right="10%";else f.style.left="0";var C={entryNode:g,innerNode:r,section:u,entryName:s,bindNode:f,borderNode:l,blockBackgroundNode:d,changeTimeCallback:function(e,i){var s;if(e.getHours&&i.getHours){s=t.calendar.util.formatTime(e.getHours(),e.getMinutes())+" &ndash; "+t.calendar.util.formatTime(i.getHours(),i.getMinutes())}else{s=t.calendar.util.formatTime(e.h,e.m)+" &ndash; "+t.calendar.util.formatTime(i.h,i.m)}p.innerHTML=s+'<span class="calendar-event-block-time-shadow">'+s+"</span>"},changeNameCallback:function(e){c.innerHTML=BX.util.htmlspecialchars(e)}};this.selectEntryPart(C,m,false);return C};i.prototype.showSimplePopupForNewEntry=function(e){this.showSimplePopup({entryNode:e.entry.entryNode,bindNode:e.entry.bindNode,section:e.entry.section,entryTime:e.entryTime||e.entry.entryTime,entryName:e.entry.entryName,changeTimeCallback:e.entry.changeTimeCallback,changeNameCallback:e.entry.changeNameCallback,closeCallback:BX.delegate(function(){BX.remove(e.entry.entryNode)},this),changeDateCallback:BX.delegate(function(e){},this),changeSectionCallback:function(t){var i=t.color;if(e.entry.borderNode)e.entry.borderNode.style.backgroundColor=i;if(e.entry.blockBackgroundNode)e.entry.blockBackgroundNode.style.backgroundColor=i},saveCallback:function(){},cancelCallback:function(){},fullFormCallback:BX.delegate(this.showEditSlider,this)})};function s(){t.apply(this,arguments);this.initConfig();this.preBuild()}s.prototype=Object.create(i.prototype);s.prototype.constructor=s;s.prototype.show=function(){t.prototype.show.apply(this,arguments);this.buildDaysGrid();if(this.calendar.navCalendar)this.calendar.navCalendar.hide();this.displayEntries();this.calendar.initialViewShow=false};s.prototype.initConfig=function(){i.prototype.initConfig.apply(this,arguments);this.name="week";this.title=BX.message("EC_VIEW_WEEK");this.contClassName="calendar-week-view";this.gridWrapClass="calendar-grid-wrap";this.fullDayContClass="calendar-grid-week-full-days-events-holder";this.outerGridClass="calendar-grid-week-container";this.gridClass="calendar-grid-week";this.gridClassCurrent="calendar-grid-week-current";this.gridClassNext="calendar-grid-week-left-slide";this.gridClassPrevious="calendar-grid-week-right-slide";this.changeNextClass="calendar-change-week-left-slide";this.changePreviousClass="calendar-change-week-right-slide";this.gridRowClass="calendar-grid-week-row";this.gridCellClass="calendar-grid-week-cell";this.gridTimelinesClass="calendar-grid-week-time-lines";this.gridTimelineHourClass="calendar-grid-week-time-line-hour";this.gridTimelineHourLabelClass="calendar-grid-week-time-line-hour-label";this.topEntryHolderClass="calendar-grid-week-events-holder";this.gridNowTimeClass="calendar-grid-week-time-line-hour-now";this.gridNowTimeLabelClass="calendar-grid-week-time-line-hour-label";this.gridNowTimeLineClass="calendar-grid-week-time-line-hour-now-line";this.gridNowTimeDotClass="calendar-grid-week-time-line-hour-now-dot";this.dayCount=7};s.prototype.setTitle=function(){var e=this.calendar.getViewRangeDate(),i=e.getTime()/1e3,s=new Date(e.getTime()+this.dayCount*this.calendar.util.dayLength);if(e.getMonth()!=s.getMonth()){t.prototype.setTitle.apply(this,[BX.date.format("f",i)+" - "+BX.date.format("f",s.getTime()/1e3)+(this.util.showWeekNumber()?", #GRAY_START#"+BX.message("EC_DATE_WEEK_NUMBER").replace("#WEEK_NUMBER#",BX.date.format("W",i))+"#GRAY_END#":"")])}else{t.prototype.setTitle.apply(this,[BX.date.format("f",i)+(this.util.showWeekNumber()?", #GRAY_START#"+BX.message("EC_DATE_WEEK_NUMBER").replace("#WEEK_NUMBER#",BX.date.format("W",i))+"#GRAY_END#":"")])}};s.prototype.getAdjustedDate=function(e,t,s){if(!e){e=new Date}if(t&&e.getTime()<t.start.getTime()){e=new Date(t.start.getTime())}if(t&&e.getTime()>t.end.getTime()){e=new Date(t.end.getTime())}var a=this.util.getWeekStart();while(this.util.getWeekDayByInd(e.getDay())!=a){e.setDate(e.getDate()-1)}if(s){t.start.setDate(e.getTime());t.end.setDate(e.getTime()+this.calendar.util.dayLength*this.dayCount)}return i.prototype.getAdjustedDate.apply(this,[e,t])};s.prototype.adjustViewRangeToDate=function(e){var t=this.util.getWeekStart();while(this.util.getWeekDayByInd(e.getDay())!=t){e.setDate(e.getDate()-1)}return i.prototype.adjustViewRangeToDate.apply(this,[e])};function a(){t.apply(this,arguments);this.name="month";this.title=BX.message("EC_VIEW_MONTH");this.contClassName="calendar-month-view";this.dayCount=7;this.slotHeight=20;this.eventHolderTopOffset=25;this.preBuild()}a.prototype=Object.create(t.prototype);a.prototype.constructor=a;a.prototype.preBuild=function(){this.viewCont=BX.create("DIV",{props:{className:this.contClassName},style:{display:"none"}})};a.prototype.build=function(){this.titleCont=this.viewCont.appendChild(BX.create("DIV",{props:{className:"calendar-grid-month-row-days-week"}}));this.gridWrap=this.viewCont.appendChild(BX.create("DIV",{props:{className:"calendar-grid-wrap"}}));this.gridMonthContainer=this.gridWrap.appendChild(BX.create("DIV",{props:{className:"calendar-grid-month-container"}}));this.grid=this.gridMonthContainer.appendChild(BX.create("DIV",{props:{className:"calendar-grid-month calendar-grid-month-current"}}))};a.prototype.show=function(){t.prototype.show.apply(this,arguments);this.buildDaysTitle();this.buildDaysGrid();if(this.calendar.navCalendar)this.calendar.navCalendar.hide();this.displayEntries();this.calendar.initialViewShow=false};a.prototype.hide=function(){t.prototype.hide.apply(this,arguments)};a.prototype.increaseViewRangeDate=function(){this.changeViewRangeDate(1);var e=this.gridMonthContainer.appendChild(BX.create("DIV",{props:{className:"calendar-grid-month calendar-grid-month-next"+" "+this.animateClass}}));BX.addClass(this.grid,this.animateClass);this.setTitle();this.buildDaysGrid({grid:e});this.preloadEntries();setTimeout(BX.delegate(function(){BX.addClass(this.gridMonthContainer,"calendar-change-month-next");setTimeout(BX.delegate(function(){BX.removeClass(this.gridMonthContainer,"calendar-change-month-next");BX.removeClass(e,"calendar-grid-month-next");BX.addClass(e,"calendar-grid-month-current");BX.remove(this.grid);this.grid=e;BX.removeClass(this.grid,this.animateClass);this.displayEntries()},this),400)},this),0)};a.prototype.decreaseViewRangeDate=function(){this.changeViewRangeDate(-1);var e=this.gridMonthContainer.insertBefore(BX.create("DIV",{props:{className:"calendar-grid-month calendar-grid-month-previous"+" "+this.animateClass}}),this.grid);BX.addClass(this.grid,this.animateClass);this.setTitle();this.buildDaysGrid({grid:e});this.preloadEntries();setTimeout(BX.delegate(function(){BX.addClass(this.gridMonthContainer,"calendar-change-month-previous");setTimeout(BX.delegate(function(){BX.removeClass(this.gridMonthContainer,"calendar-change-month-previous");BX.removeClass(e,"calendar-grid-month-previous");BX.addClass(e,"calendar-grid-month-current");BX.remove(this.grid);this.grid=e;BX.removeClass(this.grid,this.animateClass);this.displayEntries()},this),400)},this),0)};a.prototype.getViewRange=function(){var e=this.calendar.getViewRangeDate(),t=new Date(e.getTime());t.setMonth(e.getMonth()+1);return{start:e,end:t}};a.prototype.changeViewRangeDate=function(e){var t=this.calendar.getViewRangeDate(),i=new Date(t.getTime());i.setMonth(i.getMonth()+e);this.calendar.setViewRangeDate(i);return i};a.prototype.adjustViewRangeToDate=function(e){var t=this.calendar.getViewRangeDate(),i=false;var s=e.getMonth()-t.getMonth();if(s==1){this.increaseViewRangeDate()}else if(s==-1){this.decreaseViewRangeDate()}else{if(e&&e.getTime){i=new Date(e.getTime());i.setDate(1);i.setHours(0,0,0,0);this.calendar.setViewRangeDate(i)}this.fadeAnimation(this.getContainer(),100,BX.delegate(function(){this.show();this.getContainer().style.opacity=0;this.showAnimation(this.getContainer(),300)},this))}return i};a.prototype.getAdjustedDate=function(e,t){if(!e){e=new Date}if(e.getTime()<t.start.getTime()){e=new Date(t.start.getTime())}if(e.getTime()>t.end.getTime()){e=new Date(t.end.getTime())}var i=this.calendar.getViewRangeDate(),s=false;if(e&&e.getTime){s=new Date(e.getTime());s.setDate(1);s.setHours(0,0,0,0)}return s};a.prototype.buildDaysTitle=function(){BX.cleanNode(this.titleCont);var e,t,i=this.util.getWeekDays();for(e=0;e<i.length;e++){t=i[e];this.titleCont.appendChild(BX.create("DIV",{props:{className:"calendar-grid-month-cell"},html:'<span class="calendar-grid-cell-inner">'+BX.message("EC_MONTH_WEEK_TITLE").replace("#DAY_OF_WEEK#",t[1])+"</span>"}))}};a.prototype.buildDaysGrid=function(e){if(!e)e={};var t,i,s=e.grid||this.grid,a=this.calendar.getViewRangeDate(),r=a.getFullYear(),n=a.getMonth(),o=this.util.getViewHeight(),l=BX.clone(this.getViewRange(),true),d=new Date;BX.cleanNode(s);d.setFullYear(r,n,1);this.dayIndex={};this.days=[];this.entryHolders=[];this.currentMonthRow=false;this.monthRows=[];if(this.util.getWeekStart()!=this.util.getWeekDayByInd(d.getDay())){i=this.util.getWeekDayOffset(this.util.getWeekDayByInd(d.getDay()));d.setDate(d.getDate()-i);l.start=new Date(d.getTime());l.start.setHours(0,0,0,0);for(t=0;t<i;t++){this.buildDayCell({date:d,month:"previous",grid:s});d.setDate(d.getDate()+1)}}d.setFullYear(r,n,1);while(d.getMonth()==n){this.buildDayCell({date:d,grid:s});d.setDate(d.getDate()+1)}if(this.util.getWeekStart()!=this.util.getWeekDayByInd(d.getDay())){i=this.util.getWeekDayOffset(this.util.getWeekDayByInd(d.getDay()));d.setFullYear(r,n+1,1);for(t=i;t<7;t++){this.buildDayCell({date:d,month:"next",grid:s});d.setDate(d.getDate()+1)}l.end=new Date(d.getTime());l.end.setHours(23,59,59,59)}this.calendar.setDisplayedViewRange(l);if(this.monthRows.length>0){this.rowHeight=Math.round(o/this.monthRows.length);this.slotsCount=Math.floor((this.rowHeight-this.eventHolderTopOffset)/this.slotHeight);for(t=0;t<this.monthRows.length;t++){this.monthRows[t].style.height=this.rowHeight+"px"}}};a.prototype.buildDayCell=function(e){var t=e.date,i="",s=Math.round(t.getTime()/1e3)*1e3,a=t.getDay(),r=this.util.getDayCode(t),n=this.util.getWeekDayByInd(a),o=false,l=this.util.getWeekStart()==n;if(l){this.currentMonthRow=e.grid.appendChild(BX.create("DIV",{props:{className:"calendar-grid-month-row"}}));this.monthRows.push(this.currentMonthRow);if(this.util.showWeekNumber())o=BX.date.format("W",s/1e3)}if(e.month=="previous"){i+=" calendar-grid-previous-month-day"}else if(e.month=="next"){i+=" calendar-grid-next-month-day"}if(this.util.isHoliday(t)){i+=" calendar-grid-holiday"}if(this.util.isToday(t)){i+=" calendar-grid-today"}this.days.push({date:new Date(t.getTime()),dayOffset:this.util.getWeekDayOffset(n),rowIndex:this.monthRows.length-1,holderIndex:this.entryHolders.length,node:this.currentMonthRow.appendChild(BX.create("DIV",{props:{className:BX.util.trim("calendar-grid-month-cell"+i)},attrs:{"data-bx-calendar-month-day":r},html:'<span class="calendar-grid-cell-inner">'+'<span class="calendar-num-day" data-bx-calendar-date="'+s+'">'+(t.getDate()==1?BX.message("EC_MONTH_SHORT").replace("#MONTH#",BX.date.format("M",s/1e3)).replace("#DATE#",t.getDate()):t.getDate())+"</span>"+(o?'<span class="calendar-num-week"  data-bx-cal-time="'+s+'" data-bx-calendar-weeknumber="'+o+'">'+o+"</span>":"")+"</span>"})),dayCode:r});this.dayIndex[this.days[this.days.length-1].dayCode]=this.days.length-1;this.calendar.dragDrop.registerDay(this.days[this.days.length-1]);if(this.currentMonthRow&&this.util.getWeekEnd()==n){this.entryHolders.push(this.currentMonthRow.appendChild(BX.create("DIV",{props:{className:"calendar-grid-month-events-holder"}})))}};a.prototype.setTitle=function(){var e=this.calendar.getViewRangeDate();t.prototype.setTitle.apply(this,[BX.date.format("f",e.getTime()/1e3)+", #GRAY_START#"+e.getFullYear()+"#GRAY_END#"])};a.prototype.displayEntries=function(e){var t,i,s,a,r,n,o,l,d,h=[],p,c,f=this.calendar.getDisplayedViewRange();if(!e)e={};if(e.reloadEntries!==false){this.entries=this.entryController.getList({startDate:new Date(f.start.getFullYear(),f.start.getMonth(),1),finishDate:new Date(f.end.getFullYear(),f.end.getMonth()+1,1),viewRange:f,finishCallback:BX.proxy(this.displayEntries,this)})}this.entryHolders.forEach(function(e){BX.cleanNode(e)});this.days.forEach(function(e){e.slots=[];e.entries={list:[],started:[],hidden:[]}});if(this.entries===false||!this.entries||!this.entries.length)return;for(i=0;i<this.entries.length;i++){a=this.entries[i];this.entriesIndex[a.uid]=i;a.cleanParts();d=false;for(n=this.dayIndex[a.startDayCode];n<this.days.length;n++){l=this.days[n];if(l.dayCode==a.startDayCode||d&&l.dayOffset==0){d=true;r=a.startPart({from:l,daysCount:0});l.entries.started.push({entry:a,part:r})}if(d){l.entries.list.push({entry:a,part:r});r.daysCount++;r.to=l;if(l.dayCode==a.endDayCode||l.dayOffset==this.dayCount-1){h.push({part:r,entry:a});if(l.dayCode==a.endDayCode){break}}}}}for(i=0;i<h.length;i++){this.displayEntryPiece(h[i])}for(n=0;n<this.days.length;n++){l=this.days[n];if(l.entries.started.length>0){if(l.entries.started.length>0)l.entries.started.sort(this.calendar.entryController.sort);for(i=0;i<l.entries.started.length;i++){element=l.entries.started[i];if(element){a=element.entry;o=element.part;p=false;for(s=0;s<this.slotsCount;s++){if(l.slots[s]!==false){this.occupySlot({slotIndex:s,startIndex:n,endIndex:n+o.daysCount});p=true;a.getWrap(o.partIndex).style.top=s*this.slotHeight+"px";break}}if(!p){t=l.entries.started[i-1];if(t){l.entries.hidden.push(t);t.entry.getWrap(t.part.partIndex).style.display="none"}l.entries.hidden.push(element);a.getWrap(o.partIndex).style.display="none"}}}}if(l.entries.list.length>0){c=false;for(i=0;i<l.entries.list.length;i++){if(l.entries.list[i].part.params.wrapNode.style.display=="none"){c=true;break}}if(c){l.hiddenStorage=this.entryHolders[l.holderIndex].appendChild(BX.create("DIV",{props:{className:"calendar-event-line-wrap calendar-event-more-btn-container"},attrs:{"data-bx-calendar-show-all-events":l.dayCode},style:{top:this.rowHeight-42+"px",left:"calc((100% / "+this.dayCount+") * ("+(l.dayOffset+1)+" - 1) + 2px)",width:"calc(100% / "+this.dayCount+" - 3px)"}}));l.hiddenStorageText=l.hiddenStorage.appendChild(BX.create("span",{props:{className:"calendar-event-more-btn"}}));l.hiddenStorage.style.display="block";l.hiddenStorageText.innerHTML=BX.message("EC_SHOW_ALL")+" "+l.entries.list.length}else if(l.hiddenStorage){l.hiddenStorage.style.display="none"}}}BX.addClass(this.gridMonthContainer,"calendar-events-holder-show")};a.prototype.displayEntryPiece=function(e){var t=false,i=e.entry,s=e.part.from,a=e.part.daysCount,r,n,o,l,d,h,p,c="calendar-event-line-wrap",f=0,u,m,y=e.holder||this.entryHolders[s.holderIndex];if(y){if(i.isFullDay()){c+=" calendar-event-line-fill"}else if(i.isLongWithTime()){c+=" calendar-event-line-border"}if(i.isExternal()){c+=" calendar-event-line-intranet"}if(!e.popupMode&&this.util.getDayCode(i.from)!==this.util.getDayCode(s.date)){c+=" calendar-event-line-start-yesterday";f+=8;u=this.getArrow("left",i.color,i.isFullDay())}if(!e.popupMode&&this.util.getDayCode(i.to)!==this.util.getDayCode(e.part.to.date)){c+=" calendar-event-line-finish-tomorrow";m=this.getArrow("right",i.color,i.isFullDay());f+=12}if(u&&!m){f+=4}if(f==0){f=5}r=BX.create("DIV",{attrs:{"data-bx-calendar-entry":i.uid},props:{className:c},style:{top:0,left:"calc((100% / "+this.dayCount+") * ("+(s.dayOffset+1)+" - 1) + 2px)",width:"calc("+a+" * 100% / "+this.dayCount+" - "+f+"px)"}});if(u){r.appendChild(u);r.style.left="9px"}if(m){r.appendChild(m)}p=r.appendChild(BX.create("DIV",{props:{className:"calendar-event-line-inner-container"}}));o=p.appendChild(BX.create("DIV",{props:{className:"calendar-event-line-inner"}}));n=o.appendChild(BX.create("DIV",{props:{className:"calendar-event-line-dot"}}));if(i.isFullDay()){o.style.maxWidth="calc(200% / "+a+" - 3px)"}else if(i.isLongWithTime()){r.style.borderColor=i.color;o.style.maxWidth="calc(200% / "+a+" - 3px)";if(e.part.partIndex==0){d=o.appendChild(BX.create("SPAN",{props:{className:"calendar-event-line-time"},text:this.calendar.util.formatTime(i.from.getHours(),i.from.getMinutes())}));o.style.width="calc(100% / "+a+" - 3px)"}if(e.part.partIndex==i.parts.length-1){if(a>1&&i.parts.length>1){o.style.width="calc("+(a-1)+"00% / "+a+" - 3px)"}if(!e.popupMode){h=o.appendChild(BX.create("SPAN",{props:{className:i.parts.length>1&&a==1?"calendar-event-line-time":"calendar-event-line-expired-time"},text:this.calendar.util.formatTime(i.to.getHours(),i.to.getMinutes())}))}}}else{d=o.appendChild(BX.create("SPAN",{props:{className:"calendar-event-line-time"},text:this.calendar.util.formatTime(i.from.getHours(),i.from.getMinutes())}))}l=o.appendChild(BX.create("SPAN",{props:{className:"calendar-event-line-text"},text:e.entry.name}));if(i.isFullDay()){p.style.backgroundColor=this.calendar.util.hexToRgba(i.color,.3);p.style.borderColor=this.calendar.util.hexToRgba(i.color,.3)}else{if(i.isLongWithTime()){p.style.borderColor=this.calendar.util.hexToRgba(i.color,.5)}n.style.backgroundColor=i.color}y.appendChild(r);if(i.opacity!==undefined){r.style.opacity=i.opacity}t={wrapNode:r,nameNode:l,innerContainer:p,innerNode:o,timeNode:d||false,endTimeNode:h||false,dotNode:n};if(!e.popupMode){e.entry.registerPartNode(e.part,t)}this.calendar.dragDrop.registerEntry(r,e)}return t};a.prototype.refreshEventsOnWeek=function(e){var t=e*7,i=(e+1)*7,s,a,r,n,o,l,d,h,p=[],c=5,f=0;for(o=0;o<c;o++)p[o]=0;for(a=t;a<i;a++){s=this.activeDateObjDays[a];if(!s)continue;s.arEvents.hidden=[];n=s.arEvents.begining;h=[];if(n.length>0){n.sort(function(e,t){if(t.daysCount==e.daysCount&&e.daysCount==1)return e.oEvent.DT_FROM_TS-t.oEvent.DT_FROM_TS;return t.daysCount-e.daysCount});e:for(r=0;r<n.length;r++){l=n[r];if(!l)continue;if(!this.arEvents[l.oEvent.ind]){s.arEvents.begining=n=BX.util.deleteFromArray(n,r);l=n[r];if(!l)continue}for(o=0;o<this.maxEventCount;o++){if(p[o]-f<=0){p[o]=f+l.daysCount;this.ShowEventOnLevel(l.oEvent.oParts[l.partInd],o,e);continue e}}h[l.oEvent.ID]=true;s.arEvents.hidden.push(l)}}d=s.arEvents.all;for(var u=0;u<d.length;u++){l=d[u];if(!l||h[l.oEvent.ID]){continue}if(!this.arEvents[l.oEvent.ind]){s.arEvents.all=d=BX.util.deleteFromArray(d,u);l=d[u];if(!l){continue}}if(l.oEvent.oParts&&l.partInd!=undefined&&l.oEvent.oParts[l.partInd]&&l.oEvent.oParts[l.partInd].style.display=="none"){s.arEvents.hidden.push(l)}}f++}};a.prototype.handleClick=function(e){if(this.isActive()){if(!e)e={};var t,i;if(e.specialTarget&&(i=e.specialTarget.getAttribute("data-bx-calendar-entry"))){this.handleEntryClick({uid:i,specialTarget:e.specialTarget,target:e.target,e:e.e})}else if(e.specialTarget&&(t=e.specialTarget.getAttribute("data-bx-calendar-show-all-events"))){this.deselectEntry();if(this.dayIndex[t]!==undefined&&this.days[this.dayIndex[t]]){this.showAllEventsInPopup({day:this.days[this.dayIndex[t]]})}}else if(!this.calendar.util.readOnlyMode()&&this.entryController.canDo(false,"add_event")&&(t=e.specialTarget&&e.specialTarget.getAttribute("data-bx-calendar-month-day"))){this.deselectEntry();if(this.dayIndex[t]!==undefined&&this.days[this.dayIndex[t]]){this.showNewEntryWrap({dayFrom:this.days[this.dayIndex[t]]})}}}};a.prototype.showNewEntryWrap=function(e){var t,i,s,a,r,n="calendar-event-line-wrap",o=0,l=e.dayFrom,d=1,h=this.entryHolders[l.holderIndex],p=this.calendar.sectionController.getCurrentSection(),c=p.color;t=this.entryController.getTimeForNewEntry(l.date);i=this.entryController.getDefaultEntryName();s=BX.create("DIV",{props:{className:n},style:{opacity:0,top:0,left:"calc((100% / "+this.dayCount+") * ("+(l.dayOffset+1)+" - 1) + 2px)",width:"calc("+d+" * 100% / "+this.dayCount+" - "+o+"px)"}});r=s.appendChild(BX.create("DIV",{props:{className:"calendar-event-line-inner-container"}}));a=r.appendChild(BX.create("DIV",{props:{className:"calendar-event-line-inner"}}));a.appendChild(BX.create("SPAN",{props:{className:"calendar-event-line-time"},style:{color:"#fff"},text:this.calendar.util.formatTime(t.from.getHours(),t.from.getMinutes())}));a.appendChild(BX.create("SPAN",{props:{className:"calendar-event-line-text"},style:{color:"#fff"},text:i}));s.style.backgroundColor=c;s.style.borderColor=c;h.appendChild(s);var f=BX.pos(s);var u=BX.adjust(document.body.appendChild(s.cloneNode(true)),{props:{className:"calendar-event-line-clone"},style:{width:f.width-6+"px",height:f.height+"px",top:f.top+"px",left:f.left+1+"px"}});BX.addClass(h,"shifted");h.style.height=(this.slotsCount-1)*this.slotHeight+"px";setTimeout(function(){u.style.opacity="1"},100);setTimeout(BX.delegate(function(){this.showSimplePopup({entryTime:t,entryName:i,nameNode:u.querySelector(".calendar-event-line-text"),timeNode:u.querySelector(".calendar-event-line-time"),entryNode:u,section:p,closeCallback:function(){BX.cleanNode(u,true);BX.cleanNode(s,true);BX.removeClass(h,"shifted");h.style.height="1px"},changeDateCallback:BX.delegate(function(e){var t=this.util.getDayCode(e);if(t&&this.dayIndex[t]!==undefined&&this.days[this.dayIndex[t]]){var i=this.days[this.dayIndex[t]];s.style.left="calc((100% / "+this.dayCount+") * ("+(i.dayOffset+1)+" - 1) + 2px)";this.entryHolders[i.holderIndex].appendChild(s);var a=BX.pos(s);BX.adjust(u,{style:{width:a.width+1+"px",height:a.height+"px",top:a.top+"px",left:a.left+"px"}})}},this),saveCallback:function(){},changeSectionCallback:function(e){var t=e.color;if(u){u.style.background=t;u.style.borderColor=t}},fullFormCallback:BX.delegate(this.showEditSlider,this)})},this),200)};function r(e){t.apply(this,arguments);this.name="year";this.title=BX.message("EC_VIEW_YEAR");this.contClassName="calendar-year-view";this.build()}r.prototype=Object.create(t.prototype);r.prototype.constructor=r;function n(){t.apply(this,arguments);this.name="list";this.filterMode=false;this.title=BX.message("EC_VIEW_LIST");this.contClassName="calendar-list-view";this.loadDaysBefore=30;this.animateAmount=5;this.loadLimitPrevious=5;this.loadLimit=15;this.loadDaysAfter=60;this.SCROLL_DELTA_HEIGHT=200;this.todayCode=this.calendar.util.getDayCode(new Date);this.preBuild()}n.prototype=Object.create(t.prototype);n.prototype.constructor=n;n.prototype.preBuild=function(){this.viewCont=BX.create("DIV",{props:{className:this.contClassName},style:{display:"none"}});BX.addCustomEvent(this.calendar,"afterSetView",BX.delegate(function(e){if(e.viewName!==this.name&&this.filterMode){this.resetFilterMode()}},this))};n.prototype.build=function(){this.titleCont=this.viewCont.appendChild(BX.create("DIV",{props:{className:"calendar-grid-month-row-days-week"}}));this.streamScrollWrap=this.viewCont.appendChild(BX.create("DIV",{props:{className:"calendar-timeline-stream-container calendar-custom-scroll"},style:{height:this.util.getViewHeight()+"px"},events:{scroll:BX.proxy(this.scrollHandle,this)}}));this.streamContentWrap=this.streamScrollWrap.appendChild(BX.create("DIV",{props:{className:"calendar-timeline-stream-container-content"}}));this.topLoaderBlock=this.streamContentWrap.appendChild(BX.create("DIV",{props:{className:"calendar-timeline-loader-block"}}));this.listWrap=this.streamContentWrap.appendChild(BX.create("DIV",{props:{className:"calendar-timeline-stream-container-list"}}));this.bottomLoaderBlock=this.streamContentWrap.appendChild(BX.create("DIV",{props:{className:"calendar-timeline-loader-block"}}))};n.prototype.setTitle=function(){var e=this.calendar.getViewRangeDate();t.prototype.setTitle.apply(this,[BX.date.format("f",e.getTime()/1e3)+", #GRAY_START#"+e.getFullYear()+"#GRAY_END#"])};n.prototype.show=function(e){if(!e)e={};t.prototype.show.apply(this,arguments);this.showNavigationCalendar();BX.remove(this.calendar.additionalInfoOuter);this.displayedRange=this.calendar.entryController.getLoadedEntiesLimits();this.calendar.setDisplayedViewRange(this.displayedRange);if(e.displayEntries!==false){this.displayEntries()}this.nothingToLoadNext=false;this.nothingToLoadPrevious=false};n.prototype.displayEntries=function(e){if(!e)e={};if(e.reloadEntries!==false){this.entries=this.entryController.getList({startDate:this.displayedRange.start,finishDate:this.displayedRange.end,viewRange:this.displayedRange,finishCallback:BX.proxy(this.displayEntries,this)})}BX.cleanNode(this.listWrap);this.dateGroupIndex={};this.groups=[];this.groupsDayCodes=[];this.groupsIndex={};this.entryListIndex={};if(this.entries===false||!this.entries||!this.entries.length){this.showEmptyBlock();return}if(this.noEntriesWrap){this.noEntriesWrap.style.display="none"}this.streamContentWrap.style.display="";this.entryParts=[];this.attachEntries(this.entries,false,BX.delegate(this.focusOnDate,this));setTimeout(BX.delegate(this.focusOnDate,this),100)};n.prototype.displayResult=function(e){this.streamContentWrap.style.display="";if(this.filterLoaderWrap){this.filterLoaderWrap.style.display="none"}BX.addClass(this.streamContentWrap,"calendar-timeline-stream-search-result");BX.cleanNode(this.listWrap);this.dateGroupIndex={};this.groups=[];this.groupsDayCodes=[];this.groupsIndex={};this.entryListIndex={};this.resultEntries=e;this.resultEntriesIndex={};e.forEach(function(e,t){this.resultEntriesIndex[e.uid]=t},this);if(e===false||!e||!e.length){this.showEmptyBlock();return}if(this.noEntriesWrap){this.noEntriesWrap.style.display="none"}this.streamContentWrap.style.display="";this.entryParts=[];this.attachEntries(e,"next")};n.prototype.attachEntries=function(e,t,i){if(!e&&!e.length)return;var s=this.entries.length-e.length,a=s,r,n,o,l;e.forEach(function(e){e.globalIndex=a++;o=this.calendar.util.getDayCode(e.from);l=this.calendar.util.getDayCode(e.to);n=0;this.entryParts.push({index:n,dayCode:o,from:e.from,entry:e});if(o!=l){r=new Date(e.from.getTime()+this.calendar.util.dayLength);while(r.getTime()<e.to.getTime()){this.entryParts.push({index:++n,dayCode:this.calendar.util.getDayCode(r),from:r,entry:e});r=new Date(r.getTime()+this.calendar.util.dayLength)}e.lastPartIndex=n}},this);var d=false;this.entryParts.sort(function(e,t){if(e.dayCode==t.dayCode){if(e.entry.isTask()!==t.entry.isTask()){if(e.entry.isTask())return 1;if(t.entry.isTask())return-1}if(e.entry.isFullDay()!==t.entry.isFullDay()){if(e.entry.isFullDay())return-1;if(t.entry.isFullDay())return 1}}if(e.index>0||t.index>0){return!d?e.index-t.index:t.index-e.index}return!d?e.entry.from.getTime()-t.entry.from.getTime():t.entry.from.getTime()-e.entry.from.getTime()});this.today=new Date;this.animationMode=t;this.currentDisplayedEntry=0;this.actuallyAnimatedEntryCount=0;this.displayEntry(this.entryParts[this.currentDisplayedEntry],t,i)};n.prototype.displayEntry=function(e,t,i){var s;if(e.from.getTime()>this.today.getTime()&&!this.groups[this.groupsIndex[this.todayCode]]&&!this.filterMode){this.createEntryGroupForDate(this.today,t)}s=this.groups[this.groupsIndex[e.dayCode]];if(!s){this.createEntryGroupForDate(e.from,t);s=this.groups[this.groupsIndex[e.dayCode]]}if(s.emptyWarning){BX.remove(s.emptyWarning)}var a=this.getUniqueId(e);if(this.actuallyAnimatedEntryCount>this.animateAmount){t=false;this.animationMode=false}var r=!this.entryListIndex[a];if(r){this.entryListIndex[a]=true;var n,o,l,d,h,p,c=e.entry;this.entriesIndex[c.uid]=c.globalIndex;if(c.isFullDay()){n=BX.message("EC_ALL_DAY")}else if(c.isLongWithTime()){if(e.index===0)n=this.calendar.util.formatTime(c.from);else if(e.index===c.lastPartIndex)n=BX.message("EC_TILL_TIME").replace("#TIME#",this.calendar.util.formatTime(c.to));else n=BX.message("EC_ALL_DAY")}else{n=this.calendar.util.formatTime(c.from.getHours(),c.from.getMinutes())+" &ndash; "+this.calendar.util.formatTime(c.to.getHours(),c.to.getMinutes())}o=s.content.appendChild(BX.create("DIV",{attrs:{"data-bx-calendar-entry":c.uid},props:{className:"calendar-timeline-stream-content-event"+(t?" calendar-timeline-stream-section-event-animate-"+t:"")}}));l=o.appendChild(BX.create("DIV",{props:{className:"calendar-timeline-stream-content-event-time"},html:'<span class="calendar-timeline-stream-content-event-time-link">'+n+"</span>"}));var f=this.calendar.util.getTextLocation(c.location)||"";if(f){f='<span class="calendar-timeline-stream-content-event-location">('+BX.util.htmlspecialchars(f)+")</span>"}d=o.appendChild(BX.create("DIV",{props:{className:"calendar-timeline-stream-content-event-name"},html:'<span class="calendar-timeline-stream-content-event-color" style="background-color: '+c.color+'"></span><span class="calendar-timeline-stream-content-event-name-link">'+BX.util.htmlspecialchars(c.name)+"</span>"+f}));h=o.appendChild(BX.create("DIV",{props:{className:"calendar-timeline-stream-content-event-members"}}));if(c.isMeeting()&&c.getAttendees().length>0){this.showAttendees(h,c.getAttendees().filter(function(e){return e.STATUS=="Y"||e.STATUS=="H"}),c.getAttendees().length)}else if(c.isPersonal()){h.innerHTML=BX.message("EC_EVENT_IS_MINE")}e.DOM={};if(e.dayCode==this.todayCode&&BX.type.isFunction(i)){i()}}if(this.currentDisplayedEntry<this.entryParts.length-1){this.currentDisplayedEntry++;if(t&&r){this.actuallyAnimatedEntryCount++;setTimeout(BX.delegate(function(){this.displayEntry(this.entryParts[this.currentDisplayedEntry],t,i)},this),300)}else{if(this.currentDisplayedEntry%30==0){setTimeout(BX.delegate(function(){this.displayEntry(this.entryParts[this.currentDisplayedEntry],t,i)},this),1e3)}else{this.displayEntry(this.entryParts[this.currentDisplayedEntry],t,i)}}}else if(this.currentDisplayedEntry==this.entryParts.length-1&&!this.filterMode){this.animationMode=false;if(!this.groups[this.groupsIndex[this.todayCode]]){this.createEntryGroupForDate(this.today,t)}this.groupsDayCodes.sort();if(BX.type.isFunction(i)){i()}}};n.prototype.showAttendees=function(e,t,i){var s,a,r=5,n=t.length,o=7;if(n>0){if(n>o){n=r}for(s=0;s<n;s++){a=t[s]||{};e.appendChild(BX.create("IMG",{attrs:{id:"simple_view_popup_"+a.ID,src:a.AVATAR||""},props:{title:a.DISPLAY_NAME,className:"calendar-member"}}));(function(e){setTimeout(function(){BX.tooltip(e,"simple_view_popup_"+e)},100)})(a.ID)}if(n<t.length){var l=e.appendChild(BX.create("SPAN",{props:{className:"calendar-member-more-count"},text:" "+BX.message("EC_ATTENDEES_MORE").replace("#COUNT#",t.length-n),events:{click:BX.delegate(function(){this.showUserListPopup(l,t)},this)}}))}}};n.prototype.showUserListPopup=function(e,t){if(this.userListPopup)this.userListPopup.close();this.popup.setAutoHide(false);if(!t||!t.length)return;this.DOM.userListPopupWrap=BX.create("DIV",{props:{className:"calendar-user-list-popup-block"}});t.forEach(function(e){var t=this.DOM.userListPopupWrap.appendChild(BX.create("DIV",{props:{className:"calendar-slider-sidebar-user-container calendar-slider-sidebar-user-card"}}));t.appendChild(BX.create("DIV",{props:{className:"calendar-slider-sidebar-user-block-avatar"}})).appendChild(BX.create("DIV",{props:{className:"calendar-slider-sidebar-user-block-item"}})).appendChild(BX.create("IMG",{props:{width:34,height:34,src:e.AVATAR}}));t.appendChild(BX.create("DIV",{props:{className:"calendar-slider-sidebar-user-info"}})).appendChild(BX.create("A",{props:{href:e.URL?e.URL:"#",className:"calendar-slider-sidebar-user-info-name"},text:e.DISPLAY_NAME}))},this);this.userListPopup=new BX.PopupWindow(this.calendar.id+"-view-user-list-popup",e,{autoHide:true,closeByEsc:true,offsetTop:0,offsetLeft:0,width:200,resizable:false,lightShadow:true,content:this.DOM.userListPopupWrap,className:"calendar-user-list-popup"});this.userListPopup.setAngle({offset:36});this.userListPopup.show();BX.addCustomEvent(this.userListPopup,"onPopupClose",BX.delegate(function(){this.popup.setAutoHide(true);this.userListPopup.destroy()},this))};n.prototype.appendDateGroup=function(e,t,i){var s,a,r,n,o,l,d=t.getDate(),h=t.getMonth()+1,p=t.getFullYear();if(!this.dateGroupIndex[p]){n=Infinity;o=p;for(s in this.dateGroupIndex){if(this.dateGroupIndex.hasOwnProperty(s)){if(Math.abs(p-s)<n){n=Math.abs(p-s);o=s}if(n==1){break}}}this.dateGroupIndex[p]={node:BX.create("DIV",{attrs:{"data-bx-calendar-list-year":p}}),monthIndex:{}};if(o==p){this.listWrap.appendChild(this.dateGroupIndex[p].node)}else{if(p-o>0){if(this.dateGroupIndex[o].node.nextSibling){BX.insertAfter(this.dateGroupIndex[p].node,this.dateGroupIndex[o].node)}else{this.listWrap.appendChild(this.dateGroupIndex[p].node)}}else{this.listWrap.insertBefore(this.dateGroupIndex[p].node,this.dateGroupIndex[o].node)}}}if(!this.dateGroupIndex[p].monthIndex[h]){n=Infinity;o=h;for(a in this.dateGroupIndex[p].monthIndex){if(this.dateGroupIndex[p].monthIndex.hasOwnProperty(a)){if(Math.abs(h-a)<n){n=Math.abs(h-a);o=a}if(n==1){break}}}this.dateGroupIndex[p].monthIndex[h]={node:BX.create("DIV",{attrs:{"data-bx-calendar-list-month":h}}),dayIndex:{}};if(o==h){this.dateGroupIndex[p].node.appendChild(this.dateGroupIndex[p].monthIndex[h].node)}else{if(h-o>0){if(this.dateGroupIndex[p].monthIndex[o].node.nextSibling){BX.insertAfter(this.dateGroupIndex[p].monthIndex[h].node,this.dateGroupIndex[p].monthIndex[o].node)}else{this.dateGroupIndex[p].node.appendChild(this.dateGroupIndex[p].monthIndex[h].node)}}else{this.dateGroupIndex[p].monthIndex[o].node.parentNode.insertBefore(this.dateGroupIndex[p].monthIndex[h].node,this.dateGroupIndex[p].monthIndex[o].node)}}}if(!this.dateGroupIndex[p].monthIndex[h].dayIndex[d]){n=Infinity;o=d;l=this.dateGroupIndex[p].monthIndex;for(r in l[h].dayIndex){if(l[h].dayIndex.hasOwnProperty(r)){if(Math.abs(d-r)<n){n=Math.abs(d-r);o=r}if(n==1){break}}}l[h].dayIndex[d]={node:BX.create("DIV",{props:{className:"calendar-timeline-stream-day"},attrs:{"data-bx-calendar-list-day":d}})};if(o==d){l[h].node.appendChild(l[h].dayIndex[d].node)}else{if(d-o>0){if(l[h].dayIndex[o].node.nextSibling){BX.insertAfter(l[h].dayIndex[d].node,l[h].dayIndex[o].node)}else{l[h].node.appendChild(l[h].dayIndex[d].node)}}else{l[h].node.insertBefore(l[h].dayIndex[d].node,l[h].dayIndex[o].node)}}}if(l[h].dayIndex[d].node){l[h].dayIndex[d].node.appendChild(e)}else{}setTimeout(function(){e.style.opacity="1"},0)};n.prototype.hide=function(){t.prototype.hide.apply(this,arguments)};n.prototype.getAdjustedDate=function(e,t){if(!e){e=new Date}var i=this.calendar.getViewRangeDate(),s=false;if(e&&e.getTime){s=new Date(e.getTime())}return s};n.prototype.adjustViewRangeToDate=function(e,t){if(this.viewCont.style.display=="none"){var i=false;if(e&&e.getTime){i=new Date(e.getTime());i.setHours(0,0,0,0);this.currentDate=i;this.calendar.setViewRangeDate(i)}if(t!==false){this.fadeAnimation(this.getContainer(),100,BX.delegate(function(){this.show();this.getContainer().style.opacity=0;this.showAnimation(this.getContainer(),300)},this))}else{this.show()}}else{var s=this.calendar.util.getDayCode(e);var a=BX.util.array_search(s,this.groupsDayCodes);if(a>=0&&this.groupsDayCodes[a]){this.focusOnDate(this.groupsDayCodes[a],true)}}return i};n.prototype.getViewRange=function(){var e=this.calendar.getViewRangeDate(),t=new Date(e.getTime());return{start:e,end:t}};n.prototype.increaseViewRangeDate=function(){var e=BX.util.array_search(this.focusedDayCode,this.groupsDayCodes);if(e>=0&&this.groupsDayCodes[e+1]){this.focusOnDate(this.groupsDayCodes[e+1],true)}};n.prototype.decreaseViewRangeDate=function(){var e=BX.util.array_search(this.focusedDayCode,this.groupsDayCodes);if(e>0&&this.groupsDayCodes[e-1]){this.focusOnDate(this.groupsDayCodes[e-1],true)}};n.prototype.createEntryGroupForDate=function(e,t){var i=this.calendar.util.getDayCode(e),s=Math.round(e.getTime()/1e3)*1e3,a={dayCode:i,wrap:BX.create("DIV",{props:{className:"calendar-timeline-stream-section-wrap"}})};a.titleNode=a.wrap.appendChild(BX.create("DIV",{props:{className:"calendar-timeline-stream-section calendar-timeline-section-date-label"},html:'<div data-bx-calendar-date="'+s+'" class="calendar-timeline-stream-section-content"><div class="'+(i==this.todayCode?"calendar-timeline-stream-today-label":"calendar-timeline-stream-label")+'">'+this.calendar.util.formatDateUsable(e)+"</div></div>"}));a.groupNode=a.wrap.appendChild(BX.create("DIV",{props:{className:"calendar-timeline-stream-section"}}));a.content=a.groupNode.appendChild(BX.create("DIV",{props:{className:"calendar-timeline-stream-section-content"}}));a.emptyWarning=a.content.appendChild(BX.create("DIV",{props:{className:"calendar-timeline-empty-section"},text:BX.message("EC_NO_EVENTS")}));this.groups.push(a);this.groupsIndex[i]=this.groups.length-1;this.groupsDayCodes.push(i);this.appendDateGroup(this.groups[this.groups.length-1].wrap,e,t)};n.prototype.focusOnDate=function(e,t){var i=false;if(BX.type.isDate(e))i=this.calendar.util.getDayCode(e);else if(BX.type.isString(e))i=e;else i=this.todayCode;this.focusedDayCode=i;if(this.groupsIndex&&this.groups[this.groupsIndex[i]]){this.bottomLoaderBlock.style.height=this.SCROLL_DELTA_HEIGHT+Math.max(0,this.util.getViewHeight()+this.groups[this.groupsIndex[i]].wrap.offsetTop-this.bottomLoaderBlock.offsetTop)+"px";if(t&&this.streamScrollWrap){new BX.easing({duration:300,start:{scrollTop:this.streamScrollWrap.scrollTop},finish:{scrollTop:this.groups[this.groupsIndex[i]].wrap.offsetTop},transition:BX.easing.makeEaseOut(BX.easing.transitions.quad),step:BX.delegate(function(e){this.streamScrollWrap.scrollTop=e.scrollTop},this),complete:BX.delegate(function(){this.streamScrollWrap.scrollTop=this.groups[this.groupsIndex[i]].wrap.offsetTop},this)}).animate()}else{setTimeout(BX.delegate(function(){if(this.streamScrollWrap&&this.groupsIndex[i]!==undefined&&this.groups[this.groupsIndex[i]]){this.streamScrollWrap.scrollTop=this.groups[this.groupsIndex[i]].wrap.offsetTop}},this),200)}}};n.prototype.scrollHandle=function(){if(!this.filterMode){if(this.streamScrollWrap.scrollHeight-this.util.getViewHeight()-this.streamScrollWrap.scrollTop<this.SCROLL_DELTA_HEIGHT&&!this.nothingToLoadNext){this.loadMoreEntries({mode:"next"})}else if(this.streamScrollWrap.scrollTop<this.SCROLL_DELTA_HEIGHT&&!this.nothingToLoadPrevious){this.loadMoreEntries({mode:"previous"})}}};n.prototype.loadMoreEntries=function(e){if(this.currentLoadMode||this.filterMode)return;this.currentLoadMode=e.mode;if(e.mode=="next"){this.loader=this.bottomLoaderBlock.appendChild(BX.adjust(this.calendar.util.getLoader(),{style:{height:"180px"}}));this.entryController.getList({loadNext:true,loadLimit:this.loadLimit,startDate:new Date(this.displayedRange.end.getFullYear(),this.displayedRange.end.getMonth(),this.displayedRange.end.getDate()+1),finishCallback:BX.proxy(this.loadMoreCallback,this)})}else{this.loader=this.topLoaderBlock.appendChild(BX.adjust(this.calendar.util.getLoader(),{style:{height:"180px"}}));this.entryController.getList({loadPrevious:true,loadLimit:this.loadLimitPrevious,finishDate:new Date(this.displayedRange.start.getFullYear(),this.displayedRange.start.getMonth(),this.displayedRange.start.getDate()-1),finishCallback:BX.proxy(this.loadMoreCallback,this)})}};n.prototype.loadMoreCallback=function(e){BX.remove(this.loader);this.displayedRange=this.calendar.entryController.getLoadedEntiesLimits();var t=this.entryController.getList({startDate:this.displayedRange.start,finishDate:this.displayedRange.end,finishCallback:BX.proxy(this.loadMoreCallback,this)});if(this.currentLoadMode=="next"&&e.finish)this.nothingToLoadNext=true;if(this.currentLoadMode=="previous"&&e.finish)this.nothingToLoadPrevious=true;if(!this.entries)this.entries=[];if(t&&t.length){this.entries=this.entries.concat(t);this.attachEntries(t,this.currentLoadMode=="next"?"next":false)}this.currentLoadMode=false};n.prototype.getUniqueId=function(e){return e.entry.uid+"|"+e.dayCode};n.prototype.handleClick=function(e){if(this.isActive()){if(!e)e={};var t,i;if(e.specialTarget&&(i=e.specialTarget.getAttribute("data-bx-calendar-entry"))){this.handleEntryClick({uid:i,specialTarget:e.specialTarget,target:e.target,e:e.e})}else if(e.specialTarget&&(t=e.specialTarget.getAttribute("data-bx-calendar-show-all-events"))){}else if(!this.calendar.util.readOnlyMode()&&this.entryController.canDo(true,"add_event")&&(t=e.specialTarget&&e.specialTarget.getAttribute("data-bx-calendar-week-day"))){this.deselectEntry();this.showSimplePopupForNewEntry({entry:this.buildTopNewEntryWrap({dayFrom:this.days[this.dayIndex[t]],holder:this.topEntryHolder})})}}};n.prototype.showEmptyBlock=function(t){if(!this.noEntriesWrap){this.noEntriesWrap=this.streamScrollWrap.appendChild(BX.create("DIV",{props:{className:"calendar-search-main"},style:{height:this.util.getViewHeight()+"px"}}));var i=this.noEntriesWrap.appendChild(BX.create("DIV",{props:{className:"calendar-search-empty"},html:'<div class="calendar-search-empty-name">'+BX.message("EC_NO_EVENTS")+"</div>"}));if(!this.calendar.util.readOnlyMode()){this.addButton=i.appendChild(BX.create("SPAN",{props:{className:"calendar-search-empty-link"},text:BX.message("EC_CREATE_EVENT"),events:{click:BX.proxy(function(){if(!this.calendar.editSlider){this.calendar.editSlider=new e.BXEventCalendar.EditEntrySlider(this.calendar)}this.calendar.editSlider.show({})},this)}}))}}this.streamContentWrap.style.display="none";this.noEntriesWrap.style.display=""};n.prototype.applyFilterMode=function(){this.filterMode=true;this.calendar.viewTitleContainer.style.display="none";this.calendar.navigationWrap.style.display="none";if(this.searchHead){BX.remove(this.searchHead)}this.searchHead=this.calendar.topBlock.appendChild(BX.create("DIV",{props:{className:"calendar-search-head"},html:'<div class="calendar-search-name">'+BX.message("EC_SEARCH_RESULT")+"</div>"}));if(this.resettFilterWrap){BX.remove(this.resettFilterWrap)}this.resettFilterWrap=this.searchHead.appendChild(BX.create("DIV",{props:{className:"calendar-search-cancel"},html:BX.message("EC_SEARCH_RESET_RESULT"),events:{click:BX.proxy(this.resetFilterMode,this)}}));if(this.streamScrollWrap){if(!this.filterLoaderWrap){this.filterLoaderWrap=this.streamScrollWrap.appendChild(BX.create("DIV",{props:{className:"calendar-search-main"},style:{height:this.util.getViewHeight()+"px"}}));var e=this.filterLoaderWrap.appendChild(BX.create("DIV",{props:{className:"calendar-search-empty"},html:'<div class="calendar-search-empty-name">'+BX.message("EC_NO_EVENTS")+"</div>"}))}this.streamContentWrap.style.display="none";this.filterLoaderWrap.style.display=""}};n.prototype.resetFilterMode=function(e){this.filterMode=false;this.resultEntries=[];this.calendar.viewTitleContainer.style.display="";this.calendar.navigationWrap.style.display="";this.setTitle();if(this.searchHead){BX.remove(this.searchHead)}if(this.resettFilterWrap){BX.remove(this.resettFilterWrap)}this.streamContentWrap.style.display="";if(this.filterLoaderWrap){this.filterLoaderWrap.style.display="none"}if(!e||e.resetSearchFilter!==false)this.calendar.search.resetFilter();if(this.isActive())this.displayEntries()};n.prototype.handleEntryClick=function(e){if(this.filterMode){if(this.resultEntriesIndex[e.uid]!==undefined){e.entry=this.resultEntries[this.resultEntriesIndex[e.uid]]}}t.prototype.handleEntryClick.apply(this,arguments)};if(e.BXEventCalendar){e.BXEventCalendar.CalendarView=t;e.BXEventCalendar.CalendarDayView=i;e.BXEventCalendar.CalendarWeekView=s;e.BXEventCalendar.CalendarMonthView=a;e.BXEventCalendar.CalendarYearView=r;e.BXEventCalendar.CalendarListView=n}else{BX.addCustomEvent(e,"onBXEventCalendarInit",function(){e.BXEventCalendar.CalendarView=t;e.BXEventCalendar.CalendarDayView=i;e.BXEventCalendar.CalendarWeekView=s;e.BXEventCalendar.CalendarMonthView=a;e.BXEventCalendar.CalendarYearView=r;e.BXEventCalendar.CalendarListView=n})}})(window);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:71:"/bitrix/js/calendar/new/calendar-view-transition.min.js?152740167518480";s:6:"source";s:51:"/bitrix/js/calendar/new/calendar-view-transition.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
(function(e){function t(e){this.calendar=e;this.util=e.util;this.WEEK_TOP_MIN_HEIGHT=21;this.defaultBg={r:255,g:255,b:255};this.currentBg={r:250,g:250,b:250}}t.prototype={transit:function(e){var t=e.currentView,i=e.newView,n=e.currentView.getName(),o=e.newView.getName();this.currentViewDate=e.currentViewDate;this.newViewDate=e.newViewDate;if(n=="month"&&o=="week"){this.fromMonthToWeek(t,i)}else if(n=="month"&&o=="day"){this.fromMonthToDay(t,i)}else if(n=="month"&&o=="list"){this.fromMonthToList(t,i)}else if(n=="week"&&o=="month"){this.fromWeekToMonth(t,i)}else if(n=="week"&&o=="day"){this.fromWeekToDay(t,i)}else if(n=="week"&&o=="list"){this.fromWeekToList(t,i)}else if(n=="day"&&o=="week"){this.fromDayToWeek(t,i)}else if(n=="day"&&o=="month"){this.fromDayToMonth(t,i)}else if(n=="day"&&o=="list"){this.fromDayToList(t,i)}else if(n=="list"&&o=="month"){this.fromListToMonth(t,i)}else if(n=="list"&&o=="week"){this.fromListToWeek(t,i)}else if(n=="list"&&o=="day"){this.fromListToDay(t,i)}this.calendar.currentViewName=i.getName();if(i.switchNode){BX.addClass(i.switchNode,"calendar-view-switcher-list-item-active")}if(t.switchNode){BX.removeClass(t.switchNode,"calendar-view-switcher-list-item-active")}},fromMonthToWeek:function(e,t){var i=this,n=255,o=255,a=255,s=234,d=249,l=254,r=100,h=310,y=100;t.viewCont.style.opacity=0;t.show();BX.removeClass(t.grid,"calendar-events-holder-show");BX.removeClass(t.fullDayEventsCont,"calendar-events-holder-show");BX.removeClass(e.gridMonthContainer,"calendar-events-holder-show");this.calendar.viewsCont.style.overflow="hidden";var w=parseInt(t.fullDayEventsCont.style.height)||this.WEEK_TOP_MIN_HEIGHT,c=BX.pos(t.viewCont),f=e.monthRows.length,g=this.util.getDayCode(this.newViewDate),v=Math.ceil((e.dayIndex[g]+1)/e.dayCount)-1;if(!e.monthRows[v])v=0;var C=e.monthRows[v].querySelectorAll(".calendar-grid-cell-inner");t.viewCont.style.display="block";t.viewCont.style.position="absolute";t.viewCont.style.top=0;t.viewCont.style.left=0;t.viewCont.style.width=c.width+"px";t.viewCont.style.height=c.height+"px";t.viewCont.style.zIndex=100;e.gridWrap.style.overflow="hidden";e.gridWrap.style.height=BX.pos(t.gridWrap).height+"px";t.outerGrid.style.paddingLeft=0;t.fullDayEventsCont.style.height=0;t.titleCont.style.paddingLeft=0;BX.addClass(e.viewCont,"calendar-animate-mod");this.firstStage=new BX.easing({duration:r,start:{red:n,green:o,blue:a},finish:{red:s,green:d,blue:l},step:function(t){e.monthRows[v].style.background="rgb("+t.red+","+t.green+","+t.blue+")";for(var i=0;i<C.length;i++){C[i].style.background="rgb("+t.red+","+t.green+","+t.blue+")"}},complete:function(){setTimeout(function(){BX.addClass(e.viewCont,"calendar-change-animate-month-to-week");BX.removeClass(e.gridMonthContainer,"calendar-events-holder-show");for(var n=0;n<f;n++){if(n!=v){e.monthRows[n].style.height=0;if(n+1<v){e.monthRows[n].style.borderBottom="none"}}else{e.monthRows[n].style.height=BX.pos(t.outerGrid).height+"px"}}setTimeout(function(){i.secontStage.animate()},50)},100)}});this.secontStage=new BX.easing({duration:h,start:{fadeShow:0,fadeHide:100},finish:{fadeShow:100,fadeHide:0},step:function(i){e.viewCont.style.opacity=i.fadeHide/100;t.viewCont.style.opacity=i.fadeShow/100},complete:BX.delegate(function(){this.thirdStage.animate();BX.addClass(t.grid,"calendar-events-holder-show");BX.addClass(t.fullDayEventsCont,"calendar-events-holder-show")},this)});this.thirdStage=new BX.easing({duration:y,start:{paddingLeft:0,topHolderHeight:0},finish:{paddingLeft:43,topHolderHeight:w},step:function(e){t.outerGrid.style.paddingLeft=e.paddingLeft+"px";t.titleCont.style.paddingLeft=e.paddingLeft+"px";t.fullDayEventsCont.style.height=e.topHolderHeight+"px"},complete:BX.delegate(function(){t.titleCont.style.paddingLeft="";e.gridMonthContainer.style.paddingLeft="";e.monthRows[v].style.background="";BX.removeClass(e.viewCont,"calendar-change-animate-month-to-week");this.adjustViewAnimate(e,t)},this)});this.firstStage.animate()},fromMonthToDay:function(e,t){e.viewCont.style.width=e.viewCont.offsetWidth+"px";t.viewCont.style.opacity=0;t.viewCont.style.zIndex=110;t.show();e.viewCont.style.position="absolute";e.viewCont.style.top=0;e.viewCont.style.left=0;var i=this.util.getDayCode(this.newViewDate);if(e.dayIndex[i]!==undefined&&e.days[e.dayIndex[i]]){var n=e.days[e.dayIndex[i]];var o=255,a=255,s=255,d=234,l=249,r=254,h=300,y=200,w=BX.pos(n.node),c=BX.pos(e.gridWrap),f=document.body.appendChild(BX.create("DIV",{props:{className:"calendar-animate-casper-day"},style:{top:w.top+"px",right:w.right+"px",bottom:w.bottom+"px",left:w.left+"px",height:w.height+"px",width:w.width+"px"}}));this.firstStage=new BX.easing({duration:h,start:{top:w.top,right:w.right,bottom:w.bottom,left:w.left,height:w.height,width:w.width,dayRed:o,dayGreen:a,dayBlue:s},finish:{top:c.top,right:c.right,bottom:c.bottom,left:c.left,height:c.height,width:c.width,dayRed:d,dayGreen:l,dayBlue:r},step:function(e){f.style.top=e.top+"px";f.style.right=e.right+"px";f.style.bottom=e.bottom+"px";f.style.left=e.left+"px";f.style.height=e.height+"px";f.style.width=e.width+"px";f.style.background="rgb("+e.dayRed+","+e.dayGreen+","+e.dayBlue+")"},complete:BX.delegate(function(){this.secondStage.animate();e.viewCont.style.opacity=0},this)});this.secondStage=new BX.easing({duration:y,start:{hide:100,show:0},finish:{hide:0,show:100},step:function(e){t.viewCont.style.opacity=e.show/100;f.style.opacity=e.hide/100},complete:BX.delegate(function(){BX.addClass(this.calendar.mainCont,"calendar-main-container-small-calendar");BX.remove(f);this.adjustViewAnimate(e,t)},this)});this.firstStage.animate()}},fromMonthToList:function(e,t){BX.addClass(this.calendar.mainCont,"calendar-main-container-small-calendar");t.show();this.adjustViewAnimate(e,t)},fromWeekToMonth:function(e,t){var i,n=this,o=255,a=255,s=255,d=234,l=249,r=254,h=100,y=75,w=75;t.viewCont.style.opacity=0;t.show();BX.removeClass(e.grid,"calendar-events-holder-show");BX.removeClass(e.fullDayEventsCont,"calendar-events-holder-show");BX.removeClass(t.gridMonthContainer,"calendar-events-holder-show");this.calendar.viewsCont.style.overflow="hidden";t.viewCont.style.display="block";var c=BX.pos(t.viewCont);t.viewCont.style.position="absolute";t.viewCont.style.top=0;t.viewCont.style.left=0;t.viewCont.style.width=c.width+"px";t.viewCont.style.height=c.height+"px";t.viewCont.style.zIndex=100;var f=this.util.getDayCode(this.currentViewDate),g=Math.ceil((t.dayIndex[f]+1)/t.dayCount)-1,v=e.outerGrid.querySelectorAll(".calendar-grid-cell-inner"),C=t.monthRows.length;if(!t.monthRows[g])g=0;var p=t.monthRows[g].querySelectorAll(".calendar-grid-cell-inner");BX.addClass(e.viewCont,"calendar-change-animate-week-to-month");for(i=0;i<p.length;i++){p[i].style.background="rgb("+d+","+l+","+r+")"}for(i=0;i<C;i++){t.monthRows[i].style.height=i!=g?0:BX.pos(e.outerGrid).height+"px"}BX.addClass(e.viewCont,"calendar-animate-mod");BX.addClass(t.viewCont,"calendar-animate-mod");this.firstStage=new BX.easing({duration:h,start:{topHolderHeight:parseInt(e.fullDayEventsCont.style.height)||0,paddingLeft:43,fadeHide:100,red:o,green:a,blue:s},finish:{topHolderHeight:0,paddingLeft:0,fadeHide:0,red:d,green:l,blue:r},step:function(t){for(i=0;i<v.length;i++){v[i].style.background="rgb("+t.red+","+t.green+","+t.blue+")"}e.timeLinesCont.style.opacity=t.fadeHide/100;e.outerGrid.style.paddingLeft=t.paddingLeft+"px";e.titleCont.style.paddingLeft=t.paddingLeft+"px";e.fullDayEventsCont.style.height=t.topHolderHeight+"px"},complete:function(){setTimeout(function(){t.viewCont.style.opacity=1;e.viewCont.style.opacity=0;n.secondStage.animate()},100)}});this.secondStage=new BX.easing({duration:y,start:{fadeHide:100},finish:{fadeHide:0},step:function(t){e.viewCont.style.opacity=t.fadeHide/100},complete:function(){for(i=0;i<C;i++){t.monthRows[i].style.height=t.rowHeight+"px"}setTimeout(function(){BX.addClass(t.gridMonthContainer,"calendar-events-holder-show");n.thirdStage.animate()},410)}});this.thirdStage=new BX.easing({duration:w,start:{red:d,green:l,blue:r},finish:{red:o,green:a,blue:s},step:function(e){for(i=0;i<p.length;i++){p[i].style.background="rgb("+e.red+","+e.green+","+e.blue+")"}},complete:BX.delegate(function(){e.outerGrid.style.paddingLeft="";e.titleCont.style.paddingLeft="";e.fullDayEventsCont.style.height="";e.viewCont.style.opacity=0;for(i=0;i<v.length;i++){v[i].style.background=""}for(i=0;i<p.length;i++){p[i].style.background=""}BX.removeClass(e.viewCont,"calendar-change-animate-week-to-month");this.adjustViewAnimate(e,t)},this)});this.firstStage.animate()},fromWeekToDay:function(e,t){t.viewCont.style.opacity=0;t.show();t.viewCont.style.display="block";var i=BX.pos(t.viewCont);t.viewCont.style.position="absolute";t.viewCont.style.top="0px";t.viewCont.style.left="0px";t.viewCont.style.width=i.width+"px";t.viewCont.style.height=i.height+"px";t.viewCont.style.zIndex="100";this.calendar.viewsCont.style.overflow="hidden";BX.removeClass(e.grid,"calendar-events-holder-show");BX.removeClass(e.fullDayEventsCont,"calendar-events-holder-show");BX.removeClass(t.grid,"calendar-events-holder-show");BX.removeClass(t.fullDayEventsCont,"calendar-events-holder-show");var n=255,o=255,a=255,s=234,d=249,l=254,r=this.util.getDayCode(this.newViewDate),h=e.days[e.dayIndex[r]],y=75,w=310,c=e.titleCont.children.length;if(!h){h=e.days[this.util.getWeekDayOffset(this.util.getWeekDayByInd(this.newViewDate.getDay()))]}BX.addClass(e.viewCont,"calendar-animate-mod");var f=new BX.easing({duration:y,start:{topHolderHeight:parseInt(e.fullDayEventsCont.style.height)||this.WEEK_TOP_MIN_HEIGHT,red:n,green:o,blue:a},finish:{topHolderHeight:this.WEEK_TOP_MIN_HEIGHT,red:s,green:d,blue:l},step:function(t){h.node.style.background="rgb("+t.red+","+t.green+","+t.blue+")";e.fullDayEventsCont.style.height=t.topHolderHeight+"px";if(e.titleCont.children[h.dayOffset]){e.titleCont.children[h.dayOffset].style.background="rgb("+t.red+","+t.green+","+t.blue+")"}},complete:function(){setTimeout(function(){BX.addClass(e.viewCont,"calendar-change-animate-week-to-day");BX.removeClass(e.gridMonthContainer,"calendar-events-holder-show");for(var i=0;i<c;i++){if(i!=h.dayOffset){e.gridRow.children[i].style.flex=0;e.titleCont.children[i].style.flex=0}}setTimeout(function(){g.animate();BX.addClass(t.grid,"calendar-events-holder-show");BX.addClass(t.fullDayEventsCont,"calendar-events-holder-show")},210)},150)}});var g=new BX.easing({duration:w,start:{fadeShow:0,fadeHide:100},finish:{fadeShow:100,fadeHide:0},step:function(i){e.viewCont.style.opacity=i.fadeHide/100;t.viewCont.style.opacity=i.fadeShow/100},complete:BX.delegate(function(){h.node.style.background="";if(e.titleCont.children[h.dayOffset]){e.titleCont.children[h.dayOffset].style.background=""}BX.addClass(this.calendar.mainCont,"calendar-main-container-small-calendar");this.adjustViewAnimate(e,t)},this)});f.animate()},fromWeekToList:function(e,t){BX.addClass(this.calendar.mainCont,"calendar-main-container-small-calendar");t.show();this.adjustViewAnimate(e,t)},fromDayToMonth:function(e,t){BX.removeClass(this.calendar.mainCont,"calendar-main-container-small-calendar");var i=e.days[0].dayCode,n=255,o=255,a=255,s=234,d=249,l=254,r,h=250,y=300;this.firstStage=BX.delegate(function(){t.viewCont.style.opacity=0;t.viewCont.style.zIndex=110;t.show();t.viewCont.style.width=e.viewCont.offsetWidth+"px";t.viewCont.style.position="absolute";t.viewCont.style.top=0;t.viewCont.style.left=0;var r=t.days[t.dayIndex[i]],w=BX.pos(r.node),c=BX.pos(t.gridWrap),f=document.body.appendChild(BX.create("DIV",{props:{className:"calendar-animate-casper-day"},style:{opacity:0,top:c.top+"px",right:c.right+"px",bottom:c.bottom+"px",left:c.left+"px",height:c.height+"px",width:c.width+"px",background:"#000"}}));this.secondStage=new BX.easing({duration:h,start:{hide:100,show:0,dayRed:n,dayGreen:o,dayBlue:a},finish:{hide:0,show:100,dayRed:s,dayGreen:d,dayBlue:l},step:function(t){e.viewCont.style.opacity=t.hide/100;f.style.opacity=t.show/100;f.style.background="rgb("+t.dayRed+","+t.dayGreen+","+t.dayBlue+")"},complete:BX.delegate(function(){t.viewCont.style.opacity=1;this.thirdStage.animate()},this)});this.thirdStage=new BX.easing({duration:y,start:{top:c.top,right:c.right,bottom:c.bottom,left:c.left,height:c.height,width:c.width,dayRed:s,dayGreen:d,dayBlue:l},finish:{top:w.top,right:w.right,bottom:w.bottom,left:w.left,height:w.height,width:w.width,dayRed:n,dayGreen:o,dayBlue:a},step:function(e){f.style.show=e.top+"px";f.style.top=e.top+"px";f.style.right=e.right+"px";f.style.bottom=e.bottom+"px";f.style.left=e.left+"px";f.style.height=e.height+"px";f.style.width=e.width+"px";f.style.background="rgb("+e.dayRed+","+e.dayGreen+","+e.dayBlue+")"},complete:BX.delegate(function(){BX.remove(f);this.adjustViewAnimate(e,t)},this)});this.secondStage.animate()},this);setTimeout(BX.delegate(this.firstStage,this),300)},fromDayToWeek:function(e,t){BX.removeClass(this.calendar.mainCont,"calendar-main-container-small-calendar");var i=255,n=255,o=255,a=234,s=249,d=254,l=100,r=100;setTimeout(BX.delegate(function(){t.viewCont.style.opacity=0;t.show();t.viewCont.style.display="block";var h=parseInt(t.fullDayEventsCont.style.height)||this.WEEK_TOP_MIN_HEIGHT,y=BX.pos(t.viewCont);t.viewCont.style.position="absolute";t.viewCont.style.top=0;t.viewCont.style.left=0;t.viewCont.style.width=y.width+"px";t.viewCont.style.height=y.height+"px";t.viewCont.style.zIndex=100;t.fullDayEventsCont.style.height=this.WEEK_TOP_MIN_HEIGHT+"px";this.calendar.viewsCont.style.overflow="hidden";BX.removeClass(t.grid,"calendar-events-holder-show");BX.removeClass(t.fullDayEventsCont,"calendar-events-holder-show");BX.removeClass(e.grid,"calendar-events-holder-show");BX.removeClass(e.fullDayEventsCont,"calendar-events-holder-show");var w=this.util.getDayCode(this.currentViewDate),c=t.days[t.dayIndex[w]],f=t.titleCont.children.length;if(!c){w=this.util.getDayCode(this.newViewDate);c=t.days[t.dayIndex[w]]}c.node.style.background="rgb("+a+","+s+","+d+")";if(t.titleCont.children[c.dayOffset]){t.titleCont.children[c.dayOffset].style.background="rgb("+a+","+s+","+d+")"}BX.addClass(e.viewCont,"calendar-change-animate-day-to-week");for(var g=0;g<f;g++){if(g!=c.dayOffset){t.gridRow.children[g].style.flex=0;t.titleCont.children[g].style.flex=0}}var v=new BX.easing({duration:l,start:{topHolderHeight:parseInt(e.fullDayEventsCont.style.height)||this.WEEK_TOP_MIN_HEIGHT,topPadding:10,red:i,green:n,blue:o},finish:{topHolderHeight:this.WEEK_TOP_MIN_HEIGHT,topPadding:0,red:a,green:s,blue:d},step:function(t){e.fullDayEventsCont.style.height=t.topHolderHeight+"px";e.outerGrid.children[0].style.background="rgb("+t.red+","+t.green+","+t.blue+")";e.viewCont.style.paddingTop=t.topPadding+"px"},complete:BX.delegate(function(){BX.removeClass(e.viewCont,"calendar-animate-mod");setTimeout(function(){e.outerGrid.children[0].style.background="";t.viewCont.style.opacity=1;BX.addClass(t.viewCont,"calendar-animate-mod");for(var i=0;i<f;i++){t.gridRow.children[i].style.flex=1;t.titleCont.children[i].style.flex=1}setTimeout(function(){C.animate()},310)},100)},this)});var C=new BX.easing({duration:r,start:{fadeHide:100,topHolderHeight:this.WEEK_TOP_MIN_HEIGHT,red:a,green:s,blue:d},finish:{fadeHide:0,topHolderHeight:h,red:i,green:n,blue:o},step:function(i){e.viewCont.style.opacity=i.fadeHide/100;t.fullDayEventsCont.style.height=i.topHolderHeight+"px";c.node.style.background="rgb("+i.red+","+i.green+","+i.blue+")";if(t.titleCont.children[c.dayOffset]){t.titleCont.children[c.dayOffset].style.background="rgb("+i.red+","+i.green+","+i.blue+")"}},complete:BX.delegate(function(){e.outerGrid.children[0].style.background="";if(t.titleCont.children[c.dayOffset]){t.titleCont.children[c.dayOffset].style.background=""}c.node.style.background="";BX.removeClass(e.viewCont,"calendar-change-animate-day-to-week");BX.addClass(t.grid,"calendar-events-holder-show");BX.addClass(t.fullDayEventsCont,"calendar-events-holder-show");this.adjustViewAnimate(e,t)},this)});v.animate()},this),200)},fromDayToList:function(e,t){t.show();this.adjustViewAnimate(e,t)},fromListToMonth:function(e,t){var i=300,n=350;BX.removeClass(t.gridMonthContainer,"calendar-events-holder-show");BX.removeClass(this.calendar.mainCont,"calendar-main-container-small-calendar");setTimeout(BX.delegate(function(){t.viewCont.style.opacity=0;t.show();var e=BX.pos(t.viewCont);t.viewCont.style.display="block";t.viewCont.style.overflow="hidden";t.viewCont.style.position="absolute";t.viewCont.style.top=0;t.viewCont.style.left=0;t.viewCont.style.width=e.width+"px";t.viewCont.style.height=e.height+"px";t.viewCont.style.zIndex=100;this.calendar.viewsCont.style.overflow="hidden";this.firstStage.animate()},this),i);this.firstStage=new BX.easing({duration:n,start:{fadeShow:0,fadeHide:100},finish:{fadeShow:100,fadeHide:0},step:function(i){e.viewCont.style.opacity=i.fadeHide/100;t.viewCont.style.opacity=i.fadeShow/100},complete:BX.delegate(function(){this.adjustViewAnimate(e,t)},this)})},fromListToWeek:function(e,t){var i=300,n=350;BX.removeClass(t.gridMonthContainer,"calendar-events-holder-show");BX.removeClass(this.calendar.mainCont,"calendar-main-container-small-calendar");setTimeout(BX.delegate(function(){t.viewCont.style.opacity=0;t.show();var e=BX.pos(t.viewCont);t.viewCont.style.display="block";t.viewCont.style.overflow="hidden";t.viewCont.style.position="absolute";t.viewCont.style.top=0;t.viewCont.style.left=0;t.viewCont.style.width=e.width+"px";t.viewCont.style.height=e.height+"px";t.viewCont.style.zIndex=100;this.calendar.viewsCont.style.overflow="hidden";this.firstStage.animate()},this),i);this.firstStage=new BX.easing({duration:n,start:{fadeShow:0,fadeHide:100},finish:{fadeShow:100,fadeHide:0},step:function(i){e.viewCont.style.opacity=i.fadeHide/100;t.viewCont.style.opacity=i.fadeShow/100},complete:BX.delegate(function(){this.adjustViewAnimate(e,t)},this)})},fromListToDay:function(e,t){t.show();this.adjustViewAnimate(e,t)},adjustViewAnimate:function(e,t){this.calendar.viewsCont.style.cssText="";t.viewCont.style.cssText="";e.viewCont.style.cssText="";BX.removeClass(e.viewCont,"calendar-animate-mod");BX.removeClass(t.viewCont,"calendar-animate-mod");e.viewCont.style.display="none";BX.addClass(t.gridMonthContainer,"calendar-events-holder-show");if(t.getName()!=this.calendar.currentViewName)e.hide()},getRgb:function(){}};if(e.BXEventCalendar){e.BXEventCalendar.ViewTransition=t}else{BX.addCustomEvent(e,"onBXEventCalendarInit",function(){e.BXEventCalendar.ViewTransition=t})}})(window);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:61:"/bitrix/js/calendar/new/calendar-entry.min.js?152740167515879";s:6:"source";s:41:"/bitrix/js/calendar/new/calendar-entry.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
(function(e){function t(e,t){this.calendar=e;this.pulledEntriesIndex={};this.requestedEntriesIndex={};this.entriesRaw=[];this.loadedEntriesIndex={};var i=parseInt(this.calendar.util.config.init_year),a=parseInt(this.calendar.util.config.init_month);this.fillChunkIndex(new Date(i,a-2,1),new Date(i,a+1,0));this.handleEntriesList(t.entries)}t.prototype={getList:function(e){if(e.startDate&&e.finishDate&&!this.checkDateRange(e.startDate,e.finishDate)||e.loadNext||e.loadPrevious){this.loadEntries(e);return false}var t={},a,n=[],s=this.entriesRaw;this.calendar.sectionController.getSectionsInfo().allActive.forEach(function(e){t[e=="tasks"?e:parseInt(e)]=true});for(var r=0;r<s.length;r++){if(s[r]){if(s[r]["~TYPE"]=="tasks"&&!t["tasks"]||s[r]["~TYPE"]!="tasks"&&!t[parseInt(s[r]["SECT_ID"])]){continue}a=new i(this.calendar,s[r]);if(e.viewRange){if(a.applyViewRange(e.viewRange)){n.push(a)}}else{n.push(a)}}}return n},canDo:function(e,t){if(typeof e!=="object"&&t=="add_event")return!this.calendar.util.readOnlyMode();if((t=="edit"||t=="delete")&&!this.calendar.util.readOnlyMode()){if(e.isMeeting()&&e.id!==e.parentId)return false;var i=this.calendar.sectionController.getSection(e.sectionId);return i&&i.canDo&&i.canDo("edit")}return false},getUsableDateTime:function(e,t){if(typeof e=="object"&&e.getTime)e=e.getTime();var i=(t||10)*60*1e3;e=Math.ceil(e/i)*i;return new Date(e)},getTimeForNewEntry:function(e){e=this.getUsableDateTime(e);return{from:e,to:new Date(e.getTime()+36e5)}},getDefaultEntryName:function(){return BX.message("EC_DEFAULT_ENTRY_NAME")},saveEntry:function(e){var t=this.calendar.util.getActionUrl();t+=t.indexOf("?")==-1?"?":"&";t+="markAction=newEvent";t+="&markType="+this.calendar.util.type;t+="&markMeeting="+(this.checkMeetingByCodes(e.attendeesCodes)?"Y":"N");t+="&markRrule=NONE&markCrm=N";this.calendar.request({url:t,type:"post",data:{action:"simple_save_entry",name:e.name,date_from:e.dateFrom,date_to:e.dateTo,default_tz:e.defaultTz,section:e.section,location:e.location||"",skip_time:"N",remind:e.remind||false,attendees:e.attendees||"",access_codes:e.attendeesCodesList||"",meeting_notify:e.meetingNotify?"Y":"N",meeting_allow_invite:e.allowInvite?"Y":"N",exclude_users:e.excludeUsers||""},handler:BX.delegate(function(e){this.handleEntriesList(e.entries);this.calendar.getView().displayEntries()},this)})},moveEventToNewDate:function(e,t,i){e.from.setFullYear(t.getFullYear(),t.getMonth(),t.getDate());if(e.fullDay){e.from.setHours(t.getHours(),t.getMinutes(),0,0)}if(i&&BX.type.isDate(i)){e.to.setFullYear(i.getFullYear(),i.getMonth(),i.getDate());if(e.fullDay){e.to.setHours(i.getHours(),i.getMinutes(),0,0)}}else{e.to=new Date(e.from.getTime()+(e.data.DT_LENGTH-(e.fullDay?1:0))*1e3)}var a=[];if(e.isMeeting())e.data["~ATTENDEES"].forEach(function(e){a.push(e["USER_ID"])});this.calendar.request({type:"post",data:{id:e.id,action:"move_event_to_date",current_date_from:e.data.DATE_FROM,date_from:e.isFullDay()?this.calendar.util.formatDate(e.from):this.calendar.util.formatDateTime(e.from),date_to:e.isFullDay()?this.calendar.util.formatDate(e.to):this.calendar.util.formatDateTime(e.to),skip_time:e.isFullDay()?"Y":"N",attendees:a,recursive:e.isRecursive()?"Y":"N",is_meeting:e.isMeeting()?"Y":"N",section:e.sectionId,timezone:this.calendar.util.getUserOption("timezoneName"),set_timezone:"Y"},handler:BX.delegate(function(t){if(e.isMeeting()&&t.busy_warning){alert(BX.message("EC_BUSY_ALERT"))}this.calendar.reload()},this)})},deleteEntry:function(e,t){if(!t)t={};if(!e||!e.id||e.isTask())return false;if(e.wasEverRecursive()&&!t.confirmed){this.showConfirmDeleteDialog(e);return false}else{if(!t.confirmed&&!confirm(BX.message("EC_DELETE_EVENT_CONFIRM"))){return false}e.deleteParts();if(BX.SidePanel.Instance)BX.SidePanel.Instance.close();if(this.calendar.getView().simpleViewPopup)this.calendar.getView().simpleViewPopup.close();this.calendar.request({type:"post",data:{action:"delete_entry",entry_id:e.id,recursion_mode:t.recursionMode||false},handler:BX.delegate(function(i){if(t.recursionMode&&t.recursionMode!=="all"){this.calendar.reload()}else{this.clientSideDeleteEntry(e.id);this.calendar.getView().displayEntries()}},this)});this.clientSideDeleteEntry(e.id);this.calendar.getView().displayEntries({reloadEntries:false})}},excludeRecursionDate:function(e){if(BX.SidePanel.Instance)BX.SidePanel.Instance.close();this.calendar.request({type:"post",data:{action:"exclude_recursion_date",event_id:e.id,exclude_date:e.data.DATE_FROM},handler:BX.delegate(function(e){this.calendar.reload()},this)})},cutOffRecursiveEvent:function(e){if(BX.SidePanel.Instance)BX.SidePanel.Instance.close();this.calendar.request({type:"post",data:{action:"change_recurcive_event_until",event_id:e.id,until_date:this.calendar.util.formatDate(e.from.getTime()-this.calendar.util.dayLength)},handler:BX.delegate(function(e){this.calendar.reload()},this)})},deleteAllReccurent:function(e){return this.deleteEntry(e,{confirmed:true,recursionMode:"all"})},viewEntry:function(e){this.calendar.getView().showViewSlider(e)},editEntry:function(e){this.calendar.getView().showEditSlider(e)},checkDateRange:function(e,t,i){if(!i)i={};if(!i.sections)i.sections=this.calendar.sectionController.getSectionsInfo().allActive;if(!i.index)i.index=this.pulledEntriesIndex;var a,n;for(a=0;a<i.sections.length;a++){n=i.sections[a];if(!i.index[n]||!i.index[n][this.getChunkIdByDate(e)]||!i.index[n][this.getChunkIdByDate(t)]){return false}}return true},getChunkIdByDate:function(e){return e.getFullYear()+"-"+(e.getMonth()+1)},fillChunkIndex:function(e,t,i){if(!this.loadedStartDate)this.loadedStartDate=e;else if(e.getTime()<this.loadedStartDate.getTime())this.loadedStartDate=e;if(!this.loadedFinishDate)this.loadedFinishDate=t;else if(t.getTime()>this.loadedFinishDate.getTime())this.loadedFinishDate=t;if(!i)i={};if(!i.sections)i.sections=this.calendar.sectionController.getSectionsInfo().allActive;if(!i.index)i.index=this.pulledEntriesIndex;var a=0,n=new Date,s=i.index,r=i.sections,o=i.value==undefined?true:i.value;n.setFullYear(e.getFullYear(),e.getMonth(),1);var d=this.getChunkIdByDate(t),l=this.getChunkIdByDate(n);r.forEach(function(e){if(!s[e])s[e]={};s[e][l]=o;s[e][d]=o});while(l!=d&&a<100){r.forEach(function(e){s[e][l]=o});n.setMonth(n.getMonth()+1);l=this.getChunkIdByDate(n);a++}},getLoadedEntiesLimits:function(){return{start:this.loadedStartDate,end:this.loadedFinishDate}},loadEntries:function(e){if(this.calendar.mainCont){if(this.entryLoaderNode){BX.remove(this.entryLoaderNode)}this.entryLoaderNode=this.calendar.viewsCont.appendChild(BX.adjust(this.calendar.util.getLoader(200),{props:{className:"calendar-entry-loader"}}))}var t=this.calendar.sectionController.getSectionsInfo();this.calendar.request({type:"post",data:{action:"load_entries",month_from:e.startDate?e.startDate.getMonth()+1:"",year_from:e.startDate?e.startDate.getFullYear():"",month_to:e.finishDate?e.finishDate.getMonth()+1:"",year_to:e.finishDate?e.finishDate.getFullYear():"",active_sect:t.active,hidden_sect:t.hidden,sup_sect:t.superposed,loadNext:e.loadNext?"Y":"N",loadPrevious:e.loadPrevious?"Y":"N",loadLimit:e.loadLimit||0,cal_dav_data_sync:this.calendar.reloadGoogle?"Y":"N"},handler:BX.delegate(function(i){if(this.entryLoaderNode){BX.addClass(this.entryLoaderNode,"hide");setTimeout(BX.delegate(function(){BX.remove(this.entryLoaderNode)},this),300)}this.handleEntriesList(i.entries);if(!e.finishDate&&this.entriesRaw.length>0){var a=this.entriesRaw[this.entriesRaw.length-1].DATE_FROM;a=BX.parseDate(a);if(a){a.setFullYear(a.getFullYear(),a.getMonth(),0);e.finishDate=a}}if(e.startDate&&e.finishDate){this.fillChunkIndex(e.startDate,e.finishDate,{index:this.pulledEntriesIndex,sections:t.allActive})}if(e.finishCallback&&typeof e.finishCallback=="function"){e.finishCallback(i)}this.calendar.reloadGoogle=false},this)});return;this.loadEventsLastRequestId=req.reqId},handleEntriesList:function(e){if(e&&e.length){var t,i,a=this.calendar.util.getUserOption("showDeclined");for(t=0;t<e.length;t++){if((!a||parseInt(e[t].CREATED_BY)!==this.calendar.util.userId)&&e[t].MEETING_STATUS=="N"){continue}i=this.getUniqueId(e[t]);if(this.loadedEntriesIndex[i]===undefined){this.entriesRaw.push(e[t]);this.loadedEntriesIndex[i]=this.entriesRaw.length-1}else{if(e[t].CAL_TYPE==this.calendar.util.type&&e[t].OWNER_ID==this.calendar.util.ownerId){this.entriesRaw[this.loadedEntriesIndex[i]]=e[t]}}}}},getUniqueId:function(e,t){var i=e.PARENT_ID||e.ID;if(e.RRULE){i+="|"+(t?this.calendar.util.formatDate(t.from):this.calendar.util.formatDate(BX.parseDate(e.DATE_FROM)))}if(e["~TYPE"]=="tasks"){i+="|"+"task"}return i},sort:function(e,t){if(e.entry.isTask()!==t.entry.isTask()){if(e.entry.isTask())return 1;if(t.entry.isTask())return-1}if(e.part.daysCount==t.part.daysCount&&e.part.daysCount==1){return e.entry.from.getTime()-t.entry.from.getTime()}else{if(e.part.daysCount==t.part.daysCount)return e.entry.from.getTime()-t.entry.from.getTime();else return e.part.daysCount-t.part.daysCount}},clearLoadIndexCache:function(){this.pulledEntriesIndex={};this.requestedEntriesIndex={};this.entriesRaw=[];this.loadedEntriesIndex={}},setMeetingStatus:function(e,t,i){if(typeof i=="undefined")i={};if(t=="N"&&!i.confirmed){if(e.isRecursive()){this.showConfirmDeclineDialog(e);return false}else if(!confirm(BX.message("EC_DECLINE_MEETING_CONFIRM"))){return false}}this.calendar.request({type:"post",data:{action:"set_meeting_status",event_id:e.id,parent_id:e.parentId,status:t,reccurent_mode:i.recursionMode||false,current_date_from:this.calendar.util.formatDate(e.from)},handler:BX.delegate(function(e){this.calendar.reload()},this)})},showConfirmDeleteDialog:function(t){if(!this.confirmDeleteDialog)this.confirmDeleteDialog=new e.BXEventCalendar.ConfirmDeleteDialog(this.calendar);this.confirmDeleteDialog.show(t)},showConfirmEditDialog:function(t){if(!this.confirmEditDialog)this.confirmEditDialog=new e.BXEventCalendar.ConfirmEditDialog(this.calendar);this.confirmEditDialog.show(t)},showConfirmDeclineDialog:function(t){if(!this.confirmDeclineDialog)this.confirmDeclineDialog=new e.BXEventCalendar.ConfirmDeclineDialog(this.calendar);this.confirmDeclineDialog.show(t)},clientSideDeleteEntry:function(e){var t=[],i;for(i=0;i<this.calendar.getView().entries.length;i++){if(this.calendar.getView().entries[i].id!==e&&this.calendar.getView().entries[i].data.RECURRENCE_ID!==e){t.push(this.calendar.getView().entries[i])}}this.calendar.getView().entries=t;var a=[];for(i=0;i<this.entriesRaw.length;i++){if(this.entriesRaw[i].ID!==e&&this.entriesRaw[i].RECURRENCE_ID!==e){a.push(this.entriesRaw[i])}}this.entriesRaw=a},checkMeetingByCodes:function(e){var t,i=0;if(e){for(t in e){if(e.hasOwnProperty(t)){if(e[t]!="users"||i>0){return true}i++}}}return false}};function i(e,t){this.calendar=e;this.data=t;this.fullDay=t.DT_SKIP_TIME=="Y";this.id=t.ID||0;this.parentId=t.PARENT_ID||0;this.textColor=t.TEXT_COLOR;this.accessibility=t.ACCESSIBILITY;this.important=t.IMPORTANCE=="high";this.private=!!t.PRIVATE_EVENT;this.sectionId=this.isTask()?"tasks":parseInt(t.SECT_ID);this.name=t.NAME;this.parts=[];var i=this,a=this.calendar.util,n,s,r=t.COLOR||i.calendar.sectionController.getSection(this.sectionId).color;Object.defineProperties(this,{startDayCode:{get:function(){return n},set:function(e){n=a.getDayCode(e)}},endDayCode:{get:function(){return s},set:function(e){s=a.getDayCode(e)}},color:{get:function(){return r},set:function(e){r=e}},textColor:{value:t.TEXT_COLOR,writable:true,enumerable:true},location:{value:t.LOCATION,writable:true,enumerable:true}});this.prepareData();this.uid=this.calendar.entryController.getUniqueId(t,this)}i.prototype={prepareData:function(){if(this.isTask()){this.from=BX.parseDate(this.data.DATE_FROM)||new Date;this.to=BX.parseDate(this.data.DATE_TO)||this.from}else{this.from=BX.parseDate(this.data.DATE_FROM)||new Date;if(this.data.DT_SKIP_TIME!=="Y"){this.from=new Date(this.from.getTime()-(parseInt(this.data["~USER_OFFSET_FROM"])||0)*1e3)}this.to=new Date(this.from.getTime()+(this.data.DT_LENGTH-(this.fullDay?1:0))*1e3)}if(!this.data.ATTENDEES_CODES&&!this.isTask()){this.data.ATTENDEES_CODES=["U"+this.data.CREATED_BY]}this.startDayCode=this.from;this.endDayCode=this.to},getAttendeesCodes:function(){return this.data.ATTENDEES_CODES},getAttendees:function(){return this.data["~ATTENDEES"]||[]},cleanParts:function(){this.parts=[]},startPart:function(e){e.partIndex=this.parts.length;this.parts.push(e);return this.parts[e.partIndex]},registerPartNode:function(e,t){e.params=t},checkPartIsRegistered:function(e){return BX.type.isPlainObject(e.params)},getPart:function(e){return this.parts[e]||false},getWrap:function(e){return this.parts[e||0].params.wrapNode},getSectionName:function(){return this.calendar.sectionController.getSection(this.sectionId).name||""},applyViewRange:function(e){var t=e.start.getTime(),i=e.end.getTime(),a=this.from.getTime(),n=this.to.getTime();if(n<t||a>i)return false;if(a<t){this.displayFrom=e.start;this.startDayCode=this.displayFrom}if(n>i){this.displayTo=e.end;this.endDayCode=this.displayTo}return true},isPersonal:function(){return this.data.CAL_TYPE=="user"&&this.data.OWNER_ID==this.calendar.util.userId},isMeeting:function(){return!!this.data.IS_MEETING},isTask:function(){return this.data["~TYPE"]=="tasks"},isFullDay:function(){return this.fullDay},isLongWithTime:function(){return!this.fullDay&&this.calendar.util.getDayCode(this.from)!=this.calendar.util.getDayCode(this.to)},isExpired:function(){return this.to.getTime()<(new Date).getTime()},isExternal:function(){return false},isSelected:function(){return!!this.selected},isCrm:function(){return this.data.UF_CRM_CAL_EVENT&&this.data.UF_CRM_CAL_EVENT!=""},isFirstReccurentEntry:function(){return this.data.DT_FROM_TS===Math.floor(BX.parseDate(this.data["~DATE_FROM"]).getTime()/1e3)*1e3&&!this.data.RECURRENCE_ID},isRecursive:function(){return!!this.data.RRULE},getMeetingHost:function(){return parseInt(this.data.MEETING_HOST)},getRrule:function(){return this.data.RRULE},hasRecurrenceId:function(){return this.data.RECURRENCE_ID},wasEverRecursive:function(){return this.data.RRULE||this.data.RECURRENCE_ID},deselect:function(){this.selected=false},select:function(){this.selected=true},deleteParts:function(){this.parts.forEach(function(e){if(e.params){if(e.params.wrapNode){e.params.wrapNode.style.opacity=0}}},this);setTimeout(BX.delegate(function(){this.parts.forEach(function(e){if(e.params){if(e.params.wrapNode){BX.remove(e.params.wrapNode)}}},this)},this),300)},getUniqueId:function(){var e=this.data.PARENT_ID||this.data.PARENT_ID;if(this.isRecursive())e+="|"+this.data.DT_FROM_TS;if(this.data["~TYPE"]=="tasks")e+="|"+"task";return e},getCurrentStatus:function(){var e,t,i=false;if(this.isMeeting()){if(this.calendar.util.userId==this.data.CREATED_BY||this.calendar.util.userId==this.data.MEETING_HOST){i=this.data.MEETING_STATUS}else if(this.calendar.util.userId==this.data.MEETING_HOST){i=this.data.MEETING_STATUS}else if(this.data["~ATTENDEES"]){for(e=0;e<this.data["~ATTENDEES"].length;e++){t=this.data["~ATTENDEES"][e];if(t.USER_ID==this.calendar.util.userId){i=t.STATUS;break}}}}return i},getReminders:function(){var e=[];if(this.data&&this.data.REMIND){this.data.REMIND.forEach(function(t){if(t.type=="min"){e.push(t.count)}else if(t.type=="hour"){e.push(parseInt(t.count)*60)}if(t.type=="day"){e.push(parseInt(t.count)*60*24)}})}return e},getLengthInDays:function(){var e=new Date(this.from.getFullYear(),this.from.getMonth(),this.from.getDate(),0,0,0),t=new Date(this.to.getFullYear(),this.to.getMonth(),this.to.getDate(),0,0,0);return Math.round((t.getTime()-e.getTime())/this.calendar.util.dayLength)+1}};if(e.BXEventCalendar){e.BXEventCalendar.Entry=i;e.BXEventCalendar.EntryController=t}else{BX.addCustomEvent(e,"onBXEventCalendarInit",function(){e.BXEventCalendar.Entry=i;e.BXEventCalendar.EntryController=t})}})(window);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:62:"/bitrix/js/calendar/new/calendar-section.min.js?15274016757931";s:6:"source";s:43:"/bitrix/js/calendar/new/calendar-section.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
(function(window){function SectionController(t,e,i){this.calendar=t;this.sections=[];this.sectionIndex={};this.hiddenSections=i.hiddenSections;this.prepareData({sections:e.sections});if(this.calendar.showTasks){var n=new TaskSection(this.calendar,i.sectionCustomization.tasks);this.sections.push(n);this.sectionIndex[n.id]=this.sections.length-1}this.sortSections()}SectionController.prototype={prepareData:function(t){var e,i;for(e=0;e<t.sections.length;e++){i=new Section(this.calendar,t.sections[e]);this.sections.push(i);this.sectionIndex[i.id]=this.sections.length-1}},sortSections:function(){var t;this.sectionIndex={};this.sections=this.sections.sort(function(t,e){if(t.isPseudo()){return 1}else if(e.isPseudo()){return-1}return t.name.localeCompare(e.name)});for(t=0;t<this.sections.length;t++){this.sectionIndex[this.sections[t].id]=t}},getCurrentSection:function(){var t=false,e,i=this.calendar.util.getUserOption("lastUsedSection");if(i){t=this.getSection(i);if(!t||!t.name||!t.canDo("add")||!t.belongsToView()||t.isPseudo()||!t.isActive()){t=false}}if(!t){for(e=0;e<this.sections.length;e++){if(this.sections[e].canDo("add")&&this.sections[e].belongsToView()&&!this.sections[e].isPseudo()&&this.sections[e].isActive()){t=this.sections[e];break}}}return t},getSectionList:function(){var t,e=[];for(t=0;t<this.sections.length;t++){if(this.sections[t].canDo("view_event")&&this.sections[t].isActive()){e.push(this.sections[t])}}return e},getSuperposedSectionList:function(){var t,e=[];for(t=0;t<this.sections.length;t++){if(this.sections[t].canDo("view_event")&&this.sections[t].isSuperposed()&&this.sections[t].isActive()){e.push(this.sections[t])}}return e},getSectionListForEdit:function(){var t,e=[];for(t=0;t<this.sections.length;t++){if(this.sections[t].canDo("add")&&(!this.sections[t].isSuperposed()||this.sections[t].belongsToView())&&!this.sections[t].isPseudo()&&this.sections[t].isActive()){e.push(this.sections[t])}}return e},getSection:function(t){return this.sections[this.sectionIndex[t]]||{}},getDefaultSectionName:function(){return BX.message("EC_DEFAULT_SECTION_NAME")},getDefaultSectionColor:function(){var t=this.getSectionListForEdit(),e={},i,n,s=this.calendar.util.getDefaultColors();for(i=0;i<t.length;i++){e[t[i].color]=true}for(i=0;i<s.length;i++){n=s[i];if(!e[n]){return n}}return s[this.calendar.util.randomInt(0,s.length)]},getDefaultSectionAccess:function(){return this.calendar.util.config.new_section_access||{}},saveSection:function(t,e,i,n){if(n.section.id){BX.onCustomEvent(this.calendar,"BXCalendar:onSectionChange",[n.section.id,{name:t,color:e}])}else{BX.onCustomEvent(this.calendar,"BXCalendar:onSectionAddBefore",[{name:t,color:e}])}var s=this.calendar.util.getActionUrl();s+=s.indexOf("?")==-1?"?":"&";s+="&markAction="+(n.section.id?"editSection":"newSection");s+="&markType="+this.calendar.util.type;this.calendar.request({url:s,type:"post",data:{action:"section_edit",id:n.section.id||0,name:t,color:e,access:i},handler:BX.delegate(function(i){if(n.section.id){this.sections[this.sectionIndex[n.section.id]].updateData(i.calendar)}else{this.prepareData({sections:[i.calendar]})}this.sortSections();BX.onCustomEvent(this.calendar,"BXCalendar:onSectionAdd",[{name:t,color:e}])},this)})},sectionIsShown:function(t){return!BX.util.in_array(t,this.hiddenSections)},getHiddenSections:function(){return this.hiddenSections||[]},setHiddenSections:function(t){this.hiddenSections=t},getSectionsInfo:function(){var t,e=[],i=[],n=[],s=[];for(t=0;t<this.sections.length;t++){if(this.sections[t].canDo("view_time")){if(this.sections[t].isShown()){if(this.sections[t].isSuperposed()){i.push(this.sections[t].id)}else{n.push(this.sections[t].id)}e.push(this.sections[t].id)}else{s.push(this.sections[t].id)}}}return{superposed:i,active:n,hidden:s,allActive:e}}};function Section(t,e){this.calendar=t;this.updateData(e)}Section.prototype={updateData:function(t){this.data=t||{};this.color=t.COLOR;this.textColor=t.TEXT_COLOR;this.name=t.NAME||"";this.type=t.CAL_TYPE||"";Object.defineProperties(this,{id:{value:t.ID,writable:false,enumerable:true},color:{value:t.COLOR,writable:true,enumerable:true},textColor:{value:t.TEXT_COLOR,writable:true,enumerable:true}})},isShown:function(){return this.calendar.sectionController.sectionIsShown(this.id)},show:function(){if(!this.isShown()){var t=this.calendar.sectionController.getHiddenSections();t=BX.util.deleteFromArray(t,BX.util.array_search(this.id,t));this.calendar.sectionController.setHiddenSections(t);BX.userOptions.save("calendar","hidden_sections","hidden_sections",t)}},hide:function(){if(this.isShown()){var t=this.calendar.sectionController.getHiddenSections();t.push(this.id);this.calendar.sectionController.setHiddenSections(t);BX.userOptions.save("calendar","hidden_sections","hidden_sections",t)}},remove:function(){if(confirm(BX.message("EC_SEC_DELETE_CONFIRM"))){BX.onCustomEvent(this.calendar,"BXCalendar:onSectionDelete",[this.id]);this.calendar.request({type:"post",data:{action:"section_delete",id:this.id},handler:BX.delegate(function(t){this.calendar.reload()},this)})}},hideGoogle:function(){if(confirm(BX.message("EC_CAL_GOOGLE_HIDE_CONFIRM"))){this.hide();BX.onCustomEvent(this.calendar,"BXCalendar:onSectionDelete",[this.id]);this.calendar.request({type:"post",data:{action:"section_caldav_hide",id:this.id},handler:BX.delegate(function(t){this.calendar.reload()},this)})}},getLink:function(){return this.data&&this.data.LINK?this.data.LINK:""},canBeConnectedToOutlook:function(){return!this.isPseudo()&&this.data.OUTLOOK_JS&&!(this.data.CAL_DAV_CAL&&this.data.CAL_DAV_CON)&&!BX.browser.IsMac()},connectToOutlook:function(){if(!window.jsOutlookUtils){BX.loadScript("/bitrix/js/calendar/outlook.js",BX.delegate(function(){try{eval(this.data.OUTLOOK_JS)}catch(t){}},this))}else{try{eval(this.data.OUTLOOK_JS)}catch(t){}}},canDo:function(t){if(BX.util.in_array(t,["access","add","edit"])&&this.isVirtual()){return false}if(BX.util.in_array(t,["access","add","edit","edit_section"])&&this.isSuperposed()&&!this.belongsToView()){return false}if(t=="view_event")t="view_time";return this.data.PERM&&this.data.PERM[t]},isSuperposed:function(){return!this.isPseudo()&&!!this.data.SUPERPOSED},isPseudo:function(){return false},isVirtual:function(){return this.data.CAL_DAV_CAL&&this.data.CAL_DAV_CAL.indexOf("@virtual/events/")!==-1||this.data.GAPI_CALENDAR_ID&&this.data.GAPI_CALENDAR_ID.indexOf("@group.v.calendar.google.com")!==-1},isGoogle:function(){return this.data.GAPI_CALENDAR_ID},isCalDav:function(){return!this.isPseudo()&&this.data.CAL_DAV_CAL&&this.data.CAL_DAV_CON},isCompanyCalendar:function(){return!this.isPseudo()&&this.type!="user"&&this.type!="group"&&!parseInt(this.data.OWNER_ID)},belongsToView:function(){return this.type==this.calendar.util.type&&this.data.OWNER_ID==this.calendar.util.ownerId},belongToOwner:function(){return this.data.CAL_TYPE=="user"&&this.data.OWNER_ID==this.calendar.util.userId&&this.data.ACTIVE!=="N"},isActive:function(){return this.data.ACTIVE!=="N"}};function TaskSection(t,e){this.calendar=t;var i="#ff5b55",n;if(!e)e={};if(this.calendar.util.userIsOwner()){n=BX.message("EC_SEC_MY_TASK_DEFAULT")}else if(this.calendar.util.isUserCalendar()){n=BX.message("EC_SEC_USER_TASK_DEFAULT")}else if(this.calendar.util.isGroupCalendar()){n=BX.message("EC_SEC_GROUP_TASK_DEFAULT")}var s={ID:"tasks",NAME:e.name||n,COLOR:e.color||i,PERM:{edit_section:true,view_full:true,view_time:true,view_title:true}};Section.apply(this,[t,s])}TaskSection.prototype=Object.create(Section.prototype);TaskSection.prototype.constructor=TaskSection;TaskSection.prototype.isPseudo=function(){return true};if(window.BXEventCalendar){window.BXEventCalendar.SectionController=SectionController;window.BXEventCalendar.Section=Section}else{BX.addCustomEvent(window,"onBXEventCalendarInit",function(){window.BXEventCalendar.SectionController=SectionController;window.BXEventCalendar.Section=Section})}})(window);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:64:"/bitrix/js/calendar/new/calendar-controls.min.js?152740167532174";s:6:"source";s:44:"/bitrix/js/calendar/new/calendar-controls.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
(function(e){function t(e){this.calendar=e.calendar;this.wrap=e.wrap;this.id=this.calendar.id+"_top_add_button";this.create()}t.prototype={create:function(){this.button=this.wrap.appendChild(BX.create("SPAN",{props:{className:"webform-small-button webform-small-button-blue"},html:BX.message("EC_ADD"),events:{click:BX.proxy(this.addEntry,this)}}));this.menuItems=[{text:BX.message("EC_ADD_EVENT"),onclick:BX.proxy(this.addEntry,this)}];if(this.calendar.showTasks){this.menuItems.push({text:BX.message("EC_ADD_TASK"),onclick:BX.proxy(this.addTask,this)})}if(this.menuItems.length>1){BX.addClass(this.wrap,"webform-small-button-separate-wrap");this.addButtonMore=this.wrap.appendChild(BX.create("SPAN",{props:{className:"webform-small-button-right-part"},events:{click:BX.proxy(this.showPopup,this)}}))}},showPopup:function(){if(this.menuPopup&&this.menuPopup.popupWindow&&this.menuPopup.popupWindow.isShown()){return this.menuPopup.close()}this.menuPopup=BX.PopupMenu.create(this.id,this.addButtonMore,this.menuItems,{closeByEsc:true,autoHide:true,zIndex:this.zIndex,offsetTop:0,offsetLeft:15,angle:true});this.menuPopup.show();BX.addCustomEvent(this.menuPopup.popupWindow,"onPopupClose",BX.delegate(function(){BX.PopupMenu.destroy(this.addButtonMorePopupId)},this))},addEntry:function(){if(this.menuPopup&&this.menuPopup.popupWindow&&this.menuPopup.popupWindow.isShown()){this.menuPopup.close()}if(!this.calendar.editSlider){this.calendar.editSlider=new e.BXEventCalendar.EditEntrySlider(this.calendar)}this.calendar.editSlider.show({})},addTask:function(){if(this.menuPopup&&this.menuPopup.popupWindow&&this.menuPopup.popupWindow.isShown()){this.menuPopup.close()}BX.SidePanel.Instance.open(this.calendar.util.getEditTaskPath(),{loader:"task-new-loader"})}};function i(e){this.id=e.id||"bx-select-input-"+Math.round(Math.random()*1e6);this.values=e.values||false;this.input=e.input;this.defaultValue=e.defaultValue||"";this.openTitle=e.openTitle||"";this.className=e.className||"";this.currentValue=e.value;this.currentValueIndex=e.valueIndex;this.onChangeCallback=e.onChangeCallback||null;this.zIndex=e.zIndex||1200;this.disabled=e.disabled;if(this.onChangeCallback){BX.bind(this.input,"change",this.onChangeCallback);BX.bind(this.input,"keyup",this.onChangeCallback)}if(this.currentValueIndex!==undefined&&this.values[this.currentValueIndex]){this.input.value=this.values[this.currentValueIndex].label}this.curInd=false;if(this.values){BX.bind(this.input,"click",BX.proxy(this.onClick,this));BX.bind(this.input,"focus",BX.proxy(this.onFocus,this));BX.bind(this.input,"blur",BX.proxy(this.onBlur,this));BX.bind(this.input,"keyup",BX.proxy(this.onKeyup,this))}}i.prototype={showPopup:function(){if(this.shown||this.disabled)return;var e=0,t=0,i=[],a,s=this;for(a=0;a<this.values.length;a++){if(this.values[a].delimiter){i.push(this.values[a])}else{if(this.currentValue&&this.values[a]&&this.values[a].value==this.currentValue.value){e=t}i.push({id:this.values[a].value,text:this.values[a].label,onclick:this.values[a].callback||function(e,t){return function(){s.input.value=t;s.popupMenu.close();s.onChange()}}(this.values[a].value,this.values[a].labelRaw||this.values[a].label)});t++}}this.popupMenu=BX.PopupMenu.create(this.id,this.input,i,{closeByEsc:true,autoHide:true,zIndex:this.zIndex,offsetTop:0,offsetLeft:0});this.popupMenu.popupWindow.setWidth(this.input.offsetWidth-2);var n=this.popupMenu.layout.menuContainer;BX.addClass(this.popupMenu.layout.menuContainer,"calendar-select-popup");this.popupMenu.show();var o=this.popupMenu.menuItems[e];if(o&&o.layout){n.scrollTop=o.layout.item.offsetTop-o.layout.item.offsetHeight}BX.addCustomEvent(this.popupMenu.popupWindow,"onPopupClose",function(){BX.PopupMenu.destroy(s.id);s.shown=false});this.input.select();this.shown=true},closePopup:function(){BX.PopupMenu.destroy(this.id);this.shown=false},onFocus:function(){setTimeout(BX.delegate(function(){if(!this.shown){this.showPopup()}},this),200)},onClick:function(){if(this.shown){this.closePopup()}else{this.showPopup()}},onBlur:function(){setTimeout(BX.delegate(this.closePopup,this),200)},onKeyup:function(){setTimeout(BX.delegate(this.closePopup,this),50)},onChange:function(){var e=this.input.value;BX.onCustomEvent(this,"onSelectInputChanged",[this,e]);if(this.onChangeCallback&&typeof this.onChangeCallback=="function")this.onChangeCallback({value:e})},destroy:function(){if(this.onChangeCallback){BX.unbind(this.input,"change",this.onChangeCallback);BX.unbind(this.input,"keyup",this.onChangeCallback)}BX.unbind(this.input,"click",BX.proxy(this.onClick,this));BX.unbind(this.input,"focus",BX.proxy(this.onFocus,this));BX.unbind(this.input,"blur",BX.proxy(this.onBlur,this));BX.unbind(this.input,"keyup",BX.proxy(this.onKeyup,this));if(this.popupMenu)this.popupMenu.close();BX.PopupMenu.destroy(this.id);this.shown=false}};function a(e){this.controlList={};this.selectedValues=[];this.values=e.values;this.addButton=e.addButtonNode;this.valuesWrap=e.valuesContainerNode;this.changeCallack=e.changeCallack;this.showPopupCallBack=e.showPopupCallBack;this.hidePopupCallBack=e.hidePopupCallBack;this.id=e.id||"reminder-"+Math.round(Math.random()*1e6);this.zIndex=e.zIndex||3200;BX.unbind(this.addButton,"click",BX.proxy(this.showPopup,this));BX.bind(this.addButton,"click",BX.proxy(this.showPopup,this));if(e.selectedValues&&e.selectedValues.length>0){for(var t=0;t<e.selectedValues.length;t++){this.addValue(e.selectedValues[t])}}}a.prototype={showPopup:function(){var e=this,t,i=[];for(t=0;t<this.values.length;t++){if(!BX.util.in_array(this.values[t].value,this.selectedValues)){i.push({text:this.values[t].label,onclick:function(t){return function(){e.addValue(t);e.reminderMenu.close()}}(this.values[t].value)})}}this.reminderMenu=BX.PopupMenu.create(this.id,this.addButton,i,{closeByEsc:true,autoHide:true,zIndex:this.zIndex,offsetTop:0,offsetLeft:9,angle:true});this.reminderMenu.show();if(this.showPopupCallBack)this.showPopupCallBack();BX.addCustomEvent(e.reminderMenu.popupWindow,"onPopupClose",function(){if(e.hidePopupCallBack)e.hidePopupCallBack();BX.PopupMenu.destroy(e.id)})},addValue:function(e){var t,i,a,s=this;for(t=0;t<this.values.length;t++){if(this.values[t].value==e&&e>=0&&!BX.util.in_array(e,this.selectedValues)){if(!this.selectedValues.length)BX.cleanNode(this.valuesWrap);i=this.valuesWrap.appendChild(BX.create("SPAN",{props:{className:"calendar-reminder-item"},text:this.values[t].shortLabel||this.values[t].label}));a=i.appendChild(BX.create("SPAN",{props:{className:"calendar-reminder-clear-icon"},events:{click:function(){s.removeValue(e)}}}));this.selectedValues.push(e);this.controlList[e]=i;break}}if(this.selectedValues.length==this.values.length){this.addButton.style.display="none"}if(this.changeCallack)this.changeCallack(this.selectedValues)},removeValue:function(e){if(this.controlList[e]&&BX.isNodeInDom(this.controlList[e])){BX.cleanNode(this.controlList[e],true)}this.selectedValues=BX.util.deleteFromArray(this.selectedValues,BX.util.array_search(e,this.selectedValues));if(this.selectedValues.length<this.values.length){this.addButton.style.display=""}if(!this.selectedValues.length){this.valuesWrap.appendChild(BX.create("SPAN",{props:{className:""},text:" "+BX.message("EC_REMIND_NO")}))}if(this.changeCallack)this.changeCallack(this.selectedValues)}};function s(e,t){this.params=t;this.id=e;this.calendar=t.calendar;this.zIndex=t.zIndex||3100;this.wrapNode=t.wrapNode;this.destinationInputName=t.inputName||"EVENT_DESTINATION";if(this.params.itemsSelected&&this.params.itemsSelected.length){this.params.itemsSelected=this.convertAttendeesCodes(this.params.itemsSelected)}this.create()}s.prototype={create:function(){var e=this.id;this.socnetDestinationWrap=this.wrapNode.appendChild(BX.create("DIV",{props:{className:"event-grid-dest-wrap"},events:{click:function(t){BX.SocNetLogDestination.openDialog(e);BX.PreventDefault(t)}}}));this.socnetDestinationItems=this.socnetDestinationWrap.appendChild(BX.create("SPAN",{props:{className:""},events:{click:function(t){var i=t.target||t.srcElement;if(i.className=="feed-event-del-but"){BX.SocNetLogDestination.deleteItem(i.getAttribute("data-item-id"),i.getAttribute("data-item-type"),e);t.preventDefault();t.stopPropagation()}},mouseover:function(e){var t=e.target||e.srcElement;if(t.className=="feed-event-del-but")BX.addClass(t.parentNode,"event-grid-dest-hover")},mouseout:function(e){var t=e.target||e.srcElement;if(t.className=="feed-event-del-but")BX.removeClass(t.parentNode,"event-grid-dest-hover")}}}));this.socnetDestinationInputWrap=this.socnetDestinationWrap.appendChild(BX.create("SPAN",{props:{className:"feed-add-destination-input-box"}}));this.socnetDestinationInput=this.socnetDestinationInputWrap.appendChild(BX.create("INPUT",{props:{id:e+"-inp",className:"feed-add-destination-inp"},attrs:{value:"",type:"text"},events:{keydown:function(t){return BX.SocNetLogDestination.searchBeforeHandler(t,{formName:e,inputId:e+"-inp"})},keyup:function(t){return BX.SocNetLogDestination.searchHandler(t,{formName:e,inputId:e+"-inp",linkId:"event-grid-dest-add-link",sendAjax:true})}}}));this.socnetDestinationLink=this.socnetDestinationWrap.appendChild(BX.create("SPAN",{html:this.params.addLinkMessage||BX.message("EC_DESTINATION_ADD_USERS"),props:{id:e+"-link",className:"feed-add-destination-link"},events:{keydown:function(t){return BX.SocNetLogDestination.searchBeforeHandler(t,{formName:e,inputId:e+"-inp"})},keyup:function(t){return BX.SocNetLogDestination.searchHandler(t,{formName:e,inputId:e+"-inp",linkId:"event-grid-dest-add-link",sendAjax:true})}}}));this.params.items=this.calendar.util.getSocnetDestinationConfig("items");this.params.itemsLast=this.calendar.util.getSocnetDestinationConfig("itemsLast");if(this.params.itemsSelected&&!this.checkItemsSelected(this.params.items,this.params.itemsLast,this.params.itemsSelected,BX.proxy(this.init,this))){return}this.init()},init:function(){if(!this.socnetDestinationInput||!this.socnetDestinationWrap)return;var e=this;if(this.params.selectGroups===false){this.params.items.groups={};this.params.items.department={};this.params.items.sonetgroups={}}if(this.params.selectUsers===false){this.params.items.users={};this.params.items.groups={};this.params.items.department={}}BX.SocNetLogDestination.init({name:this.id,searchInput:this.socnetDestinationInput,extranetUser:false,userSearchArea:"I",bindMainPopup:{node:this.socnetDestinationWrap,offsetTop:"5px",offsetLeft:"15px"},bindSearchPopup:{node:this.socnetDestinationWrap,offsetTop:"5px",offsetLeft:"15px"},callback:{select:BX.proxy(this.selectCallback,this),unSelect:BX.proxy(this.unSelectCallback,this),openDialog:BX.proxy(this.openDialogCallback,this),closeDialog:BX.proxy(this.closeDialogCallback,this),openSearch:BX.proxy(this.openDialogCallback,this),closeSearch:function(){e.closeDialogCallback(true)}},items:this.params.items,itemsLast:this.params.itemsLast,itemsSelected:this.params.itemsSelected,departmentSelectDisable:this.params.selectGroups===false})},checkItemsSelected:function(e,t,i,a){var s=[];for(var n in i){if(i.hasOwnProperty(n)){if(i[n]=="users"&&!e.users[n]){s.push(n)}}}if(s.length>0){var o=this.socnetDestinationWrap.appendChild(BX.adjust(this.calendar.util.getLoader(40),{style:{height:"50px"}}));this.calendar.request({type:"get",data:{action:"get_destination_items",codes:s},handler:BX.delegate(function(e){if(o)BX.remove(o);this.calendar.util.mergeSocnetDestinationConfig(e.destinationItems);this.params.items=this.calendar.util.getSocnetDestinationConfig("items");this.params.itemsLast=this.calendar.util.getSocnetDestinationConfig("itemsLast");if(a&&typeof a=="function")a()},this)});return false}return true},closeAll:function(){if(BX.SocNetLogDestination.isOpenDialog()){BX.SocNetLogDestination.closeDialog()}BX.SocNetLogDestination.closeSearch()},selectCallback:function(e,t){var i=t,a="S";if(t=="sonetgroups"){a="SG"}else if(t=="groups"){a="UA";i="all-users"}else if(t=="users"){a="U"}else if(t=="department"){a="DR"}this.socnetDestinationItems.appendChild(BX.create("span",{attrs:{"data-id":e.id},props:{className:"event-grid-dest event-grid-dest-"+i},children:[BX.create("input",{attrs:{type:"hidden",name:this.destinationInputName+"["+a+"][]",value:e.id}}),BX.create("span",{props:{className:"event-grid-dest-text"},html:e.name}),BX.create("span",{props:{className:"feed-event-del-but"},attrs:{"data-item-id":e.id,"data-item-type":t}})]}));BX.onCustomEvent("OnDestinationAddNewItem",[e]);this.socnetDestinationInput.value="";this.socnetDestinationLink.innerHTML=this.params.addLinkMessage||(BX.SocNetLogDestination.getSelectedCount(this.id)>0?BX.message("EC_DESTINATION_ADD_MORE"):BX.message("EC_DESTINATION_ADD_USERS"))},unSelectCallback:function(e,t,i){var a=BX.findChildren(this.socnetDestinationItems,{attribute:{"data-id":e.id}},true);if(a!=null){for(var s=0;s<a.length;s++){BX.remove(a[s])}}BX.onCustomEvent("OnDestinationUnselect");this.socnetDestinationInput.value="";this.socnetDestinationLink.innerHTML=this.params.addLinkMessage||(BX.SocNetLogDestination.getSelectedCount(this.id)>0?BX.message("EC_DESTINATION_ADD_MORE"):BX.message("EC_DESTINATION_ADD_USERS"))},openDialogCallback:function(){if(BX.SocNetLogDestination.popupWindow){BX.SocNetLogDestination.popupWindow.params.zIndex=this.zIndex;BX.SocNetLogDestination.popupWindow.popupContainer.style.zIndex=this.zIndex}if(BX.SocNetLogDestination.popupSearchWindow){BX.SocNetLogDestination.popupSearchWindow.params.zIndex=this.zIndex;BX.SocNetLogDestination.popupSearchWindow.popupContainer.style.zIndex=this.zIndex}BX.style(this.socnetDestinationInputWrap,"display","inline-block");BX.style(this.socnetDestinationLink,"display","none");BX.focus(this.socnetDestinationInput)},closeDialogCallback:function(t){if(!BX.SocNetLogDestination.isOpenSearch()&&this.socnetDestinationInput.value.length<=0){BX.style(this.socnetDestinationInputWrap,"display","none");BX.style(this.socnetDestinationLink,"display","inline-block");if(t===true)this.socnetDestinationInput.value="";if(BX.SocNetLogDestination.backspaceDisable||BX.SocNetLogDestination.backspaceDisable!=null)BX.unbind(e,"keydown",BX.SocNetLogDestination.backspaceDisable);BX.bind(e,"keydown",BX.SocNetLogDestination.backspaceDisable=function(e){if(e.keyCode==8){e.preventDefault();return false}});setTimeout(function(){BX.unbind(e,"keydown",BX.SocNetLogDestination.backspaceDisable);BX.SocNetLogDestination.backspaceDisable=null},5e3)}},getCodes:function(){var e=this.socnetDestinationItems.getElementsByTagName("INPUT"),t=[],i;for(i=0;i<e.length;i++){t.push(e[i].value)}return t},getAttendeesCodes:function(){var e=this.socnetDestinationItems.getElementsByTagName("INPUT"),t=[],i,a;for(i=0;i<e.length;i++){t.push(e[i].value)}return this.convertAttendeesCodes(t)},convertAttendeesCodes:function(e){var t={};if(BX.type.isArray(e)){e.forEach(function(e){if(e.substr(0,2)=="DR"){t[e]="department"}else if(e.substr(0,2)=="UA"){t[e]="groups"}else if(e.substr(0,2)=="SG"){t[e]="sonetgroups"}else if(e.substr(0,1)=="U"){t[e]="users"}})}return t},getAttendeesCodesList:function(e){var t=[];if(!e)e=this.getAttendeesCodes();for(var i in e){if(e.hasOwnProperty(i)){t.push(i)}}return t}};function n(e,t,i){this.params=t;this.id=e;this.zIndex=t.zIndex||3100;this.DOM={wrapNode:t.wrapNode};this.calendar=i;this.disabled=!this.calendar.util.isRichLocationEnabled();this.value={type:"",text:"",value:""};if(t.value&&typeof t.value==="object"){this.value.text=t.value.text||"";this.value.type=t.value.type||"";this.value.value=t.value.value||""}else if(t.value&&t.value!==""){this.value=this.calendar.util.parseLocation(t.value)}this.create()}n.prototype={create:function(){this.DOM.inputWrap=this.DOM.wrapNode.appendChild(BX.create("DIV",{props:{className:"calendar-field-block"}}));if(this.disabled){BX.addClass(this.DOM.wrapNode,"locked");this.DOM.inputWrap.appendChild(BX.create("DIV",{props:{className:"calendar-lock-icon"},events:{click:function(){B24.licenseInfoPopup.show("calendar_location",BX.message("EC_B24_LOCATION_LIMITATION_TITLE"),BX.message("EC_B24_LOCATION_LIMITATION"))}}}))}this.DOM.input=this.DOM.inputWrap.appendChild(BX.create("INPUT",{attrs:{name:this.params.inputName||"",placeholder:BX.message("EC_LOCATION_LABEL"),type:"text"},props:{className:"calendar-field calendar-field-select"}}));this.setValues()},setValues:function(){if(this.selectContol){this.selectContol.destroy()}var e=[],t=this.calendar.util.getMeetingRoomList(),a=this.calendar.util.getLocationList(),s=false;if(t&&t.length){for(n=0;n<t.length;n++){e.push({ID:parseInt(t[n].ID),label:BX.util.htmlspecialchars(t[n].NAME),value:t[n].ID,type:"mr"});if(this.value.type=="mr"&&this.value.value==t[n].ID){s=e.length-1}}e.push({delimiter:true})}if(!a||!a.length){e.push({label:BX.message("EC_ADD_LOCATION"),callback:BX.delegate(this.editMeetingRooms,this)})}else{var n;for(n=0;n<a.length;n++){e.push({ID:parseInt(a[n].ID),label:BX.util.htmlspecialchars(a[n].NAME),labelRaw:a[n].NAME,value:parseInt(a[n].ID),type:"calendar"});if(this.value.type=="calendar"&&this.value.value==a[n].ID){s=e.length-1}}e.push({delimiter:true});e.push({label:BX.message("EC_LOCATION_MEETING_ROOM_SET"),callback:BX.delegate(this.editMeetingRooms,this)})}if(this.value){this.DOM.input.value=this.value.str||"";if(this.value.type&&this.value.str==this.calendar.util.getTextLocation(this.value)){this.DOM.input.value=BX.message("EC_LOCATION_404")}}if(this.selectContol){this.selectContol.destroy()}this.selectContol=new i({input:this.DOM.input,values:e,valueIndex:s,zIndex:this.zIndex,disabled:this.disabled,onChangeCallback:BX.delegate(function(){var t,i=this.DOM.input.value;this.value={text:i};for(t=0;t<e.length;t++){if(e[t].label===i){this.value.type=e[t].type;this.value.value=e[t].value;break}}if(this.params.onChangeCallback&&typeof this.params.onChangeCallback=="function"){this.params.onChangeCallback()}},this)})},editMeetingRooms:function(){var e={};if(this.params.getControlContentCallback)e.wrap=this.params.getControlContentCallback();if(!e.wrap){e.wrap=this.showEditMeetingRooms()}this.buildLocationEditControl(e)},showEditMeetingRooms:function(){var e=this;if(this.editDialog){this.editDialog.destroy()}this.editDialogContent=BX.create("DIV");this.editDialog=new BX.PopupWindow(this.id+"_popup",null,{overlay:{opacity:10},autoHide:true,closeByEsc:true,zIndex:this.zIndex,offsetLeft:0,offsetTop:0,draggable:true,bindOnResize:false,titleBar:BX.message("EC_MEETING_ROOM_LIST_TITLE"),closeIcon:{right:"12px",top:"10px"},className:"bxc-popup-window",buttons:[new BX.PopupWindowButton({text:BX.message("EC_SEC_SLIDER_SAVE"),events:{click:function(){e.saveValues();if(e.editDialog){e.editDialog.close()}}}}),new BX.PopupWindowButtonLink({text:BX.message("EC_SEC_SLIDER_CANCEL"),className:"popup-window-button-link-cancel",events:{click:function(){if(e.editDialog){e.editDialog.close()}}}})],content:this.editDialogContent,events:{}});this.editDialog.show();return this.editDialogContent},buildLocationEditControl:function(e){var t=this,i;this.locationEditControlShown=true;this.editDialogWrap=e.wrap;var a=this.calendar.util.getLocationList();this.locationList=[];this.addNewButtonField=false;for(i=0;i<a.length;i++){this.locationList.push({id:a[i].ID,name:a[i].NAME})}if(!this.locationList.length){this.locationList.push({id:0,name:""})}for(i=0;i<this.locationList.length;i++){this.addRoomField(this.locationList[i],e.wrap)}this.addNewButtonField={outerWrap:e.wrap.appendChild(BX.create("DIV",{props:{className:"calendar-field-container calendar-field-container-container-text"}}))};this.addNewButtonField.innerWrap=this.addNewButtonField.outerWrap.appendChild(BX.create("DIV",{props:{className:"calendar-field-block"}}));this.addNewButtonField.innerCont=this.addNewButtonField.innerWrap.appendChild(BX.create("DIV",{props:{className:"calendar-text"},html:'<span class="calendar-text-link">'+BX.message("EC_MEETING_ROOM_ADD")+"</span>",events:{click:function(){var i=t.locationList[t.locationList.length-1];if(i.id||i.deleted||BX.util.trim(i.field.input.value))t.locationList.push(t.addRoomField({id:0},e.wrap))}}}));e.wrap.appendChild(this.addNewButtonField.outerWrap)},addRoomField:function(e){e.field={outerWrap:this.editDialogWrap.appendChild(BX.create("DIV",{props:{className:"calendar-field-container calendar-field-container-string"}}))};e.field.innerWrap=e.field.outerWrap.appendChild(BX.create("DIV",{props:{className:"calendar-field-block"}}));var t=this;e.field.innerWrap.style.paddingRight="40px";e.field.input=e.field.innerWrap.appendChild(BX.create("INPUT",{props:{className:"calendar-field calendar-field-string"},attrs:{value:e.name||"",placeholder:BX.message("EC_MEETING_ROOM_PLACEHOLDER"),type:"text"},events:{keyup:function(i){if(i.keyCode==13){t.editRoom(e)}}}}));e.field.delRoomEntry=e.field.innerWrap.appendChild(BX.create("SPAN",{props:{className:"calendar-remove-filed"},events:{click:function(){t.deleteField(e)}}}));if(this.addNewButtonField){this.editDialogWrap.appendChild(this.addNewButtonField.outerWrap)}if(!e.id)e.field.input.focus();return e},editRoom:function(e){if(!this.locationEditControlShown)return;e.field.input.value=BX.util.trim(e.field.input.value);if(!e.id){if(e.field.input.value&&e.field.input.value!=e.name){e.name=e.field.input.value;this.locationList.push(this.addRoomField({id:0}))}}else{if(e.field.input.value!=e.name){e.name=e.field.input.value;e.changed=true}}},deleteField:function(e){BX.remove(e.field.outerWrap,true);e.deleted=true;e.changed=true},saveValues:function(){var e,t=[];for(e=0;e<this.locationList.length;e++){if(this.locationList[e].field&&this.locationList[e].field.input){if(this.locationList[e].name!==this.locationList[e].field.input.value&&this.locationList[e].id)this.locationList[e].changed=true;this.locationList[e].name=this.locationList[e].field.input.value}if(!this.locationList[e].deleted&&this.locationList[e].name||this.locationList[e].id){t.push({id:this.locationList[e].id||0,name:this.locationList[e].name||"",changed:this.locationList[e].changed||!this.locationList[e].id?"Y":"N",deleted:this.locationList[e].deleted||!this.locationList[e].name?"Y":"N"})}}this.calendar.request({type:"post",data:{action:"update_location_list",data:t},handler:BX.delegate(function(e){this.calendar.util.setLocationList(e.locationList);this.setValues()},this)});this.locationEditControlShown=false},getTextValue:function(e){if(!e)e=this.value;var t=e.text||"";if(e&&e.type=="mr"){t="ECMR_"+e.value}else if(e&&e.type=="calendar"){t="calendar_"+e.value}return t},getValue:function(){return this.value}};function o(e,t){this.calendar=e;this.outerWrap=t.wrap;this.created=false}o.prototype={show:function(){if(!this.created){this.smallCalendar=new BX.JCCalendar;this.smallCalendar.month_popup_classname="calendar-navi-month-popup";this.smallCalendar.year_popup_classname="calendar-navi-year-popup";this.smallCalendar.Show({node:this.outerWrap,callback_after:BX.proxy(this.changeDate,this),bTime:false});this.outerWrap.appendChild(this.smallCalendar.DIV);this.smallCalendar.popup.close();this.created=true;BX.addCustomEvent(this.calendar,"changeViewRange",BX.proxy(this.setDate,this))}this.outerWrap.style.display=""},hide:function(){this.outerWrap.style.display="none"},changeDate:function(e){if(e&&this.calendar.util.getDayCode(this.calendar.getViewRangeDate())!=this.calendar.util.getDayCode(e)&&this.calendar.getView()){this.calendar.getView().adjustViewRangeToDate(e)}},setDate:function(e){if(e&&this.smallCalendar.value&&this.calendar.util.getDayCode(this.smallCalendar.value)!=this.calendar.util.getDayCode(e)){e.setHours(12,0);this.smallCalendar.SetValue(e)}}};function l(e){this.calendar=e}l.prototype={reset:function(){jsDD.Reset()},registerDay:function(e){var t=e.node;jsDD.registerDest(t);t.onbxdestdragfinish=BX.delegate(function(){if(this.draggedNode){var i=this.currentState.entry;e.date.setHours(0,0,0,0);i.from.setFullYear(e.date.getFullYear(),e.date.getMonth(),e.date.getDate());i.to=new Date(i.from.getTime()+(i.data.DT_LENGTH-(i.fullDay?1:0))*1e3);i.startDayCode=i.from;i.endDayCode=i.to;i.opacity="0";this.calendar.getView().displayEntries({reloadEntries:false});var a=i.getWrap(0);BX.addClass(this.draggedNode,"animate");setTimeout(BX.delegate(function(){this.draggedNode.style.top=BX.pos(a).top+"px";this.draggedNode.style.left=BX.pos(a).left+"px"},this),1);setTimeout(BX.delegate(function(){delete i.opacity;i.parts.forEach(function(e){e.params.wrapNode.style.opacity=""});BX.remove(this.draggedNode)},this),300);this.calendar.entryController.moveEventToNewDate(this.currentState.entry,e.date);BX.removeClass(t,"calendar-grid-drag-select")}return true},this);t.onbxdestdraghover=function(){BX.addClass(t,"calendar-grid-drag-select")};t.onbxdestdraghout=function(){BX.removeClass(t,"calendar-grid-drag-select")}},registerTimelineDay:function(e){var t=e.node;jsDD.registerDest(t);t.onbxdestdragfinish=BX.delegate(function(i){if(i.getAttribute("data-bx-entry-resizer")=="Y"&&this.resizedState){this.calendar.entryController.moveEventToNewDate(this.resizedState.entry,this.resizedState.entry.from,this.resizedState.entry.to);return true}else if(this.draggedNode){var a=this.currentState.entry;a.from.setFullYear(e.date.getFullYear(),e.date.getMonth(),e.date.getDate());a.to=new Date(a.from.getTime()+(a.data.DT_LENGTH-(a.fullDay?1:0))*1e3);if(this.calendar.util.getDayCode(a.from)!=this.calendar.util.getDayCode(a.to)&&a.to.getHours()==0&&a.to.getMinutes()==0){a.to=new Date(a.to.getTime()-1e3*60)}a.startDayCode=a.from;a.endDayCode=a.to;a.opacity="0";this.calendar.getView().displayEntries({reloadEntries:false});var s=a.getWrap(0);BX.addClass(this.draggedNode,"animate");setTimeout(BX.delegate(function(){var e=BX.pos(s);this.draggedNode.style.top=e.top+"px";this.draggedNode.style.left=e.left+"px";this.draggedNode.style.height=e.height+"px";this.draggedNode.style.width=e.width+"px";this.draggedNode.style.opacity="0.6"},this),1);setTimeout(BX.delegate(function(){delete a.opacity;a.parts.forEach(function(e){e.params.wrapNode.style.opacity=""});BX.remove(this.draggedNode)},this),250);this.calendar.entryController.moveEventToNewDate(this.currentState.entry,a.from,a.to);BX.removeClass(t,"calendar-timeline-drag-select")}return true},this);t.onbxdestdraghover=BX.delegate(function(){if(this.draggedNode){var e=BX.pos(t).left+4;if(Math.abs(e-parseInt(this.draggedNode.style.left))>30){BX.addClass(this.draggedNode,"animate");setTimeout(BX.delegate(function(){this.draggedNode.style.left=BX.pos(t).left+4+"px"},this),1);if(this.clearAnimateTimeout){clearTimeout(this.clearAnimateTimeout)}this.clearAnimateTimeout=setTimeout(BX.delegate(function(){BX.removeClass(this.draggedNode,"animate")},this),300)}BX.addClass(t,"calendar-timeline-drag-select")}},this);t.onbxdestdraghout=BX.delegate(function(){if(this.draggedNode){BX.removeClass(t,"calendar-timeline-drag-select")}},this)},registerEntry:function(e,t){var i=this.calendar.entryController.canDo(t.entry,"edit");jsDD.registerObject(e);e.onbxdragstart=BX.delegate(function(){if(!i){this.draggedNode=false;BX.addClass(e,"calendar-entry-shake-mode");if(this.denyDragTimeout)clearTimeout(this.denyDragTimeout);this.denyDragTimeout=setTimeout(function(){BX.removeClass(e,"calendar-entry-shake-mode")},1e3);return}this.currentState=t;this.draggedNode=document.body.appendChild(e.cloneNode(true));e.style.opacity="0.3";BX.addClass(this.draggedNode,"calendar-entry-drag-mode");BX.removeClass(this.draggedNode,"calendar-event-line-start-yesterday");BX.removeClass(this.draggedNode,"calendar-event-line-finish-tomorrow");if(this.calendar.currentViewName=="week"||this.calendar.currentViewName=="day"){this.draggedNode.style.left=BX.pos(e).left+2+"px";this.draggedNode.style.width=this.calendar.getView().getDayWidth()-5+"px";this.currentState.offtimeTuneBaseZeroPos=BX.pos(this.calendar.getView().timeLinesCont).top;this.currentState.bottomBasePos=BX.pos(this.calendar.getView().bottomOffHours).bottom-2}else{this.draggedNode.style.width=this.calendar.getView().getDayWidth()+"px"}var a=this.currentState.entry,s=a.getLengthInDays(),n=this.draggedNode.querySelector(".calendar-event-resizer"),o=this.draggedNode.querySelector(".calendar-event-line-inner-container"),l=this.draggedNode.querySelector(".calendar-event-block-background"),r=this.draggedNode.querySelector(".calendar-event-line-inner");if(s>1){var d=this.draggedNode.querySelector(".calendar-event-line-text");if(d){d.innerHTML='<span class="calendar-event-line-days-count">('+BX.message("EC_DAY_LENGTH").replace("#COUNT#",s)+")</span> "+d.innerHTML}}if(o){if(a.isFullDay()){o.style.backgroundColor=this.calendar.util.hexToRgba(a.color,.7);o.style.borderColor=this.calendar.util.hexToRgba(a.color,.7)}else{if(a.isLongWithTime()){o.style.borderColor=this.calendar.util.hexToRgba(a.color,.7)}}}if(l){l.style.opacity="0.45"}if(r){r.style.maxWidth=""}if(this.calendar.getView().allEventsPopup){this.calendar.getView().allEventsPopup.close()}},this);e.onbxdrag=BX.delegate(function(e,t){if(this.draggedNode){if(this.calendar.currentViewName=="week"||this.calendar.currentViewName=="day"){var i,a,s=7,n=this.currentState.entry,o=this.calendar.getView(),l=this.draggedNode.offsetHeight,r=t-s;if(r<this.currentState.offtimeTuneBaseZeroPos){BX.addClass(this.draggedNode,"calendar-entry-shake-mode");if(this.shakeTimeout)clearTimeout(this.shakeTimeout);this.shakeTimeout=setTimeout(BX.proxy(function(){BX.removeClass(this.draggedNode,"calendar-entry-shake-mode")},this),400);r=this.currentState.offtimeTuneBaseZeroPos}else if(r+l>this.currentState.bottomBasePos){BX.addClass(this.draggedNode,"calendar-entry-shake-mode");if(this.shakeTimeout)clearTimeout(this.shakeTimeout);this.shakeTimeout=setTimeout(BX.proxy(function(){BX.removeClass(this.draggedNode,"calendar-entry-shake-mode")},this),400);r=this.currentState.bottomBasePos-l}i=o.getTimeByPos(r-this.currentState.offtimeTuneBaseZeroPos,5);a=this.draggedNode.querySelector(".calendar-event-block-time");this.draggedNode.style.top=r+"px";if(a&&i){n.from.setHours(i.h,i.m);n.to=new Date(n.from.getTime()+(n.data.DT_LENGTH-(n.fullDay?1:0))*1e3);if(this.calendar.util.getDayCode(n.from)!=this.calendar.util.getDayCode(n.to)&&n.to.getHours()==0&&n.to.getMinutes()==0){n.to=new Date(n.to.getTime()-1e3)}a.innerHTML=this.calendar.util.formatTime(n.from)+" &ndash; "+this.calendar.util.formatTime(n.to)}}else{this.draggedNode.style.top=t-10+"px";this.draggedNode.style.left=e-20+"px"}}},this);e.onbxdragstop=BX.delegate(function(){setTimeout(BX.delegate(function(){BX.remove(this.draggedNode)},this),400)},this);if(t.part.params.resizerNode){this.registerResizer(t.part.params.resizerNode,t)}},registerResizer:function(t,i){t.setAttribute("data-bx-entry-resizer","Y");BX.bind(t,"mousedown",BX.delegate(function(a){a=a||e.event;this.resizedState={entry:i.entry,entryWrap:i.part.params.wrapNode,node:t,startY:a.clientY+BX.GetWindowSize().scrollTop,height:parseInt(i.part.params.wrapNode.offsetHeight)||0}},this));jsDD.registerObject(t);t.onbxdrag=BX.delegate(function(e,t){if(this.resizedState){var i=this.resizedState.entry,a=Math.max(this.resizedState.height+t-this.resizedState.startY+5,5),s=this.calendar.getView().getTimeByPos(parseInt(this.resizedState.entryWrap.style.top)+a,5),n=this.calendar.util.formatTime(i.from)+" &ndash; "+this.calendar.util.formatTime(s.h,s.m),o=this.resizedState.entryWrap.querySelector(".calendar-event-block-time");i.to.setHours(s.h,s.m,0);if(o){o.innerHTML=n+'<span class="calendar-event-block-time-shadow">'+n+"</span>"}this.resizedState.entryWrap.style.height=a+"px"}},this);t.onbxdragstop=function(){setTimeout(BX.delegate(function(){if(this.resizedState){this.resizedState=null}},this),400)}}};if(e.BXEventCalendar){e.BXEventCalendar.AddButton=t;e.BXEventCalendar.SelectInput=i;e.BXEventCalendar.ReminderSelector=a;e.BXEventCalendar.DestinationSelector=s;e.BXEventCalendar.LocationSelector=n;e.BXEventCalendar.NavigationCalendar=o;e.BXEventCalendar.DragDrop=l}else{BX.addCustomEvent(e,"onBXEventCalendarInit",function(){e.BXEventCalendar.AddButton=t;e.BXEventCalendar.SelectInput=i;e.BXEventCalendar.ReminderSelector=a;e.BXEventCalendar.DestinationSelector=s;e.BXEventCalendar.LocationSelector=n;e.BXEventCalendar.NavigationCalendar=o;e.BXEventCalendar.DragDrop=l})}})(window);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:62:"/bitrix/js/calendar/new/calendar-dialogs.min.js?15274016756537";s:6:"source";s:43:"/bitrix/js/calendar/new/calendar-dialogs.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
(function(e){function t(e){this.calendar=e;this.id=this.calendar.id+"_confirm_edit";this.zIndex=3200}t.prototype={show:function(e){var t=BX.create("DIV");this.dialog=new BX.PopupWindow(this.id,null,{overlay:{opacity:10},autoHide:true,closeByEsc:true,zIndex:this.zIndex,offsetLeft:0,offsetTop:0,draggable:true,bindOnResize:false,titleBar:BX.message("EC_EDIT_REC_EVENT"),closeIcon:{right:"12px",top:"10px"},className:"bxc-popup-window",buttons:[new BX.PopupWindowButtonLink({text:BX.message("EC_SEC_SLIDER_CANCEL"),className:"popup-window-button-link-cancel",events:{click:BX.proxy(this.close,this)}})],content:t,events:{}});t.appendChild(new BX.PopupWindowButton({text:BX.message("EC_REC_EV_ONLY_THIS_EVENT"),events:{click:BX.delegate(function(){if(e.callback&&typeof e.callback=="function"){e.params.recurentEventEditMode="this";e.params.confirmed=true;e.callback(e.params)}this.close()},this)}}).buttonNode);t.appendChild(new BX.PopupWindowButton({text:BX.message("EC_REC_EV_NEXT"),events:{click:BX.delegate(function(){if(e.callback&&typeof e.callback=="function"){e.params.recurentEventEditMode="next";e.params.confirmed=true;e.callback(e.params)}this.close()},this)}}).buttonNode);t.appendChild(new BX.PopupWindowButton({text:BX.message("EC_REC_EV_ALL"),events:{click:BX.delegate(function(){if(e.callback&&typeof e.callback=="function"){e.params.recurentEventEditMode="all";e.params.confirmed=true;e.callback(e.params)}this.close()},this)}}).buttonNode);this.dialog.show()},close:function(){if(this.dialog){this.dialog.close()}}};function n(e){this.calendar=e;this.id=this.calendar.id+"_confirm_delete";this.zIndex=3200}n.prototype={show:function(e){var t=BX.create("DIV");this.dialog=new BX.PopupWindow(this.id,null,{overlay:{opacity:10},autoHide:true,closeByEsc:true,zIndex:this.zIndex,offsetLeft:0,offsetTop:0,draggable:true,bindOnResize:false,titleBar:BX.message("EC_DEL_REC_EVENT"),closeIcon:{right:"12px",top:"10px"},className:"bxc-popup-window",buttons:[new BX.PopupWindowButtonLink({text:BX.message("EC_SEC_SLIDER_CANCEL"),className:"popup-window-button-link-cancel",events:{click:BX.proxy(this.close,this)}})],content:t,events:{}});t.appendChild(new BX.PopupWindowButton({text:BX.message("EC_REC_EV_ONLY_THIS_EVENT"),events:{click:BX.delegate(function(){if(e.isRecursive()){this.calendar.entryController.excludeRecursionDate(e)}else if(e.hasRecurrenceId()){this.calendar.entryController.deleteEntry(e,{confirmed:true,recursionMode:"this"})}this.close()},this)}}).buttonNode);t.appendChild(new BX.PopupWindowButton({text:BX.message("EC_REC_EV_NEXT"),events:{click:BX.delegate(function(){if(e.isRecursive()&&e.isFirstReccurentEntry()){this.calendar.entryController.deleteAllReccurent(e)}else{this.calendar.entryController.cutOffRecursiveEvent(e)}this.close()},this)}}).buttonNode);t.appendChild(new BX.PopupWindowButton({text:BX.message("EC_REC_EV_ALL"),events:{click:BX.delegate(function(){this.calendar.entryController.deleteAllReccurent(e);this.close()},this)}}).buttonNode);this.dialog.show()},close:function(){if(this.dialog){this.dialog.close()}}};function i(e){this.calendar=e;this.id=this.calendar.id+"_confirm_decline";this.zIndex=3200}i.prototype={show:function(e){var t=BX.create("DIV");this.dialog=new BX.PopupWindow(this.id,null,{overlay:{opacity:10},autoHide:true,closeByEsc:true,zIndex:this.zIndex,offsetLeft:0,offsetTop:0,draggable:true,bindOnResize:false,titleBar:BX.message("EC_DECLINE_REC_EVENT"),closeIcon:{right:"12px",top:"10px"},className:"bxc-popup-window",buttons:[new BX.PopupWindowButtonLink({text:BX.message("EC_SEC_SLIDER_CANCEL"),className:"popup-window-button-link-cancel",events:{click:BX.proxy(this.close,this)}})],content:t,events:{}});t.appendChild(new BX.PopupWindowButton({text:BX.message("EC_DECLINE_ONLY_THIS"),events:{click:BX.delegate(function(){this.calendar.entryController.setMeetingStatus(e,"N",{confirmed:true,recursionMode:"this"});this.close()},this)}}).buttonNode);t.appendChild(new BX.PopupWindowButton({text:BX.message("EC_DECLINE_NEXT"),events:{click:BX.delegate(function(){this.calendar.entryController.setMeetingStatus(e,"N",{confirmed:true,recursionMode:"next"});this.close()},this)}}).buttonNode);t.appendChild(new BX.PopupWindowButton({text:BX.message("EC_DECLINE_ALL"),events:{click:BX.delegate(function(){this.calendar.entryController.setMeetingStatus(e,"N",{confirmed:true,recursionMode:"all"});this.close()},this)}}).buttonNode);this.dialog.show()},close:function(){if(this.dialog){this.dialog.close()}}};function s(e){this.calendar=e;this.id=this.calendar.id+"_busy_users";this.zIndex=3200;this.plural=false}s.prototype={show:function(e){this.plural=e.users.length>1;var t,n=[];for(t=0;t<e.users.length;t++){n.push(e.users[t].name)}n=n.join(", ");var i=BX.create("DIV",{props:{className:"calendar-busy-users-content-wrap"},html:'<div class="calendar-busy-users-content">'+BX.util.htmlspecialchars(this.plural?BX.message("EC_BUSY_USERS_PLURAL").replace("#USER_LIST#",n):BX.message("EC_BUSY_USERS_SINGLE").replace("#USER_NAME#",e.users[0].name))+"</div>"});this.dialog=new BX.PopupWindow(this.id,null,{overlay:{opacity:10},autoHide:true,closeByEsc:true,zIndex:this.zIndex,offsetLeft:0,offsetTop:0,draggable:true,bindOnResize:false,titleBar:BX.message("EC_BUSY_USERS_TITLE"),closeIcon:{right:"12px",top:"10px"},className:"bxc-popup-window",buttons:[new BX.PopupWindowButtonLink({text:BX.message("EC_BUSY_USERS_CLOSE"),className:"popup-window-button-link-cancel",events:{click:BX.delegate(function(){if(this.simpleEntryPopup)this.simpleEntryPopup.close();if(this.calendar.editSlider)this.calendar.editSlider.close();this.close()},this)}})],content:i,events:{}});i.appendChild(new BX.PopupWindowButton({text:BX.message("EC_BUSY_USERS_BACK2EDIT"),events:{click:BX.delegate(function(){this.close()},this)}}).buttonNode);i.appendChild(new BX.PopupWindowButton({text:this.plural?BX.message("EC_BUSY_USERS_EXCLUDE_PLURAL"):BX.message("EC_BUSY_USERS_EXCLUDE_SINGLE"),events:{click:BX.delegate(function(){if(BX.type.isFunction(e.saveCallback)){e.saveCallback()}this.close()},this)}}).buttonNode);this.dialog.show()},close:function(){if(this.dialog){this.dialog.close()}}};if(e.BXEventCalendar){e.BXEventCalendar.ConfirmEditDialog=t;e.BXEventCalendar.ConfirmDeleteDialog=n;e.BXEventCalendar.ConfirmDeclineDialog=i;e.BXEventCalendar.BusyUsersDialog=s}else{BX.addCustomEvent(e,"onBXEventCalendarInit",function(){e.BXEventCalendar.ConfirmEditDialog=t;e.BXEventCalendar.ConfirmDeleteDialog=n;e.BXEventCalendar.ConfirmDeclineDialog=i;e.BXEventCalendar.BusyUsersDialog=s})}})(window);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:68:"/bitrix/js/calendar/new/calendar-simple-popup.min.js?152740167525599";s:6:"source";s:48:"/bitrix/js/calendar/new/calendar-simple-popup.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
(function(e){function t(e){this.calendar=e}t.prototype={show:function(e){var t;this.params=e;this.entryTime=e.entryTime;this.attendees=[];this.attendeesCodesList=false;this.attendeesIndex={};this.attendeesCodes={};this.allowInvite=true;this.notify=true;if(this.calendar.ownerUser){this.attendees.push(this.calendar.ownerUser);this.attendeesIndex[this.calendar.ownerUser.id]=true;this.attendeesCodes["U"+this.calendar.ownerUser.id]="users"}this.attendees.push(this.calendar.currentUser);this.attendeesIndex[this.calendar.currentUser.id]=true;this.attendeesCodes["U"+this.calendar.currentUser.id]="users";var i,a,n=-152,s=370,l=420,r=8,o=BX.pos(e.entryNode),d=BX.GetWindowSize();if(o.right+s+r<d.innerWidth){i="left";a=o.width+r}else{i="right";a=-s-r}if(d.scrollTop+d.innerHeight-(o.bottom+l+n)<-35){i=false}t=BX.PopupWindowManager.create(this.calendar.id+"-simple-add-popup",e.bindNode||e.entryNode,{autoHide:true,closeByEsc:true,offsetTop:n,offsetLeft:a,closeIcon:true,width:s-20,titleBar:true,draggable:true,resizable:false,lightShadow:true,content:this.createContent(),overlay:{opacity:1},buttons:[new BX.PopupWindowButton({text:BX.message("JS_CORE_WINDOW_SAVE")+" (ENTER)",className:"popup-window-button-accept",events:{click:BX.delegate(this.save,this)}}),new BX.PopupWindowButton({text:BX.message("JS_CORE_WINDOW_CANCEL"),events:{click:BX.delegate(this.close,this)}})]});if(i!==false){t.setAngle({offset:130,position:i})}BX.addClass(t.titleBar,"calendar-add-popup-titlebar");BX.removeClass(t.popupContainer,"popup-window-with-titlebar");BX.removeClass(t.closeIcon,"popup-window-titlebar-close-icon");t.show(true);this.popup=t;if(t.overlay&&t.overlay.element){this.overlay=t.overlay.element;BX.addClass(t.overlay.element,"calendar-popup-overlay");setTimeout(BX.delegate(function(){BX.addClass(t.overlay.element,"calendar-popup-overlay-dark");t.overlay=null},this),1)}this.popupButtonsContainer=t.buttonsContainer;BX.addClass(t.contentContainer,"calendar-add-popup-wrap");BX.adjust(t.contentContainer,{attrs:{style:""}});t.popupContainer.style.minHeight=t.popupContainer.offsetHeight-20+"px";this.nameField.input.focus();this.nameField.input.select();BX.bind(document,"keydown",BX.proxy(this.keyHandler,this));BX.addCustomEvent(t,"onPopupClose",BX.proxy(this.close,this));this.calendar.disableKeyHandler();setTimeout(BX.delegate(function(){this.calendar.disableKeyHandler()},this),100)},save:function(t){if(!t)t={};if(t.checkBusyUsers!==false){var i=this.getBusyUserList();if(i&&i.length>0){if(!this.busyUsersDialog)this.busyUsersDialog=new e.BXEventCalendar.BusyUsersDialog(this.calendar);this.busyUsersDialog.show({users:i,saveCallback:BX.delegate(function(){var e,a=[];for(e=0;e<i.length;e++){a.push(i[e].id)}this.excludeUsers=a.join(",");t.checkBusyUsers=false;this.save(t)},this)});return}}if(this.params.section.id){var a=this.calendar.sectionController.getSection(this.params.section.id);if(a){a.show()}}this.calendar.entryController.saveEntry(this.getPopupData());if(this.params.saveCallback&&typeof this.params.saveCallback=="function")this.params.saveCallback();this.close()},close:function(){this.calendar.enableKeyHandler();if(this.popup){BX.removeCustomEvent(this.popup,"onPopupClose",BX.proxy(this.close,this));this.popup.destroy()}if(this.overlay){BX.removeClass(this.overlay,"calendar-popup-overlay-dark");setTimeout(BX.delegate(function(){BX.remove(this.overlay)},this),300)}BX.removeCustomEvent("OnDestinationAddNewItem",BX.proxy(this.checkPlannerState,this));BX.removeCustomEvent("OnDestinationUnselect",BX.proxy(this.checkPlannerState,this));BX.removeCustomEvent("OnDestinationUnselect",BX.proxy(this.clearSecondSlideHeight,this));BX.removeCustomEvent("OnCalendarPlannerSelectorChanged",BX.proxy(this.onCalendarPlannerSelectorChanged,this));if(this.plannerId){BX.onCustomEvent("OnCalendarPlannerDoUninstall",[{plannerId:this.plannerId}])}if(this.params.closeCallback&&typeof this.params.closeCallback=="function")this.params.closeCallback();BX.unbind(document,"keydown",BX.proxy(this.keyHandler,this))},getPopupData:function(){var e=[];this.attendees.forEach(function(t){e.push(t.id)});var t=this.calendar.util.parseTime(this.dateTimeField.fromTimeInput.value),i=this.calendar.util.parseTime(this.dateTimeField.toTimeInput.value),a=new Date(this.entryTime.from.getTime()),n=new Date(this.entryTime.from.getTime());a.setHours(t.h,t.m,0);n.setHours(i.h,i.m,0);if(!this.attendeesCodesList&&this.attendeesCodes){this.attendeesCodesList=[];for(var s in this.attendeesCodes){if(this.attendeesCodes.hasOwnProperty(s)){this.attendeesCodesList.push(s)}}}return{name:this.nameField.input.value,from:a,to:n,dateFrom:this.calendar.util.formatDateTime(a),dateTo:this.calendar.util.formatDateTime(n),defaultTz:this.timezoneField&&this.timezoneField.select?this.timezoneField.select.value:this.calendar.util.getUserOption("timezoneName"),section:this.params.section.id,location:this.locationSelector.getTextValue(),locationValue:this.locationSelector.getValue(),remind:this.reminderValues||false,attendees:e,attendeesCodes:this.attendeesCodes,attendeesCodesList:this.attendeesCodesList,meetingNotify:this.notify,allowInvite:this.allowInvite,excludeUsers:this.excludeUsers||""}},createContent:function(){this.mainSlide=BX.create("DIV",{props:{className:"calendar-add-popup-main-slide"}});this.secondSlide=false;this.nameField=this.createField("string-select",this.mainSlide);this.nameField.input=this.nameField.innerWrap.appendChild(BX.create("INPUT",{props:{className:"calendar-field calendar-field-string"},attrs:{value:this.params.entryName,placeholder:BX.message("EC_ENTRY_NAME"),type:"text"},events:{click:BX.delegate(function(){this.nameField.input.select()},this),keyup:BX.proxy(this.entryNameChanged,this),blur:BX.proxy(this.entryNameChanged,this),change:BX.proxy(this.entryNameChanged,this)}}));this.createSectionSelector();this.createDateTimeField();this.createReminderField();this.createlocationField();this.createPlannerField();this.fullFormField=this.createField("container-text",this.mainSlide);this.fullFormField.link=this.fullFormField.innerWrap.appendChild(BX.create("SPAN",{props:{className:"calendar-text-link"},text:BX.message("EC_FULL_FORM_LABEL"),events:{click:this.params.fullFormCallback}}));this.mainSlide.appendChild(BX.create("HR",{props:{className:"calendar-filed-separator"}}));this.sliderContainer=BX.create("DIV",{props:{className:"calendar-add-popup-slider-container"},children:[this.mainSlide]});return this.sliderContainer},prepareSecondSlide:function(e){this.closeSecondSlideCallback=e.closeCallback||null;if(this.secondSlide){BX.cleanNode(this.secondSlide)}else{this.secondSlide=this.sliderContainer.appendChild(BX.create("DIV",{props:{className:"calendar-add-popup-second-slide"}}))}this.backButton=this.secondSlide.appendChild(BX.create("DIV",{props:{className:"calendar-add-popup-second-slide-header"}})).appendChild(BX.create("SPAN",{props:{className:"calendar-add-popup-second-slide-back-btn"},html:BX.message("EC_SIMPLE_FORM_BACK")}));BX.bind(this.backButton,"click",BX.proxy(this.closeSecondSlide,this));BX.bind(document,"keyup",BX.proxy(function(e){if(e.keyCode==27){this.closeSecondSlide()}},this));this.popup.setClosingByEsc(false);this.popupButtonsContainer.style.display="none";this.resizeSecondSlide();setTimeout(BX.delegate(function(){BX.addClass(this.popup.contentContainer,"calendar-add-popup-wrap-second-tab-active")},this),0)},closeSecondSlide:function(){if(this.closeSecondSlideCallback)this.closeSecondSlideCallback();BX.unbind(document,"keyup",BX.proxy(function(e){if(e.keyCode==27){this.closeSecondSlide()}},this));BX.removeClass(this.popup.contentContainer,"calendar-add-popup-wrap-second-tab-active");this.popupButtonsContainer.style.display="";this.clearSecondSlideHeight();this.popup.setClosingByEsc(true);if(this.resizeTimeout)this.resizeTimeout=clearTimeout(this.resizeTimeout);BX.cleanNode(this.secondSlide)},resizeSecondSlide:function(){if(this.secondSlide){var e=this.secondSlide.scrollHeight;if(e!=parseInt(this.popup.contentContainer.style.minHeight)){this.secondSlide.style.minHeight=e+"px";this.sliderContainer.style.minHeight=e+"px"}this.resizeTimeout=setTimeout(BX.proxy(this.resizeSecondSlide,this),100)}},clearSecondSlideHeight:function(){if(this.secondSlide)this.secondSlide.style.minHeight="";if(this.sliderContainer)this.sliderContainer.style.minHeight=""},createField:function(e,t){if(!e)e="string";var i=BX.create("DIV",{props:{className:"calendar-field-container calendar-field-container-"+e}}),a=i.appendChild(BX.create("DIV",{props:{className:"calendar-field-block"}}));if(t)t.appendChild(i);return{outerWrap:i,innerWrap:a}},createSectionSelector:function(){this.sectionField={select:this.nameField.innerWrap.appendChild(BX.create("DIV",{props:{className:"calendar-field calendar-field-select calendar-field-tiny"}}))};this.sectionField.innerValue=this.sectionField.select.appendChild(BX.create("DIV",{props:{className:"calendar-field-select-icon"},style:{backgroundColor:this.params.section.color}}));BX.bind(this.sectionField.select,"click",i);var e=this,t=this.calendar.sectionController.getSectionListForEdit();function i(){if(e.sectionMenu&&e.sectionMenu.popupWindow&&e.sectionMenu.popupWindow.isShown()){return e.sectionMenu.close()}var i,a=[],n;for(i=0;i<t.length;i++){a.push({id:"bx-calendar-section-"+t[i].id,text:BX.util.htmlspecialchars(t[i].name),color:t[i].color,className:"calendar-add-popup-section-menu-item",onclick:function(t){return function(){e.params.section=e.calendar.sectionController.getSection(t);e.calendar.util.setUserOption("lastUsedSection",e.params.section.id);e.sectionField.innerValue.style.backgroundColor=e.params.section.color;e.sectionMenu.close();if(e.params.changeSectionCallback&&typeof e.params.changeSectionCallback=="function"){e.params.changeSectionCallback(e.params.section)}}}(t[i].id)})}e.sectionMenu=BX.PopupMenu.create("sectionMenu"+e.calendar.id,e.sectionField.select,a,{closeByEsc:true,autoHide:true,zIndex:1200,offsetTop:0,offsetLeft:40,angle:true});e.sectionMenu.show();for(i=0;i<e.sectionMenu.menuItems.length;i++){if(e.sectionMenu.menuItems[i].layout.item){n=e.sectionMenu.menuItems[i].layout.item.querySelector(".menu-popup-item-icon");if(n){n.style.backgroundColor=e.sectionMenu.menuItems[i].color}}}BX.addClass(e.sectionField.select,"active");e.popup.setAutoHide(false);BX.addCustomEvent(e.sectionMenu.popupWindow,"onPopupClose",function(){e.popup.setAutoHide(true);BX.removeClass(e.sectionField.select,"active");BX.PopupMenu.destroy("sectionMenu"+e.calendar.id)})}},createDateTimeField:function(){var t=this,i=this.calendar.util.formatTime(this.entryTime.from.getHours(),this.entryTime.from.getMinutes()),a=this.calendar.util.formatTime(this.entryTime.to.getHours(),this.entryTime.to.getMinutes());this.dateTimeField={outerWrap:this.mainSlide.appendChild(BX.create("DIV",{props:{className:"calendar-field-container calendar-field-container-datetime"}}))};this.dateTimeField.dateWrap=this.dateTimeField.outerWrap.appendChild(BX.create("DIV",{props:{className:"calendar-field-block calendar-field-block-prefix"},text:this.calendar.util.formatDateUsable(this.entryTime.from,false)}));this.dateTimeField.fromTimeInputWrap=this.dateTimeField.outerWrap.appendChild(BX.create("DIV",{props:{className:"calendar-field-block calendar-field-block-left"}}));this.dateTimeField.fromTimeInput=this.dateTimeField.fromTimeInputWrap.appendChild(BX.create("INPUT",{attrs:{value:i,placeholder:BX.message("EC_TIME_FROM_PLACEHOLDER"),type:"text"},props:{className:"calendar-field calendar-field-datetime-menu"}}));this._fromDateValue=this.entryTime.from;this.dateTimeField.outerWrap.appendChild(BX.create("DIV",{props:{className:"calendar-field-block calendar-field-block-between"}}));this.dateTimeField.toTimeInputWrap=this.dateTimeField.outerWrap.appendChild(BX.create("DIV",{props:{className:"calendar-field-block calendar-field-block-right"}}));this.dateTimeField.toTimeInput=this.dateTimeField.toTimeInputWrap.appendChild(BX.create("INPUT",{attrs:{value:a,placeholder:BX.message("EC_TIME_TO_PLACEHOLDER"),type:"text"},props:{className:"calendar-field calendar-field-datetime-menu"}}));this.dateTimeField.fromTime=new e.BXEventCalendar.SelectInput({input:this.dateTimeField.fromTimeInput,value:this.calendar.util.adaptTimeValue(t.calendar.util.parseTime(t.dateTimeField.fromTimeInput.value)),values:this.calendar.util.getSimpleTimeList(),onChangeCallback:BX.proxy(function(){var e=this.calendar.util.parseTime(this.dateTimeField.fromTimeInput.value),t=this.calendar.util.parseTime(this.dateTimeField.toTimeInput.value),i=new Date(this.entryTime.from.getTime()),a=new Date(this.entryTime.from.getTime());i.setHours(e.h,e.m,0);a.setHours(t.h,t.m,0);if(this._fromDateValue){this.entryTime.to=new Date(i.getTime()+(a.getTime()-this._fromDateValue.getTime()||36e5));this.dateTimeField.toTimeInput.value=this.calendar.util.formatTime(this.entryTime.to.getHours(),this.entryTime.to.getMinutes())}this.entryTime.from=i;this._fromDateValue=i;if(this.params.timeNode){this.params.timeNode.innerHTML=this.calendar.util.formatTime(e.h,e.m)}if(this.params.changeTimeCallback&&typeof this.params.changeTimeCallback=="function"){this.params.changeTimeCallback(e,t)}},this)});this.dateTimeField.toTime=new e.BXEventCalendar.SelectInput({input:this.dateTimeField.toTimeInput,value:this.calendar.util.adaptTimeValue(this.calendar.util.parseTime(this.dateTimeField.toTimeInput.value)),values:this.calendar.util.getSimpleTimeList()});if(!this.calendar.util.getUserOption("timezoneName")){this.timezoneField=this.createField("container-string",this.mainSlide);this.timezoneField.innerWrap.appendChild(BX.create("LABEL",{props:{className:"calendar-timezone-label"},text:BX.message("EC_ASK_TZ")}));this.timezoneField.select=this.timezoneField.innerWrap.appendChild(BX.create("SELECT",{props:{className:"calendar-field calendar-field-select"},events:{change:function(){t.calendar.util.setUserOption("timezoneName",t.timezoneField.select.value)}}}));var n,s=this.calendar.util.getTimezoneList();for(n in s){if(s.hasOwnProperty(n))this.timezoneField.select.options.add(new Option(s[n].title,n,false,false))}this.timezoneField.select.value=this.calendar.util.getUserOption("timezoneDefaultName")||"";this.timezoneField.innerWrap.appendChild(BX.create("SPAN",{props:{title:BX.message("EC_EVENT_TZ_DEF_HINT"),className:"calendar-event-quest"},html:"?"}));BX.addClass(this.timezoneField.innerWrap,"calendar-field-timezone")}},setDateTimeValues:function(e,t){if(e&&t&&this.dateTimeField&&this.dateTimeField.dateWrap){this.dateTimeField.dateWrap.innerHTML=this.calendar.util.formatDateUsable(e);this.dateTimeField.fromTimeInput.value=this.calendar.util.formatTime(e.getHours(),e.getMinutes());this.dateTimeField.toTimeInput.value=this.calendar.util.formatTime(t.getHours(),t.getMinutes());this.entryTime.from=e;this.entryTime.to=t;this._fromDateValue=e;if(this.params.timeNode)this.params.timeNode.innerHTML=this.dateTimeField.fromTimeInput.value}},createReminderField:function(){this.reminderValues=[];this.reminderField=this.createField("container-text",this.mainSlide);this.reminderField.innerCont=this.reminderField.innerWrap.appendChild(BX.create("DIV",{props:{className:"calendar-text"},text:BX.message("EC_REMIND_LABEL")+":"}));var t=this;this.reminderField.reminder=new e.BXEventCalendar.ReminderSelector({id:"reminder-"+this.calendar.id,selectedValues:[this.calendar.util.getUserOption("defaultReminder",15)],values:this.calendar.util.getRemindersList(),valuesContainerNode:this.reminderField.innerCont.appendChild(BX.create("SPAN")),addButtonNode:this.reminderField.innerCont.appendChild(BX.create("SPAN",{props:{className:"calendar-notification-btn-container calendar-notification-btn-add"},html:'<span class="calendar-notification-icon"></span>'})),changeCallack:function(e){t.reminderValues=e},showPopupCallBack:function(){t.popup.setAutoHide(false)},hidePopupCallBack:function(){t.popup.setAutoHide(true)}})},createlocationField:function(){this.locationField={outerWrap:this.mainSlide.appendChild(BX.create("DIV",{props:{className:"calendar-field-container calendar-field-container-select"}}))};this.locationSelector=new e.BXEventCalendar.LocationSelector(this.calendar.id+"-simple-slider-location",{value:this.entry?this.entry.location:"",wrapNode:this.locationField.outerWrap,getControlContentCallback:BX.delegate(function(){this.prepareSecondSlide({closeCallback:BX.proxy(this.locationSelector.saveValues,this.locationSelector)});this.secondSlide.appendChild(BX.create("DIV",{props:{className:"calendar-title-text"},text:BX.message("EC_MEETING_ROOM_LIST_TITLE")}));return this.secondSlide},this)},this.calendar)},createPlannerField:function(){this.plannerField=this.createField("container-members",this.mainSlide);this.plannerField.innerWrapAttendeesWrap=this.plannerField.innerWrap.appendChild(BX.create("DIV",{props:{className:"calendar-members-selected"},html:"<span>"+BX.message("EC_ATTENDEES_LABEL")+":</span>"}));this.plannerField.currentAttendeesWrap=this.plannerField.innerWrapAttendeesWrap.appendChild(BX.create("SPAN",{props:{className:"calendar-attendees-list"}}));this.showAttendees();this.plannerField.plannerLink=this.plannerField.innerWrapAttendeesWrap.appendChild(BX.create("SPAN",{props:{className:"calendar-members-change-link"},html:BX.message("EC_ATTENDEES_EDIT"),events:{click:BX.delegate(this.showPlannerSlide,this)}}))},showAttendees:function(){BX.cleanNode(this.plannerField.currentAttendeesWrap);var e,t,i=3,a=this.attendees.length,n=5;if(a>0){if(a>n){a=i}for(e=0;e<a;e++){t=this.attendees[e]||{};this.plannerField.currentAttendeesWrap.appendChild(BX.create("IMG",{attrs:{id:"simple_popup_"+t.id,src:t.smallAvatar||""},props:{className:"calendar-member"}}));(function(e){setTimeout(function(){BX.tooltip(e,"simple_popup_"+e)},100)})(t.id)}if(a<this.attendees.length){this.plannerField.currentAttendeesWrap.appendChild(BX.create("SPAN",{text:BX.message("EC_ATTENDEES_MORE").replace("#COUNT#",this.attendees.length-a)}))}}},showPlannerSlide:function(){this.popup.setAutoHide(false);this.prepareSecondSlide({closeCallback:BX.proxy(this.hidePlannerSlide,this)});this.attendeesSelector=new e.BXEventCalendar.DestinationSelector(this.calendar.id+"-simple-popup-destination",{wrapNode:this.secondSlide,itemsSelected:this.attendeesCodes||this.calendar.util.getSocnetDestinationConfig("itemsSelected"),calendar:this.calendar});this.loader=BX.adjust(this.calendar.util.getLoader(),{style:{height:"180px"}});this.secondSlide.appendChild(this.loader);this.initPlannerControl();this.meetingOptionsWrap=this.secondSlide.appendChild(BX.create("DIV",{props:{className:"calendar-add-popup-meeting-options-wrap"},style:{display:"none"}}));this.notifyField=this.createField("container-checkbox",this.meetingOptionsWrap);this.notifyField.label=this.notifyField.innerWrap.appendChild(BX.create("LABEL",{props:{className:"calendar-field-checkbox-label"},html:BX.message("EC_NOTIFY_STATUS_LABEL")}));this.notifyField.checkbox=this.notifyField.label.appendChild(BX.create("INPUT",{attrs:{type:"checkbox"},props:{className:"calendar-field-checkbox"}}));this.notifyField.checkbox.checked=this.notify},hidePlannerSlide:function(){this.popup.setAutoHide(true);if(this.allowInviteField){this.allowInvite=!!this.allowInviteField.checkbox.checked}if(this.notifyField){this.notify=!!this.notifyField.checkbox.checked}this.destroyDestinationControls()},entryNameChanged:function(){var e=this.nameField.input.value||BX.message("EC_ENTRY_NAME");if(this.params.nameNode){this.params.nameNode.innerHTML=BX.util.htmlspecialchars(e)}if(this.params.changeNameCallback&&typeof this.params.changeNameCallback=="function")this.params.changeNameCallback(e)},initPlannerControl:function(){this.plannerId=this.calendar.id+"-simple-planner";this.plannerShown=false;this.plannerWrap=this.secondSlide.appendChild(BX.create("DIV",{props:{className:"calendar-add-popup-planner-wrap"}}));BX.addCustomEvent("OnDestinationAddNewItem",BX.proxy(this.checkPlannerState,this));BX.addCustomEvent("OnDestinationUnselect",BX.proxy(this.checkPlannerState,this));BX.addCustomEvent("OnDestinationUnselect",BX.proxy(this.clearSecondSlideHeight,this));BX.addCustomEvent("OnCalendarPlannerSelectorChanged",BX.proxy(this.onCalendarPlannerSelectorChanged,this));if(!this.requestPlanner){this.requestPlanner=true;BX.ajax.get(this.calendar.util.getActionUrl(),{action:"get_planner",sessid:BX.bitrix_sessid(),bx_event_calendar_request:"Y",reqId:Math.round(Math.random()*1e6),planner_id:this.plannerId},BX.delegate(function(e){if(this.loader)BX.remove(this.loader);e=BX.util.trim(e);this.plannerWrap.innerHTML=e;this.requestPlanner=false;this.checkPlannerState()},this))}},onCalendarPlannerSelectorChanged:function(e){if(this.calendar.util.getDayCode(this.entryTime.from)!==this.calendar.util.getDayCode(e.dateFrom)&&this.params.changeDateCallback){this.params.changeDateCallback(e.dateFrom);if(this.popup.angle){this.popup.setAngle(false)}}this.setDateTimeValues(e.dateFrom,e.dateTo)},destroyDestinationControls:function(){if(BX.SocNetLogDestination){if(BX.SocNetLogDestination.isOpenDialog())BX.SocNetLogDestination.closeDialog();if(BX.SocNetLogDestination.popupWindow)BX.SocNetLogDestination.popupWindow.close();BX.SocNetLogDestination.closeSearch()}BX.removeCustomEvent("OnDestinationAddNewItem",BX.proxy(this.checkPlannerState,this));BX.removeCustomEvent("OnDestinationUnselect",BX.proxy(this.checkPlannerState,this));BX.removeCustomEvent("OnDestinationUnselect",BX.proxy(this.clearSecondSlideHeight,this));BX.removeCustomEvent("OnCalendarPlannerSelectorChanged",BX.proxy(this.OnCalendarPlannerSelectorChanged,this))},plannerIsShown:function(){return this.plannerWrap&&BX.hasClass(this.plannerWrap,"calendar-add-popup-show-planner")},checkPlannerState:function(){var e={codes:this.attendeesSelector.getCodes(),from:this.calendar.util.formatDate(this.entryTime.from.getTime()-this.calendar.util.dayLength*3),to:this.calendar.util.formatDate(this.entryTime.from.getTime()+this.calendar.util.dayLength*10),location:this.locationSelector.getTextValue()};this.attendeesCodes=this.attendeesSelector.getAttendeesCodes();this.attendeesCodesList=this.attendeesSelector.getAttendeesCodesList(this.attendeesCodes);this.updatePlanner(e)},updatePlanner:function(e){if(!e)e={};this.plannerLoadedlocation=e.location||"";var t=this,i=0;this.calendar.request({data:{action:"update_planner",codes:e.codes||[],cur_event_id:i,date_from:e.dateFrom||e.from||"",date_to:e.dateTo||e.to||"",timezone:this.timezoneField&&this.timezoneField.select?this.timezoneField.select.value:this.calendar.util.getUserOption("timezoneName"),location:this.plannerLoadedlocation,entries:e.entrieIds||false,add_cur_user_to_list:"N"},handler:function(i){var a,n=[],s={},l=false,r=!!(e.entries||i.entries&&i.entries.length>0);for(a=0;a<i.entries.length;a++){if(i.entries[a].type=="user"){n.push({id:i.entries[a].id,name:i.entries[a].name,avatar:i.entries[a].avatar,smallAvatar:i.entries[a].smallAvatar||i.entries[a].avatar,url:i.entries[a].url});s[i.entries[a].id]=true;if(!t.attendeesIndex[i.entries[a].id])l=true}}if(!l){for(var o in t.attendeesIndex){if(t.attendeesIndex.hasOwnProperty(o)&&!s[o]){l=true;break}}}if(l){t.attendees=n;t.showAttendees()}if(r){var d={show:r&&!t.plannerIsShown()};if(e.entries){i.entries=e.entries;d.scaleFrom=e.from;d.scaleTo=e.to}d.loadedDataFrom=e.from;d.loadedDataTo=e.to;d.data={entries:i.entries,accessibility:i.accessibility};d.focusSelector=e.focusSelector==undefined?false:e.focusSelector;t.refreshPlannerState(d)}else if(!r&&t.plannerIsShown()){t.hidePlanner()}}})},refreshPlannerState:function(e){if(!e||typeof e!=="object")e={};this.plannerData=e.data;var t=this.calendar.util.getWorkTime(),i={changeFromFullDay:{scaleType:"1hour",timelineCellWidth:40},shownScaleTimeFrom:t.start,shownScaleTimeTo:t.end,width:this.plannerWrap.offsetWidth||400,minWidth:this.plannerWrap.offsetWidth||400,entriesListWidth:50,showEntiesHeader:false,showEntryName:false},a=this.plannerIsShown();if(e.focusSelector==undefined)e.focusSelector=true;if(!a&&!e.data){this.checkPlannerState()}else{if(e.show){BX.addClass(this.plannerWrap,"calendar-add-popup-show-planner");this.meetingOptionsWrap.style.display="";if(!a&&e.show){e.focusSelector=true}}var n=this.calendar.util.parseTime(this.dateTimeField.fromTimeInput.value),s=this.calendar.util.parseTime(this.dateTimeField.toTimeInput.value),l=new Date(this.entryTime.from.getTime()),r=new Date(this.entryTime.from.getTime());l.setHours(n.h,n.m,0);r.setHours(s.h,s.m,0);BX.onCustomEvent("OnCalendarPlannerDoUpdate",[{plannerId:this.plannerId,config:i,focusSelector:e.focusSelector,selector:{from:l,to:r,fullDay:false,animation:true,updateScaleLimits:true},data:e.data||false,loadedDataFrom:e.loadedDataFrom,loadedDataTo:e.loadedDataTo,show:!!e.show}])}},getBusyUserList:function(){var e,t=[];if(this.plannerData){for(e in this.plannerData.entries){if(this.plannerData.entries.hasOwnProperty(e)&&this.plannerData.entries[e].id&&this.plannerData.entries[e].status!="h"&&this.plannerData.entries[e].strictStatus&&!this.plannerData.entries[e].currentStatus){t.push(this.plannerData.entries[e])}}}return t},hidePlanner:function(){this.meetingOptionsWrap.style.display="none";this.plannerWrap.style.opacity=0;this.plannerWrap.style.height=0;this.plannerWrap.style.overflow="hidden";BX.removeClass(this.plannerWrap,"calendar-add-popup-show-planner")},keyHandler:function(e){if(e.keyCode==this.calendar.util.KEY_CODES["enter"]){this.save()}}};if(e.BXEventCalendar){e.BXEventCalendar.SimpleAddPopup=t}else{BX.addCustomEvent(e,"onBXEventCalendarInit",function(){e.BXEventCalendar.SimpleAddPopup=t})}})(window);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:73:"/bitrix/js/calendar/new/calendar-simple-view-popup.min.js?152740167511154";s:6:"source";s:53:"/bitrix/js/calendar/new/calendar-simple-view-popup.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
(function(e){function t(e){this.calendar=e;this.params={}}t.prototype={show:function(e){var t;this.params=e;this.entry=this.params.entry;var s=e.entry.getPart(0);if(e.specialTarget){this.bindNode=e.specialTarget}else if(s&&s.params&&s.params.wrapNode){this.bindNode=s.params.wrapNode}if(!this.bindNode)return;t=new BX.PopupWindow(this.calendar.id+"-simple-view-popup",this.bindNode,{autoHide:true,closeByEsc:true,offsetTop:0,offsetLeft:0,closeIcon:true,titleBar:true,draggable:true,resizable:false,lightShadow:true,className:"calendar-simple-view-popup",content:this.createContent()});BX.addClass(t.titleBar,"calendar-add-popup-titlebar");BX.removeClass(t.popupContainer,"popup-window-with-titlebar");BX.removeClass(t.closeIcon,"popup-window-titlebar-close-icon");t.show(true);this.popup=t;this.popupButtonsContainer=t.buttonsContainer;BX.addClass(t.contentContainer,"calendar-view-popup-wrap");BX.adjust(t.contentContainer,{attrs:{style:""}});t.popupContainer.style.minHeight=t.popupContainer.offsetHeight-20+"px";BX.bind(document,"keydown",BX.proxy(this.keyHandler,this));BX.addCustomEvent(t,"onPopupClose",BX.proxy(this.close,this));this.calendar.disableKeyHandler()},close:function(e){if(!e)e={};this.calendar.enableKeyHandler();if(this.popup){BX.removeCustomEvent(this.popup,"onPopupClose",BX.proxy(this.close,this));this.popup.destroy()}if(this.params.closeCallback&&typeof this.params.closeCallback=="function")this.params.closeCallback();if(e.deselectEntry){setTimeout(BX.delegate(function(){this.calendar.getView().deselectEntry()},this),300)}BX.unbind(document,"keydown",BX.proxy(this.keyHandler,this))},isShown:function(){return this.popup&&this.popup.isShown&&this.popup.isShown()},createContent:function(e){if(e&&e.entry)this.entry=e.entry;this.wrap=BX.create("DIV",{props:{className:"calendar-right-block-event-info"}});var t;this.DOM={name:this.wrap.appendChild(BX.create("DIV",{props:{className:"calendar-right-block-event-info-title"},html:'<div class="calendar-right-block-event-info-title-calendar" style="background-color: '+this.entry.color+';"></div>'+BX.util.htmlspecialchars(this.entry.name)})),date:this.wrap.appendChild(BX.create("DIV",{props:{className:"calendar-right-block-event-info-date"},text:this.calendar.util.formatDateUsable(this.entry.from)})),tableWrap:this.wrap.appendChild(BX.create("TABLE",{props:{className:"calendar-field-right-block-table"}})),buttonsWrap:this.wrap.appendChild(BX.create("DIV",{props:{className:"calendar-right-block-event-info-btn-container"}}))};if(this.calendar.util.getDayCode(this.entry.from)==this.calendar.util.getDayCode(this.entry.to)){this.DOM.date.innerHTML=this.calendar.util.formatDateUsable(this.entry.from);if(this.entry.fullDay){this.DOM.date.innerHTML+=", "+BX.message("EC_ALL_DAY")}else{this.DOM.date.innerHTML+=", "+this.calendar.util.formatTime(this.entry.from.getHours(),this.entry.from.getMinutes())+" &ndash; "+this.calendar.util.formatTime(this.entry.to.getHours(),this.entry.to.getMinutes())}}else{this.DOM.date.innerHTML=this.calendar.util.formatDateUsable(this.entry.from)+", "+this.calendar.util.formatTime(this.entry.from.getHours(),this.entry.from.getMinutes())+" &ndash; "+this.calendar.util.formatDateUsable(this.entry.to)+", "+this.calendar.util.formatTime(this.entry.to.getHours(),this.entry.to.getMinutes())}if(this.entry.isRecursive()&&this.entry.data["~RRULE_DESCRIPTION"]){t=this.DOM.tableWrap.insertRow(-1);BX.adjust(t.insertCell(-1),{props:{className:"calendar-field-table-cell-name"},html:BX.message("EC_REPEAT")+":"});BX.adjust(t.insertCell(-1),{props:{className:"calendar-field-table-cell-value"},html:'<div class="calendar-field-container calendar-field-container-text"><div class="calendar-field-block"><div class="calendar-text">'+BX.util.htmlspecialchars(this.entry.data["~RRULE_DESCRIPTION"])+"</div></div></div>"})}if(this.entry.isMeeting()&&this.entry.getAttendees().length>0){t=this.DOM.tableWrap.insertRow(-1);BX.adjust(t.insertCell(-1),{props:{className:"calendar-field-table-cell-name"},html:BX.message("EC_HOST")+":"});this.DOM.hostWrap=BX.adjust(t.insertCell(-1),{props:{className:"calendar-field-table-cell-value"}}).appendChild(BX.create("DIV",{props:{className:"calendar-field-container calendar-field-container-members"}})).appendChild(BX.create("DIV",{props:{className:"calendar-field-block"}})).appendChild(BX.create("DIV",{props:{className:"calendar-add-popup-selected-members"}}));var s=false;this.showAttendees(this.DOM.hostWrap,this.entry.getAttendees().filter(function(e){if(s)return false;s=e.STATUS=="H"||e.USER_ID==this.entry.getMeetingHost();return s},this));t=this.DOM.tableWrap.insertRow(-1);BX.adjust(t.insertCell(-1),{props:{className:"calendar-field-table-cell-name"},html:BX.message("EC_ATTENDEES_LABEL")+":"});this.DOM.attendeesWrap=BX.adjust(t.insertCell(-1),{props:{className:"calendar-field-table-cell-value"}}).appendChild(BX.create("DIV",{props:{className:"calendar-field-container calendar-field-container-members"}})).appendChild(BX.create("DIV",{props:{className:"calendar-field-block"}})).appendChild(BX.create("DIV",{props:{className:"calendar-add-popup-selected-members"}}));this.showAttendees(this.DOM.attendeesWrap,this.entry.getAttendees().filter(function(e){return e.STATUS=="Y"||e.STATUS=="H"}),this.entry.getAttendees().length)}var a=this.calendar.util.getTextLocation(this.entry.location);if(a){t=this.DOM.tableWrap.insertRow(-1);BX.adjust(t.insertCell(-1),{props:{className:"calendar-field-table-cell-name"},html:BX.message("EC_LOCATION")+":"});BX.adjust(t.insertCell(-1),{props:{className:"calendar-field-table-cell-value"},html:'<div class="calendar-field-container calendar-field-container-text"><div class="calendar-field-block"><div class="calendar-text">'+BX.util.htmlspecialchars(a)+"</div></div></div>"})}this.showButtons();return this.wrap},showButtons:function(){this.DOM.buttonsWrap.appendChild(BX.create("SPAN",{props:{className:"calendar-right-block-event-info-btn"},text:BX.message("EC_VIEW"),events:{click:BX.proxy(function(){if(this.entry.isTask()){BX.SidePanel.Instance.open(this.calendar.util.getViewTaskPath(this.entry.id),{loader:"task-new-loader"})}else{this.calendar.getView().showViewSlider({entry:this.entry})}this.close({deselectEntry:true})},this)}}));if(this.entry&&this.entry.getCurrentStatus()){var e=this.entry.getCurrentStatus();if(e=="Q"){this.DOM.buttonsWrap.appendChild(BX.create("SPAN",{props:{className:"calendar-right-block-event-info-btn"},text:BX.message("EC_VIEW_DESIDE_BUT_Y"),events:{click:BX.proxy(function(){this.calendar.entryController.setMeetingStatus(this.entry,"Y");this.close({deselectEntry:true})},this)}}));this.DOM.buttonsWrap.appendChild(BX.create("SPAN",{props:{className:"calendar-right-block-event-info-btn"},text:BX.message("EC_VIEW_DESIDE_BUT_N"),events:{click:BX.proxy(function(){this.calendar.entryController.setMeetingStatus(this.entry,"N");this.close({deselectEntry:true})},this)}}))}else if(e=="Y"){this.DOM.buttonsWrap.appendChild(BX.create("SPAN",{props:{className:"calendar-right-block-event-info-btn"},text:BX.message("EC_VIEW_DESIDE_BUT_N"),events:{click:BX.proxy(function(){this.calendar.entryController.setMeetingStatus(this.entry,"N");this.close({deselectEntry:true})},this)}}))}else if(e=="N"){this.DOM.buttonsWrap.appendChild(BX.create("SPAN",{props:{className:"calendar-right-block-event-info-btn"},text:BX.message("EC_VIEW_DESIDE_BUT_Y"),events:{click:BX.proxy(function(){this.calendar.entryController.setMeetingStatus(this.entry,"Y");this.close({deselectEntry:true})},this)}}))}}if(this.calendar.entryController.canDo(this.entry,"edit")&&!this.entry.isTask()){this.DOM.buttonsWrap.appendChild(BX.create("SPAN",{props:{className:"calendar-right-block-event-info-btn"},text:BX.message("EC_SEC_EDIT"),events:{click:BX.proxy(function(){this.calendar.entryController.editEntry({entry:this.entry});this.close({deselectEntry:true})},this)}}))}if(this.calendar.entryController.canDo(this.entry,"delete")&&!this.entry.isTask()){this.DOM.buttonsWrap.appendChild(BX.create("SPAN",{props:{className:"calendar-right-block-event-info-btn"},text:BX.message("EC_SEC_DELETE"),events:{click:BX.proxy(function(){this.calendar.entryController.deleteEntry(this.entry);this.close({deselectEntry:true})},this)}}))}},showAttendees:function(e,t,s){var a,i,r=5,n=t.length,l=7;if(n>0){if(n>l){n=r}for(a=0;a<n;a++){i=t[a]||{};e.appendChild(BX.create("IMG",{attrs:{id:"simple_view_popup_"+i.ID,src:i.AVATAR||""},props:{title:i.DISPLAY_NAME,className:"calendar-member"}}));(function(e){setTimeout(function(){BX.tooltip(e,"simple_view_popup_"+e)},100)})(i.ID)}if(n<t.length){this.DOM.moreUsersLink=e.appendChild(BX.create("SPAN",{props:{className:"calendar-member-more-count"},text:" "+BX.message("EC_ATTENDEES_MORE").replace("#COUNT#",t.length-n),events:{click:BX.delegate(function(){this.showUserListPopup(this.DOM.moreUsersLink,t)},this)}}))}if(s-1>0&&n<s){this.DOM.allUsersLink=e.appendChild(BX.create("SPAN",{props:{className:"calendar-member-total-count"},text:" ("+BX.message("EC_ATTENDEES_TOTAL_COUNT").replace("#COUNT#",s-1)+")",events:{click:BX.delegate(function(){this.showUserListPopup(this.DOM.allUsersLink,this.entry.getAttendees())},this)}}))}}},showUserListPopup:function(e,t){if(this.userListPopup)this.userListPopup.close();if(this.popup)this.popup.setAutoHide(false);if(!t||!t.length)return;this.DOM.userListPopupWrap=BX.create("DIV",{props:{className:"calendar-user-list-popup-block"}});t.forEach(function(e){var t=this.DOM.userListPopupWrap.appendChild(BX.create("DIV",{props:{className:"calendar-slider-sidebar-user-container calendar-slider-sidebar-user-card"}}));t.appendChild(BX.create("DIV",{props:{className:"calendar-slider-sidebar-user-block-avatar"}})).appendChild(BX.create("DIV",{props:{className:"calendar-slider-sidebar-user-block-item"}})).appendChild(BX.create("IMG",{props:{width:34,height:34,src:e.AVATAR}}));t.appendChild(BX.create("DIV",{props:{className:"calendar-slider-sidebar-user-info"}})).appendChild(BX.create("A",{props:{href:e.URL?e.URL:"#",className:"calendar-slider-sidebar-user-info-name"},text:e.DISPLAY_NAME}))},this);this.userListPopup=new BX.PopupWindow(this.calendar.id+"-view-user-list-popup",e,{autoHide:true,closeByEsc:true,offsetTop:0,offsetLeft:0,width:200,resizable:false,lightShadow:true,content:this.DOM.userListPopupWrap,className:"calendar-user-list-popup"});this.userListPopup.setAngle({offset:36});this.userListPopup.show();BX.addCustomEvent(this.userListPopup,"onPopupClose",BX.delegate(function(){if(this.popup)this.popup.setAutoHide(true);this.userListPopup.destroy()},this))},keyHandler:function(e){var t=this.calendar.util.getKeyCodes(),s=e.keyCode;if(this.entry){if(s==t["enter"]){if(this.entry.isTask()){BX.SidePanel.Instance.open(this.calendar.util.getViewTaskPath(this.entry.id),{loader:"task-new-loader"})}else{this.calendar.getView().showViewSlider({entry:this.entry})}this.close({deselectEntry:true})}else if(s==t["delete"]||s==t["backspace"]){this.calendar.entryController.deleteEntry(this.entry)}}}};if(e.BXEventCalendar){e.BXEventCalendar.SimpleViewPopup=t}else{BX.addCustomEvent(e,"onBXEventCalendarInit",function(){e.BXEventCalendar.SimpleViewPopup=t})}})(window);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:70:"/bitrix/js/calendar/new/calendar-section-slider.min.js?152740167535256";s:6:"source";s:50:"/bitrix/js/calendar/new/calendar-section-slider.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
(function(e){function t(e){this.calendar=e.calendar;this.button=e.button;this.zIndex=e.zIndex||3100;this.SLIDER_WIDTH=400;this.SLIDER_DURATION=80;this.sliderId="calendar:section-slider";this.denyClose=false;BX.bind(this.button,"click",BX.delegate(this.show,this))}t.prototype={show:function(){BX.SidePanel.Instance.open(this.sliderId,{contentCallback:BX.delegate(this.create,this),width:this.SLIDER_WIDTH,animationDuration:this.SLIDER_DURATION});BX.addCustomEvent("SidePanel.Slider:onCloseByEsc",BX.proxy(this.escHide,this));BX.addCustomEvent("SidePanel.Slider:onClose",BX.proxy(this.hide,this));BX.addCustomEvent("SidePanel.Slider:onCloseComplete",BX.proxy(this.destroy,this));BX.addCustomEvent("BXCalendar:onSectionDelete",BX.proxy(this.deleteSectionHandler,this));BX.addCustomEvent("BXCalendar:onSectionChange",BX.proxy(this.changeSectionHandler,this));BX.addCustomEvent("BXCalendar:onSectionAdd",BX.proxy(this.addSectionHandler,this));this.calendar.disableKeyHandler()},escHide:function(e){if(e&&e.getSliderPage&&e.getSliderPage().getUrl()===this.sliderId&&this.denyClose){e.denyAction()}},hide:function(e){if(e&&e.getSliderPage&&e.getSliderPage().getUrl()===this.sliderId){this.closeForms();BX.removeCustomEvent("SidePanel.Slider:onClose",BX.proxy(this.hide,this));BX.removeCustomEvent("SidePanel.Slider:onCloseByEsc",BX.proxy(this.escHide,this));BX.removeCustomEvent("BXCalendar:onSectionDelete",BX.proxy(this.deleteSectionHandler,this));BX.removeCustomEvent("BXCalendar:onSectionChange",BX.proxy(this.changeSectionHandler,this));BX.removeCustomEvent("BXCalendar:onSectionAdd",BX.proxy(this.addSectionHandler,this))}},close:function(){BX.SidePanel.Instance.close()},destroy:function(e){if(e&&e.getSliderPage&&e.getSliderPage().getUrl()===this.sliderId){BX.removeCustomEvent("SidePanel.Slider:onCloseComplete",BX.proxy(this.destroy,this));BX.SidePanel.Instance.destroy(this.sliderId);delete this.sectionListWrap;this.calendar.enableKeyHandler();if(this.sectionActionMenu)this.sectionActionMenu.close()}},create:function(){this.outerWrap=BX.create("DIV",{props:{className:"calendar-list-slider-wrap"}});this.titleWrap=this.outerWrap.appendChild(BX.create("DIV",{props:{className:"calendar-list-slider-title-container"},html:'<div class="calendar-list-slider-title">'+BX.message("EC_SECTION_BUTTON")+"</div>"}));if(!this.calendar.util.readOnlyMode()){this.createAddButton();this.editSectionFormWrap=this.outerWrap.appendChild(BX.create("DIV",{props:{className:"calendar-list-slider-card-widget calendar-list-slider-form-wrap"},html:'<div class="calendar-list-slider-card-widget-title"><span class="calendar-list-slider-card-widget-title-text">'+BX.message("EC_SEC_SLIDER_NEW_SECTION")+"</span></div>"}));this.trackingCompanyFormWrap=this.outerWrap.appendChild(BX.create("DIV",{props:{className:"calendar-list-slider-card-widget calendar-list-slider-form-wrap"},html:'<div class="calendar-list-slider-card-widget-title"><span class="calendar-list-slider-card-widget-title-text">'+BX.message("EC_SEC_SLIDER_POPUP_MENU_ADD_COMP")+"</span></div>"}));this.trackingUsersFormWrap=this.outerWrap.appendChild(BX.create("DIV",{props:{className:"calendar-list-slider-card-widget calendar-list-slider-form-wrap"},html:'<div class="calendar-list-slider-card-widget-title"><span class="calendar-list-slider-card-widget-title-text">'+BX.message("EC_SEC_SLIDER_POPUP_MENU_ADD_USER")+"</span></div>"}));this.trackingGroupsFormWrap=this.outerWrap.appendChild(BX.create("DIV",{props:{className:"calendar-list-slider-card-widget calendar-list-slider-form-wrap"},html:'<div class="calendar-list-slider-card-widget-title"><span class="calendar-list-slider-card-widget-title-text">'+BX.message("EC_SEC_SLIDER_POPUP_MENU_ADD_GROUP")+"</span></div>"}))}this.createSectionList();return this.outerWrap},createSectionList:function(){var e,t;this.sliderSections=this.calendar.sectionController.getSectionList();if(this.calendar.util.type=="user"){t=BX.message("EC_SEC_SLIDER_MY_CALENDARS_LIST")}else if(this.calendar.util.type=="group"){t=BX.message("EC_SEC_SLIDER_GROUP_CALENDARS_LIST")}else{t=BX.message("EC_SEC_SLIDER_TYPE_CALENDARS_LIST")}if(this.sectionListWrap){BX.cleanNode(this.sectionListWrap);BX.adjust(this.sectionListWrap,{props:{className:"calendar-list-slider-card-widget"},html:'<div class="calendar-list-slider-card-widget-title"><span class="calendar-list-slider-card-widget-title-text">'+t+"</span></div>"})}else{this.sectionListWrap=this.outerWrap.appendChild(BX.create("DIV",{props:{className:"calendar-list-slider-card-widget"},html:'<div class="calendar-list-slider-card-widget-title"><span class="calendar-list-slider-card-widget-title-text">'+t+"</span></div>"}))}this.createSectionBlock({wrap:this.sectionListWrap,sectionList:this.sliderSections.filter(function(e){return e.belongsToView()||e.isPseudo()})});e=this.sliderSections.filter(function(e){return e.isCompanyCalendar()&&!e.belongsToView()});if(e.length>0){this.sectionListWrap.appendChild(BX.create("DIV",{props:{className:"calendar-list-slider-card-section-title"},html:'<span class="calendar-list-slider-card-section-title-text">'+BX.message("EC_SEC_SLIDER_TITLE_COMP_CAL")+"</span>"}));this.createSectionBlock({wrap:this.sectionListWrap,sectionList:this.sliderSections.filter(function(e){return e.isCompanyCalendar()})})}this.calendar.util.getSuperposedTrackedUsers().forEach(function(e){var t=this.sliderSections.filter(function(t){return!t.belongsToView()&&t.isSuperposed()&&t.type=="user"&&t.data.OWNER_ID==e.ID});if(t.length>0){this.sectionListWrap.appendChild(BX.create("DIV",{props:{className:"calendar-list-slider-card-section-title"},html:'<span class="calendar-list-slider-card-section-title-text">'+BX.util.htmlspecialchars(e.FORMATTED_NAME)+"</span>"}));this.createSectionBlock({wrap:this.sectionListWrap,sectionList:t})}},this);e=this.sliderSections.filter(function(e){return!e.belongsToView()&&e.type=="group"&&e.isSuperposed()});if(e.length>0){this.sectionListWrap.appendChild(BX.create("DIV",{props:{className:"calendar-list-slider-card-section-title"},html:'<span class="calendar-list-slider-card-section-title-text">'+BX.message("EC_SEC_SLIDER_TITLE_GROUP_CAL")+"</span>"}));this.createSectionBlock({wrap:this.sectionListWrap,sectionList:e})}},createAddButton:function(){this.addButtonOuter=this.titleWrap.appendChild(BX.create("SPAN",{props:{className:"webform-small-button-separate-wrap"},style:{marginRight:0}}));this.addButton=this.addButtonOuter.appendChild(BX.create("SPAN",{props:{className:"webform-small-button"},text:BX.message("EC_ADD")}));this.addButtonMore=this.addButtonOuter.appendChild(BX.create("SPAN",{props:{className:"webform-small-button-right-part"}}));this.addButtonMorePopupId="add_btn_popup_"+this.calendar.id;BX.bind(this.addButtonMore,"click",BX.proxy(this.showAddBtnPopup,this));BX.bind(this.addButton,"click",BX.proxy(this.showEditSectionForm,this))},showAddBtnPopup:function(e){if(this.addBtnMenu&&this.addBtnMenu.popupWindow&&this.addBtnMenu.popupWindow.isShown()){return this.addBtnMenu.close()}var t=this,s="main-buttons-submenu-separator main-buttons-submenu-item main-buttons-hidden-label",i=[{text:"<span>"+BX.message("EC_SEC_SLIDER_POPUP_NEW_TITLE")+"</span>",className:s},{text:BX.message("EC_SEC_SLIDER_POPUP_NEW_MENU"),onclick:BX.proxy(function(){this.addBtnMenu.close();this.showEditSectionForm()},this)},{text:"<span>"+BX.message("EC_SEC_SLIDER_POPUP_EXIST_TITLE")+"</span>",className:s},{text:BX.message("EC_SEC_SLIDER_POPUP_MENU_ADD_COMP"),onclick:BX.proxy(function(){this.addBtnMenu.close();this.showTrackingTypesForm()},this)},{text:BX.message("EC_SEC_SLIDER_POPUP_MENU_ADD_USER"),onclick:BX.proxy(function(){this.addBtnMenu.close();this.showTrackingUsersForm()},this)},{text:BX.message("EC_SEC_SLIDER_POPUP_MENU_ADD_GROUP"),onclick:BX.proxy(function(){this.addBtnMenu.close();this.showTrackingGroupsForm()},this)}];this.addBtnMenu=BX.PopupMenu.create(this.addButtonMorePopupId,this.addButtonMore,i,{closeByEsc:true,autoHide:true,zIndex:this.zIndex,offsetTop:0,offsetLeft:15,angle:true});this.addBtnMenu.show();this.denySliderClose();BX.addCustomEvent(this.addBtnMenu.popupWindow,"onPopupClose",function(){t.allowSliderClose();BX.PopupMenu.destroy(t.addButtonMorePopupId)})},createSectionBlock:function(e){var t=false;if(e.sectionList&&e.sectionList.length){var s=e.wrap.appendChild(BX.create("DIV",{props:{className:"calendar-list-slider-widget-content"}})).appendChild(BX.create("DIV",{props:{className:"calendar-list-slider-widget-content-block"}})).appendChild(BX.create("UL",{props:{className:"calendar-list-slider-container"}}));BX.bind(s,"click",BX.proxy(this.sectionClickHandler,this));var i,a,n,o,c;for(i=0;i<e.sectionList.length;i++){a=s.appendChild(BX.create("LI",{props:{className:"calendar-list-slider-item"},attrs:{"data-bx-calendar-section":e.sectionList[i].id.toString()}}));n=a.appendChild(BX.create("DIV",{props:{className:"calendar-list-slider-item-checkbox"+(e.sectionList[i].isShown()?" calendar-list-slider-item-checkbox-checked":"")},style:{backgroundColor:e.sectionList[i].color}}));o=a.appendChild(BX.create("DIV",{props:{className:"calendar-list-slider-item-name"},text:e.sectionList[i].name}));c=a.appendChild(BX.create("DIV",{props:{className:"calendar-list-slider-item-actions-container"},attrs:{"data-bx-calendar-section-menu":e.sectionList[i].id.toString()},html:'<span class="calendar-list-slider-item-context-menu"></span>'}));if(!e.sectionList[i].DOM){e.sectionList[i].DOM={}}e.sectionList[i].DOM.item=a;e.sectionList[i].DOM.checkbox=n;e.sectionList[i].DOM.title=o;e.sectionList[i].DOM.actionCont=c}}return t},sectionClickHandler:function(e){var t=this.calendar.util.findTargetNode(e.target||e.srcElement,this.outerWrap);if(t&&t.getAttribute){if(t.getAttribute("data-bx-calendar-section-menu")!==null){this.showSectionMenu(this.calendar.sectionController.getSection(t.getAttribute("data-bx-calendar-section-menu")))}else if(t.getAttribute("data-bx-calendar-section")!==null){this.switchSection(this.calendar.sectionController.getSection(t.getAttribute("data-bx-calendar-section")))}}},switchSection:function(e){if(BX.hasClass(e.DOM.checkbox,"calendar-list-slider-item-checkbox-checked")){BX.removeClass(e.DOM.checkbox,"calendar-list-slider-item-checkbox-checked");e.hide()}else{BX.addClass(e.DOM.checkbox,"calendar-list-slider-item-checkbox-checked");e.show()}this.calendar.refresh()},showSectionMenu:function(t){var s=this,i=[],a=this.calendar.id+"_section_"+t.id;BX.addClass(t.DOM.item,"active");if(t.getLink()&&!t.belongsToView()){i.push({text:BX.message("EC_SEC_OPEN_LINK"),href:t.getLink()})}if(!this.calendar.util.readOnlyMode()&&t.canDo("edit_section")&&!t.isPseudo()){i.push({text:BX.message("EC_SEC_EDIT"),onclick:function(){s.sectionActionMenu.close();s.showEditSectionForm({section:t})}})}if(t.isSuperposed()&&!t.belongsToView()){i.push({text:BX.message("EC_SEC_HIDE"),onclick:function(){s.hideSuperposedHandler(t);s.sectionActionMenu.close()}})}if(t.canBeConnectedToOutlook()){i.push({text:BX.message("EC_SEC_CONNECT_TO_OUTLOOK"),onclick:function(){s.sectionActionMenu.close();t.connectToOutlook();s.close()}})}if(!t.isPseudo()&&t.data.EXPORT.LINK){i.push({text:BX.message("EC_ACTION_EXPORT"),onclick:BX.delegate(function(){s.sectionActionMenu.close();if(!s.calendar.syncSlider){s.calendar.syncSlider=new e.BXEventCalendar.SyncSlider({calendar:s.calendar})}s.calendar.syncSlider.showICalExportDialog(t)},this)})}if(t.canDo("edit_section")&&t.belongsToView()&&!t.isPseudo()){i.push({text:BX.message("EC_SEC_DELETE"),onclick:function(){s.sectionActionMenu.close();t.remove()}})}if((t.isGoogle()||t.isCalDav())&&t.canDo("edit_section")){i.push({text:BX.message("EC_ACTION_REFRESH"),onclick:BX.delegate(function(){this.sectionActionMenu.close();this.calendar.reload({syncGoogle:true});this.close()},this)});if(this.calendar.syncSlider){i.push({text:BX.message("EC_ACTION_EXTERNAL_ADJUST"),onclick:function(){s.sectionActionMenu.close();s.calendar.syncSlider.showCalDavSyncDialog()}})}i.push({text:BX.message("EC_ACTION_HIDE"),onclick:BX.delegate(function(){this.sectionActionMenu.close();t.hideGoogle()},this)})}if(i&&i.length>0){this.sectionActionMenu=BX.PopupMenu.create(a,t.DOM.actionCont,i,{closeByEsc:true,autoHide:true,zIndex:this.zIndex,offsetTop:0,offsetLeft:9,angle:true});this.sectionActionMenu.show();this.denySliderClose();BX.addCustomEvent(this.sectionActionMenu.popupWindow,"onPopupClose",function(){if(t.DOM.item)BX.removeClass(t.DOM.item,"active");s.allowSliderClose();BX.PopupMenu.destroy(a)})}},denySliderClose:function(){this.denyClose=true},allowSliderClose:function(){this.denyClose=false},closeForms:function(){if(this.addBtnMenu)this.addBtnMenu.close();if(this.editSectionForm)this.editSectionForm.close();if(this.trackingUsersForm)this.trackingUsersForm.close();if(this.trackingGroupsForm)this.trackingGroupsForm.close();if(this.trackingTypesForm)this.trackingTypesForm.close()},showEditSectionForm:function(e){if(!e)e={};if(this.editSectionForm&&this.editSectionForm.isOpenedState)return this.closeForms();this.closeForms();this.editSectionFormTitle=this.editSectionFormWrap.querySelector(".calendar-list-slider-card-widget-title-text");this.editSectionForm=new s({calendar:this.calendar,wrap:this.editSectionFormWrap,zIndex:this.zIndex,closeCallback:BX.delegate(function(){this.allowSliderClose()},this)});var t=true;if(e.section&&(!e.section.belongsToView()||e.section.isPseudo())){this.editSectionFormTitle.innerHTML=BX.message("EC_SEC_SLIDER_EDIT_SECTION_PERSONAL");t=false}else if(e.section&&e.section.id){this.editSectionFormTitle.innerHTML=BX.message("EC_SEC_SLIDER_EDIT_SECTION")}else{this.editSectionFormTitle.innerHTML=BX.message("EC_SEC_SLIDER_NEW_SECTION")}this.editSectionForm.show({showAccess:t,section:e.section||{color:this.calendar.sectionController.getDefaultSectionColor(),access:this.calendar.sectionController.getDefaultSectionAccess()}});this.denySliderClose()},showTrackingTypesForm:function(){this.closeForms();if(!this.trackingTypesForm){this.trackingTypesForm=new a({calendar:this.calendar,wrap:this.trackingCompanyFormWrap,superposedSections:this.calendar.sectionController.getSuperposedSectionList(),closeCallback:BX.delegate(function(){this.allowSliderClose()},this)})}this.trackingTypesForm.show();this.denySliderClose()},showTrackingUsersForm:function(){this.closeForms();if(!this.trackingUsersForm){this.trackingUsersForm=new i({calendar:this.calendar,wrap:this.trackingUsersFormWrap,trackingUsers:this.calendar.util.getSuperposedTrackedUsers(),superposedSections:this.calendar.sectionController.getSuperposedSectionList(),closeCallback:BX.delegate(function(){this.allowSliderClose()},this)})}this.trackingUsersForm.show();this.denySliderClose()},showTrackingGroupsForm:function(){this.closeForms();if(!this.trackingGroupsForm){var e=this.calendar.sectionController.getSuperposedSectionList(),t=this.calendar.util.getSuperposedTrackedGroups();if(!t.length){e.forEach(function(e){if(e.type=="group"){var s=e.data.OWNER_ID;if(!BX.util.in_array(s,t)){t.push(s)}}},this)}this.trackingGroupsForm=new n({calendar:this.calendar,wrap:this.trackingGroupsFormWrap,trackingGroups:t,superposedSections:e})}this.trackingGroupsForm.show()},deleteSectionHandler:function(e){this.sliderSections.forEach(function(t,s){if(t.id==e&&t.DOM&&t.DOM.item){BX.addClass(t.DOM.item,"calendar-list-slider-item-disappearing");setTimeout(BX.delegate(function(){BX.cleanNode(t.DOM.item,true);this.sliderSections=BX.util.deleteFromArray(this.sliderSections,s)},this),300)}},this)},hideSuperposedHandler:function(e){var t=this.calendar.sectionController.getSuperposedSectionList(),s=[],i;for(i=0;i<t.length;i++){if(e.id!=parseInt(t[i].id))s.push(parseInt(t[i].id))}this.calendar.request({data:{action:"set_tracking_sections",sect:s},handler:BX.delegate(function(e){BX.reload()},this)})},changeSectionHandler:function(e,t){this.sliderSections.forEach(function(s){if(s.id==e&&s.DOM&&s.DOM.item){s.DOM.title.innerHTML=BX.util.htmlspecialchars(t.name);s.DOM.checkbox.style.backgroundColor=t.color}},this)},addSectionHandler:function(){this.createSectionList()}};function s(e){this.calendar=e.calendar;this.outerWrap=e.wrap;this.zIndex=e.zIndex;this.closeCallback=e.closeCallback;this.isCreated=false}s.prototype={show:function(e){this.create();this.showAccess=e.showAccess!==false;if(this.showAccess){this.accessLink.style.display="";this.accessWrap.style.display=""}else{this.accessLink.style.display="none";this.accessWrap.style.display="none"}BX.bind(document,"keydown",BX.proxy(this.keyHandler,this));BX.addClass(this.outerWrap,"show");this.section=e.section;if(e.section){if(e.section.color){this.setColor(e.section.color)}this.setAccess(e.section.access||e.section.data.ACCESS||{});if(e.section.name){this.sectionTitleInput.value=e.section.name}}BX.focus(this.sectionTitleInput);if(this.sectionTitleInput.value!=="")this.sectionTitleInput.select();this.isOpenedState=true},close:function(){this.isOpenedState=false;BX.unbind(document,"keydown",BX.proxy(this.keyHandler,this));BX.removeClass(this.outerWrap,"show");if(this.closeCallback)this.closeCallback()},isOpened:function(){return this.isOpenedState},create:function(){this.wrap=this.outerWrap.querySelector(".calendar-form-content");if(this.wrap)BX.cleanNode(this.wrap);else this.wrap=this.outerWrap.appendChild(BX.create("DIV",{props:{className:"calendar-form-content"}}));this.formFieldsWrap=this.wrap.appendChild(BX.create("DIV",{props:{className:"calendar-list-slider-widget-content"}})).appendChild(BX.create("DIV",{props:{className:"calendar-list-slider-widget-content-block"}}));this.sectionTitleInput=this.formFieldsWrap.appendChild(BX.create("DIV",{props:{className:"calendar-field-container calendar-field-container-string"}})).appendChild(BX.create("DIV",{props:{className:"calendar-field-block"}})).appendChild(BX.create("INPUT",{attrs:{type:"text",placeholder:BX.message("EC_SEC_SLIDER_SECTION_TITLE")},props:{className:"calendar-field calendar-field-string"}}));var e=this.formFieldsWrap.appendChild(BX.create("DIV",{props:{className:"calendar-list-slider-new-calendar-options-container"}}));this.colorContWrap=e.appendChild(BX.create("DIV",{props:{className:"calendar-list-slider-new-calendar-option-color"},html:BX.message("EC_SEC_SLIDER_COLOR")}));this.colorIcon=this.colorContWrap.appendChild(BX.create("SPAN",{props:{className:"calendar-list-slider-new-calendar-option-color-selected"}}));this.colorChangeLink=this.colorContWrap.appendChild(BX.create("SPAN",{props:{className:"calendar-list-slider-new-calendar-option-color-change"},html:BX.message("EC_SEC_SLIDER_CHANGE")}));this.initSectionColorSelector();this.accessLink=e.appendChild(BX.create("DIV",{props:{className:"calendar-list-slider-new-calendar-option-more"},html:BX.message("EC_SEC_SLIDER_ACCESS")}));this.accessWrap=this.formFieldsWrap.appendChild(BX.create("DIV",{props:{className:"calendar-list-slider-access-container"}}));this.initAccessController();this.buttonsWrap=this.formFieldsWrap.appendChild(BX.create("DIV",{props:{className:"calendar-list-slider-btn-container"}}));this.saveBtn=this.buttonsWrap.appendChild(BX.create("DIV",{props:{className:"webform-small-button webform-small-button-blue"},text:BX.message("EC_SEC_SLIDER_SAVE"),events:{click:BX.proxy(this.save,this)}}));this.cancelBtn=this.buttonsWrap.appendChild(BX.create("SPAN",{props:{className:"webform-button-link"},text:BX.message("EC_SEC_SLIDER_CANCEL"),events:{click:BX.proxy(this.checkClose,this)}}));this.isCreated=true},keyHandler:function(e){if(e.keyCode==this.calendar.util.KEY_CODES["escape"]){this.checkClose()}else if(e.keyCode==this.calendar.util.KEY_CODES["enter"]){this.save()}},checkClose:function(){this.close()},save:function(){this.calendar.sectionController.saveSection(this.sectionTitleInput.value,this.color,this.access,{section:this.section});this.close()},initSectionColorSelector:function(){BX.bind(this.colorIcon,"click",BX.delegate(this.showSimplePicker,this));BX.bind(this.colorChangeLink,"click",BX.delegate(this.showSimplePicker,this))},showSimplePicker:function(e){var t=BX.clone(this.calendar.util.getDefaultColors(),true),s=BX.create("DIV",{props:{className:"calendar-simple-color-wrap calendar-field-container-colorpicker-square"}}),i=s.appendChild(BX.create("DIV",{events:{click:BX.delegate(this.simplePickerClick,this)}})),a=s.appendChild(BX.create("DIV",{props:{className:"calendar-simple-color-more-link-wrap"}})),n=a.appendChild(BX.create("SPAN",{props:{className:"calendar-simple-color-more-link"},html:BX.message("EC_COLOR"),events:{click:BX.delegate(this.showFullPicker,this)}}));this.simplePickerColorWrap=i;this.colors=[];if(!BX.util.in_array(this.color,t))t.push(this.color);for(var o=0;o<t.length;o++){this.colors.push({color:t[o],node:i.appendChild(BX.create("SPAN",{props:{className:"calendar-field-colorpicker-color-item"},style:{backgroundColor:t[o]},attrs:{"data-bx-calendar-color":t[o]},html:'<span class="calendar-field-colorpicker-color"></span>'}))})}this.lastActiveNode=this.colors[BX.util.array_search(this.color,t)||0].node;BX.addClass(this.lastActiveNode,"active");this.simpleColorPopup=BX.PopupWindowManager.create(this.calendar.id+"-simple-color-popup",this.colorIcon,{zIndex:this.zIndex,autoHide:true,closeByEsc:true,offsetTop:0,offsetLeft:9,lightShadow:true,content:s});this.simpleColorPopup.setAngle({offset:10});this.simpleColorPopup.show(true);BX.addCustomEvent(this.simpleColorPopup,"onPopupClose",BX.delegate(function(){this.simpleColorPopup.destroy()},this))},simplePickerClick:function(e){var t=this.calendar.util.findTargetNode(e.target||e.srcElement,this.outerWrap);if(t&&t.getAttribute){var s=t.getAttribute("data-bx-calendar-color");if(s!==null){if(this.lastActiveNode){BX.removeClass(this.lastActiveNode,"active")}BX.addClass(t,"active");this.lastActiveNode=t;this.setColor(s)}}},showFullPicker:function(){if(this.simpleColorPopup)this.simpleColorPopup.close();if(!this.fullColorPicker){this.fullColorPicker=new BX.ColorPicker({bindElement:this.colorIcon,onColorSelected:BX.delegate(function(e){this.setColor(e)},this),popupOptions:{zIndex:this.zIndex,events:{onPopupClose:BX.delegate(function(){},this)}}})}this.fullColorPicker.open()},setColor:function(e){this.colorIcon.style.backgroundColor=e;this.color=e},setAccess:function(e){var t=0;for(var s in e){if(e.hasOwnProperty(s)){t++}}this.accessRowsCount=t;this.access=e;for(s in e){if(e.hasOwnProperty(s)){this.insertAccessRow(this.calendar.util.getAccessName(s),s,e[s])}}},initAccessController:function(){this.accessControls={};this.accessTasks=this.calendar.util.getSectionAccessTasks();BX.bind(this.accessLink,"click",BX.delegate(function(){if(BX.hasClass(this.accessWrap,"shown")){BX.removeClass(this.accessWrap,"shown")}else{BX.addClass(this.accessWrap,"shown")}},this));BX.Access.Init();this.accessWrapInner=this.accessWrap.appendChild(BX.create("DIV",{props:{className:"calendar-list-slider-access-inner-wrap"}}));this.accessTable=this.accessWrapInner.appendChild(BX.create("TABLE",{props:{className:"calendar-section-slider-access-table"}}));this.accessButtonWrap=this.accessWrap.appendChild(BX.create("DIV",{props:{className:"calendar-list-slider-new-calendar-options-container"}}));this.accessButton=this.accessButtonWrap.appendChild(BX.create("SPAN",{props:{className:"calendar-list-slider-new-calendar-option-add"},html:BX.message("EC_SEC_SLIDER_ACCESS_ADD")}));BX.bind(this.accessButton,"click",BX.proxy(function(){BX.Access.ShowForm({callback:BX.proxy(function(e){var t,s;for(t in e){if(e.hasOwnProperty(t)){for(s in e[t]){if(e[t].hasOwnProperty(s)){this.insertAccessRow(BX.Access.GetProviderName(t)+" "+e[t][s].name,s)}}}}},this),bind:this.accessButton});if(BX.Access.popup&&BX.Access.popup.popupContainer){BX.Access.popup.popupContainer.style.zIndex=this.zIndex+10}},this));BX.bind(this.accessWrapInner,"click",BX.proxy(function(e){var t,s=this.calendar.util.findTargetNode(e.target||e.srcElement,this.outerWrap);if(s&&s.getAttribute){if(s.getAttribute("data-bx-calendar-access-selector")!==null){t=s.getAttribute("data-bx-calendar-access-selector");if(this.accessControls[t]){this.showAccessSelectorPopup({node:this.accessControls[t].removeIcon,setValueCallback:BX.delegate(function(e){if(this.accessTasks[e]&&this.accessControls[t]){this.accessControls[t].valueNode.innerHTML=BX.util.htmlspecialchars(this.accessTasks[e].title);this.access[t]=e}},this)})}}else if(s.getAttribute("data-bx-calendar-access-remove")!==null){t=s.getAttribute("data-bx-calendar-access-remove");if(this.accessControls[t]){BX.cleanNode(this.accessControls[t].rowNode,true);delete this.access[t]}}}},this))},insertAccessRow:function(e,t,s){if(s===undefined){s=this.calendar.util.getDefaultSectionAccessTask()}var i=BX.adjust(this.accessTable.insertRow(-1),{props:{className:"calendar-section-slider-access-table-row"}}),a=BX.adjust(i.insertCell(-1),{props:{className:"calendar-section-slider-access-table-cell"},html:'<span class="calendar-section-slider-access-title">'+BX.util.htmlspecialchars(e)+":</span>"}),n=BX.adjust(i.insertCell(-1),{props:{className:"calendar-section-slider-access-table-cell"},attrs:{"data-bx-calendar-access-selector":t}}),o=n.appendChild(BX.create("SPAN",{props:{className:"calendar-section-slider-access-value"}})),c=o.appendChild(BX.create("SPAN",{text:this.accessTasks[s]?this.accessTasks[s].title:""})),r=o.appendChild(BX.create("SPAN",{props:{className:"calendar-section-slider-access-remove"},attrs:{"data-bx-calendar-access-remove":t}}));this.accessControls[t]={rowNode:i,titleNode:a,valueNode:c,removeIcon:r}},showAccessSelectorPopup:function(e){if(this.accessPopupMenu&&this.accessPopupMenu.popupWindow&&this.accessPopupMenu.popupWindow.isShown()){return this.accessPopupMenu.close()}var t=this.calendar.id+"_section_access_popup",s,i=this,a=[];for(s in this.accessTasks){if(this.accessTasks.hasOwnProperty(s)){a.push({text:this.accessTasks[s].title,onclick:function(t){return function(){e.setValueCallback(t);i.accessPopupMenu.close()}}(s)})}}this.accessPopupMenu=BX.PopupMenu.create(t,e.node,a,{closeByEsc:true,autoHide:true,zIndex:this.zIndex,offsetTop:-5,offsetLeft:0,angle:true});this.accessPopupMenu.show();BX.addCustomEvent(this.accessPopupMenu.popupWindow,"onPopupClose",function(){BX.PopupMenu.destroy(t)})}};function i(e){this.calendar=e.calendar;this.outerWrap=e.wrap;this.trackingUsers=e.trackingUsers||[];this.selectedCodes={};this.CHECKED_CLASS="calendar-list-slider-item-checkbox-checked";this.selectorId=this.calendar.id+"_tracking_users";this.selectGroups=false;this.selectUsers=true;this.addLinkMessage=BX.message("EC_SEC_SLIDER_SELECT_USERS");this.closeCallback=e.closeCallback;this.selected={};e.superposedSections.forEach(function(e){this.selected[e.id]=true},this);this.isCreated=false}i.prototype={show:function(){this.trackingUsers.forEach(function(e){this.selectedCodes["U"+e.ID]="users"},this);if(!this.isCreated)this.create();BX.addClass(this.outerWrap,"show");BX.bind(document,"keydown",BX.proxy(this.keyHandler,this));this.updateSectionList();this.isOpenedState=true},close:function(){BX.bind(document,"keydown",BX.proxy(this.keyHandler,this));this.isOpenedState=false;BX.removeClass(this.outerWrap,"show");if(this.closeCallback)this.closeCallback()},isOpened:function(){return this.isOpenedState},create:function(){this.selectorWrap=this.outerWrap.appendChild(BX.create("DIV",{props:{className:"calendar-list-slider-selector-wrap"}}));this.destinationSelector=new e.BXEventCalendar.DestinationSelector(this.selectorId,{calendar:this.calendar,wrapNode:this.selectorWrap,itemsSelected:this.selectedCodes,addLinkMessage:this.addLinkMessage,selectGroups:this.selectGroups,selectUsers:this.selectUsers});BX.addCustomEvent("OnDestinationAddNewItem",BX.proxy(this.updateSectionList,this));BX.addCustomEvent("OnDestinationUnselect",BX.proxy(this.updateSectionList,this));this.sectionsWrap=this.outerWrap.appendChild(BX.create("DIV",{props:{className:"calendar-list-slider-sections-wrap"}}));this.buttonsWrap=this.outerWrap.appendChild(BX.create("DIV",{props:{className:"calendar-list-slider-btn-container"}}));this.saveBtn=this.buttonsWrap.appendChild(BX.create("DIV",{props:{className:"webform-small-button webform-small-button-blue"},text:BX.message("EC_SEC_SLIDER_SAVE"),events:{click:BX.proxy(this.save,this)}}));this.cancelBtn=this.buttonsWrap.appendChild(BX.create("SPAN",{props:{className:"webform-button-link"},text:BX.message("EC_SEC_SLIDER_CANCEL"),events:{click:BX.proxy(this.close,this)}}));this.isCreated=true},save:function(){var e=this.calendar.sectionController.getSuperposedSectionList(),t=[],s=[],i,a;for(a=0;a<e.length;a++){if(e[a].type!="user"){t.push(parseInt(e[a].id))}}for(i in this.sectionIndex){if(this.sectionIndex.hasOwnProperty(i)){if(BX.hasClass(this.sectionIndex[i].checkbox,this.CHECKED_CLASS)){if(!BX.util.in_array(i,t)){t.push(parseInt(i))}}else if(BX.util.in_array(i,t)){t=BX.util.deleteFromArray(t,BX.util.array_search(i,t))}}}this.calendar.request({data:{action:"set_tracking_sections",codes:this.destinationSelector.getCodes(),sect:t,type:"users"},handler:BX.delegate(function(e){BX.reload()},this)});this.close()},updateSectionList:function(){var e=this.destinationSelector.getCodes();this.sectionsWrap.appendChild(BX.adjust(this.calendar.util.getLoader(),{style:{height:"140px"}}));this.calendar.request({data:{action:"get_tracking_sections",codes:e||[],type:"users"},handler:BX.delegate(function(e){BX.cleanNode(this.sectionsWrap);this.sectionIndex={};e.users.forEach(function(t){var s=e.sections.filter(function(e){return e.OWNER_ID==t.ID});this.sectionsWrap.appendChild(BX.create("DIV",{props:{className:"calendar-list-slider-card-section-title"},html:'<span class="calendar-list-slider-card-section-title-text">'+BX.util.htmlspecialchars(t.FORMATTED_NAME)+"</span>"}));if(s.length>0){this.createSectionBlock({sectionList:s,wrap:this.sectionsWrap})}else{this.sectionsWrap.appendChild(BX.create("DIV",{props:{className:""},html:'<span class="">'+BX.message("EC_SEC_SLIDER_NO_SECTIONS")+"</span>"}))}},this)},this)})},createSectionBlock:function(e){var t=false;if(e.sectionList&&e.sectionList.length){var s=e.wrap.appendChild(BX.create("DIV",{props:{className:"calendar-list-slider-widget-content"}})).appendChild(BX.create("DIV",{props:{className:"calendar-list-slider-widget-content-block"}})).appendChild(BX.create("UL",{props:{className:"calendar-list-slider-container"}}));BX.bind(s,"click",BX.proxy(this.sectionClick,this));var i,a,n,o,c;for(i=0;i<e.sectionList.length;i++){c=e.sectionList[i].ID.toString();a=s.appendChild(BX.create("LI",{props:{className:"calendar-list-slider-item"},attrs:{"data-bx-calendar-section":c}}));n=a.appendChild(BX.create("DIV",{props:{className:"calendar-list-slider-item-checkbox"},style:{backgroundColor:e.sectionList[i].COLOR}}));o=a.appendChild(BX.create("DIV",{props:{className:"calendar-list-slider-item-name"},text:e.sectionList[i].NAME}));this.sectionIndex[c]={item:a,checkbox:n};if(this.selected[c]){BX.addClass(n,this.CHECKED_CLASS)}}}return t},sectionClick:function(e){var t=this.calendar.util.findTargetNode(e.target||e.srcElement,this.outerWrap);if(t&&t.getAttribute){if(t.getAttribute("data-bx-calendar-section")!==null){var s=t.getAttribute("data-bx-calendar-section");if(this.sectionIndex[s]&&this.sectionIndex[s].checkbox){if(BX.hasClass(this.sectionIndex[s].checkbox,this.CHECKED_CLASS)){BX.removeClass(this.sectionIndex[s].checkbox,this.CHECKED_CLASS)}else{BX.addClass(this.sectionIndex[s].checkbox,this.CHECKED_CLASS)}}}}},keyHandler:function(e){if(e.keyCode==this.calendar.util.KEY_CODES["escape"]){this.close()}else if(e.keyCode==this.calendar.util.KEY_CODES["enter"]){this.save()}}};function a(e){i.apply(this,arguments);this.trackingGroups=e.trackingGroups||[];this.selectGroups=true;this.selectUsers=false;this.addLinkMessage=BX.message("EC_SEC_SLIDER_SELECT_GROUPS")}a.prototype=Object.create(i.prototype);a.prototype.constructor=a;a.prototype.create=function(){this.sectionsWrap=this.outerWrap.appendChild(BX.create("DIV",{props:{className:"calendar-list-slider-sections-wrap"}}));this.buttonsWrap=this.outerWrap.appendChild(BX.create("DIV",{props:{className:"calendar-list-slider-btn-container"}}));this.saveBtn=this.buttonsWrap.appendChild(BX.create("DIV",{props:{className:"webform-small-button webform-small-button-blue"},text:BX.message("EC_SEC_SLIDER_SAVE"),events:{click:BX.proxy(this.save,this)}}));this.cancelBtn=this.buttonsWrap.appendChild(BX.create("SPAN",{props:{className:"webform-button-link"},text:BX.message("EC_SEC_SLIDER_CANCEL"),events:{click:BX.proxy(this.close,this)}}));this.isCreated=true};a.prototype.show=function(){if(!this.isCreated)this.create();this.updateSectionList();this.isOpenedState=true;BX.addClass(this.outerWrap,"show")};a.prototype.updateSectionList=function(){this.sectionsWrap.appendChild(BX.adjust(this.calendar.util.getLoader(),{style:{height:"140px"}}));this.calendar.request({data:{action:"get_tracking_sections",type:"company"},handler:BX.delegate(function(e){BX.cleanNode(this.sectionsWrap);this.sectionIndex={};this.createSectionBlock({sectionList:e.sections,wrap:this.sectionsWrap})},this)})};a.prototype.save=function(){var e=this.calendar.sectionController.getSuperposedSectionList(),t=[],s,i;for(i=0;i<e.length;i++){t.push(parseInt(e[i].id))}for(s in this.sectionIndex){if(this.sectionIndex.hasOwnProperty(s)){if(BX.hasClass(this.sectionIndex[s].checkbox,this.CHECKED_CLASS)){if(!BX.util.in_array(s,t)){t.push(parseInt(s))}}else if(BX.util.in_array(s,t)){t=BX.util.deleteFromArray(t,BX.util.array_search(s,t))}}}this.calendar.request({data:{action:"set_tracking_sections",sect:t},handler:BX.delegate(function(e){BX.reload()},this)});this.close()};function n(e){i.apply(this,arguments);this.trackingGroups=e.trackingGroups||[];this.selectorId=this.calendar.id+"_tracking_groups";this.selectGroups=true;this.selectUsers=false;this.addLinkMessage=BX.message("EC_SEC_SLIDER_SELECT_GROUPS")}n.prototype=Object.create(i.prototype);n.prototype.constructor=n;n.prototype.show=function(){this.trackingGroups.forEach(function(e){this.selectedCodes["SG"+e]="sonetgroups"},this);i.prototype.show.apply(this,arguments)};n.prototype.save=function(){var e=this.calendar.sectionController.getSuperposedSectionList(),t=[],s,i;for(i=0;i<e.length;i++){t.push(parseInt(e[i].id))}for(s in this.sectionIndex){if(this.sectionIndex.hasOwnProperty(s)){if(BX.hasClass(this.sectionIndex[s].checkbox,this.CHECKED_CLASS)){if(!BX.util.in_array(s,t)){t.push(parseInt(s))}}else if(BX.util.in_array(s,t)){t=BX.util.deleteFromArray(t,BX.util.array_search(s,t))}}}this.calendar.request({data:{action:"set_tracking_sections",codes:this.destinationSelector.getCodes(),sect:t,type:"groups"},handler:BX.delegate(function(e){BX.reload()},this)});this.close()};n.prototype.updateSectionList=function(){var e=this.destinationSelector.getCodes();this.sectionsWrap.appendChild(BX.adjust(this.calendar.util.getLoader(),{style:{height:"140px"}}));this.calendar.request({data:{action:"get_tracking_sections",codes:e||[],type:"groups"},handler:BX.delegate(function(e){BX.cleanNode(this.sectionsWrap);this.sectionIndex={};this.createSectionBlock({sectionList:e.sections,wrap:this.sectionsWrap})},this)})};if(e.BXEventCalendar){e.BXEventCalendar.SectionSlider=t}else{BX.addCustomEvent(e,"onBXEventCalendarInit",function(){e.BXEventCalendar.SectionSlider=t})}})(window);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:71:"/bitrix/js/calendar/new/calendar-settings-slider.min.js?152740167510158";s:6:"source";s:51:"/bitrix/js/calendar/new/calendar-settings-slider.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
(function(e){function s(e){this.calendar=e.calendar;this.id=this.calendar.id+"_settings_slider";this.uid=this.id+"_"+Math.round(Math.random()*1e6);this.button=e.button;this.zIndex=e.zIndex||3100;this.sliderId="calendar:settings-slider";this.inPersonal=this.calendar.util.userIsOwner();this.showGeneralSettings=!!(this.calendar.util.config.perm&&this.calendar.util.config.perm.access);this.settings=this.calendar.util.config.settings;this.SLIDER_WIDTH=500;this.SLIDER_DURATION=80;BX.bind(this.button,"click",BX.delegate(this.show,this))}s.prototype={show:function(){BX.SidePanel.Instance.open(this.sliderId,{contentCallback:BX.delegate(this.create,this),width:this.SLIDER_WIDTH,animationDuration:this.SLIDER_DURATION});BX.addCustomEvent("SidePanel.Slider:onClose",BX.proxy(this.hide,this));BX.addCustomEvent("SidePanel.Slider:onCloseComplete",BX.proxy(this.destroy,this));this.calendar.disableKeyHandler()},close:function(){BX.SidePanel.Instance.close()},hide:function(e){if(e&&e.getSliderPage&&e.getSliderPage().getUrl()===this.sliderId){if(this.denyClose){e.denyAction()}else{BX.removeCustomEvent("SidePanel.Slider:onClose",BX.proxy(this.hide,this))}}},destroy:function(e){if(e&&e.getSliderPage&&e.getSliderPage().getUrl()===this.sliderId){BX.removeCustomEvent("SidePanel.Slider:onCloseComplete",BX.proxy(this.destroy,this));BX.SidePanel.Instance.destroy(this.sliderId);this.calendar.enableKeyHandler()}},create:function(){var e=new BX.Promise;BX.ajax.get(this.calendar.util.getActionUrl(),{action:"get_settings_slider",is_personal:this.inPersonal?"Y":"N",show_general_settings:this.showGeneralSettings?"Y":"N",unique_id:this.uid,sessid:BX.bitrix_sessid(),bx_event_calendar_request:"Y",reqId:Math.round(Math.random()*1e6)},BX.delegate(function(s){e.fulfill(BX.util.trim(s));this.initControls()},this));return e},initControls:function(){BX.bind(BX(this.uid+"_save"),"click",BX.proxy(this.save,this));BX.bind(BX(this.uid+"_close"),"click",BX.proxy(this.close,this));this.DOM={denyBusyInvitation:BX(this.uid+"_deny_busy_invitation"),showWeekNumbers:BX(this.uid+"_show_week_numbers")};if(this.inPersonal){this.DOM.sectionSelect=BX(this.uid+"_meet_section");this.DOM.crmSelect=BX(this.uid+"_crm_section");this.DOM.showDeclined=BX(this.uid+"_show_declined");this.DOM.showTasks=BX(this.uid+"_show_tasks");this.DOM.showCompletedTasks=BX(this.uid+"_show_completed_tasks");this.DOM.timezoneSelect=BX(this.uid+"_set_tz_sel")}this.DOM.workTimeStart=BX(this.uid+"work_time_start");this.DOM.workTimeEnd=BX(this.uid+"work_time_end");this.DOM.weekHolidays=BX(this.uid+"week_holidays");this.DOM.yearHolidays=BX(this.uid+"year_holidays");this.DOM.yearWorkdays=BX(this.uid+"year_workdays");this.typeAccess=false;if(this.calendar.util.config.TYPE_ACCESS){this.accessWrap=BX(this.uid+"type-access-values-cont");if(this.accessWrap){this.initAccessController();this.typeAccess=this.calendar.util.config.TYPE_ACCESS||{};var e;for(e in this.typeAccess){if(this.typeAccess.hasOwnProperty(e)){this.insertAccessRow(this.calendar.util.getAccessName(e),e,this.typeAccess[e])}}}}this.DOM.manageCalDav=BX(this.uid+"_manage_caldav");if(this.DOM.manageCalDav){BX.bind(this.DOM.manageCalDav,"click",BX.proxy(this.calendar.syncSlider.showCalDavSyncDialog,this.calendar.syncSlider))}if(this.inPersonal){this.DOM.sectionSelect.options.length=0;var s=this.calendar.sectionController.getSectionList(),t=this.calendar.util.getUserOption("meetSection"),i=this.calendar.util.getUserOption("crmSection"),a,n,c;for(a=0;a<s.length;a++){n=s[a];if(n.belongToOwner()){if(!t){t=n.id}c=t==n.id;this.DOM.sectionSelect.options.add(new Option(n.name,n.id,c,c));if(!i){i=n.id}c=i==n.id;this.DOM.crmSelect.options.add(new Option(n.name,n.id,c,c))}}}if(this.DOM.showDeclined){this.DOM.showDeclined.checked=!!this.calendar.util.getUserOption("showDeclined")}if(this.DOM.showTasks){this.DOM.showTasks.checked=this.calendar.util.getUserOption("showTasks")=="Y"}if(this.DOM.showCompletedTasks){this.DOM.showCompletedTasks.checked=this.calendar.util.getUserOption("showCompletedTasks")=="Y"}if(this.DOM.denyBusyInvitation){this.DOM.denyBusyInvitation.checked=!!this.calendar.util.getUserOption("denyBusyInvitation")}if(this.DOM.showWeekNumbers){this.DOM.showWeekNumbers.checked=this.calendar.util.showWeekNumber()}if(this.DOM.timezoneSelect){this.DOM.timezoneSelect.value=this.calendar.util.getUserOption("timezoneName")||""}if(this.showGeneralSettings){this.DOM.workTimeStart.value=this.settings.work_time_start;this.DOM.workTimeEnd.value=this.settings.work_time_end;if(this.DOM.weekHolidays){for(a=0;a<this.DOM.weekHolidays.options.length;a++){this.DOM.weekHolidays.options[a].selected=BX.util.in_array(this.DOM.weekHolidays.options[a].value,this.settings.week_holidays)}}this.DOM.yearHolidays.value=this.settings.year_holidays;this.DOM.yearWorkdays.value=this.settings.year_workdays}},save:function(){var e=this.calendar.util.config.userSettings;if(this.DOM.showDeclined){e.showDeclined=this.DOM.showDeclined.checked?1:0}if(this.DOM.showWeekNumbers){e.showWeekNumbers=this.DOM.showWeekNumbers.checked?"Y":"N"}if(this.DOM.showTasks){e.showTasks=this.DOM.showTasks.checked?"Y":"N"}if(this.DOM.showCompletedTasks){e.showCompletedTasks=this.DOM.showCompletedTasks.checked?"Y":"N"}if(this.DOM.sectionSelect){e.meetSection=this.DOM.sectionSelect.value}if(this.DOM.crmSelect){e.crmSection=this.DOM.crmSelect.value}if(this.DOM.denyBusyInvitation){e.denyBusyInvitation=this.DOM.denyBusyInvitation.checked?1:0}if(this.DOM.timezoneSelect){e.userTimezoneName=this.DOM.timezoneSelect.value}var s={action:"save_settings",user_settings:e,user_timezone_name:e.userTimezoneName};if(this.showGeneralSettings&&this.DOM.workTimeStart){s.settings={work_time_start:this.DOM.workTimeStart.value,work_time_end:this.DOM.workTimeEnd.value,week_holidays:[],year_holidays:this.DOM.yearHolidays.value,year_workdays:this.DOM.yearWorkdays.value};for(var t=0;t<this.DOM.weekHolidays.options.length;t++){if(this.DOM.weekHolidays.options[t].selected){s.settings.week_holidays.push(this.DOM.weekHolidays.options[t].value)}}}if(this.typeAccess!==false){s.type_access=this.typeAccess}this.calendar.request({type:"post",data:s,handler:BX.delegate(function(e){BX.reload()},this)});this.close()},initAccessController:function(){this.accessControls={};this.accessTasks=this.calendar.util.getTypeAccessTasks();BX.bind(this.accessLink,"click",BX.delegate(function(){if(BX.hasClass(this.accessWrap,"shown")){BX.removeClass(this.accessWrap,"shown")}else{BX.addClass(this.accessWrap,"shown")}},this));BX.Access.Init();this.accessWrapInner=this.accessWrap.appendChild(BX.create("DIV",{props:{className:"calendar-list-slider-access-inner-wrap"}}));this.accessTable=this.accessWrapInner.appendChild(BX.create("TABLE",{props:{className:"calendar-section-slider-access-table"}}));this.accessButtonWrap=this.accessWrap.appendChild(BX.create("DIV",{props:{className:"calendar-list-slider-new-calendar-options-container"}}));this.accessButton=this.accessButtonWrap.appendChild(BX.create("SPAN",{props:{className:"calendar-list-slider-new-calendar-option-add"},html:BX.message("EC_SEC_SLIDER_ACCESS_ADD")}));BX.bind(this.accessButton,"click",BX.proxy(function(){BX.Access.ShowForm({callback:BX.proxy(function(e){var s,t;for(s in e){if(e.hasOwnProperty(s)){for(t in e[s]){if(e[s].hasOwnProperty(t)){this.insertAccessRow(BX.Access.GetProviderName(s)+" "+e[s][t].name,t)}}}}},this),bind:this.accessButton});if(BX.Access.popup&&BX.Access.popup.popupContainer){BX.Access.popup.popupContainer.style.zIndex=this.zIndex+10}},this));BX.bind(this.accessWrapInner,"click",BX.proxy(function(e){var s,t=this.calendar.util.findTargetNode(e.target||e.srcElement,this.outerWrap);if(t&&t.getAttribute){if(t.getAttribute("data-bx-calendar-access-selector")!==null){s=t.getAttribute("data-bx-calendar-access-selector");if(this.accessControls[s]){this.showAccessSelectorPopup({node:this.accessControls[s].removeIcon,setValueCallback:BX.delegate(function(e){if(this.accessTasks[e]&&this.accessControls[s]){this.accessControls[s].valueNode.innerHTML=BX.util.htmlspecialchars(this.accessTasks[e].title);this.typeAccess[s]=e}},this)})}}else if(t.getAttribute("data-bx-calendar-access-remove")!==null){s=t.getAttribute("data-bx-calendar-access-remove");if(this.accessControls[s]){BX.cleanNode(this.accessControls[s].rowNode,true);delete this.typeAccess[s]}}}},this))},insertAccessRow:function(e,s,t){if(t===undefined){t=this.calendar.util.getDefaultTypeAccessTask();this.typeAccess[s]=t}var i=BX.adjust(this.accessTable.insertRow(-1),{props:{className:"calendar-section-slider-access-table-row"}}),a=BX.adjust(i.insertCell(-1),{props:{className:"calendar-section-slider-access-table-cell"},html:'<span class="calendar-section-slider-access-title">'+BX.util.htmlspecialchars(e)+":</span>"}),n=BX.adjust(i.insertCell(-1),{props:{className:"calendar-section-slider-access-table-cell"},attrs:{"data-bx-calendar-access-selector":s}}),c=n.appendChild(BX.create("SPAN",{props:{className:"calendar-section-slider-access-value"}})),o=c.appendChild(BX.create("SPAN",{text:this.accessTasks[t]?this.accessTasks[t].title:""})),l=c.appendChild(BX.create("SPAN",{props:{className:"calendar-section-slider-access-remove"},attrs:{"data-bx-calendar-access-remove":s}}));this.accessControls[s]={rowNode:i,titleNode:a,valueNode:o,removeIcon:l}},showAccessSelectorPopup:function(e){if(this.accessPopupMenu&&this.accessPopupMenu.popupWindow&&this.accessPopupMenu.popupWindow.isShown()){return this.accessPopupMenu.close()}var s=this.calendar.id+"_type_access_popup",t,i=this,a=[];for(t in this.accessTasks){if(this.accessTasks.hasOwnProperty(t)){a.push({text:this.accessTasks[t].title,onclick:function(s){return function(){e.setValueCallback(s);i.accessPopupMenu.close()}}(t)})}}this.accessPopupMenu=BX.PopupMenu.create(s,e.node,a,{closeByEsc:true,autoHide:true,zIndex:this.zIndex,offsetTop:-5,offsetLeft:0,angle:true});this.accessPopupMenu.show();BX.addCustomEvent(this.accessPopupMenu.popupWindow,"onPopupClose",function(){BX.PopupMenu.destroy(s)})}};if(e.BXEventCalendar){e.BXEventCalendar.SettingsSlider=s}else{BX.addCustomEvent(e,"onBXEventCalendarInit",function(){e.BXEventCalendar.SettingsSlider=s})}})(window);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:73:"/bitrix/js/calendar/new/calendar-edit-entry-slider.min.js?152740167535751";s:6:"source";s:53:"/bitrix/js/calendar/new/calendar-edit-entry-slider.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
(function(e){function t(e){this.calendar=e;this.sliderId="calendar:edit-entry-slider";this.zIndex=3100;this.DOM={};this.denyClose=false;this.formSettings={pinnedFields:{}}}t.prototype={show:function(e){this.id="calendar_slider_"+Math.round(Math.random()*1e6);this.editorId=this.id+"_entry_slider_editor";this.entry=e.entry||this.getNewEntry(e.entry||e.newEntryData);this.formType=e.formType||"slider_main";this.formSettings=this.getSettings();BX.SidePanel.Instance.open(this.sliderId,{contentCallback:BX.delegate(this.createContent,this)});BX.bind(document,"keydown",BX.proxy(this.keyHandler,this));BX.addCustomEvent("SidePanel.Slider:onClose",BX.proxy(this.hide,this));BX.addCustomEvent("SidePanel.Slider:onCloseComplete",BX.proxy(this.destroy,this));BX.bind(document,"click",BX.proxy(this.calendar.util.applyHacksForPopupzIndex,this.calendar.util));this.calendar.disableKeyHandler();setTimeout(BX.delegate(function(){this.calendar.disableKeyHandler()},this),300);this.opened=true},createContent:function(t){var i=new BX.Promise;BX.ajax.get(this.calendar.util.getActionUrl(),{action:"get_edit_slider",event_id:this.entry.id,unique_id:this.id,form_type:this.formType,sessid:BX.bitrix_sessid(),bx_event_calendar_request:"Y",reqId:Math.round(Math.random()*1e6)},BX.delegate(function(s){if(BX.type.isFunction(t.isOpen)&&t.isOpen()||t.isOpen===true){i.fulfill(BX.util.trim(s));this.initControls()}else{if(e["BXHtmlEditor"]){var a=e["BXHtmlEditor"].Get(this.editorId);if(a){a.Destroy()}}}},this));return i},close:function(){BX.SidePanel.Instance.close()},hide:function(e){if(e&&e.getSliderPage&&e.getSliderPage().getUrl()===this.sliderId){if(this.checkDenyClose()){e.denyAction()}else{BX.removeCustomEvent("SidePanel.Slider::onClose",BX.proxy(this.hide,this));if(this.attendeesSelector)this.attendeesSelector.closeAll()}}},destroy:function(t){if(t&&t.getSliderPage&&t.getSliderPage().getUrl()===this.sliderId){if(e.LHEPostForm&&e.LHEPostForm.unsetHandler&&LHEPostForm.getHandler(this.editorId)){e.LHEPostForm.unsetHandler(this.editorId)}BX.onCustomEvent("OnCalendarPlannerDoUninstall",[{plannerId:this.plannerId}]);BX.removeCustomEvent("OnDestinationAddNewItem",BX.proxy(this.checkPlannerState,this));BX.removeCustomEvent("OnDestinationUnselect",BX.proxy(this.checkPlannerState,this));BX.removeCustomEvent("OnCalendarPlannerSelectorChanged",BX.proxy(this.onCalendarPlannerSelectorChanged,this));BX.removeCustomEvent("SidePanel.Slider:onCloseComplete",BX.proxy(this.destroy,this));BX.SidePanel.Instance.destroy(this.sliderId);if(this.attendeesSelector)this.attendeesSelector.closeAll();this.calendar.enableKeyHandler();BX.unbind(document,"click",BX.proxy(this.calendar.util.applyHacksForPopupzIndex,this.calendar.util));this.opened=false}},isOpened:function(){return this.opened},denySliderClose:function(){this.denyClose=true},allowSliderClose:function(){this.denyClose=false},checkDenyClose:function(){if(BX(this.id+"_time_from_div")&&BX(this.id+"_time_from_div").style.display!="none")return true;if(BX(this.id+"_time_to_div")&&BX(this.id+"_time_to_div").style.display!="none")return true;return this.denyClose},initControls:function(){this.DOM.title=BX(this.id+"_title");this.DOM.formWrap=BX(this.id+"_form_wrap");this.DOM.form=BX(this.id+"_form");this.DOM.importanceCheckbox=BX(this.id+"_important");this.DOM.entryName=BX.adjust(BX(this.id+"_entry_name"),{events:{click:t}});this.DOM.privateCheckbox=BX(this.id+"_private");BX.bind(BX(this.id+"_save"),"click",BX.proxy(this.save,this));BX.bind(BX(this.id+"_close"),"click",BX.proxy(this.close,this));BX(this.id+"_save_cmd").innerHTML=BX.browser.IsMac()?"(Cmd+Enter)":"(Ctrl+Enter)";this.initDateTimeControl();this.initReminderControl();this.initSectionSelector();this.initEditorControl();this.initLocationControl();this.initRepeatRuleControl();this.initAttendeesControl();this.initColorControl();if(this.entry.accessibility)BX(this.id+"_accessibility").value=this.entry.accessibility;if(this.entry.important)BX(this.id+"_important").checked=this.entry.important;if(this.entry.private)BX(this.id+"_private").checked=this.entry.private;this.DOM.mainBlock=BX(this.id+"_main_block_wrap");this.DOM.additionalBlockWrap=BX(this.id+"_additional_block_wrap");this.DOM.additionalBlock=BX(this.id+"_additional_block");this.DOM.pinnedNamesWrap=BX(this.id+"_additional_pinned_names");this.DOM.additionalSwitch=BX.adjust(BX(this.id+"_additional_switch"),{events:{click:BX.proxy(function(){if(BX.hasClass(this.DOM.additionalSwitch,"opened")){this.hideAdditionalBlock()}else{this.showAdditionalBlock()}},this)}});BX.bind(this.DOM.formWrap,"click",BX.delegate(function(e){var t=e.target||e.srcElement;if(t&&t.getAttribute&&t.getAttribute("data-bx-fixfield")){var i=t.getAttribute("data-bx-fixfield");if(!this.fieldIsPinned(i)){this.pinField(i)}else{this.unPinField(i)}}},this));this.DOM.entryName.value=this.entry.name;setTimeout(BX.delegate(function(){this.DOM.entryName.focus();this.DOM.entryName.select()},this),500);this.checkLastItemBorder();var e=this;function t(){e.DOM.entryName.select();BX.unbind(e.DOM.entryName,"click",t)}},initDateTimeControl:function(){var e=this;this.DOM.dateTimeWrap=BX(this.id+"_datetime_container");this.DOM.fromDate=BX.adjust(BX(this.id+"_date_from"),{events:{click:t,change:i}});this.DOM.toDate=BX.adjust(BX(this.id+"_date_to"),{events:{click:t,change:s}});this.DOM.fromTime=BX.adjust(BX(this.id+"_time_from"),{events:{click:function(){e.showClock("time_from")},change:a}});this.DOM.toTime=BX.adjust(BX(this.id+"_time_to"),{events:{click:function(){e.showClock("time_to")}},change:n});this.DOM.fullDay=BX.adjust(BX(this.id+"_date_full_day"),{events:{click:BX.proxy(this.switchFullDay,this)}});this.DOM.defTimezoneWrap=BX(this.id+"_timezone_default_wrap");this.DOM.defTimezone=BX(this.id+"_timezone_default");this.DOM.fromTz=BX.adjust(BX(this.id+"_timezone_from"),{events:{change:o}});this.DOM.toTz=BX.adjust(BX(this.id+"_timezone_to"),{events:{click:r}});this.DOM.tzButton=BX.adjust(BX(this.id+"_timezone_btn"),{events:{click:BX.proxy(this.switchTimezone,this)}});this.DOM.tzOuterCont=BX(this.id+"_timezone_wrap");this.DOM.tzCont=BX(this.id+"_timezone_inner_wrap");BX(this.id+"_timezone_hint").title=BX.message("EC_EVENT_TZ_HINT");BX(this.id+"_timezone_default_hint").title=BX.message("EC_EVENT_TZ_DEF_HINT");BX.bind(this.DOM.fromTz,"change",BX.delegate(function(){if(this.linkFromToTz)this.DOM.toTz.value=this.DOM.fromTz.value;this.linkFromToDefaultTz=false},this));BX.bind(this.DOM.toTz,"change",BX.delegate(function(){this.linkFromToTz=false;this.linkFromToDefaultTz=false},this));BX.bind(this.DOM.defTimezone,"change",BX.delegate(function(){this.calendar.util.setUserOption("timezoneName",this.DOM.defTimezone.value);if(this.linkFromToDefaultTz)this.DOM.fromTz.value=this.DOM.toTz.value=this.DOM.defTimezone.value},this));this.linkFromToTz=this.DOM.fromTz.value==this.DOM.toTz.value;this.linkFromToDefaultTz=this.DOM.fromTz.value==this.DOM.toTz.value&&this.DOM.fromTz.value==this.DOM.defTimezone.value;BX.addCustomEvent("onJCClockInit",function(t){if(t.inputId==e.id+"_time_from"||t.inputId==e.id+"_time_to"){JCClock.setOptions({popupHeight:250})}});function t(){BX.calendar({node:this.parentNode,field:this,bTime:false});e.denySliderClose();if(BX.calendar.get().popup)BX.removeCustomEvent(BX.calendar.get().popup,"onPopupClose",BX.proxy(e.allowSliderClose,e));BX.addCustomEvent(BX.calendar.get().popup,"onPopupClose",BX.proxy(e.allowSliderClose,e))}function i(){if(e._fromDateValue){var t=e.calendar.util.parseTime(e.DOM.fromTime.value),i=e.calendar.util.parseTime(e.DOM.toTime.value),s=BX.parseDate(e.DOM.fromDate.value),a=BX.parseDate(e.DOM.toDate.value);if(e.DOM.fullDay.checked&&e._fromDateValue){e._fromDateValue.setHours(0,0,0)}else{if(s&&t){s.setHours(t.h,t.m,0)}if(a&&i){a.setHours(i.h,i.m,0)}}if(s&&e._fromDateValue){a=new Date(s.getTime()+(a.getTime()-e._fromDateValue.getTime()||36e5));if(a){e.DOM.toDate.value=e.calendar.util.formatDate(a)}}}e._fromDateValue=s;e.refreshPlannerState()}function s(){e.refreshPlannerState()}function a(){var t=e.calendar.util.parseTime(e.DOM.fromTime.value),i=e.calendar.util.parseTime(e.DOM.toTime.value),s=BX.parseDate(e.DOM.fromDate.value),a=BX.parseDate(e.DOM.toDate.value);if(s&&t)s.setHours(t.h,t.m,0);if(a&&i)a.setHours(i.h,i.m,0);if(e._fromDateValue){var n=new Date(e.calendar.util.getTimeEx(s)+e.calendar.util.getTimeEx(a)-e.calendar.util.getTimeEx(e._fromDateValue));e.DOM.toTime.value=e.calendar.util.formatTime(n);e.DOM.toDate.value=e.calendar.util.formatDate(n)}e._fromDateValue=s;e.refreshPlannerState()}function n(){e.refreshPlannerState()}function o(){if(e.linkFromToTz)e.DOM.toTz.value=e.DOM.fromTz.value;e.linkFromToDefaultTz=false;e.refreshPlannerState()}function r(){e.linkFromToTz=false;e.linkFromToDefaultTz=false;e.refreshPlannerState()}if(this.calendar.util.getUserOption("timezoneName")){this.DOM.defTimezone.value=this.calendar.util.getUserOption("timezoneName")||this.calendar.util.getUserOption("timezoneDefaultName")}else{this.DOM.defTimezoneWrap.style.display="";this.DOM.defTimezone.value=this.calendar.util.getUserOption("timezoneDefaultName")||"";if(this.DOM.defTimezone.value){this.calendar.util.setUserOption("timezoneName",this.DOM.defTimezone.value)}}this.DOM.fullDay.checked=this.entry.fullDay;this.switchFullDay();var l,d;if(this.entry.id){l=BX.parseDate(this.entry.data.DATE_FROM);d=new Date(l.getTime()+(this.entry.data.DT_LENGTH-(this.entry.fullDay?1:0))*1e3)}else{l=this.entry.from;d=this.entry.to}this.DOM.fromDate.value=this.calendar.util.formatDate(l);this.DOM.fromTime.value=this.calendar.util.formatTime(l.getHours(),l.getMinutes());this.DOM.toDate.value=this.calendar.util.formatDate(d);this.DOM.toTime.value=this.calendar.util.formatTime(d.getHours(),d.getMinutes());this._fromDateValue=this.entry.from;this.DOM.fromTz.value=this.entry.data&&this.entry.data.TZ_FROM?this.entry.data.TZ_FROM:this.DOM.defTimezone.value;this.DOM.toTz.value=this.entry.data&&this.entry.data.TZ_TO?this.entry.data.TZ_TO:this.DOM.defTimezone.value},showClock:function(e){top["bxShowClock_"+this.id+"_"+e]();setTimeout(BX.delegate(function(){if(BX(this.id+"_"+e+"_div")){BX.addClass(BX(this.id+"_"+e+"_div"),"calendar-clock-wrap")}},this),50)},switchFullDay:function(e){e=this.DOM.fullDay.checked;if(e&&this.calendar.util.getUserOption("timezoneName")&&(this.DOM.fromTz.value==""||this.DOM.toTz.value=="")){this.DOM.fromTz.value=this.DOM.toTz.value=this.DOM.defTimezone.value=this.calendar.util.getUserOption("timezoneName")}if(e){BX.addClass(this.DOM.dateTimeWrap,"calendar-options-item-datetime-hide-time")}else{BX.removeClass(this.DOM.dateTimeWrap,"calendar-options-item-datetime-hide-time")}this.refreshPlannerState()},switchTimezone:function(){if(BX.hasClass(this.DOM.tzCont,"calendar-options-timezone-collapse")){BX.addClass(this.DOM.tzCont,"calendar-options-timezone-expand");BX.removeClass(this.DOM.tzCont,"calendar-options-timezone-collapse")}else{BX.addClass(this.DOM.tzCont,"calendar-options-timezone-collapse");BX.removeClass(this.DOM.tzCont,"calendar-options-timezone-expand")}},initReminderControl:function(){var t=this;this.reminderValues=[];this.DOM.reminderValuesWrap=BX(this.id+"_reminder_values_wrap");this.DOM.reminderInputsWrap=BX(this.id+"_reminder_inputs_wrap");this.DOM.reminderAddButton=BX(this.id+"_reminder_add_button");var i=[15];if(this.entry&&this.entry.remind){i=this.entry.remind}else if(this.entry.getReminders){i=this.entry.getReminders()}this.reminder=new e.BXEventCalendar.ReminderSelector({id:"reminder-slider-"+this.calendar.id,selectedValues:i,values:this.calendar.util.getRemindersList(),valuesContainerNode:this.DOM.reminderValuesWrap,addButtonNode:this.DOM.reminderAddButton,zIndex:this.zIndex,changeCallack:function(e){t.reminderValues=e;BX.cleanNode(t.DOM.reminderInputsWrap);t.reminderValues.forEach(function(e){t.DOM.reminderInputsWrap.appendChild(BX.create("INPUT",{props:{name:"reminder[]",type:"hidden"},attrs:{value:e}}))})},showPopupCallBack:function(){t.denySliderClose()},hidePopupCallBack:function(){t.allowSliderClose()}})},initSectionSelector:function(){this.DOM.sectionWrap=BX(this.id+"_section_wrap");this.DOM.sectionInput=BX(this.id+"_section");var e=this.entry.section;if(!e&&this.entry.sectionId)e=this.calendar.sectionController.getSection(this.entry.sectionId);this.DOM.sectionInput.value=e.id;this.DOM.sectionSelect=this.DOM.sectionWrap.appendChild(BX.create("DIV",{props:{className:"calendar-field calendar-field-select"}}));this.DOM.sectionSelectInner=this.DOM.sectionSelect.appendChild(BX.create("DIV",{props:{className:"calendar-field-select-icon"},style:{backgroundColor:e.color}}));this.DOM.sectionSelectInnerText=this.DOM.sectionSelect.appendChild(BX.create("SPAN",{text:e.name}));BX.bind(this.DOM.sectionSelect,"click",s);var t=this,i=this.calendar.sectionController.getSectionListForEdit();function s(){if(t.sectionMenu&&t.sectionMenu.popupWindow&&t.sectionMenu.popupWindow.isShown()){return t.sectionMenu.close()}var e,s=[],a;for(e=0;e<i.length;e++){s.push({id:"bx-calendar-section-"+i[e].id,text:BX.util.htmlspecialchars(i[e].name),color:i[e].color,className:"calendar-add-popup-section-menu-item",onclick:function(e){return function(){var i=t.calendar.sectionController.getSection(e);t.calendar.util.setUserOption("lastUsedSection",i.id);t.DOM.sectionInput.value=i.id;t.DOM.sectionSelectInner.style.backgroundColor=i.color;t.setColor(i.color);t.DOM.sectionSelectInnerText.innerHTML=BX.util.htmlspecialchars(i.name);t.sectionMenu.close()}}(i[e].id)})}t.sectionMenu=BX.PopupMenu.create("sectionMenuSlider"+t.calendar.id,t.DOM.sectionSelect,s,{closeByEsc:true,autoHide:true,zIndex:t.zIndex,offsetTop:0,offsetLeft:0});t.sectionMenu.popupWindow.setWidth(t.DOM.sectionSelect.offsetWidth-2);t.sectionMenu.show();for(e=0;e<t.sectionMenu.menuItems.length;e++){if(t.sectionMenu.menuItems[e].layout.item){a=t.sectionMenu.menuItems[e].layout.item.querySelector(".menu-popup-item-icon");if(a){a.style.backgroundColor=t.sectionMenu.menuItems[e].color}}}BX.addClass(t.DOM.sectionSelect,"active");BX.addCustomEvent(t.sectionMenu.popupWindow,"onPopupClose",function(){BX.removeClass(t.DOM.sectionSelect,"active");BX.PopupMenu.destroy("sectionMenuSlider"+t.calendar.id)})}},initEditorControl:function(){if(!e["BXHtmlEditor"]){return setTimeout(BX.delegate(this.initEditorControl,this),100)}var t=this,i=e["BXHtmlEditor"].Get(this.editorId);if(i&&i.IsShown()){s(i)}else{BX.addCustomEvent(e["BXHtmlEditor"],"OnEditorCreated",function(e){if(e.id==t.editorId){s(e)}})}function s(e){if(e.toolbar.controls&&e.toolbar.controls.spoiler){BX.remove(e.toolbar.controls.spoiler.pCont)}}if(this.entry&&this.entry.data&&this.entry.data.DESCRIPTION)this.descriptionValue=this.entry.data.DESCRIPTION;else if(this.DOM.form&&this.DOM.form.desc&&this.DOM.form.desc.value)this.descriptionValue=this.DOM.form.desc.value;else this.descriptionValue=""},initLocationControl:function(){this.locationSelector=new e.BXEventCalendar.LocationSelector(this.calendar.id+"-slider-location",{inputName:"location_text",wrapNode:BX(this.id+"_location_wrap"),onChangeCallback:BX.proxy(this.checkPlannerState,this),value:this.entry.location},this.calendar)},initRepeatRuleControl:function(){this.DOM.rruleWrap=BX(this.id+"_rrule_wrap");this.DOM.endsonDateInput=BX(this.id+"_endson_date_input");this.DOM.endsonDateRadio=BX(this.id+"_endson_date");this.DOM.rruleType=BX.adjust(BX(this.id+"_rrule_type"),{events:{change:BX.delegate(function(){this.DOM.rruleWrap.className="calendar-rrule-type-"+this.DOM.rruleType.value.toLowerCase()},this)}});BX.bind(this.DOM.endsonDateInput,"click",BX.proxy(function(){this.DOM.endsonDateRadio.checked="checked";BX.calendar({node:this.DOM.endsonDateInput,field:this.DOM.endsonDateInput,bTime:false});BX.focus(this.DOM.endsonDateInput)},this));if(this.entry&&this.entry.isRecursive&&this.entry.isRecursive()){var e=this.entry.getRrule();this.DOM.rruleType.value=e.FREQ;this.DOM.rruleWrap.className="calendar-rrule-type-"+e.FREQ.toLowerCase();BX(this.id+"_rrule_count").value=e.INTERVAL;if(e.COUNT){BX(this.id+"_endson_count").checked="checked";BX(this.id+"event-endson-count-input").value=e.COUNT}else if(e["~UNTIL"]){BX(this.id+"_endson_date").checked="checked";BX(this.id+"_endson_date_input").value=e["~UNTIL"]}else{BX(this.id+"_endson_never").checked="checked"}if(e.BYDAY&&typeof e.BYDAY=="object"){for(var t in e.BYDAY){if(e.BYDAY.hasOwnProperty(t)){BX(this.id+"_rrule_byday_"+t).checked="checked"}}}}},initAttendeesControl:function(){this.attendees=this.entry.attendees||[this.calendar.currentUser];this.attendeesIndex={};this.attendees.forEach(function(e){this.attendeesIndex[e]=true},this);if(this.entry.getAttendeesCodes)this.attendeesCodes=this.entry.getAttendeesCodes();else this.attendeesCodes=this.entry.attendeesCodes||false;this.DOM.attendeesWrap=BX(this.id+"_attendees_wrap");this.attendeesSelector=new e.BXEventCalendar.DestinationSelector(this.calendar.id+"-slider-destination",{calendar:this.calendar,wrapNode:this.DOM.attendeesWrap,itemsSelected:this.attendeesCodes||this.calendar.util.getSocnetDestinationConfig("itemsSelected")});this.DOM.plannerWrap=BX(this.id+"_planner_wrap");this.DOM.attendeesTitle=BX(this.id+"_attendees_title_wrap");this.plannerId=this.id+"_slider_planner";BX.addCustomEvent("OnDestinationAddNewItem",BX.proxy(this.checkPlannerState,this));BX.addCustomEvent("OnDestinationUnselect",BX.proxy(this.checkPlannerState,this));BX.addCustomEvent("OnCalendarPlannerSelectorChanged",BX.proxy(this.onCalendarPlannerSelectorChanged,this));this.checkPlannerState();this.DOM.moreOuterWrap=BX(this.id+"_more_outer_wrap");if(this.DOM.form.allow_invite){if(this.entry.data)this.DOM.form.allow_invite.checked=this.entry.data.MEETING&&this.entry.data.MEETING.ALLOW_INVITE;else this.DOM.form.allow_invite.checked=this.entry.allowInvite}if(this.DOM.form.meeting_notify){if(this.entry.data)this.DOM.form.meeting_notify.checked=this.entry.data.MEETING&&this.entry.data.MEETING.NOTIFY;else this.DOM.form.meeting_notify.checked=this.entry.meetingNotify}},initColorControl:function(){var e=this;this.DOM.colorSelectorWrap=BX(this.id+"_color_selector_wrap");BX.bind(this.DOM.colorSelectorWrap,"click",i);this.defaultColors=this.calendar.util.getDefaultColors();this.colors=[];this.activeColor=this.entry.color;if(!this.activeColor&&this.entry.section){this.activeColor=this.entry.section.color}for(var t=0;t<this.defaultColors.length;t++){this.colors.push({color:this.defaultColors[t],node:this.DOM.colorSelectorWrap.appendChild(BX.create("LI",{props:{className:"calendar-field-colorpicker-color-item"},attrs:{"data-bx-calendar-color":this.defaultColors[t]},style:{backgroundColor:this.defaultColors[t]},html:'<span class="calendar-field-colorpicker-color"></span>'}))})}this.customColorNode=this.DOM.colorSelectorWrap.appendChild(BX.create("LI",{props:{className:"calendar-field-colorpicker-color-item"},style:{backgroundColor:"transparent",width:0},html:'<span class="calendar-field-colorpicker-color"></span>'}));this.otherColorLink=this.DOM.colorSelectorWrap.appendChild(BX.create("LI",{props:{className:"calendar-field-colorpicker-color-item-more"},html:'<span class="calendar-field-colorpicker-color-item-more-link">'+BX.message("EC_COLOR")+"</span>",events:{click:BX.delegate(function(){if(!this.colorPicker){this.colorPicker=new BX.ColorPicker({bindElement:this.otherColorLink,onColorSelected:BX.proxy(this.setColor,this),popupOptions:{zIndex:this.zIndex,events:{onPopupClose:function(){}}}})}this.colorPicker.open()},this)}}));function i(t){var i=e.calendar.util.findTargetNode(t.target||t.srcElement,this.outerWrap);if(i&&i.getAttribute){var s=i.getAttribute("data-bx-calendar-color");if(s!==null){if(e.activeColorNode){BX.removeClass(e.activeColorNode,"active")}e.activeColorNode=i;e.activeColor=s;BX.addClass(e.activeColorNode,"active")}}}this.setColor(this.activeColor)},setColor:function(e){this.activeColor=e;if(this.activeColorNode){BX.removeClass(this.activeColorNode,"active")}if(!BX.util.in_array(this.activeColor,this.defaultColors)&&this.activeColor){this.customColorNode.style.backgroundColor=this.activeColor;this.customColorNode.style.width="";this.activeColorNode=this.customColorNode;BX.addClass(this.activeColorNode,"active")}for(i=0;i<this.colors.length;i++){if(this.colors[i].color==this.activeColor){this.activeColorNode=this.colors[i].node;BX.addClass(this.activeColorNode,"active");break}}},save:function(t){if(!t)t={};var i=this.calendar.util.getActionUrl(),s=Math.round(Math.random()*1e6);i+=i.indexOf("?")==-1?"?":"&";i+="action=edit_event&bx_event_calendar_request=Y&sessid="+BX.bitrix_sessid()+"&reqId="+s;i+="&markAction="+(this.entry.id?"editEvent":"newEvent");i+="&markType="+this.calendar.util.type;i+="&markRrule="+this.DOM.rruleType.value;i+="&markMeeting="+(this.isMeeting()?"Y":"N");i+="&markCrm="+(this.isCrm()?"Y":"N");this.DOM.form.action=i;var a=this.calendar.util.parseTime(this.DOM.fromTime.value),n=this.calendar.util.parseTime(this.DOM.toTime.value),o=BX.parseDate(this.DOM.fromDate.value),r=BX.parseDate(this.DOM.toDate.value);if(o&&a)o.setHours(a.h,a.m,0);if(r&&n)r.setHours(n.h,n.m,0);this.fromDate=o;this.toDate=r;BX(this.id+"_time_from_real").value=BX.date.format(this.calendar.util.TIME_FORMAT,o.getTime()/1e3);BX(this.id+"_time_to_real").value=BX.date.format(this.calendar.util.TIME_FORMAT,r.getTime()/1e3);if(t.recurentEventEditMode){BX(this.id+"_event_current_date_from").value=this.calendar.util.formatDate(this.entry.from);BX(this.id+"_event_rec_edit_mode").value=t.recurentEventEditMode}else{BX(this.id+"_event_current_date_from").value="";BX(this.id+"_event_rec_edit_mode").value=""}if(t.checkBusyUsers!==false){var l=this.getBusyUserList();if(l&&l.length>0){if(!this.busyUsersDialog)this.busyUsersDialog=new e.BXEventCalendar.BusyUsersDialog(this.calendar);this.busyUsersDialog.show({users:l,saveCallback:BX.delegate(function(){var e,i=[];for(e=0;e<l.length;e++){i.push(l[e].id)}BX(this.id+"_exclude_users").value=i.join(",");t.checkBusyUsers=false;this.save(t)},this)});return}}BX(this.id+"_location_new").value=this.locationSelector.getTextValue();if(this.locationSelector.getTextValue().substr(0,5)=="ECMR_"&&this.DOM.rruleType.value!=="NONE"){alert(BX.message("EC_RESERVE_PERIOD_WARN"));return false}BX(this.id+"_id").value=this.entry.id||0;if(this.entry.id&&this.entry.isRecursive()&&!t.confirmed&&this.checkForSignificantChanges()){this.calendar.entryController.showConfirmEditDialog({params:t,callback:BX.delegate(this.save,this)});return false}var d=this.calendar.sectionController.getSection(this.DOM.sectionInput.value);if(d){d.show();if(d.color.toLowerCase()!=this.activeColor.toLowerCase()){BX(this.id+"_color").value=this.activeColor}}BX.ajax.submitAjax(this.DOM.form,{dataType:"json",method:"POST",onsuccess:BX.delegate(function(e){if(t.recurentEventEditMode){this.calendar.reload()}else{if(e){this.calendar.entryController.handleEntriesList(e.entries);this.calendar.getView().displayEntries()}}},this)});this.close()},getBusyUserList:function(){var e,t=[];if(this.plannerData){for(e in this.plannerData.entries){if(this.plannerData.entries.hasOwnProperty(e)&&this.plannerData.entries[e].id&&this.plannerData.entries[e].status!="h"&&this.plannerData.entries[e].strictStatus&&!this.plannerData.entries[e].currentStatus){t.push(this.plannerData.entries[e])}}}return t},checkForSignificantChanges:function(){var e=false;if(!e&&this.entry.name!==this.DOM.form.name.value)e=true;if(!e&&this.descriptionValue!==this.DOM.form.desc.value)e=true;if(!e&&this.entry.data.LOCATION!==this.DOM.form.location_text.value)e=true;if(!e&&this.entry.isFullDay()!=this.DOM.form.skip_time.checked)e=true;if(!e){var t=BX.parseDate(this.entry.data.DATE_FROM),i=new Date(t.getTime()+(this.entry.data.DT_LENGTH-(this.entry.isFullDay()?1:0))*1e3);if(Math.abs(t.getTime()-this.fromDate.getTime())>1e3||Math.abs(i.getTime()-this.toDate.getTime())>1e3)e=true;if(!e&&!this.entry.isFullDay()&&(this.entry.data.TZ_FROM!=this.DOM.form.tz_from.value||this.entry.data.TZ_TO!=this.DOM.form.tz_to.value)){e=true}}if(!e&&this.plannerData&&false){var s,a={},n=0;if(this.oEvent.IS_MEETING&&this.oEvent["~ATTENDEES"]){for(s in this.oEvent["~ATTENDEES"]){if(this.oEvent["~ATTENDEES"].hasOwnProperty(s)&&this.oEvent["~ATTENDEES"][s]["USER_ID"]){a[this.oEvent["~ATTENDEES"][s]["USER_ID"]]=true;n++}}}for(s in this.plannerData.entries){if(this.plannerData.entries.hasOwnProperty(s)&&this.plannerData.entries[s].type=="user"&&this.plannerData.entries[s].id){if(a[this.plannerData.entries[s].id]){a[this.plannerData.entries[s].id]="+"}else{e=true;break}}}if(!e&&a){for(s in a){if(a.hasOwnProperty(s)&&a[s]!=="+"){e=true;break}}}}return e},onCalendarPlannerSelectorChanged:function(e){this.DOM.fromDate.value=this.calendar.util.formatDate(e.dateFrom);this.DOM.fromTime.value=this.calendar.util.formatTime(e.dateFrom);this.DOM.toDate.value=this.calendar.util.formatDate(e.dateTo);this.DOM.toTime.value=this.calendar.util.formatTime(e.dateTo)},checkPlannerState:function(){var e=this,t=BX.parseDate(this.DOM.fromDate.value),i=BX.parseDate(e.DOM.toDate.value),s={codes:this.attendeesSelector.getCodes(),from:this.calendar.util.formatDate(t.getTime()-this.calendar.util.dayLength*3),to:this.calendar.util.formatDate(i.getTime()+this.calendar.util.dayLength*10),location:this.locationSelector.getTextValue(),focusSelector:true};this.attendeesCodes=this.attendeesSelector.getAttendeesCodes();this.updatePlanner(s)},updatePlanner:function(e){if(!e)e={};var t=this;this.calendar.request({data:{action:"update_planner",codes:e.codes||[],cur_event_id:this.entry.id||0,date_from:e.dateFrom||e.from||"",date_to:e.dateTo||e.to||"",timezone:this.DOM.fromTz.value?this.DOM.fromTz.value:this.calendar.util.getUserOption("timezoneName"),location:e.location||"",entries:e.entrieIds||false,add_cur_user_to_list:this.calendar.util.userIsOwner()?"Y":"N"},handler:function(i){var s,a=[],n={},o=false,r=!!(e.entries||i.entries&&i.entries.length>0);for(s=0;s<i.entries.length;s++){if(i.entries[s].type=="user"){a.push({id:i.entries[s].id,name:i.entries[s].name,avatar:i.entries[s].avatar,smallAvatar:i.entries[s].smallAvatar||i.entries[s].avatar,url:i.entries[s].url});n[i.entries[s].id]=true;if(!t.attendeesIndex[i.entries[s].id])o=true}}if(!o){for(var l in t.attendeesIndex){if(t.attendeesIndex.hasOwnProperty(l)&&!n[l]){o=true;break}}}if(r){var d={};if(e.entries){i.entries=e.entries;d.scaleFrom=e.from;d.scaleTo=e.to}d.loadedDataFrom=e.from;d.loadedDataTo=e.to;d.data={entries:i.entries,accessibility:i.accessibility};d.focusSelector=e.focusSelector==undefined?false:e.focusSelector;t.refreshPlannerState(d)}}})},refreshPlannerState:function(e){if(!e||typeof e!=="object")e={};this.plannerData=e.data;var t=BX.parseDate(this.DOM.fromDate.value),s=BX.parseDate(this.DOM.toDate.value),a=this.calendar.util.parseTime(this.DOM.fromTime.value),n=this.calendar.util.parseTime(this.DOM.toTime.value),o=this.DOM.fullDay.checked,r={},l,d;if(!o){if(t&&a)t.setHours(a.h,a.m,0);if(s&&n)s.setHours(n.h,n.m,0)}if(e.focusSelector==undefined)e.focusSelector=true;if(t&&s&&t.getTime&&s.getTime&&t.getTime()<=s.getTime()){BX.addClass(this.DOM.plannerWrap,"calendar-edit-planner-wrap-shown");if(!this.plannerIsShown()&&e.show){e.focusSelector=true}if(o){l=new Date(t.getTime());l=e.scaleFrom||new Date(l.getTime()-this.calendar.util.dayLength*3);d=e.scaleTo||new Date(l.getTime()+this.calendar.util.dayLength*10);r.scaleType="1day";r.scaleDateFrom=l;r.scaleDateTo=d;r.adjustCellWidth=false}else{r.changeFromFullDay={scaleType:"1hour",timelineCellWidth:40};r.shownScaleTimeFrom=parseInt(this.calendar.util.getWorkTime().start);r.shownScaleTimeTo=parseInt(this.calendar.util.getWorkTime().end)}r.entriesListWidth=this.DOM.attendeesTitle.offsetWidth+16;r.width=this.DOM.plannerWrap.offsetWidth;this.DOM.moreOuterWrap.style.paddingLeft=r.entriesListWidth+"px";var h=false;if(this.DOM.rruleType.value!=="NONE"&&false){h={FREQ:this.RepeatSelect.value,INTERVAL:this.RepeatCount.value,UNTIL:this.RepeatDiapTo.value};if(h.UNTIL==EC_MESS.NoLimits)h.UNTIL="";if(h.FREQ=="WEEKLY"){h.WEEK_DAYS=[];for(i=0;i<7;i++){if(this.RepeatWeekDaysCh[i].checked){h.WEEK_DAYS.push(this.RepeatWeekDaysCh[i].value)}}if(!h.WEEK_DAYS.length){h=false}}}BX.onCustomEvent("OnCalendarPlannerDoUpdate",[{plannerId:this.plannerId,config:r,focusSelector:e.focusSelector,selector:{from:t,to:s,fullDay:o,RRULE:h,animation:true,updateScaleLimits:true},data:e.data||false,loadedDataFrom:e.loadedDataFrom,loadedDataTo:e.loadedDataTo,show:true}])}},plannerIsShown:function(){return this.DOM.plannerWrap&&BX.hasClass(this.DOM.plannerWrap,"calendar-edit-planner-wrap-shown")},RepeatSelectOnChange:function(e){var t,i,s;e=e.toUpperCase();if(e=="NONE"){}else{this.RepeatPhrase2.innerHTML=EC_MESS.DeDot;if(e=="WEEKLY"){this.RepeatPhrase1.innerHTML=EC_MESS.EveryF;this.RepeatPhrase2.innerHTML+=EC_MESS.WeekP;this.RepeatWeekDays.style.display=e=="WEEKLY"?"inline-block":"none";i={};if(!this.RepeatWeekDaysCh){this.RepeatWeekDaysCh=[];for(t=0;t<7;t++)this.RepeatWeekDaysCh[t]=BX(this.id+"bxec_week_day_"+t)}if(this.oEvent&&this.oEvent.ID&&this.oEvent.RRULE&&this.oEvent.RRULE.BYDAY){i=this.oEvent.RRULE.BYDAY}else{s=BX.parseDate(this.pFromDate.value);if(!s)s=bxGetDateFromTS(this.oEvent.DT_FROM_TS);if(s)i[this.oEC.GetWeekDayByInd(s.getDay())]=true}for(t=0;t<7;t++)this.RepeatWeekDaysCh[t].checked=!!i[this.RepeatWeekDaysCh[t].value]}else{if(e=="YEARLY")this.RepeatPhrase1.innerHTML=EC_MESS.EveryN;else this.RepeatPhrase1.innerHTML=EC_MESS.EveryM;if(e=="DAILY")this.RepeatPhrase2.innerHTML+=EC_MESS.DayP;else if(e=="MONTHLY")this.RepeatPhrase2.innerHTML+=EC_MESS.MonthP;else if(e=="YEARLY")this.RepeatPhrase2.innerHTML+=EC_MESS.YearP;this.RepeatWeekDays.style.display="none"}var a=this.oEvent&&this.oEC.Event.IsRecursive(this.oEvent);this.RepeatCount.value=!this.oEvent.ID||!a?1:this.oEvent.RRULE.INTERVAL;if(!this.oEvent.ID||!a){this.RepeatEndsOnNever.checked=true}else{if(this.oEvent.RRULE&&this.oEvent.RRULE.COUNT>0){this.RepeatCountInp.value=parseInt(this.oEvent.RRULE.COUNT);this.RepeatEndsOnCount.checked=true}else if(this.oEvent.RRULE&&this.oEvent.RRULE["~UNTIL"]){this.RepeatDiapTo.value=this.oEvent.RRULE["~UNTIL"];this.RepeatEndsOnUntil.checked=true}else{this.RepeatEndsOnNever.checked=true}this.EndsOnChange()}}},getNewEntry:function(e){if(!e)e={};var t=this.calendar.entryController.getTimeForNewEntry(new Date);return{from:e.from||t.from,to:e.to||t.to,fullDay:false,name:e.name||this.calendar.entryController.getDefaultEntryName(),section:e.section?this.calendar.sectionController.getSection(e.section):this.calendar.sectionController.getCurrentSection(),remind:e.remind||[this.calendar.util.getUserOption("defaultReminder",15)],location:e.locationValue||"",attendeesList:e.attendees||[],attendees:e.attendees,attendeesCodes:e.attendeesCodes,attendeesCodesList:e.attendeesCodesList,meetingNotify:e.meetingNotify,allowInvite:e.allowInvite}},fieldIsPinned:function(e){return this.pinnedFieldsIndex[e]},collectPlaceholders:function(e){this.placeHolders={};this.placeHoldersAdditional={};var t,i,s=this.DOM.formWrap.querySelectorAll(".calendar-field-additional-placeholder");for(t=0;t<s.length;t++){i=s[t].getAttribute("data-bx-block-placeholer");if(i){this.placeHoldersAdditional[i]=s[t]}}s=this.DOM.formWrap.querySelectorAll(".calendar-field-placeholder");for(t=0;t<s.length;t++){i=s[t].getAttribute("data-bx-block-placeholer");if(i){this.placeHolders[i]=s[t]}}},pinField:function(t){if(!this.placeHolders){this.collectPlaceholders()}var i=this,s=this.placeHoldersAdditional[t],a=this.placeHolders[t],n=s.offsetHeight;s.style.height=n+"px";setTimeout(function(){BX.addClass(s,"calendar-hide-field")},0);a.style.height="0";if(t=="description"){setTimeout(function(){var e=BX(i.id+"_description_additional_wrap");if(e){while(e.firstChild){a.appendChild(e.firstChild)}}a.style.height=n+"px"},200);setTimeout(function(){BX.removeClass(s,"calendar-hide-field");s.style.display="none";a.style.height="";i.pinnedFieldsIndex[t]=true;var n=e["BXHtmlEditor"].Get(i.editorId);if(n){n.CheckAndReInit()}i.saveSettings();i.updateAdditionalBlockState()},300)}else{setTimeout(function(){while(s.firstChild){a.appendChild(s.firstChild)}a.style.height=n+"px"},200);setTimeout(function(){BX.removeClass(s,"calendar-hide-field");s.style.height="";a.style.height="";i.pinnedFieldsIndex[t]=true;i.saveSettings();i.updateAdditionalBlockState()},300)}},unPinField:function(t){if(!this.placeHolders){this.collectPlaceholders()}var i=this,s=this.placeHoldersAdditional[t],a=this.placeHolders[t],n=a.offsetHeight;a.style.height=n+"px";setTimeout(function(){BX.addClass(a,"calendar-hide-field")},0);s.style.height="0";if(t=="description"){setTimeout(function(){var e=BX(i.id+"_description_additional_wrap");if(e){while(a.firstChild){e.appendChild(a.firstChild)}}s.style.display="";s.style.height=n+"px"},200);setTimeout(function(){BX.removeClass(a,"calendar-hide-field");a.style.height="";s.style.height="";i.pinnedFieldsIndex[t]=false;var n=e["BXHtmlEditor"].Get(i.editorId);if(n){n.CheckAndReInit()}i.saveSettings();i.updateAdditionalBlockState()},300)}else{setTimeout(function(){while(a.firstChild){s.appendChild(a.firstChild)}s.style.height=n+"px"},200);setTimeout(function(){BX.removeClass(a,"calendar-hide-field");a.style.height="";s.style.height="";i.pinnedFieldsIndex[t]=false;i.saveSettings();i.updateAdditionalBlockState()},300)}},getSettings:function(){this.pinnedFieldsIndex={};var e,t=[],i=this.calendar.util.getFormSettings(this.formType);for(e in i.pinnedFields){if(i.pinnedFields.hasOwnProperty(e)){t.push(i.pinnedFields[e]);this.pinnedFieldsIndex[i.pinnedFields[e]]=true}}i.pinnedFields=t;return i},saveSettings:function(){var e,t=[];for(e in this.pinnedFieldsIndex){if(this.pinnedFieldsIndex.hasOwnProperty(e)&&this.pinnedFieldsIndex[e]){t.push(e)}}this.formSettings.pinnedFields=t;this.calendar.util.saveFormSettings(this.formType,this.formSettings)},updateAdditionalBlockState:function(){setTimeout(BX.delegate(function(){var e,t=this.DOM.additionalBlock.getElementsByClassName("js-calendar-field-name");BX.cleanNode(this.DOM.pinnedNamesWrap);for(e=0;e<t.length;e++){this.DOM.pinnedNamesWrap.appendChild(BX.create("SPAN",{props:{className:"calendar-additional-alt-promo-text"},html:t[e].innerHTML}))}if(!t.length){BX.addClass(this.DOM.additionalBlockWrap,"calendar-additional-block-hidden")}else if(BX.hasClass(this.DOM.additionalBlockWrap,"calendar-additional-block-hidden")){BX.removeClass(this.DOM.additionalBlockWrap,"calendar-additional-block-hidden")}this.checkLastItemBorder()},this),300)},showAdditionalBlock:function(){BX.addClass(this.DOM.additionalSwitch,"opened");BX.removeClass(this.DOM.additionalBlock,"invisible")},hideAdditionalBlock:function(){BX.removeClass(this.DOM.additionalSwitch,"opened");BX.addClass(this.DOM.additionalBlock,"invisible")},keyHandler:function(e){if((e.ctrlKey||e.metaKey)&&!e.altKey&&e.keyCode==this.calendar.util.KEY_CODES["enter"]){this.save()}},checkLastItemBorder:function(){var e="no-border",t,i;i=this.DOM.mainBlock.querySelectorAll(".calendar-options-item-border");for(t=0;t<i.length;t++){if(t==i.length-1){BX.addClass(i[t],e)}else{BX.removeClass(i[t],e)}}i=this.DOM.additionalBlock.querySelectorAll(".calendar-options-item-border");for(t=0;t<i.length;t++){if(t==i.length-1){BX.addClass(i[t],e)}else{BX.removeClass(i[t],e)}}},isMeeting:function(){var e,t=0;if(this.attendeesCodes){for(e in this.attendeesCodes){if(this.attendeesCodes.hasOwnProperty(e)){if(this.attendeesCodes[e]!="users"||t>0){return true}t++}}}return false},isCrm:function(){return this.DOM.form["UF_CRM_CAL_EVENT[]"]&&(this.DOM.form["UF_CRM_CAL_EVENT[]"].length>1||this.DOM.form["UF_CRM_CAL_EVENT[]"].value)}};if(e.BXEventCalendar){e.BXEventCalendar.EditEntrySlider=t}else{BX.addCustomEvent(e,"onBXEventCalendarInit",function(){e.BXEventCalendar.EditEntrySlider=t})}})(window);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:73:"/bitrix/js/calendar/new/calendar-view-entry-slider.min.js?152740167510187";s:6:"source";s:53:"/bitrix/js/calendar/new/calendar-view-entry-slider.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
(function(t){function e(t){this.calendar=t;this.id="calendar_view_slider_"+Math.round(Math.random()*1e6);this.sliderId="calendar:view-entry-slider";this.zIndex=3100;this.DOM={}}e.prototype={show:function(t){this.entry=t.entry;this.formType=t.formType||"slider_main";BX.SidePanel.Instance.open(this.sliderId,{contentCallback:BX.delegate(this.createContent,this)});this.calendar.disableKeyHandler();BX.addCustomEvent("SidePanel.Slider:onClose",BX.proxy(this.hide,this));BX.addCustomEvent("SidePanel.Slider:onCloseComplete",BX.proxy(this.destroy,this));BX.bind(document,"click",BX.proxy(this.calendar.util.applyHacksForPopupzIndex,this.calendar.util));this.opened=true},hide:function(t){if(t&&t.getSliderPage&&t.getSliderPage().getUrl()===this.sliderId){if(this.denyClose){t.denyAction()}else{BX.removeCustomEvent("SidePanel.Slider:onClose",BX.proxy(this.hide,this))}}},destroy:function(t){if(t&&t.getSliderPage&&t.getSliderPage().getUrl()===this.sliderId){BX.unbind(document,"click",BX.proxy(this.calendar.util.applyHacksForPopupzIndex,this.calendar.util));BX.removeCustomEvent("SidePanel.Slider:onCloseComplete",BX.proxy(this.destroy,this));BX.onCustomEvent("OnCalendarPlannerDoUninstall",[{plannerId:this.plannerId}]);BX.SidePanel.Instance.destroy(this.sliderId);this.calendar.enableKeyHandler();if(this.userListPopup)this.userListPopup.close();setTimeout(BX.delegate(function(){this.calendar.getView().deselectEntry()},this),300);this.opened=false}},isOpened:function(){return this.opened},close:function(){BX.SidePanel.Instance.close()},createContent:function(){var t=new BX.Promise;BX.ajax.get(this.calendar.util.getActionUrl(),{action:"get_view_slider",unique_id:this.id,form_type:this.formType,sessid:BX.bitrix_sessid(),bx_event_calendar_request:"Y",entry_id:this.entry.id,date_from:this.entry.data["~CURRENT_DATE"]||this.entry.data.DATE_FROM,section_name:this.entry.getSectionName(),date_from_offset:this.entry.data.TZ_OFFSET_FROM,reqId:Math.round(Math.random()*1e6)},BX.delegate(function(e){t.fulfill(BX.util.trim(e));this.initControls()},this));return t},initControls:function(){this.initPlannerControl();this.initUserListControl();this.DOM.buttonSet=BX(this.id+"_buttonset");this.DOM.editButton=BX(this.id+"_but_edit");this.DOM.delButton=BX(this.id+"_but_del");if(BX(this.id+"_time_inner_wrap").offsetHeight>50){BX.addClass(BX(this.id+"_time_wrap"),"calendar-slider-sidebar-head-long-time")}if(this.calendar.entryController.canDo(this.entry,"edit")){BX.bind(this.DOM.editButton,"click",BX.delegate(function(){BX.SidePanel.Instance.close(false,BX.delegate(function(){this.calendar.entryController.editEntry({entry:this.entry})},this))},this))}else{BX.remove(this.DOM.editButton)}if(this.calendar.entryController.canDo(this.entry,"delete")){BX.bind(this.DOM.delButton,"click",BX.delegate(function(){this.calendar.entryController.deleteEntry(this.entry)},this))}else{BX.remove(this.DOM.delButton)}BX.viewElementBind(this.id+"_"+this.entry.id+"_files_wrap",{showTitle:true},function(t){return BX.type.isElementNode(t)&&(t.getAttribute("data-bx-viewer")||t.getAttribute("data-bx-image"))});if(this.entry&&this.entry.getCurrentStatus()){this.initAcceptMeetingControll()}var t=BX(this.id+"_sidebar_inner");if(t){var e=t.querySelectorAll(".calendar-slider-sidebar-border-bottom");if(e.length>=2){BX.removeClass(e[e.length-1],"calendar-slider-sidebar-border-bottom")}}this.DOM.copyButton=BX(this.id+"_copy_url_btn");if(this.DOM.copyButton){BX.bind(this.DOM.copyButton,"click",BX.proxy(this.copyEventUrl,this))}},initPlannerControl:function(){this.plannerId=this.id+"_view_slider_planner";this.DOM.plannerWrap=BX(this.id+"_view_planner_wrap");setTimeout(BX.delegate(function(){if(this.DOM.plannerWrap){BX.removeClass(this.DOM.plannerWrap,"hidden")}},this),500);setTimeout(BX.delegate(function(){if(this.DOM.plannerWrap&&this.DOM.plannerWrap.offsetWidth){BX.onCustomEvent("OnCalendarPlannerDoResize",[{plannerId:this.plannerId,timeoutCheck:true,width:this.DOM.plannerWrap.offsetWidth}])}},this),200);BX.bind(t,"resize",BX.delegate(function(){if(this.DOM.plannerWrap&&this.DOM.plannerWrap.offsetWidth){BX.onCustomEvent("OnCalendarPlannerDoResize",[{plannerId:this.plannerId,timeoutCheck:true,width:this.DOM.plannerWrap.offsetWidth}])}},this))},initUserListControl:function(){var t={y:[],i:[],q:[],n:[]};if(this.entry.isMeeting()){this.entry.getAttendees().forEach(function(e){if(e.STATUS=="H"){t.y.push(e)}else if(t[e.STATUS.toLowerCase()]){t[e.STATUS.toLowerCase()].push(e)}},this)}BX.bind(BX(this.id+"_attendees_y"),"click",BX.delegate(function(){this.showUserListPopup(BX(this.id+"_attendees_y"),t.y)},this));BX.bind(BX(this.id+"_attendees_n"),"click",BX.delegate(function(){this.showUserListPopup(BX(this.id+"_attendees_n"),t.n)},this));BX.bind(BX(this.id+"_attendees_q"),"click",BX.delegate(function(){this.showUserListPopup(BX(this.id+"_attendees_q"),t.q)},this));BX.bind(BX(this.id+"_attendees_i"),"click",BX.delegate(function(){this.showUserListPopup(BX(this.id+"_attendees_i"),t.i)},this))},showUserListPopup:function(t,e){if(this.userListPopup)this.userListPopup.close();if(!e||!e.length)return;this.DOM.userListPopupWrap=BX.create("DIV",{props:{className:"calendar-user-list-popup-block"}});e.forEach(function(t){var e=this.DOM.userListPopupWrap.appendChild(BX.create("DIV",{props:{className:"calendar-slider-sidebar-user-container calendar-slider-sidebar-user-card"}}));e.appendChild(BX.create("DIV",{props:{className:"calendar-slider-sidebar-user-block-avatar"}})).appendChild(BX.create("DIV",{props:{className:"calendar-slider-sidebar-user-block-item"}})).appendChild(BX.create("IMG",{props:{width:34,height:34,src:t.AVATAR}}));e.appendChild(BX.create("DIV",{props:{className:"calendar-slider-sidebar-user-info"}})).appendChild(BX.create("A",{props:{href:t.URL?t.URL:"#",className:"calendar-slider-sidebar-user-info-name"},text:t.DISPLAY_NAME}))},this);this.userListPopup=BX.PopupWindowManager.create(this.calendar.id+"-user-list-popup",t,{autoHide:true,closeByEsc:true,offsetTop:0,offsetLeft:0,width:200,resizable:false,lightShadow:true,content:this.DOM.userListPopupWrap,className:"calendar-user-list-popup"});this.userListPopup.setAngle({offset:36});this.userListPopup.show();BX.addCustomEvent(this.userListPopup,"onPopupClose",BX.delegate(function(){this.userListPopup.destroy()},this))},initAcceptMeetingControll:function(){this.setStatus=new s({calendar:this.calendar,wrap:BX(this.id+"_status_buttonset"),currentStatus:BX(this.id+"_current_status").value||this.entry.getCurrentStatus(),changeStatusCallback:BX.delegate(function(t){this.calendar.entryController.setMeetingStatus(this.entry,t)},this)})},copyEventUrl:function(){var t=this.calendar.util.getEventPath(this.entry);if(!BX.clipboard.copy(t)){return}this.timeoutIds=this.timeoutIds||[];var e={content:BX.message("CALENDAR_TIP_TEMPLATE_LINK_COPIED"),darkMode:true,autoHide:true,zIndex:1e3,angle:true,offsetLeft:20};var s=new BX.PopupWindow("calendar_clipboard_copy",this.DOM.copyButton,e);s.show();var i;while(i=this.timeoutIds.pop())clearTimeout(i);i=setTimeout(function(){s.close()},1500);this.timeoutIds.push(i)}};function s(t){this.calendar=t.calendar;this.wrap=t.wrap;this.id=this.calendar.id+"_set_status_button";this.status=t.currentStatus;this.changeStatusCallback=t.changeStatusCallback;this.zIndex=3100;this.create();this.updateStatus()}s.prototype={create:function(){this.selectorButton=this.wrap.appendChild(BX.create("SPAN",{props:{className:"webform-small-button webform-small-button-transparent webform-small-button-dropdown"},events:{click:BX.proxy(this.showPopup,this)}}));this.selectorButtonText=this.selectorButton.appendChild(BX.create("SPAN",{props:{className:"webform-small-button-text"}}));this.selectorButtonIcon=this.selectorButton.appendChild(BX.create("SPAN",{props:{className:"webform-small-button-icon"}}));this.buttonY=this.wrap.appendChild(BX.create("SPAN",{props:{className:"webform-small-button webform-small-button-accept"},events:{click:BX.proxy(function(){this.setStatus("Y")},this)},html:BX.message("EC_VIEW_DESIDE_BUT_Y")}));this.buttonI=this.wrap.appendChild(BX.create("SPAN",{props:{className:"webform-small-button webform-small-button-transparent"},style:{display:"none"},events:{click:BX.proxy(function(){this.setStatus("I")},this)},html:BX.message("EC_VIEW_DESIDE_BUT_I")}));this.buttonN=this.wrap.appendChild(BX.create("SPAN",{props:{className:"webform-small-button-link"},events:{click:BX.proxy(function(){this.setStatus("N")},this)},html:BX.message("EC_VIEW_DESIDE_BUT_N")}))},updateStatus:function(){if(this.status=="Q"){this.selectorButton.style.display="none";this.buttonY.style.display="";this.buttonN.style.display=""}else{this.selectorButton.style.display="";this.selectorButtonText.innerHTML=BX.message("EC_VIEW_STATUS_BUT_"+this.status);this.buttonY.style.display="none";this.buttonI.style.display="none";this.buttonN.style.display="none"}},setStatus:function(t){this.status=t;if(this.menuPopup){this.menuPopup.close()}if(this.changeStatusCallback&&typeof this.changeStatusCallback=="function"){this.changeStatusCallback(this.status)}this.updateStatus()},showPopup:function(){if(this.menuPopup&&this.menuPopup.popupWindow&&this.menuPopup.popupWindow.isShown()){return this.menuPopup.close()}var t;if(this.status=="Y"||this.status=="H"){t=[{text:BX.message("EC_VIEW_DESIDE_BUT_N"),onclick:BX.proxy(function(){this.setStatus("N")},this)}]}else if(this.status=="N"){t=[{text:BX.message("EC_VIEW_DESIDE_BUT_Y"),onclick:BX.proxy(function(){this.setStatus("Y")},this)}]}else if(this.status=="I"){t=[{text:BX.message("EC_VIEW_DESIDE_BUT_Y"),onclick:BX.proxy(function(){this.setStatus("Y")},this)},{text:BX.message("EC_VIEW_DESIDE_BUT_N"),onclick:BX.proxy(function(){this.setStatus("N")},this)}]}this.menuPopup=BX.PopupMenu.create(this.id,this.selectorButtonIcon,t,{closeByEsc:true,autoHide:true,zIndex:this.zIndex,offsetTop:15,offsetLeft:5,angle:true});this.menuPopup.show();BX.addCustomEvent(this.menuPopup.popupWindow,"onPopupClose",BX.delegate(function(){BX.PopupMenu.destroy(this.id)},this))}};if(t.BXEventCalendar){t.BXEventCalendar.ViewEntrySlider=e}else{BX.addCustomEvent(t,"onBXEventCalendarInit",function(){t.BXEventCalendar.ViewEntrySlider=e})}})(window);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:67:"/bitrix/js/calendar/new/calendar-sync-slider.min.js?152740167522952";s:6:"source";s:47:"/bitrix/js/calendar/new/calendar-sync-slider.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
(function(window){function SyncSlider(e){this.calendar=e.calendar;this.id=this.calendar.id+"_sync";this.zIndex=e.zIndex||1e3;this.sliderId="calendar:sync-slider";this.SLIDER_WIDTH=500;this.SLIDER_DURATION=80;this.DOM={button:e.button};this.config=this.calendar.util.config;this.syncInfo=this.config.syncInfo;if(this.DOM.button){BX.bind(this.DOM.button,"click",BX.proxy(this.show,this))}}SyncSlider.prototype={show:function(){this.init();BX.SidePanel.Instance.open(this.sliderId,{contentCallback:BX.delegate(this.create,this),width:this.SLIDER_WIDTH,animationDuration:this.SLIDER_DURATION});BX.addCustomEvent("SidePanel.Slider:onClose",BX.proxy(this.hide,this));BX.addCustomEvent("SidePanel.Slider:onCloseComplete",BX.proxy(this.destroy,this));this.calendar.disableKeyHandler()},close:function(){BX.SidePanel.Instance.close()},hide:function(e){if(e&&e.getSliderPage&&e.getSliderPage().getUrl()===this.sliderId){if(this.denyClose){e.denyAction()}else{BX.removeCustomEvent("SidePanel.Slider:onClose",BX.proxy(this.hide,this))}}},destroy:function(e){if(e&&e.getSliderPage&&e.getSliderPage().getUrl()===this.sliderId){BX.removeCustomEvent("SidePanel.Slider:onCloseComplete",BX.proxy(this.destroy,this));BX.SidePanel.Instance.destroy(this.sliderId);this.calendar.enableKeyHandler()}},init:function(){this.syncList=[{id:"google",label:BX.message("EC_CAL_SYNC_GOOGLE"),active:!!this.syncInfo.google.active,connected:!!this.syncInfo.google.connected,syncDate:this.syncInfo.google.syncDate,connectHandler:BX.delegate(function(e){BX.util.popup(this.config.googleCalDavStatus.authLink,500,600);return BX.PreventDefault(e||window.event)},this),disconnectHandler:BX.delegate(function(e){this.disconnectGoogle(e);return BX.PreventDefault(e||window.event)},this)},{id:"macosx",label:BX.message("EC_CAL_SYNC_MAC"),active:!!this.syncInfo.macosx.active,connected:!!this.syncInfo.macosx.connected,syncDate:this.syncInfo.macosx.syncDate,connectHandler:BX.delegate(function(e){this.connectMacOSX();return BX.PreventDefault(e||window.event)},this),disconnectHandler:BX.delegate(function(e){this.disconnectMacOSX();return BX.PreventDefault(e||window.event)},this)},{id:"iphone",label:BX.message("EC_CAL_SYNC_IPHONE"),active:!!this.syncInfo.iphone.active,connected:!!this.syncInfo.iphone.connected,syncDate:this.syncInfo.iphone.syncDate,connectHandler:BX.delegate(function(e){this.connectIphone();return BX.PreventDefault(e||window.event)},this),disconnectHandler:BX.delegate(function(e){this.disconnectIphone();return BX.PreventDefault(e||window.event)},this)},{id:"android",label:BX.message("EC_CAL_SYNC_ANDROID"),active:!!this.syncInfo.android.active,connected:!!this.syncInfo.android.connected,syncDate:this.syncInfo.android.syncDate,connectHandler:BX.delegate(function(e){this.connectAndroid();return BX.PreventDefault(e||window.event)},this),disconnectHandler:BX.delegate(function(e){this.disconnectAndroid();return BX.PreventDefault(e||window.event)},this)},{id:"outlook",label:BX.message("EC_CAL_SYNC_OUTLOOK"),active:!!this.syncInfo.outlook.active&&!BX.browser.IsMac(),connected:!!this.syncInfo.outlook.connected,syncDate:this.syncInfo.outlook.syncDate,connectHandler:BX.delegate(function(e){this.connectOutlook();return BX.PreventDefault(e||window.event)},this),disconnectHandler:BX.delegate(function(e){this.disconnectOutlook();return BX.PreventDefault(e||window.event)},this)},{id:"office365",label:BX.message("EC_CAL_SYNC_OFFICE_365"),active:!!this.syncInfo.office365.active,connected:!!this.syncInfo.office365.connected,syncDate:this.syncInfo.office365.syncDate},{id:"exchange",label:BX.message("EC_CAL_SYNC_EXCHANGE"),active:!!this.syncInfo.exchange.active,connected:!!this.syncInfo.exchange.connected,syncDate:this.syncInfo.exchange.syncDate,connectHandler:function(e){},disconnectHandler:function(e){},refreshHandler:BX.delegate(function(e){this.calendar.request({type:"post",data:{action:"exchange_sync"},handler:BX.delegate(function(e){if(e.result===false)alert(BX.message("EC_BAN_EXCH_NO_SYNC"));else BX.reload()},this)});return BX.PreventDefault(e||window.event)},this)}];this.syncList.forEach(function(e){if(e.active&&e.connected&&e.syncDate){e.syncDate=BX.parseDate(e.syncDate)}e.DOM={}});this.syncList.sort(function(e,n){if(e.active&&e.connected&&n.active&&n.connected&&e.syncDate&&n.syncDate){return n.syncDate.getTime()-e.syncDate.getTime()}if(e.active&&e.connected)return-1;if(n.active&&n.connected)return 1;return 0})},create:function(){this.DOM.wrap=BX.create("DIV",{props:{className:"calendar-slider-calendar-wrap calendar-custom-scroll"}});this.DOM.header=this.DOM.wrap.appendChild(BX.create("DIV",{props:{className:"calendar-slider-header"},html:'<div class="calendar-head-area"><div class="calendar-head-area-inner"><div class="calendar-head-area-title">'+'<span class="calendar-head-area-name">'+BX.message("EC_CAL_SYNC_TITLE")+"</span>"+"</div></div></div>"}));this.DOM.sliderWorkarea=this.DOM.wrap.appendChild(BX.create("DIV",{props:{className:"calendar-slider-workarea"},style:{minWidth:"auto"}}));this.DOM.tableWrap=this.DOM.sliderWorkarea.appendChild(BX.create("DIV",{props:{className:"calendar-slider-content calendar-slider-sync-content"}}));this.DOM.table=this.DOM.tableWrap.appendChild(BX.create("TABLE",{props:{className:"calendar-sync"}}));var e,n,t,a,s,c,i,o,l,d;for(o=0;o<this.syncList.length;o++){d=this.syncList[o];d.DOM={};if(d.active){l=BX.adjust(this.DOM.table.insertRow(-1),{props:{className:"calendar-sync-column"}});e=BX.adjust(l.insertCell(-1),{props:{className:"calendar-sync-cell calendar-sync-cell-icon"}}).appendChild(BX.create("DIV",{props:{className:"calendar-sync-platform-icon calendar-sync-platform-icon-"+this.syncList[o].id}}));n=BX.adjust(l.insertCell(-1),{props:{className:"calendar-sync-cell"}}).appendChild(BX.create("DIV",{props:{className:"calendar-sync-platform-name calendar-sync-cell"},text:this.syncList[o].label}));t=BX.adjust(l.insertCell(-1),{props:{className:"calendar-sync-cell"}});if(d.connected){a=t.appendChild(BX.create("DIV",{props:{className:"calendar-sync-info"}})).appendChild(BX.create("DIV",{props:{className:"calendar-sync-info-inner"}}));s=a.appendChild(BX.create("DIV",{props:{className:"calendar-sync-info-status"},text:BX.message("EC_CAL_SYNC_OK")}));if(d.syncDate){var r=this.calendar.util.formatDateUsable(d.syncDate);if(((new Date).getTime()-d.syncDate.getTime())/this.calendar.util.dayLength<3){r+=" "+this.calendar.util.formatTime(d.syncDate.getHours(),d.syncDate.getMinutes())}c=a.appendChild(BX.create("DIV",{props:{className:"calendar-sync-info-date"},html:r}))}if(d.id=="exchange"&&this.calendar.util.config.bExchange){n.style.cursor="pointer";BX.bind(n,"click",BX.proxy(this.syncExchange,this))}}i=BX.adjust(l.insertCell(-1),{props:{className:"calendar-sync-cell calendar-sync-cell-link"}});if(!d.connected&&d.connectHandler){d.DOM.connectLink=i.appendChild(BX.create("SPAN",{props:{className:"calendar-sync-link"},events:{click:d.connectHandler},text:BX.message("EC_CAL_SYNC_CONNECT")}))}else if(d.connected){if(d.disconnectHandler){d.DOM.disconnectLink=i.appendChild(BX.create("SPAN",{props:{className:"calendar-sync-link"},events:{click:d.disconnectHandler},text:BX.message("EC_CAL_SYNC_DISCONNECT")}))}if(d.refreshHandler){d.DOM.refreshLink=i.appendChild(BX.create("SPAN",{props:{className:"calendar-sync-link"},events:{click:d.refreshHandler},text:BX.message("EC_CAL_SYNC_REFRESH")}))}if(d.disconnectHandler&&d.refreshHandler){BX.addClass(i,"calendar-sync-two-links")}}d.DOM.row=l}}return this.DOM.wrap},syncSectionWithOutlook:function(section){if(section&&section.data.OUTLOOK_JS)try{eval(section.data.OUTLOOK_JS)}catch(e){}},disconnectGoogle:function(e){if(confirm(BX.message("EC_CAL_REMOVE_GOOGLE_SYNC_CONFIRM"))){var n,t=null;for(n=0;n<this.calendar.calDavConnections.length;n++){t=this.calendar.calDavConnections[n];if(t.account_type=="caldav_google_oauth"){break}}if(t&&t.id){this.calendar.request({type:"post",data:{action:"disconnect_google",connectionId:t.id},handler:BX.delegate(function(e){BX.reload()},this)})}}return BX.PreventDefault(e||window.event)},connectOutlook:function(){var e=this.calendar.sectionController.getSectionList(),n=this,t=[],a,s,c;for(s=0;s<e.length;s++){if(e[s].belongsToView()&&e[s].data.OUTLOOK_JS){t.push(e[s])}}if(t.length==1){this.syncSectionWithOutlook(t[0])}else{var i=this.getSyncItem("outlook");if(i){a=[];for(s=0;s<t.length;s++){a.push({id:"bx-calendar-outlook-"+t[s].id,text:BX.util.htmlspecialchars(t[s].name),color:t[s].color,className:"calendar-add-popup-section-menu-item",onclick:function(e){return function(){n.syncSectionWithOutlook(n.calendar.sectionController.getSection(e));n.sectionMenu.close()}}(t[s].id)})}this.sectionMenu=BX.PopupMenu.create("outlookSectionMenu"+this.calendar.id,i.DOM.connectLink,a,{closeByEsc:true,autoHide:true,zIndex:3200,offsetTop:0,offsetLeft:0,angle:true});this.sectionMenu.show();for(s=0;s<this.sectionMenu.menuItems.length;s++){if(this.sectionMenu.menuItems[s].layout.item){c=this.sectionMenu.menuItems[s].layout.item.querySelector(".menu-popup-item-icon");if(c){c.style.backgroundColor=this.sectionMenu.menuItems[s].color}}}}}},connectIphone:function(){this.showSyncHelp("iphone")},connectMacOSX:function(){this.showSyncHelp("macosx")},connectAndroid:function(){this.showSyncHelp("android")},disconnectIphone:function(){this.clearSyncInformation("iphone");var e=this.getSyncItem("iphone");if(e&&e.pDisconnectLink){var n=this;this.showInfoPopup(e.pDisconnectLink,BX.message("EC_CAL_DISCONNECT_IPHONE"),function(){n.syncInfo.iphone.connected=false;n.syncInfo.iphone.syncDate=false})}},disconnectMacOSX:function(){this.clearSyncInformation("mac");var e=this.getSyncItem("macosx");if(e&&e.pDisconnectLink){var n=this;this.showInfoPopup(e.pDisconnectLink,BX.message("EC_CAL_DISCONNECT_MAC"),function(){n.syncInfo.macosx.connected=false;n.syncInfo.macosx.syncDate=false})}},disconnectAndroid:function(){this.clearSyncInformation("android");var e=this.getSyncItem("android");if(e&&e.pDisconnectLink){var n=this;this.showInfoPopup(e.pDisconnectLink,BX.message("EC_CAL_DISCONNECT_ANDROID"),function(){n.syncInfo.android.connected=false;n.syncInfo.android.syncDate=false})}},disconnectOutlook:function(){this.clearSyncInformation("outlook");var e=this.getSyncItem("outlook");if(e&&e.pDisconnectLink){var n=this;this.showInfoPopup(e.pDisconnectLink,BX.message("EC_CAL_DISCONNECT_OUTLOOK"),function(){n.syncInfo.outlook.connected=false;n.syncInfo.outlook.syncDate=false})}},showInfoPopup:function(e,n,t){var a=BX.PopupWindowManager.create(this.id+"-disconnect-popup",e,{autoHide:true,closeByEsc:true,offsetTop:-1,offsetLeft:1,lightShadow:true,content:BX.create("DIV",{props:{className:"bxec-disconnect-popup-wrap"},html:n})});a.show(true);function s(){if(t&&typeof t=="function")t();if(a&&a.destroy){BX.removeCustomEvent(a,"onPopupClose",s);a.destroy();a=null}}BX.addCustomEvent(a,"onPopupClose",s)},buildSyncItem:function(e,n){if(!n)n=this.pWrap;if(e.active){e.pOuter=n.appendChild(BX.create("DIV",{props:{className:"bxec-sect-access-el "+(e.className||"")}}));e.pInner=e.pOuter.appendChild(BX.create("DIV",{props:{className:"bxec-sect-access-el-block"}}));if(!e.connected&&e.connectHandler){e.pConnectLink=e.pInner.appendChild(BX.create("A",{props:{className:"bxec-sect-access-connect-link"},text:BX.message("EC_CAL_SYNC_CONNECT")}));BX.bind(e.pConnectLink,"click",e.connectHandler)}e.pIcon=e.pInner.appendChild(BX.create("DIV",{props:{className:"bxec-sect-access-icon"}}));e.pTextWrap=e.pInner.appendChild(BX.create("DIV",{props:{className:"bxec-sect-access-text-wrap"},text:e.label}));if(!this.brightMode||e.connected)BX.addClass(e.pOuter,"bxec-sect-access-connected");if(e.connected){e.pInner.appendChild(BX.create("DIV",{props:{className:"bxec-sect-access-allowed-icon"}}));e.pInfoCont=e.pOuter.appendChild(BX.create("DIV",{props:{className:"bxec-sect-access-block-info bxec-sect-access-el-block-active"}}));var t=e.pInfoCont.appendChild(BX.create("TABLE",{props:{className:"bxec-sect-access-el-table"}}));var a=t.insertRow(-1);BX.adjust(a.insertCell(-1),{props:{className:"bxec-sect-access-status"},html:BX.message("EC_CAL_SYNC_OK")});var s=BX.adjust(a.insertCell(-1),{style:{textAlign:"right"}});if(e.syncDate){e.pSyncDate=s.appendChild(BX.create("DIV",{props:{className:"bxec-sect-access-status-time"}}));e.pSyncDate.innerHTML=e.syncDate}if(e.disconnectHandler){e.pDisconnectLink=s.appendChild(BX.create("SPAN",{props:{className:"bxec-sect-access-disconnect-link"},html:BX.message("EC_CAL_SYNC_DISCONNECT")}));BX.bind(e.pDisconnectLink,"click",e.disconnectHandler)}if(e.id=="exchange"&&this.calendar.util.config.bExchange){e.pTextWrap.style.cursor="pointer";BX.bind(e.pTextWrap,"click",BX.proxy(this.syncExchange,this))}}}},getSyncItem:function(e){var n;for(n=0;n<this.syncList.length;n++){if(this.syncList[n].active&&this.syncList[n].id==e){return this.syncList[n]}}},showSyncHelp:function(e){var n=[],t;var a=this.syncList.filter(function(n){return n.id==e});if(!a||!a[0])return;a=a[0];if(!a.DOM.helpCell){a.DOM.helpRow=BX.adjust(this.DOM.table.insertRow(a.DOM.row.rowIndex+1),{props:{className:"calendar-sync-column calendar-sync-desc"}});a.DOM.helpCell=BX.adjust(a.DOM.helpRow.insertCell(-1),{attrs:{colspan:"4"},props:{className:"calendar-sync-cell"}}).appendChild(BX.create("DIV",{props:{className:"calendar-sync-help-wrap"}}));if(e=="iphone"){a.DOM.helpCell.innerHTML=BX.message("EC_MOBILE_HELP_IPHONE")}else if(e=="macosx"){a.DOM.helpCell.innerHTML=BX.message("EC_MOBILE_HELP_MAC")}else if(e=="android"){a.DOM.helpCell.innerHTML=BX.message("EC_MOBILE_HELP_ANDROID")}if(e=="iphone"||e=="macosx"){n=n.concat(BX.findChildren(a.DOM.helpCell,{tagName:"SPAN",className:"bxec-link"},true));for(t=0;t<n.length;t++){if(n[t]&&n[t].nodeName){n[t].innerHTML=this.calendar.util.config.caldav_link_all}}}}if(BX.hasClass(a.DOM.helpCell,"open")){BX.removeClass(a.DOM.helpCell,"open");setTimeout(function(){a.DOM.helpRow.style.display="none"},300)}else{a.DOM.helpRow.style.display="";setTimeout(function(){BX.addClass(a.DOM.helpCell,"open")},0)}},clearSyncInformation:function(e){this.calendar.request({type:"post",data:{action:"clear_sync_info",sync_type:e},handler:BX.delegate(function(e){BX.reload()},this)})},showCalDavSyncDialog:function(){if(!this.calDavSyncDialog){var e=this.calendar.id;this.calDavSyncDialog={DOM:{content:BX.create("DIV",{props:{className:"calendar-caldav-popup-wrap"},html:'<div class="bxec-dav-list" id="'+e+'_caldav_list"></div>'})},popup:false};var n=this;this.calDavSyncDialog.popup=new BX.PopupWindow("BXCExternalDialog"+this.id,null,{overlay:{opacity:10},autoHide:false,closeByEsc:true,zIndex:4e3,width:600,offsetLeft:0,offsetTop:0,draggable:true,titleBar:BX.message("EC_CALDAV_TITLE"),closeIcon:{right:"12px",top:"10px"},className:"bxc-popup-window bxc-popup-window-white",contentColor:"white",contentNoPaddings:true,buttons:[new BX.PopupWindowButton({text:BX.message("EC_ADD_CALDAV"),events:{click:function(){n.connections.push({name:BX.message("EC_NEW_CONNECTION_NAME"),link:"",user_name:""});n.displayConnection(n.connections[n.connections.length-1],n.connections.length-1)}}}),new BX.PopupWindowButton({text:BX.message("EC_SEC_SLIDER_SAVE"),className:"popup-window-button-accept",events:{click:function(){if(n.calDavSyncDialog.bLockClosing)return alert(BX.message("EC_CAL_DAV_CON_WAIT"));n.calDavSyncDialog.bLockClosing=true;n.saveCalDavConnections(function(e){n.calDavSyncDialog.bLockClosing=false;if(e){n.calDavSyncDialog.popup.close();BX.reload()}})}}}),new BX.PopupWindowButtonLink({text:BX.message("EC_SEC_SLIDER_CLOSE"),className:"popup-window-button-link-cancel",events:{click:function(){n.calDavSyncDialog.popup.close()}}})],content:this.calDavSyncDialog.DOM.content});BX.addCustomEvent(this.calDavSyncDialog.popup,"onPopupClose",BX.proxy(this.closeCalDavSyncDialog,this))}this.calDavSyncDialog.popup.show();this.calDavSyncDialog.DOM.list=BX(e+"_caldav_list");this.calendar.disableKeyHandler();this.calDavSyncDialog.curEditedConInd=false;BX.cleanNode(this.calDavSyncDialog.DOM.list);this.connections=BX.clone(this.calendar.util.getCalDavConnections());this.connections.forEach(this.displayConnection,this);if(this.connections.length==0){this.connections.push({name:BX.message("EC_NEW_CONNECTION_NAME"),link:"",user_name:""});this.displayConnection(this.connections[this.connections.length-1],this.connections.length-1)}},displayConnection:function(e,n){var t=this,a=this.calendar.id,s,c=this.calDavSyncDialog.DOM.list.appendChild(BX.create("DIV",{props:{id:a+"_dav_con_"+n,className:"calendar-caldav-item"}})),i=c.appendChild(BX.create("DIV",{props:{className:"calendar-caldav-item-title"}})),o=i.appendChild(BX.create("IMG",{props:{src:"/bitrix/images/1.gif",className:"bxec-dav-item-status"}})),l=i.appendChild(BX.create("SPAN",{text:e.name})),d=i.appendChild(BX.create("SPAN",{text:""})),r=i.appendChild(BX.create("A",{props:{href:"javascript: void(0);",className:"bxec-dav-del"},text:BX.message("EC_CALDAV_DEL")}));if(e.id>0&&(e.account_type=="google_api_oauth"||e.account_type=="caldav_google_oauth")){s=c.appendChild(BX.create("DIV",{props:{className:"bxec-dav-new-form"},html:'<div class="calendar-caldav-field-container-wrap">'+'<div  class="calendar-caldav-sections-outer-wrap" id="'+a+"_dav_sections_cont_outer"+n+'">'+'<div class="calendar-caldav-sections-title">'+BX.message("EC_ADD_CALDAV_SECTIONS")+" : </div>"+'<div class="calendar-caldav-sections-wrap" id="'+a+"_dav_sections_cont"+n+'"></div>'+"</div>"+"</div>"}))}else{s=c.appendChild(BX.create("DIV",{props:{className:"bxec-dav-new-form"},html:'<div  class="calendar-caldav-field-container-wrap">'+'<div class="calendar-field-container calendar-field-container-string"><div class="calendar-field-block"><input id="'+a+"_caldav_name"+n+'" type="text" placeholder="'+BX.message("EC_ADD_CALDAV_NAME")+'" class="calendar-field calendar-field-string"></div></div>'+'<div class="calendar-field-container calendar-field-container-string"><div class="calendar-field-block"><input id="'+a+"_caldav_link"+n+'" type="text" placeholder="'+BX.message("EC_ADD_CALDAV_LINK")+'" class="calendar-field calendar-field-string"></div></div>'+'<div class="calendar-field-container calendar-field-container-string"><div class="calendar-field-block"><input id="'+a+"_caldav_username"+n+'" type="text" placeholder="'+BX.message("EC_ADD_CALDAV_USER_NAME")+'" class="calendar-field calendar-field-string"></div></div>'+'<div class="calendar-field-container calendar-field-container-string"><div class="calendar-field-block"><input id="'+a+"_caldav_password"+n+'" type="password" placeholder="'+BX.message("EC_ADD_CALDAV_PASS")+'" class="calendar-field calendar-field-string"></div></div>'+'<div  class="calendar-caldav-sections-outer-wrap" id="'+a+"_dav_sections_cont_outer"+n+'">'+'<div class="calendar-caldav-sections-title">'+BX.message("EC_ADD_CALDAV_SECTIONS")+" : </div>"+'<div class="calendar-caldav-sections-wrap" id="'+a+"_dav_sections_cont"+n+'"></div>'+"</div>"+"</div>"}))}if(e.id>0){if(e.last_result&&e.last_result.indexOf("[200]")>=0){o.className="bxec-dav-item-status bxec-dav-ok";o.title=BX.message("EC_CALDAV_SYNC_OK")+". "+BX.message("EC_CALDAV_SYNC_DATE")+": "+e.sync_date}else{o.className+="bxec-dav-item-status bxec-dav-error";o.title=BX.message("EC_CALDAV_SYNC_ERROR")+": "+e.last_result+". "+BX.message("EC_CALDAV_SYNC_DATE")+": "+e.sync_date}var p=0;e.sections={};this.calendar.sectionController.sections.forEach(function(t){if(t.belongsToView()&&(t.isCalDav()||t.isGoogle())&&t.data.CAL_DAV_CON==e.id){p++;var s=BX(a+"_dav_sections_cont"+n).appendChild(BX.create("DIV",{props:{className:"bxec-dav-sect"}}));e.sections[t.id]={section:t,checkbox:s.appendChild(BX.create("SPAN",{props:{className:"bxec-dav-sect-check"}})).appendChild(BX.create("INPUT",{props:{type:"checkbox",id:a+"_dav_sections_cont"+n+t.id,checked:t.isActive()}}))};s.appendChild(BX.create("SPAN",{props:{className:"bxc-spd-sect-label"},html:'<label for="'+a+"_dav_sections_cont"+n+t.id+'"><span>'+BX.util.htmlspecialchars(t.name)+"</span></label>"}))}},this);d.innerHTML=" ("+p+")";if(p>0){BX(a+"_dav_sections_cont_outer"+n).style.display=""}else{BX(a+"_dav_sections_cont_outer"+n).style.display="none"}r.style.display="inline-block"}else{BX(a+"_dav_sections_cont"+n).style.display="none"}e.nameInput=BX(a+"_caldav_name"+n)||false;e.linkInput=BX(a+"_caldav_link"+n)||false;e.userInput=BX(a+"_caldav_username"+n)||false;e.passInput=BX(a+"_caldav_password"+n)||false;r.onclick=function(n){if(e.id>0&&(e.account_type=="google_api_oauth"||e.account_type=="caldav_google_oauth")){t.disconnectGoogle(n)}else{}return BX.PreventDefault(n)}},saveCalDavConnections:function(e){var n=[];this.connections.forEach(function(e){var t,a={};for(t in e.sections){if(e.sections.hasOwnProperty(t)){a[t]=e.sections[t].checkbox.checked?"Y":"N"}}var s={id:e.id||0,name:e.nameInput?e.nameInput.value:e.name,link:e.linkInput?e.linkInput.value:e.link,user_name:e.userInput?e.userInput.value:e.user_name,pass:e.passInput&&e.passInput.value?e.passInput.value:"bxec_not_modify_pass",del:e.del?"Y":"N",del_calendars:"Y",sections:a};if(!e.id&&(!s.name||!s.user_name||!s.pass))return;n.push(s)},this);this.calendar.request({type:"post",data:{action:"connections_edit",connections:n},handler:BX.delegate(function(n){setTimeout(function(){if(e&&typeof e=="function")e(true)},100);if(n.result===false)alert(BX.message("EC_BAN_EXCH_NO_SYNC"));else BX.reload()},this)});return true},closeCalDavSyncDialog:function(){this.calendar.enableKeyHandler();this.calDavSyncDialog.popup.destroy();this.calDavSyncDialog=null},showICalExportDialog:function(e){var n=this;if(!this.exportDialog){var t=BX.create("DIV",{html:"<span>"+BX.message("EC_EXP_TEXT")+"</span>"});this.exportDialog=new BX.PopupWindow("export_dialog"+this.calendar.id,null,{autoHide:false,closeByEsc:true,zIndex:4e3,offsetLeft:0,offsetTop:0,width:800,draggable:true,titleBar:BX.message("EC_JS_EXPORT_TILE"),closeIcon:{right:"12px",top:"10px"},className:"bxc-popup-window",buttons:[new BX.PopupWindowButtonLink({text:BX.message("EC_SEC_SLIDER_CLOSE"),className:"popup-window-button-link-cancel",events:{click:function(){n.exportDialog.close()}}})],content:t});this.exportDialog.DOM={}}this.exportDialog.show();var a=this.calendar.util.config.path;a+=a.indexOf("?")>=0?"&":"?";if(e&&e.data.EXPORT.LINK){a+="action=export"+e.data.EXPORT.LINK}this.exportDialog.DOM.link=t.appendChild(BX.create("DIV",{props:{className:""}})).appendChild(BX.create("A",{props:{href:a,target:"_blank"},html:a,events:{click:function(e){window.location.href="webcal"+a.substr(a.indexOf("://"));e.preventDefault();e.stopPropagation()}}}));BX.ajax.get(a+"&check=Y","",function(e){setTimeout(function(){if(!e||e.length<=0||e.toUpperCase().indexOf("BEGIN:VCALENDAR")==-1){alert(BX.message("EC_EDEV_EXP_WARN"))}},300)})}};if(window.BXEventCalendar){window.BXEventCalendar.SyncSlider=SyncSlider}else{BX.addCustomEvent(window,"onBXEventCalendarInit",function(){window.BXEventCalendar.SyncSlider=SyncSlider})}})(window);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:60:"/bitrix/js/calendar/new/calendar-util.min.js?152740167517027";s:6:"source";s:40:"/bitrix/js/calendar/new/calendar-util.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
(function(e){function t(e,t,i){this.calendar=e;this.config=t||{};this.additionalParams=i;this.dayLength=864e5;this.type=this.config.type;this.userId=parseInt(this.config.userId);this.ownerId=parseInt(this.config.ownerId);this.accessNames={};if(this.config.accessNames)this.handleAccessNames(this.config.accessNames);this.DATE_FORMAT_BX=BX.message("FORMAT_DATE");this.DATETIME_FORMAT_BX=BX.message("FORMAT_DATETIME");if(this.DATETIME_FORMAT_BX.substr(0,this.DATE_FORMAT_BX.length)==this.DATE_FORMAT_BX)this.TIME_FORMAT_BX=BX.util.trim(this.DATETIME_FORMAT_BX.substr(this.DATE_FORMAT_BX.length));else this.TIME_FORMAT_BX=BX.isAmPmMode()?"H:MI:SS T":"HH:MI:SS";this.TIME_FORMAT_SHORT_BX=this.TIME_FORMAT_BX.replace(":SS","");this.DATE_FORMAT=BX.date.convertBitrixFormat(BX.message("FORMAT_DATE"));this.DATETIME_FORMAT=BX.date.convertBitrixFormat(BX.message("FORMAT_DATETIME"));if(this.DATETIME_FORMAT.substr(0,this.DATE_FORMAT.length)==this.DATE_FORMAT)this.TIME_FORMAT=BX.util.trim(this.DATETIME_FORMAT.substr(this.DATE_FORMAT.length));else this.TIME_FORMAT=BX.date.convertBitrixFormat(BX.isAmPmMode()?"H:MI:SS T":"HH:MI:SS");this.TIME_FORMAT_SHORT=this.TIME_FORMAT.replace(":s","");this.KEY_CODES={backspace:8,enter:13,escape:27,space:32,delete:46,left:37,right:39,up:38,down:40,z:90,y:89,shift:16,ctrl:17,alt:18,cmd:91,cmdRight:93,pageUp:33,pageDown:34}}t.prototype={getEventPath:function(e){var t=this.config.path;t+=(t.indexOf("?")===-1?"?":"&")+"EVENT_ID="+e.id+"&EVENT_DATE="+this.formatDate(e.from);return t},getWeekDays:function(){return this.config.weekDays},getWeekStart:function(){return this.config.weekStart},getWeekEnd:function(){return{MO:"SU",TU:"MO",WE:"TU",TH:"WE",FR:"TH",SA:"FR",SU:"SA"}[this.config.weekStart]},getWeekDayOffset:function(e){if(!this.weekDayOffsetIndex){var t,i=this.getWeekDays();this.weekDayOffsetIndex={};for(t=0;t<i.length;t++)this.weekDayOffsetIndex[i[t][2]]=t}return this.weekDayOffsetIndex[e]},getWeekDayByInd:function(e){return["SU","MO","TU","WE","TH","FR","SA"][e]},isHoliday:function(e){var t;if(!this.weekHolidays){this.weekHolidays={};for(t in this.config.week_holidays){if(this.config.week_holidays.hasOwnProperty(t)){this.weekHolidays[this.config.week_holidays[t]]=true}}this.yearHolidays={};for(t in this.config.year_holidays){if(this.config.year_holidays.hasOwnProperty(t)){this.yearHolidays[this.config.year_holidays[t]]=true}}this.yearWorkdays={};for(t in this.config.year_workdays){if(this.config.year_workdays.hasOwnProperty(t)){this.yearWorkdays[this.config.year_workdays[t]]=true}}}var i=[6,0,1,2,3,4,5][e.getDay()],s=e.getDate(),r=e.getMonth();return(this.weekHolidays[i]||this.yearHolidays[s+"."+r])&&!this.yearWorkdays[s+"."+r]},isToday:function(e){var t=new Date;return t.getDate()==e.getDate()&&t.getMonth()==e.getMonth()&&t.getFullYear()==e.getFullYear()},getWorkTime:function(){this.config.userWorkTime=this.config.userWorkTime||[];if(this.config.userSettings.work_time_start&&this.config.userSettings.work_time_end){this.workTime={start:Math.floor(parseFloat(this.config.userSettings.work_time_start||9)),end:Math.ceil(parseFloat(this.config.userSettings.work_time_end||18))}}else{this.workTime={start:Math.floor(parseFloat(this.config.userWorkTime[0]||9)),end:Math.ceil(parseFloat(this.config.userWorkTime[1]||18))}}this.getWorkTime=BX.proxy(function(){return this.workTime},this);return this.workTime},setWorkTime:function(e){this.workTime={start:Math.min(Math.max(e.start,0),24),end:Math.min(Math.max(e.end,e.start),24)};BX.userOptions.save("calendar","workTime","start",this.workTime.start);BX.userOptions.save("calendar","workTime","end",this.workTime.end);return this.workTime},formatTime:function(e,t,i){if(BX.type.isDate(e)){t=e.getMinutes();e=e.getHours()}var s="";if(i!==true||!BX.isAmPmMode())i=false;if(t==undefined){t="00"}else{t=parseInt(t,10);if(isNaN(t)){t="00"}else{if(t>59)t=59;t=t<10?"0"+t.toString():t.toString()}}e=parseInt(e,10);if(e>24){e=24}if(isNaN(e)){e=0}if(BX.isAmPmMode()){var r="am";if(e==0){e=12}else if(e==12){r="pm"}else if(e>12){r="pm";e-=12}if(i){s=e.toString()+" "+r}else{s=e.toString()+":"+t.toString()+" "+r}}else{s=e.toString()+":"+t.toString()}return s},formatDate:function(e){if(BX.type.isDate(e))e=e.getTime();return BX.date.format(this.DATE_FORMAT,e/1e3)},formatDateTime:function(e){if(BX.type.isDate(e))e=e.getTime();return BX.date.format(this.DATETIME_FORMAT,e/1e3)},formatDateUsable:function(e,t){var i=BX.date.convertBitrixFormat(BX.message("FORMAT_DATE"));if(BX.message("LANGUAGE_ID")=="ru"||BX.message("LANGUAGE_ID")=="ua"){i="j F";if(e.getFullYear&&e.getFullYear()!=(new Date).getFullYear()&&t!==false){i+=" Y"}}return BX.date.format([["today","today"],["tommorow","tommorow"],["yesterday","yesterday"],["",i]],e)},parseTime:function(e){var t=this.parseDate(BX.date.format(this.DATE_FORMAT,new Date)+" "+e,false);return t?{h:t.getHours(),m:t.getMinutes()}:t},parseDate:function(e,t,i){var s,r,n,a,o=false;if(!t)t=BX.message("FORMAT_DATETIME");e=BX.util.trim(e);if(i!==false)t=t.replace(":SS","");if(BX.type.isNotEmptyString(e)){a="";for(s=1;s<=12;s++){a=a+"|"+BX.message("MON_"+s)}var u=new RegExp("([0-9]+|[a-z]+"+a+")","ig"),l=e.match(u),f=BX.message("FORMAT_DATE").match(/(DD|MI|MMMM|MM|M|YYYY)/gi),c=[],h=[],g={};if(!l){return null}if(l.length>f.length){f=t.match(/(DD|MI|MMMM|MM|M|YYYY|HH|H|SS|TT|T|GG|G)/gi)}for(s=0,r=l.length;s<r;s++){if(BX.util.trim(l[s])!=""){c[c.length]=l[s]}}for(s=0,r=f.length;s<r;s++){if(BX.util.trim(f[s])!=""){h[h.length]=f[s]}}var d=BX.util.array_search("MMMM",h);if(d>0){c[d]=BX.getNumMonth(c[d]);h[d]="MM"}else{d=BX.util.array_search("M",h);if(d>0){c[d]=BX.getNumMonth(c[d]);h[d]="MM"}}for(s=0,r=h.length;s<r;s++){n=h[s].toUpperCase();g[n]=n=="T"||n=="TT"?c[s]:parseInt(c[s],10)}if(g["DD"]>0&&g["MM"]>0&&g["YYYY"]>0){var m=new Date;if(o){m.setUTCDate(1);m.setUTCFullYear(g["YYYY"]);m.setUTCMonth(g["MM"]-1);m.setUTCDate(g["DD"]);m.setUTCHours(0,0,0)}else{m.setDate(1);m.setFullYear(g["YYYY"]);m.setMonth(g["MM"]-1);m.setDate(g["DD"]);m.setHours(0,0,0)}if((!isNaN(g["HH"])||!isNaN(g["GG"])||!isNaN(g["H"])||!isNaN(g["G"]))&&!isNaN(g["MI"])){if(!isNaN(g["H"])||!isNaN(g["G"])){var T=(g["T"]||g["TT"]||"am").toUpperCase()=="PM";var p=parseInt(g["H"]||g["G"]||0,10);if(T){g["HH"]=p+(p==12?0:12)}else{g["HH"]=p<12?p:0}}else{g["HH"]=parseInt(g["HH"]||g["GG"]||0,10)}if(isNaN(g["SS"]))g["SS"]=0;if(o){m.setUTCHours(g["HH"],g["MI"],g["SS"])}else{m.setHours(g["HH"],g["MI"],g["SS"])}}return m}}return null},findTargetNode:function(e,t){if(e){var i=false,s="data-bx-calendar",r;if(!t)t=this.calendar.viewsCont;if(e.attributes&&e.attributes.length){for(r=0;r<e.attributes.length;r++){if(e.attributes[r].name&&e.attributes[r].name.substr(0,s.length)==s){i=e;break}}}if(!i){i=BX.findParent(e,function(e){var t;if(e.attributes&&e.attributes.length){for(t=0;t<e.attributes.length;t++){if(e.attributes[t].name&&e.attributes[t].name.substr(0,s.length)==s)return true}}return false},t)}}return i},getViewHeight:function(){var e=756,t=BX.GetWindowInnerSize(document).innerHeight-300;return Math.max(e,t)},showWeekNumber:function(){return this.getUserOption("showWeekNumbers","N")=="Y"},getScrollbarWidth:function(){var e=this.calendar.mainCont.appendChild(BX.create("DIV",{props:{className:"calendar-tmp-outer"}})),t=e.offsetWidth;e.style.overflow="scroll";var i=e.appendChild(BX.create("DIV",{props:{className:"calendar-tmp-inner"}})),s=i.offsetWidth,r=t-s;BX.cleanNode(e,true);this.getScrollbarWidth=function(){return r};return r},getMessagePlural:function(e,t){var i,s;s=BX.message("LANGUAGE_ID")||"en";t=parseInt(t);if(t<0){t=-1*t}if(s){switch(s){case"de":case"en":i=t!==1?1:0;break;case"ru":case"ua":i=t%10===1&&t%100!==11?0:t%10>=2&&t%10<=4&&(t%100<10||t%100>=20)?1:2;break;default:i=1;break}}else{i=1}return BX.message(e+"_PLURAL_"+i)},getUserOption:function(e,t){if(this.config.userSettings[e]===undefined)return t;return this.config.userSettings[e]},setUserOption:function(e,t){if(this.config.userSettings[e]!==t){BX.userOptions.save("calendar","user_settings",e,t);this.config.userSettings[e]=t}},getKeyCodes:function(){return this.KEY_CODES},getMousePos:function(t){if(!t)t=e.event;var i=0,s=0;if(t.pageX||t.pageY){i=t.pageX;s=t.pageY}else if(t.clientX||t.clientY){i=t.clientX+(document.documentElement.scrollLeft||document.body.scrollLeft)-document.documentElement.clientLeft;s=t.clientY+(document.documentElement.scrollTop||document.body.scrollTop)-document.documentElement.clientTop}return{x:i,y:s}},getDayCode:function(e){return e.getFullYear()+"-"+("0"+~~(e.getMonth()+1)).substr(-2,2)+"-"+("0"+~~e.getDate()).substr(-2,2)},getTextColor:function(e){if(!e)return false;if(e.charAt(0)=="#")e=e.substring(1,7);var t=parseInt(e.substring(0,2),16),i=parseInt(e.substring(2,4),16),s=parseInt(e.substring(4,6),16),r=(t*.8+i+s*.2)/510*100;return r<50},getTimeValue:function(e){return e.getHours()+Math.round(e.getMinutes()*100/60)/100},getTimeEx:function(e){return Math.round(e.getTime()/6e4)*6e4},getTimeByFraction:function(e,t){t=t||5;e=Math.min(Math.max(e,0),24);var i=true,s=Math.floor(e),r=i?Math.floor((e-s)*60/t)*t:Math.round((e-s)*60/t)*t;if(r==60){r=0;s++}if(s==24&&r==0){s=23;r=59}return{h:s,m:r}},getWeekNumberInMonthByDate:function(e){var t=new Date;t.setFullYear(e.getFullYear(),e.getMonth(),1);return parseInt(BX.date.format("W",e.getTime()/1e3))-parseInt(BX.date.format("W",t.getTime()/1e3))},getRemindersList:function(){if(!this.reminderList){this.reminderList=[{value:0,label:BX.message("EC_REMIND_0"),shortLabel:BX.message("EC_REMIND_SHORT_0")},{value:5,label:BX.message("EC_REMIND_5"),shortLabel:BX.message("EC_REMIND_SHORT_5")},{value:10,label:BX.message("EC_REMIND_10"),shortLabel:BX.message("EC_REMIND_SHORT_10")},{value:15,label:BX.message("EC_REMIND_15"),shortLabel:BX.message("EC_REMIND_SHORT_15")},{value:30,label:BX.message("EC_REMIND_30"),shortLabel:BX.message("EC_REMIND_SHORT_30")},{value:60,label:BX.message("EC_REMIND_60"),shortLabel:BX.message("EC_REMIND_SHORT_60")},{value:120,label:BX.message("EC_REMIND_120"),shortLabel:BX.message("EC_REMIND_SHORT_120")},{value:1440,label:BX.message("EC_REMIND_1440"),shortLabel:BX.message("EC_REMIND_SHORT_1440")},{value:2880,label:BX.message("EC_REMIND_2880"),shortLabel:BX.message("EC_REMIND_SHORT_2880")}]}return this.reminderList},getSimpleTimeList:function(){var e,t=[];for(e=0;e<24;e++){t.push({value:e*60,label:this.formatTime(e,0)});t.push({value:e*60+30,label:this.formatTime(e,30)})}this.getSimpleTimeList=function(){return t};return t},adaptTimeValue:function(e){e=parseInt(e.h*60)+parseInt(e.m);var t=this.getSimpleTimeList(),i=24*60,s=false,r;for(r=0;r<t.length;r++){if(Math.abs(t[r].value-e)<i){i=Math.abs(t[r].value-e);s=r;if(i<=15)break}}return t[s||0]},getMeetingRoomList:function(){return this.config.meetingRooms||[]},getLocationList:function(){return this.additionalParams.locationList||[]},setLocationList:function(e){this.additionalParams.locationList=e},mergeSocnetDestinationConfig:function(e){if(e.USERS){for(var t in e.USERS){if(e.USERS.hasOwnProperty(t)&&!this.additionalParams["socnetDestination"].USERS[t]){this.additionalParams["socnetDestination"].USERS[t]=e.USERS[t]}}}},getSocnetDestinationConfig:function(e){var t,i=this.additionalParams["socnetDestination"]||{};if(e=="items"){t={users:i.USERS||{},groups:i.EXTRANET_USER=="Y"||i.DENY_TOALL?{}:{UA:{id:"UA",name:i.DEPARTMENT?BX.message("EC_SOCNET_DESTINATION_4"):BX.message("EC_SOCNET_DESTINATION_3")}},sonetgroups:i.SONETGROUPS||{},department:i.DEPARTMENT||{},departmentRelation:i.DEPARTMENT_RELATION||{}}}else if(e=="itemsLast"&&i.LAST){t={users:i.LAST.USERS||{},groups:i.EXTRANET_USER=="Y"?{}:{UA:true},sonetgroups:i.LAST.SONETGROUPS||{},department:i.LAST.DEPARTMENT||{}}}else if(e=="itemsSelected"){t=i.SELECTED||{}}return t||{}},getActionUrl:function(){return this.config.actionUrl},getTimezoneList:function(){return this.additionalParams.timezoneList||[]},getDefaultColors:function(){return this.additionalParams.defaultColorsList},getFormSettings:function(e){return this.additionalParams.formSettings&&this.additionalParams.formSettings[e]?this.additionalParams.formSettings[e]:{}},saveFormSettings:function(e,t){if(e){BX.userOptions.save("calendar",e,"pinnedFields",t.pinnedFields)}},randomInt:function(e,t){return Math.round(e-.5+Math.random()*(t-e+1))},handleAccessNames:function(e){for(var t in e){if(e.hasOwnProperty(t)){this.accessNames[t]=e[t]}}},getAccessName:function(e){return this.accessNames[e]||e},getSectionAccessTasks:function(){return this.config.sectionAccessTasks},getTypeAccessTasks:function(){return this.config.typeAccessTasks},getDefaultTypeAccessTask:function(){var e,t=this.getTypeAccessTasks();for(e in t){if(t.hasOwnProperty(e)&&t[e].name=="calendar_type_view"){break}}this.getDefaultTypeAccessTask=function(){return e};return e},getDefaultSectionAccessTask:function(){var e,t=this.getSectionAccessTasks();for(e in t){if(t.hasOwnProperty(e)&&t[e].name=="calendar_view"){break}}this.getDefaultSectionAccessTask=function(){return e};return e},getSuperposedTrackedUsers:function(){return(this.config.trackingUsersList||[]).sort(function(e,t){if(!e.LAST_NAME)e.LAST_NAME="";if(!t.LAST_NAME)t.LAST_NAME="";return e.LAST_NAME.localeCompare(t.LAST_NAME)})},getSuperposedTrackedGroups:function(){return this.config.trackingGroupList||[]},isUserCalendar:function(){return this.type==="user"},isGroupCalendar:function(){return this.type==="group"},userIsOwner:function(){return this.isUserCalendar()&&this.userId===this.ownerId},hexToRgb:function(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null},hexToRgba:function(e,t){var i=this.hexToRgb(e);if(!i)i=this.hexToRgb("#9dcf00");return"rgba("+i.r+", "+i.g+", "+i.b+", "+t+")"},parseLocation:function(e){if(!e)e="";var t,i={type:false,value:false,str:e};if(e.length>5&&e.substr(0,5)=="ECMR_"){i.type="mr";t=e.split("_");if(t.length>=2){if(!isNaN(parseInt(t[1]))&&parseInt(t[1])>0){i.value=i.mrid=parseInt(t[1])}if(!isNaN(parseInt(t[2]))&&parseInt(t[2])>0){i.mrevid=parseInt(t[2])}}}else if(e.length>5&&e.substr(0,9)=="calendar_"){i.type="calendar";t=e.split("_");if(t.length>=2){if(!isNaN(parseInt(t[1]))&&parseInt(t[1])>0){i.value=i.room_id=parseInt(t[1])}if(!isNaN(parseInt(t[2]))&&parseInt(t[2])>0){i.room_event_id=parseInt(t[2])}}}return i},getTextLocation:function(e){var t=typeof e==="object"?e:this.parseLocation(e),i,s=t.str;if(t.type=="mr"){var r=this.calendar.util.getMeetingRoomList();for(i=0;i<r.length;i++){if(t.value==r[i].ID){s=r[i].NAME;break}}}if(t.type=="calendar"){var n=this.calendar.util.getLocationList();for(i=0;i<n.length;i++){if(t.value==n[i].ID){s=n[i].NAME;break}}}return s},getTextReminder:function(e){if(BX.util.in_array(e,[0,5,10,15,30,60,120,1440,2880])){return BX.message("EC_REMIND_SHORT_"+e)}return""},getEditTaskPath:function(){return this.config.editTaskPath},getViewTaskPath:function(e){return this.config.viewTaskPath.replace("#task_id#",e)},readOnlyMode:function(){this.readOnly=this.config.readOnly;if(!this.readOnly){var e=this.calendar.sectionController.getSectionListForEdit();if(!e||!e.length)this.readOnly=true}this.readOnlyMode=BX.proxy(function(){return this.readOnly},this);return this.readOnly},getLoader:function(e){var t=e?'style="width: '+parseInt(e)+"px; height: "+parseInt(e)+'px;"':"";return BX.create("DIV",{props:{className:"calendar-loader"},html:'<svg class="calendar-loader-circular"'+t+' viewBox="25 25 50 50">'+'<circle class="calendar-loader-path" cx="50" cy="50" r="20" fill="none" stroke-miterlimit="10"/>'+'<circle class="calendar-loader-inner-path" cx="50" cy="50" r="20" fill="none" stroke-miterlimit="10"/>'+"</svg>"})},applyHacksForPopupzIndex:function(){var e=3200;if(BX.PopupMenu&&BX.PopupMenu.Data){for(var t in BX.PopupMenu.Data){if(BX.PopupMenu.Data.hasOwnProperty(t)&&BX.PopupMenu.Data[t].popupWindow&&BX.PopupMenu.Data[t].popupWindow.isShown()){BX.PopupMenu.Data[t].popupWindow.params.zIndex=e;BX.PopupMenu.Data[t].popupWindow.popupContainer.style.zIndex=e}}}},applyHacksHandlersForPopupzIndex:function(){var e=this,t=3200;BX.addCustomEvent("onPopupShow",function(i){if(e.calendar.viewSlider&&e.calendar.viewSlider.isOpened()||e.calendar.editSlider&&e.calendar.editSlider.isOpened()){i.params.zIndex=t;i.popupContainer.style.zIndex=t}})},isFilterEnabled:function(){return this.userIsOwner()&&this.config.counters},getCalDavConnections:function(){return this.config.connections||[]},isRichLocationEnabled:function(){return!!this.config.locationFeatureEnabled},isDarkColor:function(e){e=e.toLowerCase();if({"#9dcf00":true,"#2FC6F6":true,"#56D1E0":true,"#FFA900":true,"#47E4C2":true,"#F87396":true,"#9985DD":true,"#A8ADB4":true,"#AF7E00":true}[e])return false;if(!e)return false;if(e.charAt(0)=="#")e=e.substring(1,7);var t=parseInt(e.substring(0,2),16),i=parseInt(e.substring(2,4),16),s=parseInt(e.substring(4,6),16),r=(t*.8+i+s*.2)/510*100;return r<50}};if(e.BXEventCalendar){e.BXEventCalendar.Util=t}else{BX.addCustomEvent(e,"onBXEventCalendarInit",function(){e.BXEventCalendar.Util=t})}})(window);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:61:"/bitrix/js/calendar/new/calendar-search.min.js?15274016753418";s:6:"source";s:42:"/bitrix/js/calendar/new/calendar-search.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
(function(e){function t(e,t){this.calendar=e;this.util=this.calendar.util;this.filterId=t.filterId;this.minSearchStringLength=2;this.showCounters=false;this.counters=[{id:"invitation",className:"calendar-counter-invitation",pluralMessageId:"EC_COUNTER_INVITATION",value:t.counters.invitation||0}];this.filter=BX.Main.filterManager.getById(this.filterId);if(this.filter){this.filterApi=this.filter.getApi();BX.addCustomEvent("BX.Main.Filter:beforeApply",BX.delegate(this.beforeFilterApply,this));BX.addCustomEvent("BX.Main.Filter:apply",BX.delegate(this.applyFilter,this))}}t.prototype={getFilter:function(){return this.filter},updateCounters:function(){var e,t=this;this.showCounters=false;BX.cleanNode(this.calendar.countersCont);this.countersWrap=this.calendar.countersCont.appendChild(BX.create("DIV",{props:{className:"calendar-counter-title"}}));for(e=0;e<this.counters.length;e++){if(this.counters[e]&&this.counters[e].value>0){this.showCounters=true;break}}if(this.showCounters){this.countersWrap.appendChild(BX.create("span",{props:{className:"calendar-counter-page-name"},text:BX.message("EC_COUNTER_TOTAL")+":"}));for(e=0;e<this.counters.length;e++){if(this.counters[e]&&this.counters[e].value>0){this.countersWrap.appendChild(BX.create("span",{props:{className:"calendar-counter-container"+" "+this.counters[e].className},attrs:{"data-bx-counter":this.counters[e].id},html:'<span class="calendar-counter-inner">'+'<span class="calendar-counter-number">'+this.counters[e].value+"</span>"+'<span class="calendar-counter-text">'+this.util.getMessagePlural(this.counters[e].pluralMessageId,this.counters[e].value)+"</span>"+"</span>",events:{click:function(e){return function(){t.appplyCounterEntries(e.id)}}(this.counters[e])}}))}}}else{this.countersWrap.innerHTML=BX.message("EC_NO_COUNTERS")}},appplyCounterEntries:function(e){if(e=="invitation"){this.filterApi.setFilter({preset_id:"filter_calendar_meeting_status_q"})}},beforeFilterApply:function(){if(!this.isFilterEmpty()){}},applyFilter:function(e,t,i,s,n){n.autoResolve=false;if(this.isFilterEmpty()){if(this.calendar.getView().resetFilterMode){this.calendar.getView().resetFilterMode({resetSearchFilter:false})}s.fulfill()}else{this.calendar.setView("list",{animation:false});setTimeout(BX.delegate(function(){this.calendar.getView().applyFilterMode()},this),100);this.calendar.request({data:{action:"get_filter_data"},handler:BX.delegate(function(e){if(e&&e.entries){if(!this.calendar.getView().filterMode){setTimeout(BX.delegate(function(){this.calendar.getView().applyFilterMode();this.displaySearchResult(e)},this),100)}else{this.displaySearchResult(e)}}s.fulfill()},this)})}},displaySearchResult:function(t){var i,s=[];for(i=0;i<t.entries.length;i++){s.push(new e.BXEventCalendar.Entry(this.calendar,t.entries[i]))}this.calendar.getView().displayResult(s);if(BX.type.isPlainObject(t.counters)){for(i=0;i<this.counters.length;i++){if(t.counters[this.counters[i].id]!==undefined){this.counters[i].value=t.counters[this.counters[i].id]||0}}this.updateCounters()}},isFilterEmpty:function(){var e=this.filter.getSearch();return!e.getLastSquare()&&(!e.getSearchString()||e.getSearchString().length<this.minSearchStringLength)},searchInput:function(){},resetFilter:function(){this.filter.resetFilter()}};if(e.BXEventCalendar){e.BXEventCalendar.Search=t}else{BX.addCustomEvent(e,"OnBXEventCalendarInit",function(){e.BXEventCalendar.Search=t})}})(window);
/* End */
;